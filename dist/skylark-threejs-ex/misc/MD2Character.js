/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../loaders/MD2Loader"],function(e,i){return e.MD2Character=function(){var i=this;function t(i,t){for(var s=new e.TextureLoader,n=[],o=0;o<t.length;o++)n[o]=s.load(i+t[o],a),n[o].mapping=e.UVMapping,n[o].name=t[o],n[o].encoding=e.sRGBEncoding;return n}function s(i,t){var s=new e.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),a=new e.MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),n=new e.Mesh(i,a);return n.rotation.y=-Math.PI/2,n.castShadow=!0,n.receiveShadow=!0,n.materialTexture=a,n.materialWireframe=s,n}function a(){i.loadCounter-=1,0===i.loadCounter&&i.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new e.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(n){this.loadCounter=2*n.weapons.length+n.skins.length+1;for(var o=[],h=0;h<n.weapons.length;h++)o[h]=n.weapons[h][1];this.skinsBody=t(n.baseUrl+"skins/",n.skins),this.skinsWeapon=t(n.baseUrl+"skins/",o);var r=new e.MD2Loader;r.load(n.baseUrl+n.body,function(t){var n=new e.Box3;n.setFromBufferAttribute(t.attributes.position),i.root.position.y=-i.scale*n.min.y;var o=s(t,i.skinsBody[0]);o.scale.set(i.scale,i.scale,i.scale),i.root.add(o),i.meshBody=o,i.meshBody.clipOffset=0,i.activeAnimationClipName=o.geometry.animations[0].name,i.mixer=new e.AnimationMixer(o),a()});var m=function(e,t){return function(n){var o=s(n,i.skinsWeapon[e]);o.scale.set(i.scale,i.scale,i.scale),o.visible=!1,o.name=t,i.root.add(o),i.weapons[e]=o,i.meshWeapon=o,a()}};for(h=0;h<n.weapons.length;h++)r.load(n.baseUrl+n.weapons[h][0],m(h,n.weapons[h][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(e){for(var t=0;t<this.weapons.length;t++)this.weapons[t].visible=!1;var s=this.weapons[e];s&&(s.visible=!0,this.meshWeapon=s,i.syncWeaponAnimation())},this.setAnimation=function(e){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var t=this.mixer.clipAction(e,this.meshBody);t&&(this.meshBody.activeAction=t.play())}i.activeClipName=e,i.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var e=i.activeClipName;if(i.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var t=this.mixer.clipAction(e,this.meshWeapon);t&&(this.meshWeapon.activeAction=t.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}},e.MD2Character});
//# sourceMappingURL=../sourcemaps/misc/MD2Character.js.map
