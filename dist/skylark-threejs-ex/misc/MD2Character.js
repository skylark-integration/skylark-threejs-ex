/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../loaders/MD2Loader"],function(e,i){"use strict";return function(){var t=this;function s(i,t){for(var s=new e.TextureLoader,a=[],o=0;o<t.length;o++)a[o]=s.load(i+t[o],n),a[o].mapping=e.UVMapping,a[o].name=t[o],a[o].encoding=e.sRGBEncoding;return a}function a(i,t){var s=new e.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),a=new e.MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),n=new e.Mesh(i,a);return n.rotation.y=-Math.PI/2,n.castShadow=!0,n.receiveShadow=!0,n.materialTexture=a,n.materialWireframe=s,n}function n(){t.loadCounter-=1,0===t.loadCounter&&t.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new e.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(o){this.loadCounter=2*o.weapons.length+o.skins.length+1;for(var h=[],r=0;r<o.weapons.length;r++)h[r]=o.weapons[r][1];this.skinsBody=s(o.baseUrl+"skins/",o.skins),this.skinsWeapon=s(o.baseUrl+"skins/",h);var m=new i;m.load(o.baseUrl+o.body,function(i){var s=new e.Box3;s.setFromBufferAttribute(i.attributes.position),t.root.position.y=-t.scale*s.min.y;var o=a(i,t.skinsBody[0]);o.scale.set(t.scale,t.scale,t.scale),t.root.add(o),t.meshBody=o,t.meshBody.clipOffset=0,t.activeAnimationClipName=o.geometry.animations[0].name,t.mixer=new e.AnimationMixer(o),n()});var l=function(e,i){return function(s){var o=a(s,t.skinsWeapon[e]);o.scale.set(t.scale,t.scale,t.scale),o.visible=!1,o.name=i,t.root.add(o),t.weapons[e]=o,t.meshWeapon=o,n()}};for(r=0;r<o.weapons.length;r++)m.load(o.baseUrl+o.weapons[r][0],l(r,o.weapons[r][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(e){for(var i=0;i<this.weapons.length;i++)this.weapons[i].visible=!1;var s=this.weapons[e];s&&(s.visible=!0,this.meshWeapon=s,t.syncWeaponAnimation())},this.setAnimation=function(e){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var i=this.mixer.clipAction(e,this.meshBody);i&&(this.meshBody.activeAction=i.play())}t.activeClipName=e,t.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var e=t.activeClipName;if(t.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var i=this.mixer.clipAction(e,this.meshWeapon);i&&(this.meshWeapon.activeAction=i.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}}});
//# sourceMappingURL=../sourcemaps/misc/MD2Character.js.map
