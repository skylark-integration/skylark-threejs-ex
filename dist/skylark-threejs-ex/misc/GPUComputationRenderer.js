/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex"],function(e,r){"use strict";return r.misc.GPUComputationRenderer=function(r,t,n){this.variables=[],this.currentTextureIndex=0;var a=new e.Scene,i=new e.Camera;i.position.z=1;var s={passThruTexture:{value:null}},u=o("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",s),l=new e.Mesh(new e.PlaneBufferGeometry(2,2),u);function d(e){e.defines.resolution="vec2( "+r.toFixed(1)+", "+t.toFixed(1)+" )"}function o(r,t){t=t||{};var n=new e.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:r});return d(n),n}a.add(l),this.addVariable=function(r,t,n){var a={name:r,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:e.NearestFilter,magFilter:e.NearestFilter};return this.variables.push(a),a},this.setVariableDependencies=function(e,r){e.dependencies=r},this.init=function(){if(!n.capabilities.isWebGL2&&!n.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var e=0;e<this.variables.length;e++){var a=this.variables[e];a.renderTargets[0]=this.createRenderTarget(r,t,a.wrapS,a.wrapT,a.minFilter,a.magFilter),a.renderTargets[1]=this.createRenderTarget(r,t,a.wrapS,a.wrapT,a.minFilter,a.magFilter),this.renderTexture(a.initialValueTexture,a.renderTargets[0]),this.renderTexture(a.initialValueTexture,a.renderTargets[1]);var i=a.material,s=i.uniforms;if(null!==a.dependencies)for(var u=0;u<a.dependencies.length;u++){var l=a.dependencies[u];if(l.name!==a.name){for(var d=!1,o=0;o<this.variables.length;o++)if(l.name===this.variables[o].name){d=!0;break}if(!d)return"Variable dependency not found. Variable="+a.name+", dependency="+l.name}s[l.name]={value:null},i.fragmentShader="\nuniform sampler2D "+l.name+";\n"+i.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,r=0===this.currentTextureIndex?1:0,t=0,n=this.variables.length;t<n;t++){var a=this.variables[t];if(null!==a.dependencies)for(var i=a.material.uniforms,s=0,u=a.dependencies.length;s<u;s++){var l=a.dependencies[s];i[l.name].value=l.renderTargets[e].texture}this.doRenderTarget(a.material,a.renderTargets[r])}this.currentTextureIndex=r},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=d,this.createShaderMaterial=o,this.createRenderTarget=function(n,a,i,s,u,l){return n=n||r,a=a||t,i=i||e.ClampToEdgeWrapping,s=s||e.ClampToEdgeWrapping,u=u||e.NearestFilter,l=l||e.NearestFilter,new e.WebGLRenderTarget(n,a,{wrapS:i,wrapT:s,minFilter:u,magFilter:l,format:e.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?e.HalfFloatType:e.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var n=new Float32Array(r*t*4);return new e.DataTexture(n,r,t,e.RGBAFormat,e.FloatType)},this.renderTexture=function(e,r){s.passThruTexture.value=e,this.doRenderTarget(u,r),s.passThruTexture.value=null},this.doRenderTarget=function(e,r){var t=n.getRenderTarget();l.material=e,n.setRenderTarget(r),n.render(a,i),l.material=u,n.setRenderTarget(t)}}});
//# sourceMappingURL=../sourcemaps/misc/GPUComputationRenderer.js.map
