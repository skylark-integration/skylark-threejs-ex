/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex"],function(t,i){"use strict";var a=function(i,a){t.Mesh.call(this,i,a),this.animationsMap={},this.animationsList=[];var n=Object.keys(this.morphTargetDictionary).length,r=n-1,e=n/1;this.createAnimation("__default",0,r,e),this.setAnimationWeight("__default",1)};return a.prototype=Object.assign(Object.create(t.Mesh.prototype),{constructor:a,createAnimation:function(t,i,a,n){var r={start:i,end:a,length:a-i+1,fps:n,duration:(a-i)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=r,this.animationsList.push(r)},autoCreateAnimations:function(t){var i,a=/([a-z]+)_?(\d+)/i,n={},r=0;for(var e in this.morphTargetDictionary){var o=e.match(a);if(o&&o.length>1)n[s=o[1]]||(n[s]={start:1/0,end:-1/0}),r<(m=n[s]).start&&(m.start=r),r>m.end&&(m.end=r),i||(i=s);r++}for(var s in n){var m=n[s];this.createAnimation(s,m.start,m.end,t)}this.firstAnimation=i},setAnimationDirectionForward:function(t){var i=this.animationsMap[t];i&&(i.direction=1,i.directionBackwards=!1)},setAnimationDirectionBackward:function(t){var i=this.animationsMap[t];i&&(i.direction=-1,i.directionBackwards=!0)},setAnimationFPS:function(t,i){var a=this.animationsMap[t];a&&(a.fps=i,a.duration=(a.end-a.start)/a.fps)},setAnimationDuration:function(t,i){var a=this.animationsMap[t];a&&(a.duration=i,a.fps=(a.end-a.start)/a.duration)},setAnimationWeight:function(t,i){var a=this.animationsMap[t];a&&(a.weight=i)},setAnimationTime:function(t,i){var a=this.animationsMap[t];a&&(a.time=i)},getAnimationTime:function(t){var i=0,a=this.animationsMap[t];return a&&(i=a.time),i},getAnimationDuration:function(t){var i=-1,a=this.animationsMap[t];return a&&(i=a.duration),i},playAnimation:function(t){var i=this.animationsMap[t];i?(i.time=0,i.active=!0):console.warn("MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},stopAnimation:function(t){var i=this.animationsMap[t];i&&(i.active=!1)},update:function(i){for(var a=0,n=this.animationsList.length;a<n;a++){var r=this.animationsList[a];if(r.active){var e=r.duration/r.length;r.time+=r.direction*i,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.start+t.MathUtils.clamp(Math.floor(r.time/e),0,r.length-1),s=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var m=r.time%e/e;r.directionBackwards&&(m=1-m),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=m*s,this.morphTargetInfluences[r.lastFrame]=(1-m)*s):this.morphTargetInfluences[r.currentFrame]=s}}}}),i.misc.MorphBlendMesh=a});
//# sourceMappingURL=../sourcemaps/misc/MorphBlendMesh.js.map
