/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../postprocessing/Pass","../shaders/BokehShader"],function(e,r,t){"use strict";var a=function(a,i,s){r.call(this),this.scene=a,this.camera=i;var l=void 0!==s.focus?s.focus:1,n=void 0!==s.aspect?s.aspect:i.aspect,h=void 0!==s.aperture?s.aperture:.025,o=void 0!==s.maxblur?s.maxblur:1,d=s.width||window.innerWidth||1,u=s.height||window.innerHeight||1;this.renderTargetDepth=new e.WebGLRenderTarget(d,u,{minFilter:e.NearestFilter,magFilter:e.NearestFilter,stencilBuffer:!1}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new e.MeshDepthMaterial,this.materialDepth.depthPacking=e.RGBADepthPacking,this.materialDepth.blending=e.NoBlending,void 0===t&&console.error("BokehPass relies on BokehShader");var c=t,p=e.UniformsUtils.clone(c.uniforms);p.tDepth.value=this.renderTargetDepth.texture,p.focus.value=l,p.aspect.value=n,p.aperture.value=h,p.maxblur.value=o,p.nearClip.value=i.near,p.farClip.value=i.far,this.materialBokeh=new e.ShaderMaterial({defines:Object.assign({},c.defines),uniforms:p,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this.uniforms=p,this.needsSwap=!1,this.fsQuad=new r.FullScreenQuad(this.materialBokeh),this.oldClearColor=new e.Color};return a.prototype=Object.assign(Object.create(r.prototype),{constructor:a,render:function(e,r,t){this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),i=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=t.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(a),e.autoClear=i}}),a});
//# sourceMappingURL=../sourcemaps/postprocessing/BokehPass.js.map
