/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex"],function(e,t){"use strict";var n=function(){e.Object3D.call(this),this.type="TransformControlsGizmo";var t=new e.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:e.DoubleSide,fog:!1}),n=new e.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),i=t.clone();i.opacity=.15;var o=t.clone();o.opacity=.33;var a=t.clone();a.color.set(16711680);var r=t.clone();r.color.set(65280);var s=t.clone();s.color.set(255);var l=t.clone();l.opacity=.25;var h=l.clone();h.color.set(16776960);var c=l.clone();c.color.set(65535);var w=l.clone();w.color.set(16711935),t.clone().color.set(16776960);var u=n.clone();u.color.set(16711680);var p=n.clone();p.color.set(65280);var y=n.clone();y.color.set(255);var m=n.clone();m.color.set(65535);var M=n.clone();M.color.set(16711935);var d=n.clone();d.color.set(16776960);var f=n.clone();f.color.set(7895160);var v=d.clone();v.opacity=.25;var b=new e.CylinderBufferGeometry(0,.05,.2,12,1,!1),P=new e.BoxBufferGeometry(.125,.125,.125),B=new e.BufferGeometry;B.setAttribute("position",new e.Float32BufferAttribute([0,0,0,1,0,0],3));var I,X=function(t,n){for(var i=new e.BufferGeometry,o=[],a=0;a<=64*n;++a)o.push(0,Math.cos(a/32*Math.PI)*t,Math.sin(a/32*Math.PI)*t);return i.setAttribute("position",new e.Float32BufferAttribute(o,3)),i},G={X:[[new e.Mesh(b,a),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new e.Mesh(b,a),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new e.Line(B,u)]],Y:[[new e.Mesh(b,r),[0,1,0],null,null,"fwd"],[new e.Mesh(b,r),[0,1,0],[Math.PI,0,0],null,"bwd"],[new e.Line(B,p),null,[0,0,Math.PI/2]]],Z:[[new e.Mesh(b,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new e.Mesh(b,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new e.Line(B,y),null,[0,-Math.PI/2,0]]],XYZ:[[new e.Mesh(new e.OctahedronBufferGeometry(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new e.Mesh(new e.PlaneBufferGeometry(.295,.295),h.clone()),[.15,.15,0]],[new e.Line(B,d),[.18,.3,0],null,[.125,1,1]],[new e.Line(B,d),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new e.Mesh(new e.PlaneBufferGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new e.Line(B,m),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new e.Line(B,m),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new e.Mesh(new e.PlaneBufferGeometry(.295,.295),w.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new e.Line(B,M),[.18,0,.3],null,[.125,1,1]],[new e.Line(B,M),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},Y={X:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new e.Mesh(new e.OctahedronBufferGeometry(.2,0),i)]],XY:[[new e.Mesh(new e.PlaneBufferGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new e.Mesh(new e.PlaneBufferGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new e.Mesh(new e.PlaneBufferGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},Z={START:[[new e.Mesh(new e.OctahedronBufferGeometry(.01,2),o),null,null,null,"helper"]],END:[[new e.Mesh(new e.OctahedronBufferGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new e.Line((I=new e.BufferGeometry,I.setAttribute("position",new e.Float32BufferAttribute([0,0,0,1,1,1],3)),I),o),null,null,null,"helper"]],X:[[new e.Line(B,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new e.Line(B,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new e.Line(B,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},g={X:[[new e.Line(X(1,.5),u)],[new e.Mesh(new e.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[1,3,1]]],Y:[[new e.Line(X(1,.5),p),null,[0,0,-Math.PI/2]],[new e.Mesh(new e.OctahedronBufferGeometry(.04,0),r),[0,0,.99],null,[3,1,1]]],Z:[[new e.Line(X(1,.5),y),null,[0,Math.PI/2,0]],[new e.Mesh(new e.OctahedronBufferGeometry(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new e.Line(X(1.25,1),v),null,[0,Math.PI/2,0]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),v),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),v),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),v),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),v),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new e.Line(X(1,1),f),null,[0,Math.PI/2,0]]]},x={AXIS:[[new e.Line(B,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={X:[[new e.Mesh(new e.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new e.Mesh(new e.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new e.Mesh(new e.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new e.Mesh(new e.TorusBufferGeometry(1.25,.1,2,24),i)]],XYZE:[[new e.Mesh(new e.SphereBufferGeometry(.7,10,8),i)]]},Q={X:[[new e.Mesh(P,a),[.8,0,0],[0,0,-Math.PI/2]],[new e.Line(B,u),null,null,[.8,1,1]]],Y:[[new e.Mesh(P,r),[0,.8,0]],[new e.Line(B,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new e.Mesh(P,s),[0,0,.8],[Math.PI/2,0,0]],[new e.Line(B,y),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new e.Mesh(P,h),[.85,.85,0],null,[2,2,.2]],[new e.Line(B,d),[.855,.98,0],null,[.125,1,1]],[new e.Line(B,d),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new e.Mesh(P,c),[0,.85,.85],null,[.2,2,2]],[new e.Line(B,m),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new e.Line(B,m),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new e.Mesh(P,w),[.85,0,.85],null,[2,.2,2]],[new e.Line(B,M),[.855,0,.98],null,[.125,1,1]],[new e.Line(B,M),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new e.Mesh(new e.BoxBufferGeometry(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new e.Mesh(new e.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new e.Mesh(new e.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,0,1.1]]]},A={X:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new e.Mesh(P,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new e.Mesh(P,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new e.Mesh(P,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new e.Mesh(new e.BoxBufferGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new e.Mesh(new e.BoxBufferGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new e.Mesh(new e.BoxBufferGeometry(.2,.2,.2),i),[0,0,1.1]]]},C={X:[[new e.Line(B,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new e.Line(B,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new e.Line(B,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},O=function(t){var n=new e.Object3D;for(var i in t)for(var o=t[i].length;o--;){var a=t[i][o][0].clone(),r=t[i][o][1],s=t[i][o][2],l=t[i][o][3],h=t[i][o][4];a.name=i,a.tag=h,r&&a.position.set(r[0],r[1],r[2]),s&&a.rotation.set(s[0],s[1],s[2]),l&&a.scale.set(l[0],l[1],l[2]),a.updateMatrix();var c=a.geometry.clone();c.applyMatrix4(a.matrix),a.geometry=c,a.renderOrder=1/0,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1),n.add(a)}return n},E=new e.Vector3(0,0,0),T=new e.Euler,z=new e.Vector3(0,1,0),S=new e.Vector3(0,0,0),k=new e.Matrix4,q=new e.Quaternion,F=new e.Quaternion,D=new e.Quaternion,j=new e.Vector3(1,0,0),V=new e.Vector3(0,1,0),_=new e.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=O(G)),this.add(this.gizmo.rotate=O(g)),this.add(this.gizmo.scale=O(Q)),this.add(this.picker.translate=O(Y)),this.add(this.picker.rotate=O(L)),this.add(this.picker.scale=O(A)),this.add(this.helper.translate=O(Z)),this.add(this.helper.rotate=O(x)),this.add(this.helper.scale=O(C)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var t=this.space;"scale"===this.mode&&(t="local");var n="local"===t?this.worldQuaternion:D;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var o=0;o<i.length;o++){var a=i[o];a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition);var r=this.worldPosition.distanceTo(this.cameraPosition);if(a.scale.set(1,1,1).multiplyScalar(r*this.size/7),"helper"!==a.tag){if(a.quaternion.copy(n),"translate"===this.mode||"scale"===this.mode){"X"!==a.name&&"XYZX"!==a.name||Math.abs(z.copy(j).applyQuaternion(n).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Y"!==a.name&&"XYZY"!==a.name||Math.abs(z.copy(V).applyQuaternion(n).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Z"!==a.name&&"XYZZ"!==a.name||Math.abs(z.copy(_).applyQuaternion(n).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XY"===a.name&&Math.abs(z.copy(_).applyQuaternion(n).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"YZ"===a.name&&Math.abs(z.copy(j).applyQuaternion(n).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XZ"===a.name&&Math.abs(z.copy(V).applyQuaternion(n).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),-1!==a.name.search("X")&&(z.copy(j).applyQuaternion(n).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.x*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Y")&&(z.copy(V).applyQuaternion(n).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.y*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Z")&&(z.copy(_).applyQuaternion(n).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.z*=-1:"bwd"===a.tag&&(a.visible=!1))}else"rotate"===this.mode&&(F.copy(n),z.copy(this.eye).applyQuaternion(q.copy(n).inverse()),-1!==a.name.search("E")&&a.quaternion.setFromRotationMatrix(k.lookAt(this.eye,S,V)),"X"===a.name&&(q.setFromAxisAngle(j,Math.atan2(-z.y,z.z)),q.multiplyQuaternions(F,q),a.quaternion.copy(q)),"Y"===a.name&&(q.setFromAxisAngle(V,Math.atan2(z.x,z.z)),q.multiplyQuaternions(F,q),a.quaternion.copy(q)),"Z"===a.name&&(q.setFromAxisAngle(_,Math.atan2(z.y,z.x)),q.multiplyQuaternions(F,q),a.quaternion.copy(q)));a.visible=a.visible&&(-1===a.name.indexOf("X")||this.showX),a.visible=a.visible&&(-1===a.name.indexOf("Y")||this.showY),a.visible=a.visible&&(-1===a.name.indexOf("Z")||this.showZ),a.visible=a.visible&&(-1===a.name.indexOf("E")||this.showX&&this.showY&&this.showZ),a.material._opacity=a.material._opacity||a.material.opacity,a.material._color=a.material._color||a.material.color.clone(),a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled?this.axis&&(a.name===this.axis?(a.material.opacity=1,a.material.color.lerp(new e.Color(1,1,1),.5)):this.axis.split("").some(function(e){return a.name===e})?(a.material.opacity=1,a.material.color.lerp(new e.Color(1,1,1),.5)):(a.material.opacity*=.25,a.material.color.lerp(new e.Color(1,1,1),.5))):(a.material.opacity*=.5,a.material.color.lerp(new e.Color(1,1,1),.5))}else a.visible=!1,"AXIS"===a.name?(a.position.copy(this.worldPositionStart),a.visible=!!this.axis,"X"===this.axis&&(q.setFromEuler(T.set(0,0,0)),a.quaternion.copy(n).multiply(q),Math.abs(z.copy(j).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),"Y"===this.axis&&(q.setFromEuler(T.set(0,0,Math.PI/2)),a.quaternion.copy(n).multiply(q),Math.abs(z.copy(V).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),"Z"===this.axis&&(q.setFromEuler(T.set(0,Math.PI/2,0)),a.quaternion.copy(n).multiply(q),Math.abs(z.copy(_).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),"XYZE"===this.axis&&(q.setFromEuler(T.set(0,Math.PI/2,0)),z.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(k.lookAt(S,z,V)),a.quaternion.multiply(q),a.visible=this.dragging),"E"===this.axis&&(a.visible=!1)):"START"===a.name?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):"END"===a.name?(a.position.copy(this.worldPosition),a.visible=this.dragging):"DELTA"===a.name?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),E.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),E.applyQuaternion(this.worldQuaternionStart.clone().inverse()),a.scale.copy(E),a.visible=this.dragging):(a.quaternion.copy(n),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=-1!==this.axis.search(a.name)))}e.Object3D.prototype.updateMatrixWorld.call(this)}};return n.prototype=Object.assign(Object.create(e.Object3D.prototype),{constructor:n,isTransformControlsGizmo:!0}),t.controls.TransformControlsGizmo=n});
//# sourceMappingURL=../sourcemaps/controls/TransformControlsGizmo.js.map
