/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex"],function(t,e){"use strict";var i=function(e,i,r){this._scene=e,this._trackInfo=i,this._onUpdate=r,this._mixer=new t.AnimationMixer(e),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};return i.prototype={constructor:i,init:function(){for(var e=[],i=this._trackInfo,r=0,n=i.length;r!==n;++r){var s=i[r];e.push(this._addTrack(s.type,s.propertyPath,s.initialValue,s.interpolation))}this._clip=new t.AnimationClip("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(t){this._action.time=t,this._mixer.update(0),this._onUpdate()},setDuration:function(t){this._clip.duration=t},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(t){return this._tracks[t].times},setKeyframe:function(t,e){var i=this._tracks[t],r=i.times,n=Timeliner.binarySearch(r,e),s=i.values,a=i.getValueSize(),h=n*a;if(n<0){h=(n=~n)*a;for(var l=r.length+1,o=s.length+a,c=l-1;c!==n;--c)r[c]=r[c-1];c=o-1;for(var u=h+a-1;c!==u;--c)s[c]=s[c-a]}r[n]=e,this._propRefs[t].getValue(s,h)},delKeyframe:function(t,e){var i=this._tracks[t],r=i.times,n=Timeliner.binarySearch(r,e);if(r.length>1&&n>=0){for(var s=r.length-1,a=i.values,h=i.getValueSize(),l=a.length-h,o=n;o!==s;++o)r[o]=r[o+1];r.pop();for(var c=n*h;c!==l;++c)a[c]=a[c+h];a.length=l}},moveKeyframe:function(t,e,i,r){var n=this._tracks[t],s=n.times,a=Timeliner.binarySearch(s,e);if(a>=0){for(var h=r?s.length:a+1,l=s[a-1]<=e||!r&&e>=s[a+1];a!==h;)s[a++]+=i;l&&this._sort(n)}},serialize:function(){for(var t={duration:this._clip.duration,channels:{}},e=this._channelNames,i=this._tracks,r=t.channels,n=0,s=e.length;n!==s;++n){var a=e[n],h=i[a];r[a]={times:h.times,values:h.values}}return t},deserialize:function(t){var e=this._channelNames,i=this._tracks,r=t.channels;this.setDuration(t.duration);for(var n=0,s=e.length;n!==s;++n){var a=e[n],h=i[a],l=r[a];this._setArray(h.times,l.times),this._setArray(h.values,l.values)}this.setDisplayTime(this._mixer.time)},_sort:function(e){var i=e.times,r=t.AnimationUtils.getKeyframeOrder(i);this._setArray(i,t.AnimationUtils.sortedArray(i,1,r));var n=e.values,s=e.getValueSize();this._setArray(n,t.AnimationUtils.sortedArray(n,s,r))},_setArray:function(t,e){t.length=0,t.push.apply(t,e)},_addTrack:function(e,i,r,n){var s=new e(i,[0],r,n);return s.times=Array.prototype.slice.call(s.times),s.values=Array.prototype.slice.call(s.values),this._channelNames.push(i),this._tracks[i]=s,this._propRefs[i]=new t.PropertyBinding(this._scene,i),s}},e.animation.TimelinerController=i});
//# sourceMappingURL=../sourcemaps/animation/TimelinerController.js.map
