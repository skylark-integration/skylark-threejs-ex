/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../renderers/Projector"],function(e,i){"use strict";var t=function(i){e.Object3D.call(this),this.node=i};(t.prototype=Object.create(e.Object3D.prototype)).constructor=t;var o=function(){var o,r,n,s,a,c,l,p,d,f,h,u,y,S=this,m=new i,v=document.createElementNS("http://www.w3.org/2000/svg","svg"),x=new e.Box2,g=new e.Box2,w=new e.Color,b=new e.Color,M=new e.Color,C=new e.Color,z=new e.Color,k=new e.Color,L=new e.Vector3,P=new e.Vector3,j=new e.Vector3,B=new e.Matrix3,R=new e.Matrix4,E=new e.Matrix4,A=[],W=0,F=1,V=null;function G(){for(W=0;v.childNodes.length>0;)v.removeChild(v.childNodes[0])}function N(e){return null!==V?e.toFixed(V):e}function O(e,i,t){var o=i.scale.x*c,r=i.scale.y*l;t.isPointsMaterial&&(o*=t.size,r*=t.size);var n="M"+N(e.x-.5*o)+","+N(e.y-.5*r)+"h"+N(o)+"v"+N(r)+"h"+N(-o)+"z",s="";(t.isSpriteMaterial||t.isPointsMaterial)&&(s="fill:"+t.color.getStyle()+";fill-opacity:"+t.opacity),q(s,n)}function D(e,i,t,o){var r="M"+N(e.positionScreen.x)+","+N(e.positionScreen.y)+"L"+N(i.positionScreen.x)+","+N(i.positionScreen.y);if(o.isLineBasicMaterial){var n="fill:none;stroke:"+o.color.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;o.isLineDashedMaterial&&(n=n+";stroke-dasharray:"+o.dashSize+","+o.gapSize),q(n,r)}}function I(e,i,t,o,r){S.info.render.vertices+=3,S.info.render.faces++;var s="M"+N(e.positionScreen.x)+","+N(e.positionScreen.y)+"L"+N(i.positionScreen.x)+","+N(i.positionScreen.y)+"L"+N(t.positionScreen.x)+","+N(t.positionScreen.y)+"z";r.isMeshBasicMaterial?(w.copy(r.color),r.vertexColors&&w.multiply(o.color)):r.isMeshLambertMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial?(b.copy(r.color),r.vertexColors&&b.multiply(o.color),w.copy(M),P.copy(e.positionWorld).add(i.positionWorld).add(t.positionWorld).divideScalar(3),function(e,i,t,o){for(var r=0,n=e.length;r<n;r++){var s=e[r],a=s.color;if(s.isDirectionalLight){var c=L.setFromMatrixPosition(s.matrixWorld).normalize();if((l=t.dot(c))<=0)continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}else if(s.isPointLight){var l;if(c=L.setFromMatrixPosition(s.matrixWorld),(l=t.dot(L.subVectors(c,i).normalize()))<=0)continue;if(0==(l*=0==s.distance?1:1-Math.min(i.distanceTo(c)/s.distance,1)))continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}}}(n,P,o.normalModel,w),w.multiply(b).add(r.emissive)):r.isMeshNormalMaterial&&(j.copy(o.normalModel).applyMatrix3(B).normalize(),w.setRGB(j.x,j.y,j.z).multiplyScalar(.5).addScalar(.5)),q(r.wireframe?"fill:none;stroke:"+w.getStyle()+";stroke-opacity:"+r.opacity+";stroke-width:"+r.wireframeLinewidth+";stroke-linecap:"+r.wireframeLinecap+";stroke-linejoin:"+r.wireframeLinejoin:"fill:"+w.getStyle()+";fill-opacity:"+r.opacity,s)}function T(e,i,t){var o,r=i.x-e.x,n=i.y-e.y,s=r*r+n*n;0!==s&&(r*=o=t/Math.sqrt(s),n*=o,i.x+=r,i.y+=n,e.x-=r,e.y-=n)}function q(e,i){y===e?u+=i:(H(),y=e,u=i)}function H(){u&&((h=function(e){if(null==A[e])return A[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==F&&A[e].setAttribute("shape-rendering","crispEdges"),A[e];return A[e]}(W++)).setAttribute("d",u),h.setAttribute("style",y),v.appendChild(h)),u="",y=""}this.domElement=v,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":F=1;break;case"low":F=0}},this.setClearColor=function(e){k.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,i){c=(s=e)/2,l=(a=i)/2,v.setAttribute("viewBox",-c+" "+-l+" "+s+" "+a),v.setAttribute("width",s),v.setAttribute("height",a),x.min.set(-c,-l),x.max.set(c,l)},this.setPrecision=function(e){V=e},this.clear=function(){G(),v.style.backgroundColor=k.getStyle()},this.render=function(s,a){if(a instanceof e.Camera!=!1){var h=s.background;h&&h.isColor?(G(),v.style.backgroundColor=h.getStyle()):!0===this.autoClear&&this.clear(),S.info.render.vertices=0,S.info.render.faces=0,R.copy(a.matrixWorldInverse),E.multiplyMatrices(a.projectionMatrix,R),o=m.projectScene(s,a,this.sortObjects,this.sortElements),r=o.elements,n=o.lights,B.getNormalMatrix(a.matrixWorldInverse),function(e){M.setRGB(0,0,0),C.setRGB(0,0,0),z.setRGB(0,0,0);for(var i=0,t=e.length;i<t;i++){var o=e[i],r=o.color;o.isAmbientLight?(M.r+=r.r,M.g+=r.g,M.b+=r.b):o.isDirectionalLight?(C.r+=r.r,C.g+=r.g,C.b+=r.b):o.isPointLight&&(z.r+=r.r,z.g+=r.g,z.b+=r.b)}}(n),u="",y="";for(var w=0,b=r.length;w<b;w++){var k=r[w],P=k.material;if(void 0!==P&&0!==P.opacity)if(g.makeEmpty(),k instanceof i.RenderableSprite)(p=k).x*=c,p.y*=-l,O(p,k,P);else if(k instanceof i.RenderableLine)p=k.v1,d=k.v2,p.positionScreen.x*=c,p.positionScreen.y*=-l,d.positionScreen.x*=c,d.positionScreen.y*=-l,g.setFromPoints([p.positionScreen,d.positionScreen]),!0===x.intersectsBox(g)&&D(p,d,k,P);else if(k instanceof i.RenderableFace){if(p=k.v1,d=k.v2,f=k.v3,p.positionScreen.z<-1||p.positionScreen.z>1)continue;if(d.positionScreen.z<-1||d.positionScreen.z>1)continue;if(f.positionScreen.z<-1||f.positionScreen.z>1)continue;p.positionScreen.x*=c,p.positionScreen.y*=-l,d.positionScreen.x*=c,d.positionScreen.y*=-l,f.positionScreen.x*=c,f.positionScreen.y*=-l,this.overdraw>0&&(T(p.positionScreen,d.positionScreen,this.overdraw),T(d.positionScreen,f.positionScreen,this.overdraw),T(f.positionScreen,p.positionScreen,this.overdraw)),g.setFromPoints([p.positionScreen,d.positionScreen,f.positionScreen]),!0===x.intersectsBox(g)&&I(p,d,f,k,P)}}H(),s.traverseVisible(function(e){if(e instanceof t){if(L.setFromMatrixPosition(e.matrixWorld),L.applyMatrix4(E),L.z<-1||L.z>1)return;var i=L.x*c,o=-L.y*l,r=e.node;r.setAttribute("transform","translate("+i+","+o+")"),v.appendChild(r)}})}else console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.")}};return o.SVGObject=t,o});
//# sourceMappingURL=../sourcemaps/renderers/SVGRenderer.js.map
