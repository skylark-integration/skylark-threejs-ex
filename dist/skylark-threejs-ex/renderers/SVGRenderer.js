/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","./Projector"],function(e){return e.SVGObject=function(i){e.Object3D.call(this),this.node=i},e.SVGObject.prototype=Object.create(e.Object3D.prototype),e.SVGObject.prototype.constructor=e.SVGObject,e.SVGRenderer=function(){var i,t,o,r,n,s,a,c,l,p,d,f,h,S=this,y=new e.Projector,u=document.createElementNS("http://www.w3.org/2000/svg","svg"),m=new e.Box2,v=new e.Box2,x=new e.Color,g=new e.Color,w=new e.Color,b=new e.Color,M=new e.Color,C=new e.Color,z=new e.Vector3,j=new e.Vector3,k=new e.Vector3,L=new e.Matrix3,P=new e.Matrix4,R=new e.Matrix4,V=[],G=0,B=1,E=null;function O(){for(G=0;u.childNodes.length>0;)u.removeChild(u.childNodes[0])}function A(e){return null!==E?e.toFixed(E):e}function W(e,i,t){var o=i.scale.x*s,r=i.scale.y*a;t.isPointsMaterial&&(o*=t.size,r*=t.size);var n="M"+A(e.x-.5*o)+","+A(e.y-.5*r)+"h"+A(o)+"v"+A(r)+"h"+A(-o)+"z",c="";(t.isSpriteMaterial||t.isPointsMaterial)&&(c="fill:"+t.color.getStyle()+";fill-opacity:"+t.opacity),T(c,n)}function F(e,i,t,o){var r="M"+A(e.positionScreen.x)+","+A(e.positionScreen.y)+"L"+A(i.positionScreen.x)+","+A(i.positionScreen.y);if(o.isLineBasicMaterial){var n="fill:none;stroke:"+o.color.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;o.isLineDashedMaterial&&(n=n+";stroke-dasharray:"+o.dashSize+","+o.gapSize),T(n,r)}}function N(e,i,t,r,n){S.info.render.vertices+=3,S.info.render.faces++;var s="M"+A(e.positionScreen.x)+","+A(e.positionScreen.y)+"L"+A(i.positionScreen.x)+","+A(i.positionScreen.y)+"L"+A(t.positionScreen.x)+","+A(t.positionScreen.y)+"z";n.isMeshBasicMaterial?(x.copy(n.color),n.vertexColors&&x.multiply(r.color)):n.isMeshLambertMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial?(g.copy(n.color),n.vertexColors&&g.multiply(r.color),x.copy(w),j.copy(e.positionWorld).add(i.positionWorld).add(t.positionWorld).divideScalar(3),function(e,i,t,o){for(var r=0,n=e.length;r<n;r++){var s=e[r],a=s.color;if(s.isDirectionalLight){var c=z.setFromMatrixPosition(s.matrixWorld).normalize();if((l=t.dot(c))<=0)continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}else if(s.isPointLight){var l;if(c=z.setFromMatrixPosition(s.matrixWorld),(l=t.dot(z.subVectors(c,i).normalize()))<=0)continue;if(0==(l*=0==s.distance?1:1-Math.min(i.distanceTo(c)/s.distance,1)))continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}}}(o,j,r.normalModel,x),x.multiply(g).add(n.emissive)):n.isMeshNormalMaterial&&(k.copy(r.normalModel).applyMatrix3(L).normalize(),x.setRGB(k.x,k.y,k.z).multiplyScalar(.5).addScalar(.5)),T(n.wireframe?"fill:none;stroke:"+x.getStyle()+";stroke-opacity:"+n.opacity+";stroke-width:"+n.wireframeLinewidth+";stroke-linecap:"+n.wireframeLinecap+";stroke-linejoin:"+n.wireframeLinejoin:"fill:"+x.getStyle()+";fill-opacity:"+n.opacity,s)}function D(e,i,t){var o,r=i.x-e.x,n=i.y-e.y,s=r*r+n*n;0!==s&&(r*=o=t/Math.sqrt(s),n*=o,i.x+=r,i.y+=n,e.x-=r,e.y-=n)}function T(e,i){h===e?f+=i:(H(),h=e,f=i)}function H(){f&&((d=function(e){if(null==V[e])return V[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==B&&V[e].setAttribute("shape-rendering","crispEdges"),V[e];return V[e]}(G++)).setAttribute("d",f),d.setAttribute("style",h),u.appendChild(d)),f="",h=""}this.domElement=u,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":B=1;break;case"low":B=0}},this.setClearColor=function(e){C.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,i){s=(r=e)/2,a=(n=i)/2,u.setAttribute("viewBox",-s+" "+-a+" "+r+" "+n),u.setAttribute("width",r),u.setAttribute("height",n),m.min.set(-s,-a),m.max.set(s,a)},this.setPrecision=function(e){E=e},this.clear=function(){O(),u.style.backgroundColor=C.getStyle()},this.render=function(r,n){if(n instanceof e.Camera!=!1){var d=r.background;d&&d.isColor?(O(),u.style.backgroundColor=d.getStyle()):!0===this.autoClear&&this.clear(),S.info.render.vertices=0,S.info.render.faces=0,P.copy(n.matrixWorldInverse),R.multiplyMatrices(n.projectionMatrix,P),i=y.projectScene(r,n,this.sortObjects,this.sortElements),t=i.elements,o=i.lights,L.getNormalMatrix(n.matrixWorldInverse),function(e){w.setRGB(0,0,0),b.setRGB(0,0,0),M.setRGB(0,0,0);for(var i=0,t=e.length;i<t;i++){var o=e[i],r=o.color;o.isAmbientLight?(w.r+=r.r,w.g+=r.g,w.b+=r.b):o.isDirectionalLight?(b.r+=r.r,b.g+=r.g,b.b+=r.b):o.isPointLight&&(M.r+=r.r,M.g+=r.g,M.b+=r.b)}}(o),f="",h="";for(var x=0,g=t.length;x<g;x++){var C=t[x],j=C.material;if(void 0!==j&&0!==j.opacity)if(v.makeEmpty(),C instanceof e.RenderableSprite)(c=C).x*=s,c.y*=-a,W(c,C,j);else if(C instanceof e.RenderableLine)c=C.v1,l=C.v2,c.positionScreen.x*=s,c.positionScreen.y*=-a,l.positionScreen.x*=s,l.positionScreen.y*=-a,v.setFromPoints([c.positionScreen,l.positionScreen]),!0===m.intersectsBox(v)&&F(c,l,C,j);else if(C instanceof e.RenderableFace){if(c=C.v1,l=C.v2,p=C.v3,c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;if(p.positionScreen.z<-1||p.positionScreen.z>1)continue;c.positionScreen.x*=s,c.positionScreen.y*=-a,l.positionScreen.x*=s,l.positionScreen.y*=-a,p.positionScreen.x*=s,p.positionScreen.y*=-a,this.overdraw>0&&(D(c.positionScreen,l.positionScreen,this.overdraw),D(l.positionScreen,p.positionScreen,this.overdraw),D(p.positionScreen,c.positionScreen,this.overdraw)),v.setFromPoints([c.positionScreen,l.positionScreen,p.positionScreen]),!0===m.intersectsBox(v)&&N(c,l,p,C,j)}}H(),r.traverseVisible(function(i){if(i instanceof e.SVGObject){if(z.setFromMatrixPosition(i.matrixWorld),z.applyMatrix4(R),z.z<-1||z.z>1)return;var t=z.x*s,o=-z.y*a,r=i.node;r.setAttribute("transform","translate("+t+","+o+")"),u.appendChild(r)}})}else console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.")}},e.SVGRenderer});
//# sourceMappingURL=../sourcemaps/renderers/SVGRenderer.js.map
