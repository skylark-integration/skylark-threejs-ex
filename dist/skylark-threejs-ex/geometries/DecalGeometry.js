/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs"],function(t){return t.DecalGeometry=function(o,e,r,n){t.BufferGeometry.call(this);var i=[],s=[],u=[],p=new t.Vector3,a=new t.Matrix4;a.makeRotationFromEuler(r),a.setPosition(e);var l=(new t.Matrix4).getInverse(a);function c(e,r,n){r.applyMatrix4(o.matrixWorld),r.applyMatrix4(l),n.transformDirection(o.matrixWorld),e.push(new t.DecalVertex(r.clone(),n.clone()))}function h(t,o){for(var e=[],r=.5*Math.abs(n.dot(o)),i=0;i<t.length;i+=3){var s,u,p,a,l,c,h,m=t[i+0].position.dot(o)-r;switch(u=t[i+1].position.dot(o)-r>0,p=t[i+2].position.dot(o)-r>0,((s=m>0)?1:0)+(u?1:0)+(p?1:0)){case 0:e.push(t[i]),e.push(t[i+1]),e.push(t[i+2]);break;case 1:if(s&&(a=t[i+1],l=t[i+2],c=f(t[i],a,o,r),h=f(t[i],l,o,r)),u){a=t[i],l=t[i+2],c=f(t[i+1],a,o,r),h=f(t[i+1],l,o,r),e.push(c),e.push(l.clone()),e.push(a.clone()),e.push(l.clone()),e.push(c.clone()),e.push(h);break}p&&(a=t[i],l=t[i+1],c=f(t[i+2],a,o,r),h=f(t[i+2],l,o,r)),e.push(a.clone()),e.push(l.clone()),e.push(c),e.push(h),e.push(c.clone()),e.push(l.clone());break;case 2:s||(l=f(a=t[i].clone(),t[i+1],o,r),c=f(a,t[i+2],o,r),e.push(a),e.push(l),e.push(c)),u||(l=f(a=t[i+1].clone(),t[i+2],o,r),c=f(a,t[i],o,r),e.push(a),e.push(l),e.push(c)),p||(l=f(a=t[i+2].clone(),t[i],o,r),c=f(a,t[i+1],o,r),e.push(a),e.push(l),e.push(c))}}return e}function f(o,e,r,n){var i=o.position.dot(r)-n,s=i/(i-(e.position.dot(r)-n));return new t.DecalVertex(new t.Vector3(o.position.x+s*(e.position.x-o.position.x),o.position.y+s*(e.position.y-o.position.y),o.position.z+s*(e.position.z-o.position.z)),new t.Vector3(o.normal.x+s*(e.normal.x-o.normal.x),o.normal.y+s*(e.normal.y-o.normal.y),o.normal.z+s*(e.normal.z-o.normal.z)))}!function(){var e,r=new t.BufferGeometry,l=[],f=new t.Vector3,m=new t.Vector3;o.geometry.isGeometry?r.fromGeometry(o.geometry):r.copy(o.geometry);var y=r.attributes.position,x=r.attributes.normal;if(null!==r.index){var b=r.index;for(e=0;e<b.count;e++)f.fromBufferAttribute(y,b.getX(e)),m.fromBufferAttribute(x,b.getX(e)),c(l,f,m)}else for(e=0;e<y.count;e++)f.fromBufferAttribute(y,e),m.fromBufferAttribute(x,e),c(l,f,m);for(l=h(l=h(l=h(l=h(l=h(l=h(l,p.set(1,0,0)),p.set(-1,0,0)),p.set(0,1,0)),p.set(0,-1,0)),p.set(0,0,1)),p.set(0,0,-1)),e=0;e<l.length;e++){var w=l[e];u.push(.5+w.position.x/n.x,.5+w.position.y/n.y),w.position.applyMatrix4(a),i.push(w.position.x,w.position.y,w.position.z),s.push(w.normal.x,w.normal.y,w.normal.z)}}(),this.setAttribute("position",new t.Float32BufferAttribute(i,3)),this.setAttribute("normal",new t.Float32BufferAttribute(s,3)),this.setAttribute("uv",new t.Float32BufferAttribute(u,2))},t.DecalGeometry.prototype=Object.create(t.BufferGeometry.prototype),t.DecalGeometry.prototype.constructor=t.DecalGeometry,t.DecalVertex=function(t,o){this.position=t,this.normal=o},t.DecalVertex.prototype.clone=function(){return new this.constructor(this.position.clone(),this.normal.clone())},t.DecalGeometry});
//# sourceMappingURL=../sourcemaps/geometries/DecalGeometry.js.map
