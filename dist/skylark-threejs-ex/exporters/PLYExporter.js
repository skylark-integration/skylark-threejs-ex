/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs"],function(t){"use strict";var e=function(){};return e.prototype={constructor:e,parse:function(e,n,r){function i(t){e.traverse(function(e){if(!0===e.isMesh){var n=e,r=n.geometry;!0===r.isGeometry&&(r=l.get(r)),!0===r.isBufferGeometry&&void 0!==r.getAttribute("position")&&t(n,r)}})}n&&"object"==typeof n&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=n,n=void 0);var o=(r=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},r)).excludeAttributes,l=new WeakMap,a=!1,u=!1,s=!1,f=0,g=0;e.traverse(function(e){if(!0===e.isMesh){var n=e,r=n.geometry;if(!0===r.isGeometry){var i=l.get(r)||(new t.BufferGeometry).setFromObject(n);l.set(r,i),r=i}if(!0===r.isBufferGeometry){var o=r.getAttribute("position"),d=r.getAttribute("normal"),c=r.getAttribute("uv"),p=r.getAttribute("color"),y=r.getIndex();if(void 0===o)return;f+=o.count,g+=y?y.count/3:o.count/3,void 0!==d&&(a=!0),void 0!==c&&(s=!0),void 0!==p&&(u=!0)}}});var d=-1===o.indexOf("index");if(a=a&&-1===o.indexOf("normal"),u=u&&-1===o.indexOf("color"),s=s&&-1===o.indexOf("uv"),d&&g!==Math.floor(g))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var c="ply\n"+`format ${r.binary?r.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0\n`+`element vertex ${f}\n`+"property float x\nproperty float y\nproperty float z\n";!0===a&&(c+="property float nx\nproperty float ny\nproperty float nz\n"),!0===s&&(c+="property float s\nproperty float t\n"),!0===u&&(c+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===d&&(c+=`element face ${g}\n`+"property list uchar int vertex_index\n"),c+="end_header\n";var p=new t.Vector3,y=new t.Matrix3,x=null;if(!0===r.binary){var v=(new TextEncoder).encode(c),b=f*(12+(a?12:0)+(u?3:0)+(s?8:0)),m=d?13*g:0,h=new DataView(new ArrayBuffer(v.length+b+m));new Uint8Array(h.buffer).set(v,0);var E=v.length,A=v.length+b,M=0;i(function(t,e){var n=e.getAttribute("position"),i=e.getAttribute("normal"),o=e.getAttribute("uv"),l=e.getAttribute("color"),f=e.getIndex();y.getNormalMatrix(t.matrixWorld);for(var g=0,c=n.count;g<c;g++)p.x=n.getX(g),p.y=n.getY(g),p.z=n.getZ(g),p.applyMatrix4(t.matrixWorld),h.setFloat32(E,p.x,r.littleEndian),E+=4,h.setFloat32(E,p.y,r.littleEndian),E+=4,h.setFloat32(E,p.z,r.littleEndian),E+=4,!0===a&&(null!=i?(p.x=i.getX(g),p.y=i.getY(g),p.z=i.getZ(g),p.applyMatrix3(y).normalize(),h.setFloat32(E,p.x,r.littleEndian),E+=4,h.setFloat32(E,p.y,r.littleEndian),E+=4,h.setFloat32(E,p.z,r.littleEndian),E+=4):(h.setFloat32(E,0,r.littleEndian),E+=4,h.setFloat32(E,0,r.littleEndian),E+=4,h.setFloat32(E,0,r.littleEndian),E+=4)),!0===s&&(null!=o?(h.setFloat32(E,o.getX(g),r.littleEndian),E+=4,h.setFloat32(E,o.getY(g),r.littleEndian),E+=4):!1!==s&&(h.setFloat32(E,0,r.littleEndian),E+=4,h.setFloat32(E,0,r.littleEndian),E+=4)),!0===u&&(null!=l?(h.setUint8(E,Math.floor(255*l.getX(g))),E+=1,h.setUint8(E,Math.floor(255*l.getY(g))),E+=1,h.setUint8(E,Math.floor(255*l.getZ(g))),E+=1):(h.setUint8(E,255),E+=1,h.setUint8(E,255),E+=1,h.setUint8(E,255),E+=1));if(!0===d)if(null!==f)for(g=0,c=f.count;g<c;g+=3)h.setUint8(A,3),A+=1,h.setUint32(A,f.getX(g+0)+M,r.littleEndian),A+=4,h.setUint32(A,f.getX(g+1)+M,r.littleEndian),A+=4,h.setUint32(A,f.getX(g+2)+M,r.littleEndian),A+=4;else for(g=0,c=n.count;g<c;g+=3)h.setUint8(A,3),A+=1,h.setUint32(A,M+g,r.littleEndian),A+=4,h.setUint32(A,M+g+1,r.littleEndian),A+=4,h.setUint32(A,M+g+2,r.littleEndian),A+=4;M+=n.count}),x=h.buffer}else{M=0;var F="",U="";i(function(t,e){var n=e.getAttribute("position"),r=e.getAttribute("normal"),i=e.getAttribute("uv"),o=e.getAttribute("color"),l=e.getIndex();y.getNormalMatrix(t.matrixWorld);for(var f=0,c=n.count;f<c;f++){p.x=n.getX(f),p.y=n.getY(f),p.z=n.getZ(f),p.applyMatrix4(t.matrixWorld);var x=p.x+" "+p.y+" "+p.z;!0===a&&(null!=r?(p.x=r.getX(f),p.y=r.getY(f),p.z=r.getZ(f),p.applyMatrix3(y).normalize(),x+=" "+p.x+" "+p.y+" "+p.z):x+=" 0 0 0"),!0===s&&(null!=i?x+=" "+i.getX(f)+" "+i.getY(f):!1!==s&&(x+=" 0 0")),!0===u&&(x+=null!=o?" "+Math.floor(255*o.getX(f))+" "+Math.floor(255*o.getY(f))+" "+Math.floor(255*o.getZ(f)):" 255 255 255"),F+=x+"\n"}if(!0===d){if(null!==l)for(f=0,c=l.count;f<c;f+=3)U+=`3 ${l.getX(f+0)+M}`,U+=` ${l.getX(f+1)+M}`,U+=` ${l.getX(f+2)+M}\n`;else for(f=0,c=n.count;f<c;f+=3)U+=`3 ${M+f} ${M+f+1} ${M+f+2}\n`;g+=l?l.count/3:n.count/3}M+=n.count}),x=`${c}${F}${d?`${U}\n`:"\n"}`}return"function"==typeof n&&requestAnimationFrame(()=>n(x)),x}},e});
//# sourceMappingURL=../sourcemaps/exporters/PLYExporter.js.map
