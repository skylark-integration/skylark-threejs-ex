/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../core/NodeBuilder","../inputs/ColorNode","../accessors/PositionNode","./nodes/RawNode"],function(e,t,i,s,r){"use strict";function h(t,h){e.ShaderMaterial.call(this);var n=this;this.vertex=t||new r(new s(s.PROJECTION)),this.fragment=h||new r(new i(16711680)),this.updaters=[],this.onBeforeCompile=function(e,t){var i=t.properties.get(this);this.version!==i.__version&&(this.build({renderer:t}),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader)},this.onBeforeCompile.toString=function(){return n.needsCompile}}return h.prototype=Object.create(e.ShaderMaterial.prototype),h.prototype.constructor=h,h.prototype.type="NodeMaterial",h.prototype.isNodeMaterial=!0,Object.defineProperties(h.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}}),h.prototype.updateFrame=function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},h.prototype.build=function(i){var s=(i=i||{}).builder||new t;return s.setMaterial(this,i.renderer),s.build(this.vertex,this.fragment),this.vertexShader=s.getCode("vertex"),this.fragmentShader=s.getCode("fragment"),this.defines=s.defines,this.uniforms=s.uniforms,this.extensions=s.extensions,this.updaters=s.updaters,this.fog=s.requires.fog,this.lights=s.requires.lights,this.transparent=s.requires.transparent||this.blending>e.NormalBlending,this},h.prototype.copy=function(e){var t=this.uuid;for(var i in e)this[i]=e[i];return this.uuid=t,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},h.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var i={};i.uuid=this.uuid,i.type=this.type,t.materials[i.uuid]=i,""!==this.name&&(i.name=this.name),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==e.NormalBlending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==e.FrontSide&&(i.side=this.side),this.vertexColors!==e.NoColors&&(i.vertexColors=this.vertexColors),this.depthFunc!==e.LessEqualDepth&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.fog=this.fog,i.lights=this.lights,i.vertex=this.vertex.toJSON(t).uuid,i.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t},h});
//# sourceMappingURL=../../sourcemaps/nodes/materials/NodeMaterial.js.map
