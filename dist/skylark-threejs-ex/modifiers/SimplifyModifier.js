/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex"],function(e,o){"use strict";var i=function(){};return function(){var o=new e.Vector3,t=new e.Vector3;function s(e,o){var i=e.indexOf(o);i>-1&&e.splice(i,1)}function r(e,o){var i,t,s,r=o.position.distanceTo(e.position),n=0,h=[],a=e.faces.length;for(i=0;i<a;i++)(t=e.faces[i]).hasVertex(o)&&h.push(t);for(i=0;i<a;i++){var f=1;t=e.faces[i];for(var v=0;v<h.length;v++){s=h[v];var c=t.normal.dot(s.normal);f=Math.min(f,(1.001-c)/2)}n=Math.max(n,f)}return h.length<2&&(n=1),r*n+0}function n(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var o=0;o<e.neighbors.length;o++){var i=r(e,e.neighbors[o]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[o],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[o],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function h(e,o){for(console.assert(0===e.faces.length);e.neighbors.length;){s(e.neighbors.pop().neighbors,e)}s(o,e)}function a(e,o){s(o,e),e.v1&&s(e.v1.faces,e),e.v2&&s(e.v2.faces,e),e.v3&&s(e.v3.faces,e);for(var i,t,r=[e.v1,e.v2,e.v3],n=0;n<3;n++)t=r[(n+1)%3],(i=r[n])&&t&&(i.removeIfNonNeighbor(t),t.removeIfNonNeighbor(i))}function f(e,o,i,t){if(t){var s,r=[];for(s=0;s<i.neighbors.length;s++)r.push(i.neighbors[s]);for(s=i.faces.length-1;s>=0;s--)i.faces[s].hasVertex(t)&&a(i.faces[s],o);for(s=i.faces.length-1;s>=0;s--)i.faces[s].replaceVertex(i,t);for(h(i,e),s=0;s<r.length;s++)n(r[s])}else h(i,e)}function v(e){for(var o=e[0],i=0;i<e.length;i++)e[i].collapseCost<o.collapseCost&&(o=e[i]);return o}function c(o,i,t,s,r,n){this.a=s,this.b=r,this.c=n,this.v1=o,this.v2=i,this.v3=t,this.normal=new e.Vector3,this.computeNormal(),o.faces.push(this),o.addUniqueNeighbor(i),o.addUniqueNeighbor(t),i.faces.push(this),i.addUniqueNeighbor(o),i.addUniqueNeighbor(t),t.faces.push(this),t.addUniqueNeighbor(o),t.addUniqueNeighbor(i)}function l(e,o){this.position=e,this.id=o,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var e=this.v1.position,i=this.v2.position,s=this.v3.position;o.subVectors(s,i),t.subVectors(e,i),o.cross(t).normalize(),this.normal.copy(o)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,o){e===this.v1?this.v1=o:e===this.v2?this.v2=o:e===this.v3&&(this.v3=o),s(e.faces,this),o.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},l.prototype.addUniqueNeighbor=function(e){var o,i;o=this.neighbors,i=e,-1===o.indexOf(i)&&o.push(i)},l.prototype.removeIfNonNeighbor=function(e){var o=this.neighbors,i=this.faces,t=o.indexOf(e);if(-1!==t){for(var s=0;s<i.length;s++)if(i[s].hasVertex(e))return;o.splice(t,1)}},i.prototype.modify=function(o,i){o.isBufferGeometry&&(o=(new e.Geometry).fromBufferGeometry(o)),o.mergeVertices();var t,s,r,h=o.vertices,a=o.faces,u=[],g=[];for(t=0,s=h.length;t<s;t++){var p=new l(h[t],t);u.push(p)}for(t=0,s=a.length;t<s;t++){var b=(U=a[t]).a,d=U.b,N=U.c,m=new c(u[b],u[d],u[N],b,d,N);g.push(m)}for(t=0,s=u.length;t<s;t++)n(u[t]);for(var x=i;x--;){if(!(r=v(u))){console.log("THREE.SimplifyModifier: No next vertex");break}f(u,g,r,r.collapseNeighbor)}var y=new e.BufferGeometry,C=[],q=[];for(t=0;t<u.length;t++){p=u[t].position;C.push(p.x,p.y,p.z)}for(t=0;t<g.length;t++){var U=g[t];b=u.indexOf(U.v1),d=u.indexOf(U.v2),N=u.indexOf(U.v3);q.push(b,d,N)}return y.setAttribute("position",new e.Float32BufferAttribute(C,3)),y.setIndex(q),y}}(),o.modifiers.SimplifyModifier=i});
//# sourceMappingURL=../sourcemaps/modifiers/SimplifyModifier.js.map
