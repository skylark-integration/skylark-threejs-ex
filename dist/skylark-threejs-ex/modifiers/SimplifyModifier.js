/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs"],function(e){"use strict";var o=function(){};return function(){var t=new e.Vector3,i=new e.Vector3;function s(e,o){var t=e.indexOf(o);t>-1&&e.splice(t,1)}function r(e,o){var t,i,s,r=o.position.distanceTo(e.position),n=0,h=[],a=e.faces.length;for(t=0;t<a;t++)(i=e.faces[t]).hasVertex(o)&&h.push(i);for(t=0;t<a;t++){var f=1;i=e.faces[t];for(var v=0;v<h.length;v++){s=h[v];var c=i.normal.dot(s.normal);f=Math.min(f,(1.001-c)/2)}n=Math.max(n,f)}return h.length<2&&(n=1),r*n+0}function n(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var o=0;o<e.neighbors.length;o++){var t=r(e,e.neighbors[o]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[o],e.collapseCost=t,e.minCost=t,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=t,t<e.minCost&&(e.collapseNeighbor=e.neighbors[o],e.minCost=t)}e.collapseCost=e.totalCost/e.costCount}function h(e,o){for(console.assert(0===e.faces.length);e.neighbors.length;){s(e.neighbors.pop().neighbors,e)}s(o,e)}function a(e,o){s(o,e),e.v1&&s(e.v1.faces,e),e.v2&&s(e.v2.faces,e),e.v3&&s(e.v3.faces,e);for(var t,i,r=[e.v1,e.v2,e.v3],n=0;n<3;n++)i=r[(n+1)%3],(t=r[n])&&i&&(t.removeIfNonNeighbor(i),i.removeIfNonNeighbor(t))}function f(e,o,t,i){if(i){var s,r=[];for(s=0;s<t.neighbors.length;s++)r.push(t.neighbors[s]);for(s=t.faces.length-1;s>=0;s--)t.faces[s].hasVertex(i)&&a(t.faces[s],o);for(s=t.faces.length-1;s>=0;s--)t.faces[s].replaceVertex(t,i);for(h(t,e),s=0;s<r.length;s++)n(r[s])}else h(t,e)}function v(e){for(var o=e[0],t=0;t<e.length;t++)e[t].collapseCost<o.collapseCost&&(o=e[t]);return o}function c(o,t,i,s,r,n){this.a=s,this.b=r,this.c=n,this.v1=o,this.v2=t,this.v3=i,this.normal=new e.Vector3,this.computeNormal(),o.faces.push(this),o.addUniqueNeighbor(t),o.addUniqueNeighbor(i),t.faces.push(this),t.addUniqueNeighbor(o),t.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(o),i.addUniqueNeighbor(t)}function l(e,o){this.position=e,this.id=o,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var e=this.v1.position,o=this.v2.position,s=this.v3.position;t.subVectors(s,o),i.subVectors(e,o),t.cross(i).normalize(),this.normal.copy(t)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,o){e===this.v1?this.v1=o:e===this.v2?this.v2=o:e===this.v3&&(this.v3=o),s(e.faces,this),o.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},l.prototype.addUniqueNeighbor=function(e){var o,t;o=this.neighbors,t=e,-1===o.indexOf(t)&&o.push(t)},l.prototype.removeIfNonNeighbor=function(e){var o=this.neighbors,t=this.faces,i=o.indexOf(e);if(-1!==i){for(var s=0;s<t.length;s++)if(t[s].hasVertex(e))return;o.splice(i,1)}},o.prototype.modify=function(o,t){o.isBufferGeometry&&(o=(new e.Geometry).fromBufferGeometry(o)),o.mergeVertices();var i,s,r,h=o.vertices,a=o.faces,u=[],g=[];for(i=0,s=h.length;i<s;i++){var p=new l(h[i],i);u.push(p)}for(i=0,s=a.length;i<s;i++){var b=(U=a[i]).a,N=U.b,d=U.c,m=new c(u[b],u[N],u[d],b,N,d);g.push(m)}for(i=0,s=u.length;i<s;i++)n(u[i]);for(var x=t;x--;){if(!(r=v(u))){console.log("THREE.SimplifyModifier: No next vertex");break}f(u,g,r,r.collapseNeighbor)}var C=new e.BufferGeometry,y=[],q=[];for(i=0;i<u.length;i++){p=u[i].position;y.push(p.x,p.y,p.z)}for(i=0;i<g.length;i++){var U=g[i];b=u.indexOf(U.v1),N=u.indexOf(U.v2),d=u.indexOf(U.v3);q.push(b,N,d)}return C.setAttribute("position",new e.Float32BufferAttribute(y,3)),C.setIndex(q),C}}(),o});
//# sourceMappingURL=../sourcemaps/modifiers/SimplifyModifier.js.map
