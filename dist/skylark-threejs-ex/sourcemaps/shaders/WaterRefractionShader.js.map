{"version":3,"sources":["shaders/WaterRefractionShader.js"],"names":["define","threex","WaterRefractionShader","uniforms","color","value","time","tDiffuse","tDudv","textureMatrix","vertexShader","join","fragmentShader","shaders"],"mappings":";;;;;;;AAAAA,QACI,aACF,SAAUC,GACR,aACA,IAAIC,GACAC,UACIC,OAAWC,MAAO,MAClBC,MAAUD,MAAO,GACjBE,UAAcF,MAAO,MACrBG,OAAWH,MAAO,MAClBI,eAAmBJ,MAAO,OAE9BK,cACI,8BACA,oBACA,8BACA,gBACA,cACA,2DACA,8EACA,KACFC,KAAK,MACPC,gBACI,sBACA,sBACA,8BACA,2BACA,oBACA,8BACA,kDACA,sGACA,IACA,+CACA,qHACA,IACA,gBACA,6BACA,2BACA,sGACA,oFACA,yFACA,oCACA,wBACA,+CACA,iEACA,KACFD,KAAK,OAEX,OAAQV,EAAOY,QAAQX,sBAAwBA","file":"../../shaders/WaterRefractionShader.js","sourcesContent":["define([\n    \"../threex\"\n],function (threex) {\n    'use strict';\n    var WaterRefractionShader = {\n        uniforms: {\n            'color': { value: null },\n            'time': { value: 0 },\n            'tDiffuse': { value: null },\n            'tDudv': { value: null },\n            'textureMatrix': { value: null }\n        },\n        vertexShader: [\n            'uniform mat4 textureMatrix;',\n            'varying vec2 vUv;',\n            'varying vec4 vUvRefraction;',\n            'void main() {',\n            '\\tvUv = uv;',\n            '\\tvUvRefraction = textureMatrix * vec4( position, 1.0 );',\n            '\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n            '}'\n        ].join('\\n'),\n        fragmentShader: [\n            'uniform vec3 color;',\n            'uniform float time;',\n            'uniform sampler2D tDiffuse;',\n            'uniform sampler2D tDudv;',\n            'varying vec2 vUv;',\n            'varying vec4 vUvRefraction;',\n            'float blendOverlay( float base, float blend ) {',\n            '\\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );',\n            '}',\n            'vec3 blendOverlay( vec3 base, vec3 blend ) {',\n            '\\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );',\n            '}',\n            'void main() {',\n            ' float waveStrength = 0.1;',\n            ' float waveSpeed = 0.03;',\n            '\\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;',\n            '\\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );',\n            '\\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;',\n            ' vec4 uv = vec4( vUvRefraction );',\n            ' uv.xy += distortion;',\n            '\\tvec4 base = texture2DProj( tDiffuse, uv );',\n            '\\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );',\n            '}'\n        ].join('\\n')\n    };\n    return  threex.shaders.WaterRefractionShader = WaterRefractionShader;\n});"]}