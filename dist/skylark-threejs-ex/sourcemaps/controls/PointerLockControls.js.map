{"version":3,"sources":["controls/PointerLockControls.js"],"names":["define","THREE","threex","PointerLockControls","camera","domElement","undefined","console","warn","document","body","this","isLocked","direction","scope","changeEvent","type","lockEvent","unlockEvent","euler","Euler","PI_2","Math","PI","vec","Vector3","onMouseMove","event","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","setFromQuaternion","quaternion","y","x","max","min","setFromEuler","dispatchEvent","onPointerlockChange","pointerLockElement","onPointerlockError","error","connect","addEventListener","disconnect","removeEventListener","dispose","getObject","getDirection","v","copy","applyQuaternion","moveForward","distance","setFromMatrixColumn","matrix","crossVectors","up","position","addScaledVector","moveRight","lock","requestPointerLock","unlock","exitPointerLock","prototype","Object","create","EventDispatcher","constructor","controls"],"mappings":";;;;;;;AAAAA,QACI,kBACA,aACD,SACCC,EACAC,GAEA,aACA,IAAIC,EAAsB,SAAUC,EAAQC,QACrBC,IAAfD,IACAE,QAAQC,KAAK,kFACbH,EAAaI,SAASC,MAE1BC,KAAKN,WAAaA,EAClBM,KAAKC,UAAW,EAChB,IAgDQC,EAhDJC,EAAQH,KACRI,GAAgBC,KAAM,UACtBC,GAAcD,KAAM,QACpBE,GAAgBF,KAAM,UACtBG,EAAQ,IAAIlB,EAAMmB,MAAM,EAAG,EAAG,EAAG,OACjCC,EAAOC,KAAKC,GAAK,EACjBC,EAAM,IAAIvB,EAAMwB,QACpB,SAASC,EAAYC,GACjB,IAAuB,IAAnBb,EAAMF,SAAV,CAEA,IAAIgB,EAAYD,EAAMC,WAAaD,EAAME,cAAgBF,EAAMG,iBAAmB,EAC9EC,EAAYJ,EAAMI,WAAaJ,EAAMK,cAAgBL,EAAMM,iBAAmB,EAClFd,EAAMe,kBAAkB9B,EAAO+B,YAC/BhB,EAAMiB,GAAiB,KAAZR,EACXT,EAAMkB,GAAiB,KAAZN,EACXZ,EAAMkB,EAAIf,KAAKgB,KAAKjB,EAAMC,KAAKiB,IAAIlB,EAAMF,EAAMkB,IAC/CjC,EAAO+B,WAAWK,aAAarB,GAC/BL,EAAM2B,cAAc1B,IAExB,SAAS2B,IACDjC,SAASkC,qBAAuB7B,EAAMT,YACtCS,EAAM2B,cAAcxB,GACpBH,EAAMF,UAAW,IAEjBE,EAAM2B,cAAcvB,GACpBJ,EAAMF,UAAW,GAGzB,SAASgC,IACLrC,QAAQsC,MAAM,6DAElBlC,KAAKmC,QAAU,WACXrC,SAASsC,iBAAiB,YAAarB,GAAa,GACpDjB,SAASsC,iBAAiB,oBAAqBL,GAAqB,GACpEjC,SAASsC,iBAAiB,mBAAoBH,GAAoB,IAEtEjC,KAAKqC,WAAa,WACdvC,SAASwC,oBAAoB,YAAavB,GAAa,GACvDjB,SAASwC,oBAAoB,oBAAqBP,GAAqB,GACvEjC,SAASwC,oBAAoB,mBAAoBL,GAAoB,IAEzEjC,KAAKuC,QAAU,WACXvC,KAAKqC,cAETrC,KAAKwC,UAAY,WACb,OAAO/C,GAEXO,KAAKyC,cACGvC,EAAY,IAAIZ,EAAMwB,QAAQ,EAAG,GAAI,GAClC,SAAU4B,GACb,OAAOA,EAAEC,KAAKzC,GAAW0C,gBAAgBnD,EAAO+B,cAGxDxB,KAAK6C,YAAc,SAAUC,GACzBjC,EAAIkC,oBAAoBtD,EAAOuD,OAAQ,GACvCnC,EAAIoC,aAAaxD,EAAOyD,GAAIrC,GAC5BpB,EAAO0D,SAASC,gBAAgBvC,EAAKiC,IAEzC9C,KAAKqD,UAAY,SAAUP,GACvBjC,EAAIkC,oBAAoBtD,EAAOuD,OAAQ,GACvCvD,EAAO0D,SAASC,gBAAgBvC,EAAKiC,IAEzC9C,KAAKsD,KAAO,WACRtD,KAAKN,WAAW6D,sBAEpBvD,KAAKwD,OAAS,WACV1D,SAAS2D,mBAEbzD,KAAKmC,WAMT,OAHA3C,EAAoBkE,UAAYC,OAAOC,OAAOtE,EAAMuE,gBAAgBH,YACtCI,YAActE,EAErCD,EAAOwE,SAASvE,oBAAsBA","file":"../../controls/PointerLockControls.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var PointerLockControls = function (camera, domElement) {\r\n        if (domElement === undefined) {\r\n            console.warn('THREE.PointerLockControls: The second parameter \"domElement\" is now mandatory.');\r\n            domElement = document.body;\r\n        }\r\n        this.domElement = domElement;\r\n        this.isLocked = false;\r\n        var scope = this;\r\n        var changeEvent = { type: 'change' };\r\n        var lockEvent = { type: 'lock' };\r\n        var unlockEvent = { type: 'unlock' };\r\n        var euler = new THREE.Euler(0, 0, 0, 'YXZ');\r\n        var PI_2 = Math.PI / 2;\r\n        var vec = new THREE.Vector3();\r\n        function onMouseMove(event) {\r\n            if (scope.isLocked === false)\r\n                return;\r\n            var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\r\n            var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\r\n            euler.setFromQuaternion(camera.quaternion);\r\n            euler.y -= movementX * 0.002;\r\n            euler.x -= movementY * 0.002;\r\n            euler.x = Math.max(-PI_2, Math.min(PI_2, euler.x));\r\n            camera.quaternion.setFromEuler(euler);\r\n            scope.dispatchEvent(changeEvent);\r\n        }\r\n        function onPointerlockChange() {\r\n            if (document.pointerLockElement === scope.domElement) {\r\n                scope.dispatchEvent(lockEvent);\r\n                scope.isLocked = true;\r\n            } else {\r\n                scope.dispatchEvent(unlockEvent);\r\n                scope.isLocked = false;\r\n            }\r\n        }\r\n        function onPointerlockError() {\r\n            console.error('THREE.PointerLockControls: Unable to use Pointer Lock API');\r\n        }\r\n        this.connect = function () {\r\n            document.addEventListener('mousemove', onMouseMove, false);\r\n            document.addEventListener('pointerlockchange', onPointerlockChange, false);\r\n            document.addEventListener('pointerlockerror', onPointerlockError, false);\r\n        };\r\n        this.disconnect = function () {\r\n            document.removeEventListener('mousemove', onMouseMove, false);\r\n            document.removeEventListener('pointerlockchange', onPointerlockChange, false);\r\n            document.removeEventListener('pointerlockerror', onPointerlockError, false);\r\n        };\r\n        this.dispose = function () {\r\n            this.disconnect();\r\n        };\r\n        this.getObject = function () {\r\n            return camera;\r\n        };\r\n        this.getDirection = function () {\r\n            var direction = new THREE.Vector3(0, 0, -1);\r\n            return function (v) {\r\n                return v.copy(direction).applyQuaternion(camera.quaternion);\r\n            };\r\n        }();\r\n        this.moveForward = function (distance) {\r\n            vec.setFromMatrixColumn(camera.matrix, 0);\r\n            vec.crossVectors(camera.up, vec);\r\n            camera.position.addScaledVector(vec, distance);\r\n        };\r\n        this.moveRight = function (distance) {\r\n            vec.setFromMatrixColumn(camera.matrix, 0);\r\n            camera.position.addScaledVector(vec, distance);\r\n        };\r\n        this.lock = function () {\r\n            this.domElement.requestPointerLock();\r\n        };\r\n        this.unlock = function () {\r\n            document.exitPointerLock();\r\n        };\r\n        this.connect();\r\n    };\r\n    \r\n    PointerLockControls.prototype = Object.create(THREE.EventDispatcher.prototype);\r\n    PointerLockControls.prototype.constructor = PointerLockControls;\r\n\r\n    return threex.controls.PointerLockControls = PointerLockControls;\r\n});"]}