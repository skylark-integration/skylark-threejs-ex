{"version":3,"sources":["controls/experimental/CameraControls.js"],"names":["define","THREE","threex","CameraControls","object","domElement","offset","quat","quatInverse","lastPosition","lastQuaternion","q","vec","undefined","console","warn","document","error","this","enabled","target","Vector3","trackball","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","Math","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","position","quaternion0","quaternion","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","scope","copy","reset","updateProjectionMatrix","dispatchEvent","changeEvent","update","state","STATE","NONE","Quaternion","setFromUnitVectors","up","inverse","sub","sphericalDelta","set","applyQuaternion","factor","setFromAxisAngle","premultiply","multiplyScalar","scale","clampLength","rotateLeft","setFromVector3","max","min","makeSafe","radius","setFromSpherical","addScaledVector","panOffset","add","lookAt","zoomChanged","distanceToSquared","EPS","dot","dispose","removeEventListener","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","onKeyDown","type","startEvent","endEvent","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","v","panLeft","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","length","tan","fov","clientHeight","matrix","isOrthographicCamera","right","left","clientWidth","top","bottom","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","event","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","x","y","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","subVectors","handleTouchMovePan","handleTouchMoveDolly","mouseAction","preventDefault","focus","window","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","addEventListener","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","stopPropagation","handleMouseWheel","needsUpdate","keyCode","handleKeyDown","handleTouchStartDollyPan","DOLLY_ROTATE","handleTouchStartDollyRotate","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","tabIndex","prototype","Object","create","EventDispatcher","constructor","controls","experimental"],"mappings":"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","file":"../../../controls/experimental/CameraControls.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    \"../../threex\"\n], function (\n    THREE,\n    threex\n) {\n    'use strict';\n    var CameraControls = function (object, domElement) {\n        if (domElement === undefined)\n            console.warn('THREE.CameraControls: The second parameter \"domElement\" is now mandatory.');\n        if (domElement === document)\n            console.error('THREE.CameraControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n        this.object = object;\n        this.domElement = domElement;\n        this.enabled = true;\n        this.target = new THREE.Vector3();\n        this.trackball = false;\n        this.minDistance = 0;\n        this.maxDistance = Infinity;\n        this.minZoom = 0;\n        this.maxZoom = Infinity;\n        this.minPolarAngle = 0;\n        this.maxPolarAngle = Math.PI;\n        this.minAzimuthAngle = -Infinity;\n        this.maxAzimuthAngle = Infinity;\n        this.enableDamping = false;\n        this.dampingFactor = 0.05;\n        this.enableZoom = true;\n        this.zoomSpeed = 1;\n        this.enableRotate = true;\n        this.rotateSpeed = 1;\n        this.enablePan = true;\n        this.panSpeed = 1;\n        this.screenSpacePanning = false;\n        this.keyPanSpeed = 7;\n        this.autoRotate = false;\n        this.autoRotateSpeed = 2;\n        this.enableKeys = true;\n        this.keys = {\n            LEFT: 37,\n            UP: 38,\n            RIGHT: 39,\n            BOTTOM: 40\n        };\n        this.mouseButtons = {\n            LEFT: THREE.MOUSE.ROTATE,\n            MIDDLE: THREE.MOUSE.DOLLY,\n            RIGHT: THREE.MOUSE.PAN\n        };\n        this.touches = {\n            ONE: THREE.TOUCH.ROTATE,\n            TWO: THREE.TOUCH.DOLLY_PAN\n        };\n        this.target0 = this.target.clone();\n        this.position0 = this.object.position.clone();\n        this.quaternion0 = this.object.quaternion.clone();\n        this.zoom0 = this.object.zoom;\n        this.getPolarAngle = function () {\n            return spherical.phi;\n        };\n        this.getAzimuthalAngle = function () {\n            return spherical.theta;\n        };\n        this.saveState = function () {\n            scope.target0.copy(scope.target);\n            scope.position0.copy(scope.object.position);\n            scope.quaternion0.copy(scope.object.quaternion);\n            scope.zoom0 = scope.object.zoom;\n        };\n        this.reset = function () {\n            scope.target.copy(scope.target0);\n            scope.object.position.copy(scope.position0);\n            scope.object.quaternion.copy(scope.quaternion0);\n            scope.object.zoom = scope.zoom0;\n            scope.object.updateProjectionMatrix();\n            scope.dispatchEvent(changeEvent);\n            scope.update();\n            state = STATE.NONE;\n        };\n        this.update = function () {\n            var offset = new THREE.Vector3();\n            var quat = new THREE.Quaternion().setFromUnitVectors(object.up, new THREE.Vector3(0, 1, 0));\n            var quatInverse = quat.clone().inverse();\n            var lastPosition = new THREE.Vector3();\n            var lastQuaternion = new THREE.Quaternion();\n            var q = new THREE.Quaternion();\n            var vec = new THREE.Vector3();\n            return function update() {\n                var position = scope.object.position;\n                offset.copy(position).sub(scope.target);\n                if (scope.trackball) {\n                    if (sphericalDelta.theta) {\n                        vec.set(0, 1, 0).applyQuaternion(scope.object.quaternion);\n                        var factor = scope.enableDamping ? scope.dampingFactor : 1;\n                        q.setFromAxisAngle(vec, sphericalDelta.theta * factor);\n                        scope.object.quaternion.premultiply(q);\n                        offset.applyQuaternion(q);\n                    }\n                    if (sphericalDelta.phi) {\n                        vec.set(1, 0, 0).applyQuaternion(scope.object.quaternion);\n                        var factor = scope.enableDamping ? scope.dampingFactor : 1;\n                        q.setFromAxisAngle(vec, sphericalDelta.phi * factor);\n                        scope.object.quaternion.premultiply(q);\n                        offset.applyQuaternion(q);\n                    }\n                    offset.multiplyScalar(scale);\n                    offset.clampLength(scope.minDistance, scope.maxDistance);\n                } else {\n                    offset.applyQuaternion(quat);\n                    if (scope.autoRotate && state === STATE.NONE) {\n                        rotateLeft(getAutoRotationAngle());\n                    }\n                    spherical.setFromVector3(offset);\n                    if (scope.enableDamping) {\n                        spherical.theta += sphericalDelta.theta * scope.dampingFactor;\n                        spherical.phi += sphericalDelta.phi * scope.dampingFactor;\n                    } else {\n                        spherical.theta += sphericalDelta.theta;\n                        spherical.phi += sphericalDelta.phi;\n                    }\n                    spherical.theta = Math.max(scope.minAzimuthAngle, Math.min(scope.maxAzimuthAngle, spherical.theta));\n                    spherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\n                    spherical.makeSafe();\n                    spherical.radius *= scale;\n                    spherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius));\n                    offset.setFromSpherical(spherical);\n                    offset.applyQuaternion(quatInverse);\n                }\n                if (scope.enableDamping === true) {\n                    scope.target.addScaledVector(panOffset, scope.dampingFactor);\n                } else {\n                    scope.target.add(panOffset);\n                }\n                position.copy(scope.target).add(offset);\n                if (scope.trackball === false) {\n                    scope.object.lookAt(scope.target);\n                }\n                if (scope.enableDamping === true) {\n                    sphericalDelta.theta *= 1 - scope.dampingFactor;\n                    sphericalDelta.phi *= 1 - scope.dampingFactor;\n                    panOffset.multiplyScalar(1 - scope.dampingFactor);\n                } else {\n                    sphericalDelta.set(0, 0, 0);\n                    panOffset.set(0, 0, 0);\n                }\n                scale = 1;\n                if (zoomChanged || lastPosition.distanceToSquared(scope.object.position) > EPS || 8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS) {\n                    scope.dispatchEvent(changeEvent);\n                    lastPosition.copy(scope.object.position);\n                    lastQuaternion.copy(scope.object.quaternion);\n                    zoomChanged = false;\n                    return true;\n                }\n                return false;\n            };\n        }();\n        this.dispose = function () {\n            scope.domElement.removeEventListener('contextmenu', onContextMenu, false);\n            scope.domElement.removeEventListener('mousedown', onMouseDown, false);\n            scope.domElement.removeEventListener('wheel', onMouseWheel, false);\n            scope.domElement.removeEventListener('touchstart', onTouchStart, false);\n            scope.domElement.removeEventListener('touchend', onTouchEnd, false);\n            scope.domElement.removeEventListener('touchmove', onTouchMove, false);\n            document.removeEventListener('mousemove', onMouseMove, false);\n            document.removeEventListener('mouseup', onMouseUp, false);\n            scope.domElement.removeEventListener('keydown', onKeyDown, false);\n        };\n        var scope = this;\n        var changeEvent = { type: 'change' };\n        var startEvent = { type: 'start' };\n        var endEvent = { type: 'end' };\n        var STATE = {\n            NONE: -1,\n            ROTATE: 0,\n            DOLLY: 1,\n            PAN: 2,\n            TOUCH_ROTATE: 3,\n            TOUCH_PAN: 4,\n            TOUCH_DOLLY_PAN: 5,\n            TOUCH_DOLLY_ROTATE: 6\n        };\n        var state = STATE.NONE;\n        var EPS = 0.000001;\n        var spherical = new THREE.Spherical();\n        var sphericalDelta = new THREE.Spherical();\n        var scale = 1;\n        var panOffset = new THREE.Vector3();\n        var zoomChanged = false;\n        var rotateStart = new THREE.Vector2();\n        var rotateEnd = new THREE.Vector2();\n        var rotateDelta = new THREE.Vector2();\n        var panStart = new THREE.Vector2();\n        var panEnd = new THREE.Vector2();\n        var panDelta = new THREE.Vector2();\n        var dollyStart = new THREE.Vector2();\n        var dollyEnd = new THREE.Vector2();\n        var dollyDelta = new THREE.Vector2();\n        function getAutoRotationAngle() {\n            return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n        }\n        function getZoomScale() {\n            return Math.pow(0.95, scope.zoomSpeed);\n        }\n        function rotateLeft(angle) {\n            sphericalDelta.theta -= angle;\n        }\n        function rotateUp(angle) {\n            sphericalDelta.phi -= angle;\n        }\n        var panLeft = function () {\n            var v = new THREE.Vector3();\n            return function panLeft(distance, objectMatrix) {\n                v.setFromMatrixColumn(objectMatrix, 0);\n                v.multiplyScalar(-distance);\n                panOffset.add(v);\n            };\n        }();\n        var panUp = function () {\n            var v = new THREE.Vector3();\n            return function panUp(distance, objectMatrix) {\n                if (scope.screenSpacePanning === true) {\n                    v.setFromMatrixColumn(objectMatrix, 1);\n                } else {\n                    v.setFromMatrixColumn(objectMatrix, 0);\n                    v.crossVectors(scope.object.up, v);\n                }\n                v.multiplyScalar(distance);\n                panOffset.add(v);\n            };\n        }();\n        var pan = function () {\n            var offset = new THREE.Vector3();\n            return function pan(deltaX, deltaY) {\n                var element = scope.domElement;\n                if (scope.object.isPerspectiveCamera) {\n                    var position = scope.object.position;\n                    offset.copy(position).sub(scope.target);\n                    var targetDistance = offset.length();\n                    targetDistance *= Math.tan(scope.object.fov / 2 * Math.PI / 180);\n                    panLeft(2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix);\n                    panUp(2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix);\n                } else if (scope.object.isOrthographicCamera) {\n                    panLeft(deltaX * (scope.object.right - scope.object.left) / scope.object.zoom / element.clientWidth, scope.object.matrix);\n                    panUp(deltaY * (scope.object.top - scope.object.bottom) / scope.object.zoom / element.clientHeight, scope.object.matrix);\n                } else {\n                    console.warn('WARNING: CameraControls.js encountered an unknown camera type - pan disabled.');\n                    scope.enablePan = false;\n                }\n            };\n        }();\n        function dollyIn(dollyScale) {\n            if (scope.object.isPerspectiveCamera) {\n                scale /= dollyScale;\n            } else if (scope.object.isOrthographicCamera) {\n                scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom * dollyScale));\n                scope.object.updateProjectionMatrix();\n                zoomChanged = true;\n            } else {\n                console.warn('WARNING: CameraControls.js encountered an unknown camera type - dolly/zoom disabled.');\n                scope.enableZoom = false;\n            }\n        }\n        function dollyOut(dollyScale) {\n            if (scope.object.isPerspectiveCamera) {\n                scale *= dollyScale;\n            } else if (scope.object.isOrthographicCamera) {\n                scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / dollyScale));\n                scope.object.updateProjectionMatrix();\n                zoomChanged = true;\n            } else {\n                console.warn('WARNING: CameraControls.js encountered an unknown camera type - dolly/zoom disabled.');\n                scope.enableZoom = false;\n            }\n        }\n        function handleMouseDownRotate(event) {\n            rotateStart.set(event.clientX, event.clientY);\n        }\n        function handleMouseDownDolly(event) {\n            dollyStart.set(event.clientX, event.clientY);\n        }\n        function handleMouseDownPan(event) {\n            panStart.set(event.clientX, event.clientY);\n        }\n        function handleMouseMoveRotate(event) {\n            rotateEnd.set(event.clientX, event.clientY);\n            rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n            var element = scope.domElement;\n            rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight);\n            rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n            rotateStart.copy(rotateEnd);\n            scope.update();\n        }\n        function handleMouseMoveDolly(event) {\n            dollyEnd.set(event.clientX, event.clientY);\n            dollyDelta.subVectors(dollyEnd, dollyStart);\n            if (dollyDelta.y > 0) {\n                dollyIn(getZoomScale());\n            } else if (dollyDelta.y < 0) {\n                dollyOut(getZoomScale());\n            }\n            dollyStart.copy(dollyEnd);\n            scope.update();\n        }\n        function handleMouseMovePan(event) {\n            panEnd.set(event.clientX, event.clientY);\n            panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n            pan(panDelta.x, panDelta.y);\n            panStart.copy(panEnd);\n            scope.update();\n        }\n        function handleMouseUp() {\n        }\n        function handleMouseWheel(event) {\n            if (event.deltaY < 0) {\n                dollyOut(getZoomScale());\n            } else if (event.deltaY > 0) {\n                dollyIn(getZoomScale());\n            }\n            scope.update();\n        }\n        function handleKeyDown(event) {\n            var needsUpdate = false;\n            switch (event.keyCode) {\n            case scope.keys.UP:\n                pan(0, scope.keyPanSpeed);\n                needsUpdate = true;\n                break;\n            case scope.keys.BOTTOM:\n                pan(0, -scope.keyPanSpeed);\n                needsUpdate = true;\n                break;\n            case scope.keys.LEFT:\n                pan(scope.keyPanSpeed, 0);\n                needsUpdate = true;\n                break;\n            case scope.keys.RIGHT:\n                pan(-scope.keyPanSpeed, 0);\n                needsUpdate = true;\n                break;\n            }\n            if (needsUpdate) {\n                event.preventDefault();\n                scope.update();\n            }\n        }\n        function handleTouchStartRotate(event) {\n            if (event.touches.length == 1) {\n                rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n            } else {\n                var x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n                var y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n                rotateStart.set(x, y);\n            }\n        }\n        function handleTouchStartPan(event) {\n            if (event.touches.length == 1) {\n                panStart.set(event.touches[0].pageX, event.touches[0].pageY);\n            } else {\n                var x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n                var y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n                panStart.set(x, y);\n            }\n        }\n        function handleTouchStartDolly(event) {\n            var dx = event.touches[0].pageX - event.touches[1].pageX;\n            var dy = event.touches[0].pageY - event.touches[1].pageY;\n            var distance = Math.sqrt(dx * dx + dy * dy);\n            dollyStart.set(0, distance);\n        }\n        function handleTouchStartDollyPan(event) {\n            if (scope.enableZoom)\n                handleTouchStartDolly(event);\n            if (scope.enablePan)\n                handleTouchStartPan(event);\n        }\n        function handleTouchStartDollyRotate(event) {\n            if (scope.enableZoom)\n                handleTouchStartDolly(event);\n            if (scope.enableRotate)\n                handleTouchStartRotate(event);\n        }\n        function handleTouchMoveRotate(event) {\n            if (event.touches.length == 1) {\n                rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n            } else {\n                var x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n                var y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n                rotateEnd.set(x, y);\n            }\n            rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n            var element = scope.domElement;\n            rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight);\n            rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n            rotateStart.copy(rotateEnd);\n        }\n        function handleTouchMovePan(event) {\n            if (event.touches.length == 1) {\n                panEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n            } else {\n                var x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n                var y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n                panEnd.set(x, y);\n            }\n            panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n            pan(panDelta.x, panDelta.y);\n            panStart.copy(panEnd);\n        }\n        function handleTouchMoveDolly(event) {\n            var dx = event.touches[0].pageX - event.touches[1].pageX;\n            var dy = event.touches[0].pageY - event.touches[1].pageY;\n            var distance = Math.sqrt(dx * dx + dy * dy);\n            dollyEnd.set(0, distance);\n            dollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed));\n            dollyIn(dollyDelta.y);\n            dollyStart.copy(dollyEnd);\n        }\n        function handleTouchMoveDollyPan(event) {\n            if (scope.enableZoom)\n                handleTouchMoveDolly(event);\n            if (scope.enablePan)\n                handleTouchMovePan(event);\n        }\n        function handleTouchMoveDollyRotate(event) {\n            if (scope.enableZoom)\n                handleTouchMoveDolly(event);\n            if (scope.enableRotate)\n                handleTouchMoveRotate(event);\n        }\n        function handleTouchEnd() {\n        }\n        function onMouseDown(event) {\n            if (scope.enabled === false)\n                return;\n            event.preventDefault();\n            scope.domElement.focus ? scope.domElement.focus() : window.focus();\n            var mouseAction;\n            switch (event.button) {\n            case 0:\n                mouseAction = scope.mouseButtons.LEFT;\n                break;\n            case 1:\n                mouseAction = scope.mouseButtons.MIDDLE;\n                break;\n            case 2:\n                mouseAction = scope.mouseButtons.RIGHT;\n                break;\n            default:\n                mouseAction = -1;\n            }\n            switch (mouseAction) {\n            case THREE.MOUSE.DOLLY:\n                if (scope.enableZoom === false)\n                    return;\n                handleMouseDownDolly(event);\n                state = STATE.DOLLY;\n                break;\n            case THREE.MOUSE.ROTATE:\n                if (event.ctrlKey || event.metaKey || event.shiftKey) {\n                    if (scope.enablePan === false)\n                        return;\n                    handleMouseDownPan(event);\n                    state = STATE.PAN;\n                } else {\n                    if (scope.enableRotate === false)\n                        return;\n                    handleMouseDownRotate(event);\n                    state = STATE.ROTATE;\n                }\n                break;\n            case THREE.MOUSE.PAN:\n                if (event.ctrlKey || event.metaKey || event.shiftKey) {\n                    if (scope.enableRotate === false)\n                        return;\n                    handleMouseDownRotate(event);\n                    state = STATE.ROTATE;\n                } else {\n                    if (scope.enablePan === false)\n                        return;\n                    handleMouseDownPan(event);\n                    state = STATE.PAN;\n                }\n                break;\n            default:\n                state = STATE.NONE;\n            }\n            if (state !== STATE.NONE) {\n                document.addEventListener('mousemove', onMouseMove, false);\n                document.addEventListener('mouseup', onMouseUp, false);\n                scope.dispatchEvent(startEvent);\n            }\n        }\n        function onMouseMove(event) {\n            if (scope.enabled === false)\n                return;\n            event.preventDefault();\n            switch (state) {\n            case STATE.ROTATE:\n                if (scope.enableRotate === false)\n                    return;\n                handleMouseMoveRotate(event);\n                break;\n            case STATE.DOLLY:\n                if (scope.enableZoom === false)\n                    return;\n                handleMouseMoveDolly(event);\n                break;\n            case STATE.PAN:\n                if (scope.enablePan === false)\n                    return;\n                handleMouseMovePan(event);\n                break;\n            }\n        }\n        function onMouseUp(event) {\n            if (scope.enabled === false)\n                return;\n            handleMouseUp(event);\n            document.removeEventListener('mousemove', onMouseMove, false);\n            document.removeEventListener('mouseup', onMouseUp, false);\n            scope.dispatchEvent(endEvent);\n            state = STATE.NONE;\n        }\n        function onMouseWheel(event) {\n            if (scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE && state !== STATE.ROTATE)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            scope.dispatchEvent(startEvent);\n            handleMouseWheel(event);\n            scope.dispatchEvent(endEvent);\n        }\n        function onKeyDown(event) {\n            if (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false)\n                return;\n            handleKeyDown(event);\n        }\n        function onTouchStart(event) {\n            if (scope.enabled === false)\n                return;\n            event.preventDefault();\n            switch (event.touches.length) {\n            case 1:\n                switch (scope.touches.ONE) {\n                case THREE.TOUCH.ROTATE:\n                    if (scope.enableRotate === false)\n                        return;\n                    handleTouchStartRotate(event);\n                    state = STATE.TOUCH_ROTATE;\n                    break;\n                case THREE.TOUCH.PAN:\n                    if (scope.enablePan === false)\n                        return;\n                    handleTouchStartPan(event);\n                    state = STATE.TOUCH_PAN;\n                    break;\n                default:\n                    state = STATE.NONE;\n                }\n                break;\n            case 2:\n                switch (scope.touches.TWO) {\n                case THREE.TOUCH.DOLLY_PAN:\n                    if (scope.enableZoom === false && scope.enablePan === false)\n                        return;\n                    handleTouchStartDollyPan(event);\n                    state = STATE.TOUCH_DOLLY_PAN;\n                    break;\n                case THREE.TOUCH.DOLLY_ROTATE:\n                    if (scope.enableZoom === false && scope.enableRotate === false)\n                        return;\n                    handleTouchStartDollyRotate(event);\n                    state = STATE.TOUCH_DOLLY_ROTATE;\n                    break;\n                default:\n                    state = STATE.NONE;\n                }\n                break;\n            default:\n                state = STATE.NONE;\n            }\n            if (state !== STATE.NONE) {\n                scope.dispatchEvent(startEvent);\n            }\n        }\n        function onTouchMove(event) {\n            if (scope.enabled === false)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            switch (state) {\n            case STATE.TOUCH_ROTATE:\n                if (scope.enableRotate === false)\n                    return;\n                handleTouchMoveRotate(event);\n                scope.update();\n                break;\n            case STATE.TOUCH_PAN:\n                if (scope.enablePan === false)\n                    return;\n                handleTouchMovePan(event);\n                scope.update();\n                break;\n            case STATE.TOUCH_DOLLY_PAN:\n                if (scope.enableZoom === false && scope.enablePan === false)\n                    return;\n                handleTouchMoveDollyPan(event);\n                scope.update();\n                break;\n            case STATE.TOUCH_DOLLY_ROTATE:\n                if (scope.enableZoom === false && scope.enableRotate === false)\n                    return;\n                handleTouchMoveDollyRotate(event);\n                scope.update();\n                break;\n            default:\n                state = STATE.NONE;\n            }\n        }\n        function onTouchEnd(event) {\n            if (scope.enabled === false)\n                return;\n            handleTouchEnd(event);\n            scope.dispatchEvent(endEvent);\n            state = STATE.NONE;\n        }\n        function onContextMenu(event) {\n            if (scope.enabled === false)\n                return;\n            event.preventDefault();\n        }\n        scope.domElement.addEventListener('contextmenu', onContextMenu, false);\n        scope.domElement.addEventListener('mousedown', onMouseDown, false);\n        scope.domElement.addEventListener('wheel', onMouseWheel, false);\n        scope.domElement.addEventListener('touchstart', onTouchStart, false);\n        scope.domElement.addEventListener('touchend', onTouchEnd, false);\n        scope.domElement.addEventListener('touchmove', onTouchMove, false);\n        scope.domElement.addEventListener('keydown', onKeyDown, false);\n        if (scope.domElement.tabIndex === -1) {\n            scope.domElement.tabIndex = 0;\n        }\n        this.object.lookAt(scope.target);\n        this.update();\n        this.saveState();\n    };\n    CameraControls.prototype = Object.create(THREE.EventDispatcher.prototype);\n    CameraControls.prototype.constructor = CameraControls;\n\n    return threex.controls.experimental.CameraControls = CameraControls;\n});"]}