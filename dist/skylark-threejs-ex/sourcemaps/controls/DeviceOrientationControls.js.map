{"version":3,"sources":["controls/DeviceOrientationControls.js"],"names":["define","THREE","threex","controls","DeviceOrientationControls","object","scope","this","rotation","reorder","enabled","deviceOrientation","screenOrientation","alphaOffset","zee","euler","q0","q1","onDeviceOrientationChangeEvent","event","onScreenOrientationChangeEvent","window","orientation","setObjectQuaternion","Vector3","Euler","Quaternion","Math","sqrt","quaternion","alpha","beta","gamma","orient","set","setFromEuler","multiply","setFromAxisAngle","connect","undefined","DeviceOrientationEvent","requestPermission","then","response","addEventListener","catch","error","console","disconnect","removeEventListener","update","device","MathUtils","degToRad","dispose"],"mappings":";;;;;;;AAAAA,QACI,kBACA,aACD,SACCC,EACAC,GAEA,aAkEA,OAAOA,EAAOC,SAASC,0BAjES,SAAUC,GACtC,IAAIC,EAAQC,KACZA,KAAKF,OAASA,EACdE,KAAKF,OAAOG,SAASC,QAAQ,OAC7BF,KAAKG,SAAU,EACfH,KAAKI,qBACLJ,KAAKK,kBAAoB,EACzBL,KAAKM,YAAc,EACnB,IAOQC,EACAC,EACAC,EACAC,EAVJC,EAAiC,SAAUC,GAC3Cb,EAAMK,kBAAoBQ,GAE1BC,EAAiC,WACjCd,EAAMM,kBAAoBS,OAAOC,aAAe,GAEhDC,GACIT,EAAM,IAAIb,EAAMuB,QAAQ,EAAG,EAAG,GAC9BT,EAAQ,IAAId,EAAMwB,MAClBT,EAAK,IAAIf,EAAMyB,WACfT,EAAK,IAAIhB,EAAMyB,YAAYC,KAAKC,KAAK,IAAM,EAAG,EAAGD,KAAKC,KAAK,KACxD,SAAUC,EAAYC,EAAOC,EAAMC,EAAOC,GAC7ClB,EAAMmB,IAAIH,EAAMD,GAAQE,EAAO,OAC/BH,EAAWM,aAAapB,GACxBc,EAAWO,SAASnB,GACpBY,EAAWO,SAASpB,EAAGqB,iBAAiBvB,GAAMmB,MAGtD1B,KAAK+B,QAAU,WACXlB,SACsCmB,IAAlClB,OAAOmB,wBAAmG,mBAApDnB,OAAOmB,uBAAuBC,kBACpFpB,OAAOmB,uBAAuBC,oBAAoBC,KAAK,SAAUC,GAC7C,WAAZA,IACAtB,OAAOuB,iBAAiB,oBAAqBxB,GAAgC,GAC7EC,OAAOuB,iBAAiB,oBAAqB1B,GAAgC,MAElF2B,MAAM,SAAUC,GACfC,QAAQD,MAAM,wEAAyEA,MAG3FzB,OAAOuB,iBAAiB,oBAAqBxB,GAAgC,GAC7EC,OAAOuB,iBAAiB,oBAAqB1B,GAAgC,IAEjFZ,EAAMI,SAAU,GAEpBH,KAAKyC,WAAa,WACd3B,OAAO4B,oBAAoB,oBAAqB7B,GAAgC,GAChFC,OAAO4B,oBAAoB,oBAAqB/B,GAAgC,GAChFZ,EAAMI,SAAU,GAEpBH,KAAK2C,OAAS,WACV,IAAsB,IAAlB5C,EAAMI,QAAV,CAEA,IAAIyC,EAAS7C,EAAMK,kBACnB,GAAIwC,EAAQ,CACR,IAAIrB,EAAQqB,EAAOrB,MAAQ7B,EAAMmD,UAAUC,SAASF,EAAOrB,OAASxB,EAAMO,YAAc,EACpFkB,EAAOoB,EAAOpB,KAAO9B,EAAMmD,UAAUC,SAASF,EAAOpB,MAAQ,EAC7DC,EAAQmB,EAAOnB,MAAQ/B,EAAMmD,UAAUC,SAASF,EAAOnB,OAAS,EAChEC,EAAS3B,EAAMM,kBAAoBX,EAAMmD,UAAUC,SAAS/C,EAAMM,mBAAqB,EAC3FW,EAAoBjB,EAAMD,OAAOwB,WAAYC,EAAOC,EAAMC,EAAOC,MAGzE1B,KAAK+C,QAAU,WACXhD,EAAM0C,cAEVzC,KAAK+B","file":"../../controls/DeviceOrientationControls.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var DeviceOrientationControls = function (object) {\r\n        var scope = this;\r\n        this.object = object;\r\n        this.object.rotation.reorder('YXZ');\r\n        this.enabled = true;\r\n        this.deviceOrientation = {};\r\n        this.screenOrientation = 0;\r\n        this.alphaOffset = 0;\r\n        var onDeviceOrientationChangeEvent = function (event) {\r\n            scope.deviceOrientation = event;\r\n        };\r\n        var onScreenOrientationChangeEvent = function () {\r\n            scope.screenOrientation = window.orientation || 0;\r\n        };\r\n        var setObjectQuaternion = function () {\r\n            var zee = new THREE.Vector3(0, 0, 1);\r\n            var euler = new THREE.Euler();\r\n            var q0 = new THREE.Quaternion();\r\n            var q1 = new THREE.Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5));\r\n            return function (quaternion, alpha, beta, gamma, orient) {\r\n                euler.set(beta, alpha, -gamma, 'YXZ');\r\n                quaternion.setFromEuler(euler);\r\n                quaternion.multiply(q1);\r\n                quaternion.multiply(q0.setFromAxisAngle(zee, -orient));\r\n            };\r\n        }();\r\n        this.connect = function () {\r\n            onScreenOrientationChangeEvent();\r\n            if (window.DeviceOrientationEvent !== undefined && typeof window.DeviceOrientationEvent.requestPermission === 'function') {\r\n                window.DeviceOrientationEvent.requestPermission().then(function (response) {\r\n                    if (response == 'granted') {\r\n                        window.addEventListener('orientationchange', onScreenOrientationChangeEvent, false);\r\n                        window.addEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.error('THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:', error);\r\n                });\r\n            } else {\r\n                window.addEventListener('orientationchange', onScreenOrientationChangeEvent, false);\r\n                window.addEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);\r\n            }\r\n            scope.enabled = true;\r\n        };\r\n        this.disconnect = function () {\r\n            window.removeEventListener('orientationchange', onScreenOrientationChangeEvent, false);\r\n            window.removeEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);\r\n            scope.enabled = false;\r\n        };\r\n        this.update = function () {\r\n            if (scope.enabled === false)\r\n                return;\r\n            var device = scope.deviceOrientation;\r\n            if (device) {\r\n                var alpha = device.alpha ? THREE.MathUtils.degToRad(device.alpha) + scope.alphaOffset : 0;\r\n                var beta = device.beta ? THREE.MathUtils.degToRad(device.beta) : 0;\r\n                var gamma = device.gamma ? THREE.MathUtils.degToRad(device.gamma) : 0;\r\n                var orient = scope.screenOrientation ? THREE.MathUtils.degToRad(scope.screenOrientation) : 0;\r\n                setObjectQuaternion(scope.object.quaternion, alpha, beta, gamma, orient);\r\n            }\r\n        };\r\n        this.dispose = function () {\r\n            scope.disconnect();\r\n        };\r\n        this.connect();\r\n    };\r\n    return threex.controls.DeviceOrientationControls = DeviceOrientationControls;\r\n});"]}