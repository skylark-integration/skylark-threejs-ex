{"version":3,"sources":["controls/TrackballControls.js"],"names":["define","THREE","TrackballControls","object","domElement","undefined","console","warn","document","error","_this","this","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","MIDDLE","RIGHT","target","Vector3","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","box","getBoundingClientRect","d","ownerDocument","documentElement","window","pageXOffset","clientLeft","pageYOffset","clientTop","vector","angle","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","mouseChange","objectUp","pan","getMouseOnScreen","pageX","pageY","set","getMouseOnCircle","keydown","event","removeEventListener","keyCode","keyup","addEventListener","mousedown","preventDefault","stopPropagation","button","state","copy","mousemove","mouseup","dispatchEvent","mousewheel","deltaMode","y","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","x","touchmove","touchend","contextmenu","rotateCamera","Quaternion","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","panCamera","lengthSq","scale_x","right","clientWidth","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","prototype","Object","create","EventDispatcher","constructor"],"mappings":"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","file":"../../controls/TrackballControls.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    var TrackballControls = function (object, domElement) {\n        if (domElement === undefined)\n            console.warn('THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.');\n        if (domElement === document)\n            console.error('THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n        var _this = this;\n        var STATE = {\n            NONE: -1,\n            ROTATE: 0,\n            ZOOM: 1,\n            PAN: 2,\n            TOUCH_ROTATE: 3,\n            TOUCH_ZOOM_PAN: 4\n        };\n        this.object = object;\n        this.domElement = domElement;\n        this.enabled = true;\n        this.screen = {\n            left: 0,\n            top: 0,\n            width: 0,\n            height: 0\n        };\n        this.rotateSpeed = 1;\n        this.zoomSpeed = 1.2;\n        this.panSpeed = 0.3;\n        this.noRotate = false;\n        this.noZoom = false;\n        this.noPan = false;\n        this.staticMoving = false;\n        this.dynamicDampingFactor = 0.2;\n        this.minDistance = 0;\n        this.maxDistance = Infinity;\n        this.keys = [\n            65,\n            83,\n            68\n        ];\n        this.mouseButtons = {\n            LEFT: THREE.MOUSE.ROTATE,\n            MIDDLE: THREE.MOUSE.ZOOM,\n            RIGHT: THREE.MOUSE.PAN\n        };\n        this.target = new THREE.Vector3();\n        var EPS = 0.000001;\n        var lastPosition = new THREE.Vector3();\n        var lastZoom = 1;\n        var _state = STATE.NONE, _keyState = STATE.NONE, _eye = new THREE.Vector3(), _movePrev = new THREE.Vector2(), _moveCurr = new THREE.Vector2(), _lastAxis = new THREE.Vector3(), _lastAngle = 0, _zoomStart = new THREE.Vector2(), _zoomEnd = new THREE.Vector2(), _touchZoomDistanceStart = 0, _touchZoomDistanceEnd = 0, _panStart = new THREE.Vector2(), _panEnd = new THREE.Vector2();\n        this.target0 = this.target.clone();\n        this.position0 = this.object.position.clone();\n        this.up0 = this.object.up.clone();\n        this.zoom0 = this.object.zoom;\n        var changeEvent = { type: 'change' };\n        var startEvent = { type: 'start' };\n        var endEvent = { type: 'end' };\n        this.handleResize = function () {\n            var box = this.domElement.getBoundingClientRect();\n            var d = this.domElement.ownerDocument.documentElement;\n            this.screen.left = box.left + window.pageXOffset - d.clientLeft;\n            this.screen.top = box.top + window.pageYOffset - d.clientTop;\n            this.screen.width = box.width;\n            this.screen.height = box.height;\n        };\n        var getMouseOnScreen = function () {\n            var vector = new THREE.Vector2();\n            return function getMouseOnScreen(pageX, pageY) {\n                vector.set((pageX - _this.screen.left) / _this.screen.width, (pageY - _this.screen.top) / _this.screen.height);\n                return vector;\n            };\n        }();\n        var getMouseOnCircle = function () {\n            var vector = new THREE.Vector2();\n            return function getMouseOnCircle(pageX, pageY) {\n                vector.set((pageX - _this.screen.width * 0.5 - _this.screen.left) / (_this.screen.width * 0.5), (_this.screen.height + 2 * (_this.screen.top - pageY)) / _this.screen.width);\n                return vector;\n            };\n        }();\n        this.rotateCamera = function () {\n            var axis = new THREE.Vector3(), quaternion = new THREE.Quaternion(), eyeDirection = new THREE.Vector3(), objectUpDirection = new THREE.Vector3(), objectSidewaysDirection = new THREE.Vector3(), moveDirection = new THREE.Vector3(), angle;\n            return function rotateCamera() {\n                moveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\n                angle = moveDirection.length();\n                if (angle) {\n                    _eye.copy(_this.object.position).sub(_this.target);\n                    eyeDirection.copy(_eye).normalize();\n                    objectUpDirection.copy(_this.object.up).normalize();\n                    objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\n                    objectUpDirection.setLength(_moveCurr.y - _movePrev.y);\n                    objectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\n                    moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\n                    axis.crossVectors(moveDirection, _eye).normalize();\n                    angle *= _this.rotateSpeed;\n                    quaternion.setFromAxisAngle(axis, angle);\n                    _eye.applyQuaternion(quaternion);\n                    _this.object.up.applyQuaternion(quaternion);\n                    _lastAxis.copy(axis);\n                    _lastAngle = angle;\n                } else if (!_this.staticMoving && _lastAngle) {\n                    _lastAngle *= Math.sqrt(1 - _this.dynamicDampingFactor);\n                    _eye.copy(_this.object.position).sub(_this.target);\n                    quaternion.setFromAxisAngle(_lastAxis, _lastAngle);\n                    _eye.applyQuaternion(quaternion);\n                    _this.object.up.applyQuaternion(quaternion);\n                }\n                _movePrev.copy(_moveCurr);\n            };\n        }();\n        this.zoomCamera = function () {\n            var factor;\n            if (_state === STATE.TOUCH_ZOOM_PAN) {\n                factor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n                _touchZoomDistanceStart = _touchZoomDistanceEnd;\n                if (_this.object.isPerspectiveCamera) {\n                    _eye.multiplyScalar(factor);\n                } else if (_this.object.isOrthographicCamera) {\n                    _this.object.zoom *= factor;\n                    _this.object.updateProjectionMatrix();\n                } else {\n                    console.warn('THREE.TrackballControls: Unsupported camera type');\n                }\n            } else {\n                factor = 1 + (_zoomEnd.y - _zoomStart.y) * _this.zoomSpeed;\n                if (factor !== 1 && factor > 0) {\n                    if (_this.object.isPerspectiveCamera) {\n                        _eye.multiplyScalar(factor);\n                    } else if (_this.object.isOrthographicCamera) {\n                        _this.object.zoom /= factor;\n                        _this.object.updateProjectionMatrix();\n                    } else {\n                        console.warn('THREE.TrackballControls: Unsupported camera type');\n                    }\n                }\n                if (_this.staticMoving) {\n                    _zoomStart.copy(_zoomEnd);\n                } else {\n                    _zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\n                }\n            }\n        };\n        this.panCamera = function () {\n            var mouseChange = new THREE.Vector2(), objectUp = new THREE.Vector3(), pan = new THREE.Vector3();\n            return function panCamera() {\n                mouseChange.copy(_panEnd).sub(_panStart);\n                if (mouseChange.lengthSq()) {\n                    if (_this.object.isOrthographicCamera) {\n                        var scale_x = (_this.object.right - _this.object.left) / _this.object.zoom / _this.domElement.clientWidth;\n                        var scale_y = (_this.object.top - _this.object.bottom) / _this.object.zoom / _this.domElement.clientWidth;\n                        mouseChange.x *= scale_x;\n                        mouseChange.y *= scale_y;\n                    }\n                    mouseChange.multiplyScalar(_eye.length() * _this.panSpeed);\n                    pan.copy(_eye).cross(_this.object.up).setLength(mouseChange.x);\n                    pan.add(objectUp.copy(_this.object.up).setLength(mouseChange.y));\n                    _this.object.position.add(pan);\n                    _this.target.add(pan);\n                    if (_this.staticMoving) {\n                        _panStart.copy(_panEnd);\n                    } else {\n                        _panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(_this.dynamicDampingFactor));\n                    }\n                }\n            };\n        }();\n        this.checkDistances = function () {\n            if (!_this.noZoom || !_this.noPan) {\n                if (_eye.lengthSq() > _this.maxDistance * _this.maxDistance) {\n                    _this.object.position.addVectors(_this.target, _eye.setLength(_this.maxDistance));\n                    _zoomStart.copy(_zoomEnd);\n                }\n                if (_eye.lengthSq() < _this.minDistance * _this.minDistance) {\n                    _this.object.position.addVectors(_this.target, _eye.setLength(_this.minDistance));\n                    _zoomStart.copy(_zoomEnd);\n                }\n            }\n        };\n        this.update = function () {\n            _eye.subVectors(_this.object.position, _this.target);\n            if (!_this.noRotate) {\n                _this.rotateCamera();\n            }\n            if (!_this.noZoom) {\n                _this.zoomCamera();\n            }\n            if (!_this.noPan) {\n                _this.panCamera();\n            }\n            _this.object.position.addVectors(_this.target, _eye);\n            if (_this.object.isPerspectiveCamera) {\n                _this.checkDistances();\n                _this.object.lookAt(_this.target);\n                if (lastPosition.distanceToSquared(_this.object.position) > EPS) {\n                    _this.dispatchEvent(changeEvent);\n                    lastPosition.copy(_this.object.position);\n                }\n            } else if (_this.object.isOrthographicCamera) {\n                _this.object.lookAt(_this.target);\n                if (lastPosition.distanceToSquared(_this.object.position) > EPS || lastZoom !== _this.object.zoom) {\n                    _this.dispatchEvent(changeEvent);\n                    lastPosition.copy(_this.object.position);\n                    lastZoom = _this.object.zoom;\n                }\n            } else {\n                console.warn('THREE.TrackballControls: Unsupported camera type');\n            }\n        };\n        this.reset = function () {\n            _state = STATE.NONE;\n            _keyState = STATE.NONE;\n            _this.target.copy(_this.target0);\n            _this.object.position.copy(_this.position0);\n            _this.object.up.copy(_this.up0);\n            _this.object.zoom = _this.zoom0;\n            _this.object.updateProjectionMatrix();\n            _eye.subVectors(_this.object.position, _this.target);\n            _this.object.lookAt(_this.target);\n            _this.dispatchEvent(changeEvent);\n            lastPosition.copy(_this.object.position);\n            lastZoom = _this.object.zoom;\n        };\n        function keydown(event) {\n            if (_this.enabled === false)\n                return;\n            window.removeEventListener('keydown', keydown);\n            if (_keyState !== STATE.NONE) {\n                return;\n            } else if (event.keyCode === _this.keys[STATE.ROTATE] && !_this.noRotate) {\n                _keyState = STATE.ROTATE;\n            } else if (event.keyCode === _this.keys[STATE.ZOOM] && !_this.noZoom) {\n                _keyState = STATE.ZOOM;\n            } else if (event.keyCode === _this.keys[STATE.PAN] && !_this.noPan) {\n                _keyState = STATE.PAN;\n            }\n        }\n        function keyup() {\n            if (_this.enabled === false)\n                return;\n            _keyState = STATE.NONE;\n            window.addEventListener('keydown', keydown, false);\n        }\n        function mousedown(event) {\n            if (_this.enabled === false)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            if (_state === STATE.NONE) {\n                switch (event.button) {\n                case _this.mouseButtons.LEFT:\n                    _state = STATE.ROTATE;\n                    break;\n                case _this.mouseButtons.MIDDLE:\n                    _state = STATE.ZOOM;\n                    break;\n                case _this.mouseButtons.RIGHT:\n                    _state = STATE.PAN;\n                    break;\n                default:\n                    _state = STATE.NONE;\n                }\n            }\n            var state = _keyState !== STATE.NONE ? _keyState : _state;\n            if (state === STATE.ROTATE && !_this.noRotate) {\n                _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n                _movePrev.copy(_moveCurr);\n            } else if (state === STATE.ZOOM && !_this.noZoom) {\n                _zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n                _zoomEnd.copy(_zoomStart);\n            } else if (state === STATE.PAN && !_this.noPan) {\n                _panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n                _panEnd.copy(_panStart);\n            }\n            document.addEventListener('mousemove', mousemove, false);\n            document.addEventListener('mouseup', mouseup, false);\n            _this.dispatchEvent(startEvent);\n        }\n        function mousemove(event) {\n            if (_this.enabled === false)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            var state = _keyState !== STATE.NONE ? _keyState : _state;\n            if (state === STATE.ROTATE && !_this.noRotate) {\n                _movePrev.copy(_moveCurr);\n                _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n            } else if (state === STATE.ZOOM && !_this.noZoom) {\n                _zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n            } else if (state === STATE.PAN && !_this.noPan) {\n                _panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n            }\n        }\n        function mouseup(event) {\n            if (_this.enabled === false)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            _state = STATE.NONE;\n            document.removeEventListener('mousemove', mousemove);\n            document.removeEventListener('mouseup', mouseup);\n            _this.dispatchEvent(endEvent);\n        }\n        function mousewheel(event) {\n            if (_this.enabled === false)\n                return;\n            if (_this.noZoom === true)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            switch (event.deltaMode) {\n            case 2:\n                _zoomStart.y -= event.deltaY * 0.025;\n                break;\n            case 1:\n                _zoomStart.y -= event.deltaY * 0.01;\n                break;\n            default:\n                _zoomStart.y -= event.deltaY * 0.00025;\n                break;\n            }\n            _this.dispatchEvent(startEvent);\n            _this.dispatchEvent(endEvent);\n        }\n        function touchstart(event) {\n            if (_this.enabled === false)\n                return;\n            event.preventDefault();\n            switch (event.touches.length) {\n            case 1:\n                _state = STATE.TOUCH_ROTATE;\n                _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n                _movePrev.copy(_moveCurr);\n                break;\n            default:\n                _state = STATE.TOUCH_ZOOM_PAN;\n                var dx = event.touches[0].pageX - event.touches[1].pageX;\n                var dy = event.touches[0].pageY - event.touches[1].pageY;\n                _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\n                var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n                var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n                _panStart.copy(getMouseOnScreen(x, y));\n                _panEnd.copy(_panStart);\n                break;\n            }\n            _this.dispatchEvent(startEvent);\n        }\n        function touchmove(event) {\n            if (_this.enabled === false)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            switch (event.touches.length) {\n            case 1:\n                _movePrev.copy(_moveCurr);\n                _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n                break;\n            default:\n                var dx = event.touches[0].pageX - event.touches[1].pageX;\n                var dy = event.touches[0].pageY - event.touches[1].pageY;\n                _touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\n                var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n                var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n                _panEnd.copy(getMouseOnScreen(x, y));\n                break;\n            }\n        }\n        function touchend(event) {\n            if (_this.enabled === false)\n                return;\n            switch (event.touches.length) {\n            case 0:\n                _state = STATE.NONE;\n                break;\n            case 1:\n                _state = STATE.TOUCH_ROTATE;\n                _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n                _movePrev.copy(_moveCurr);\n                break;\n            }\n            _this.dispatchEvent(endEvent);\n        }\n        function contextmenu(event) {\n            if (_this.enabled === false)\n                return;\n            event.preventDefault();\n        }\n        this.dispose = function () {\n            this.domElement.removeEventListener('contextmenu', contextmenu, false);\n            this.domElement.removeEventListener('mousedown', mousedown, false);\n            this.domElement.removeEventListener('wheel', mousewheel, false);\n            this.domElement.removeEventListener('touchstart', touchstart, false);\n            this.domElement.removeEventListener('touchend', touchend, false);\n            this.domElement.removeEventListener('touchmove', touchmove, false);\n            document.removeEventListener('mousemove', mousemove, false);\n            document.removeEventListener('mouseup', mouseup, false);\n            window.removeEventListener('keydown', keydown, false);\n            window.removeEventListener('keyup', keyup, false);\n        };\n        this.domElement.addEventListener('contextmenu', contextmenu, false);\n        this.domElement.addEventListener('mousedown', mousedown, false);\n        this.domElement.addEventListener('wheel', mousewheel, false);\n        this.domElement.addEventListener('touchstart', touchstart, false);\n        this.domElement.addEventListener('touchend', touchend, false);\n        this.domElement.addEventListener('touchmove', touchmove, false);\n        window.addEventListener('keydown', keydown, false);\n        window.addEventListener('keyup', keyup, false);\n        this.handleResize();\n        this.update();\n    };\n    TrackballControls.prototype = Object.create(THREE.EventDispatcher.prototype);\n    TrackballControls.prototype.constructor = TrackballControls;\n\n    return TrackballControls;\n});"]}