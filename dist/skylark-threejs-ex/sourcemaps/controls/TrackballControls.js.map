{"version":3,"sources":["controls/TrackballControls.js"],"names":["define","THREE","threex","TrackballControls","object","domElement","undefined","console","warn","document","error","_this","this","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","MIDDLE","RIGHT","target","Vector3","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","box","getBoundingClientRect","d","ownerDocument","documentElement","window","pageXOffset","clientLeft","pageYOffset","clientTop","vector","angle","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","mouseChange","objectUp","pan","getMouseOnScreen","pageX","pageY","set","getMouseOnCircle","keydown","event","removeEventListener","keyCode","keyup","addEventListener","mousedown","preventDefault","stopPropagation","button","state","copy","mousemove","mouseup","dispatchEvent","mousewheel","deltaMode","y","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","x","touchmove","touchend","contextmenu","rotateCamera","Quaternion","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","panCamera","lengthSq","scale_x","right","clientWidth","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","prototype","Object","create","EventDispatcher","constructor","controls"],"mappings":"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","file":"../../controls/TrackballControls.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var TrackballControls = function (object, domElement) {\r\n        if (domElement === undefined)\r\n            console.warn('THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.');\r\n        if (domElement === document)\r\n            console.error('THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\r\n        var _this = this;\r\n        var STATE = {\r\n            NONE: -1,\r\n            ROTATE: 0,\r\n            ZOOM: 1,\r\n            PAN: 2,\r\n            TOUCH_ROTATE: 3,\r\n            TOUCH_ZOOM_PAN: 4\r\n        };\r\n        this.object = object;\r\n        this.domElement = domElement;\r\n        this.enabled = true;\r\n        this.screen = {\r\n            left: 0,\r\n            top: 0,\r\n            width: 0,\r\n            height: 0\r\n        };\r\n        this.rotateSpeed = 1;\r\n        this.zoomSpeed = 1.2;\r\n        this.panSpeed = 0.3;\r\n        this.noRotate = false;\r\n        this.noZoom = false;\r\n        this.noPan = false;\r\n        this.staticMoving = false;\r\n        this.dynamicDampingFactor = 0.2;\r\n        this.minDistance = 0;\r\n        this.maxDistance = Infinity;\r\n        this.keys = [\r\n            65,\r\n            83,\r\n            68\r\n        ];\r\n        this.mouseButtons = {\r\n            LEFT: THREE.MOUSE.ROTATE,\r\n            MIDDLE: THREE.MOUSE.ZOOM,\r\n            RIGHT: THREE.MOUSE.PAN\r\n        };\r\n        this.target = new THREE.Vector3();\r\n        var EPS = 0.000001;\r\n        var lastPosition = new THREE.Vector3();\r\n        var lastZoom = 1;\r\n        var _state = STATE.NONE, _keyState = STATE.NONE, _eye = new THREE.Vector3(), _movePrev = new THREE.Vector2(), _moveCurr = new THREE.Vector2(), _lastAxis = new THREE.Vector3(), _lastAngle = 0, _zoomStart = new THREE.Vector2(), _zoomEnd = new THREE.Vector2(), _touchZoomDistanceStart = 0, _touchZoomDistanceEnd = 0, _panStart = new THREE.Vector2(), _panEnd = new THREE.Vector2();\r\n        this.target0 = this.target.clone();\r\n        this.position0 = this.object.position.clone();\r\n        this.up0 = this.object.up.clone();\r\n        this.zoom0 = this.object.zoom;\r\n        var changeEvent = { type: 'change' };\r\n        var startEvent = { type: 'start' };\r\n        var endEvent = { type: 'end' };\r\n        this.handleResize = function () {\r\n            var box = this.domElement.getBoundingClientRect();\r\n            var d = this.domElement.ownerDocument.documentElement;\r\n            this.screen.left = box.left + window.pageXOffset - d.clientLeft;\r\n            this.screen.top = box.top + window.pageYOffset - d.clientTop;\r\n            this.screen.width = box.width;\r\n            this.screen.height = box.height;\r\n        };\r\n        var getMouseOnScreen = function () {\r\n            var vector = new THREE.Vector2();\r\n            return function getMouseOnScreen(pageX, pageY) {\r\n                vector.set((pageX - _this.screen.left) / _this.screen.width, (pageY - _this.screen.top) / _this.screen.height);\r\n                return vector;\r\n            };\r\n        }();\r\n        var getMouseOnCircle = function () {\r\n            var vector = new THREE.Vector2();\r\n            return function getMouseOnCircle(pageX, pageY) {\r\n                vector.set((pageX - _this.screen.width * 0.5 - _this.screen.left) / (_this.screen.width * 0.5), (_this.screen.height + 2 * (_this.screen.top - pageY)) / _this.screen.width);\r\n                return vector;\r\n            };\r\n        }();\r\n        this.rotateCamera = function () {\r\n            var axis = new THREE.Vector3(), quaternion = new THREE.Quaternion(), eyeDirection = new THREE.Vector3(), objectUpDirection = new THREE.Vector3(), objectSidewaysDirection = new THREE.Vector3(), moveDirection = new THREE.Vector3(), angle;\r\n            return function rotateCamera() {\r\n                moveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\r\n                angle = moveDirection.length();\r\n                if (angle) {\r\n                    _eye.copy(_this.object.position).sub(_this.target);\r\n                    eyeDirection.copy(_eye).normalize();\r\n                    objectUpDirection.copy(_this.object.up).normalize();\r\n                    objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\r\n                    objectUpDirection.setLength(_moveCurr.y - _movePrev.y);\r\n                    objectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\r\n                    moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\r\n                    axis.crossVectors(moveDirection, _eye).normalize();\r\n                    angle *= _this.rotateSpeed;\r\n                    quaternion.setFromAxisAngle(axis, angle);\r\n                    _eye.applyQuaternion(quaternion);\r\n                    _this.object.up.applyQuaternion(quaternion);\r\n                    _lastAxis.copy(axis);\r\n                    _lastAngle = angle;\r\n                } else if (!_this.staticMoving && _lastAngle) {\r\n                    _lastAngle *= Math.sqrt(1 - _this.dynamicDampingFactor);\r\n                    _eye.copy(_this.object.position).sub(_this.target);\r\n                    quaternion.setFromAxisAngle(_lastAxis, _lastAngle);\r\n                    _eye.applyQuaternion(quaternion);\r\n                    _this.object.up.applyQuaternion(quaternion);\r\n                }\r\n                _movePrev.copy(_moveCurr);\r\n            };\r\n        }();\r\n        this.zoomCamera = function () {\r\n            var factor;\r\n            if (_state === STATE.TOUCH_ZOOM_PAN) {\r\n                factor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\r\n                _touchZoomDistanceStart = _touchZoomDistanceEnd;\r\n                if (_this.object.isPerspectiveCamera) {\r\n                    _eye.multiplyScalar(factor);\r\n                } else if (_this.object.isOrthographicCamera) {\r\n                    _this.object.zoom *= factor;\r\n                    _this.object.updateProjectionMatrix();\r\n                } else {\r\n                    console.warn('THREE.TrackballControls: Unsupported camera type');\r\n                }\r\n            } else {\r\n                factor = 1 + (_zoomEnd.y - _zoomStart.y) * _this.zoomSpeed;\r\n                if (factor !== 1 && factor > 0) {\r\n                    if (_this.object.isPerspectiveCamera) {\r\n                        _eye.multiplyScalar(factor);\r\n                    } else if (_this.object.isOrthographicCamera) {\r\n                        _this.object.zoom /= factor;\r\n                        _this.object.updateProjectionMatrix();\r\n                    } else {\r\n                        console.warn('THREE.TrackballControls: Unsupported camera type');\r\n                    }\r\n                }\r\n                if (_this.staticMoving) {\r\n                    _zoomStart.copy(_zoomEnd);\r\n                } else {\r\n                    _zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\r\n                }\r\n            }\r\n        };\r\n        this.panCamera = function () {\r\n            var mouseChange = new THREE.Vector2(), objectUp = new THREE.Vector3(), pan = new THREE.Vector3();\r\n            return function panCamera() {\r\n                mouseChange.copy(_panEnd).sub(_panStart);\r\n                if (mouseChange.lengthSq()) {\r\n                    if (_this.object.isOrthographicCamera) {\r\n                        var scale_x = (_this.object.right - _this.object.left) / _this.object.zoom / _this.domElement.clientWidth;\r\n                        var scale_y = (_this.object.top - _this.object.bottom) / _this.object.zoom / _this.domElement.clientWidth;\r\n                        mouseChange.x *= scale_x;\r\n                        mouseChange.y *= scale_y;\r\n                    }\r\n                    mouseChange.multiplyScalar(_eye.length() * _this.panSpeed);\r\n                    pan.copy(_eye).cross(_this.object.up).setLength(mouseChange.x);\r\n                    pan.add(objectUp.copy(_this.object.up).setLength(mouseChange.y));\r\n                    _this.object.position.add(pan);\r\n                    _this.target.add(pan);\r\n                    if (_this.staticMoving) {\r\n                        _panStart.copy(_panEnd);\r\n                    } else {\r\n                        _panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(_this.dynamicDampingFactor));\r\n                    }\r\n                }\r\n            };\r\n        }();\r\n        this.checkDistances = function () {\r\n            if (!_this.noZoom || !_this.noPan) {\r\n                if (_eye.lengthSq() > _this.maxDistance * _this.maxDistance) {\r\n                    _this.object.position.addVectors(_this.target, _eye.setLength(_this.maxDistance));\r\n                    _zoomStart.copy(_zoomEnd);\r\n                }\r\n                if (_eye.lengthSq() < _this.minDistance * _this.minDistance) {\r\n                    _this.object.position.addVectors(_this.target, _eye.setLength(_this.minDistance));\r\n                    _zoomStart.copy(_zoomEnd);\r\n                }\r\n            }\r\n        };\r\n        this.update = function () {\r\n            _eye.subVectors(_this.object.position, _this.target);\r\n            if (!_this.noRotate) {\r\n                _this.rotateCamera();\r\n            }\r\n            if (!_this.noZoom) {\r\n                _this.zoomCamera();\r\n            }\r\n            if (!_this.noPan) {\r\n                _this.panCamera();\r\n            }\r\n            _this.object.position.addVectors(_this.target, _eye);\r\n            if (_this.object.isPerspectiveCamera) {\r\n                _this.checkDistances();\r\n                _this.object.lookAt(_this.target);\r\n                if (lastPosition.distanceToSquared(_this.object.position) > EPS) {\r\n                    _this.dispatchEvent(changeEvent);\r\n                    lastPosition.copy(_this.object.position);\r\n                }\r\n            } else if (_this.object.isOrthographicCamera) {\r\n                _this.object.lookAt(_this.target);\r\n                if (lastPosition.distanceToSquared(_this.object.position) > EPS || lastZoom !== _this.object.zoom) {\r\n                    _this.dispatchEvent(changeEvent);\r\n                    lastPosition.copy(_this.object.position);\r\n                    lastZoom = _this.object.zoom;\r\n                }\r\n            } else {\r\n                console.warn('THREE.TrackballControls: Unsupported camera type');\r\n            }\r\n        };\r\n        this.reset = function () {\r\n            _state = STATE.NONE;\r\n            _keyState = STATE.NONE;\r\n            _this.target.copy(_this.target0);\r\n            _this.object.position.copy(_this.position0);\r\n            _this.object.up.copy(_this.up0);\r\n            _this.object.zoom = _this.zoom0;\r\n            _this.object.updateProjectionMatrix();\r\n            _eye.subVectors(_this.object.position, _this.target);\r\n            _this.object.lookAt(_this.target);\r\n            _this.dispatchEvent(changeEvent);\r\n            lastPosition.copy(_this.object.position);\r\n            lastZoom = _this.object.zoom;\r\n        };\r\n        function keydown(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            window.removeEventListener('keydown', keydown);\r\n            if (_keyState !== STATE.NONE) {\r\n                return;\r\n            } else if (event.keyCode === _this.keys[STATE.ROTATE] && !_this.noRotate) {\r\n                _keyState = STATE.ROTATE;\r\n            } else if (event.keyCode === _this.keys[STATE.ZOOM] && !_this.noZoom) {\r\n                _keyState = STATE.ZOOM;\r\n            } else if (event.keyCode === _this.keys[STATE.PAN] && !_this.noPan) {\r\n                _keyState = STATE.PAN;\r\n            }\r\n        }\r\n        function keyup() {\r\n            if (_this.enabled === false)\r\n                return;\r\n            _keyState = STATE.NONE;\r\n            window.addEventListener('keydown', keydown, false);\r\n        }\r\n        function mousedown(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            if (_state === STATE.NONE) {\r\n                switch (event.button) {\r\n                case _this.mouseButtons.LEFT:\r\n                    _state = STATE.ROTATE;\r\n                    break;\r\n                case _this.mouseButtons.MIDDLE:\r\n                    _state = STATE.ZOOM;\r\n                    break;\r\n                case _this.mouseButtons.RIGHT:\r\n                    _state = STATE.PAN;\r\n                    break;\r\n                default:\r\n                    _state = STATE.NONE;\r\n                }\r\n            }\r\n            var state = _keyState !== STATE.NONE ? _keyState : _state;\r\n            if (state === STATE.ROTATE && !_this.noRotate) {\r\n                _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\r\n                _movePrev.copy(_moveCurr);\r\n            } else if (state === STATE.ZOOM && !_this.noZoom) {\r\n                _zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n                _zoomEnd.copy(_zoomStart);\r\n            } else if (state === STATE.PAN && !_this.noPan) {\r\n                _panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n                _panEnd.copy(_panStart);\r\n            }\r\n            document.addEventListener('mousemove', mousemove, false);\r\n            document.addEventListener('mouseup', mouseup, false);\r\n            _this.dispatchEvent(startEvent);\r\n        }\r\n        function mousemove(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            var state = _keyState !== STATE.NONE ? _keyState : _state;\r\n            if (state === STATE.ROTATE && !_this.noRotate) {\r\n                _movePrev.copy(_moveCurr);\r\n                _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\r\n            } else if (state === STATE.ZOOM && !_this.noZoom) {\r\n                _zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n            } else if (state === STATE.PAN && !_this.noPan) {\r\n                _panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n            }\r\n        }\r\n        function mouseup(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            _state = STATE.NONE;\r\n            document.removeEventListener('mousemove', mousemove);\r\n            document.removeEventListener('mouseup', mouseup);\r\n            _this.dispatchEvent(endEvent);\r\n        }\r\n        function mousewheel(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            if (_this.noZoom === true)\r\n                return;\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            switch (event.deltaMode) {\r\n            case 2:\r\n                _zoomStart.y -= event.deltaY * 0.025;\r\n                break;\r\n            case 1:\r\n                _zoomStart.y -= event.deltaY * 0.01;\r\n                break;\r\n            default:\r\n                _zoomStart.y -= event.deltaY * 0.00025;\r\n                break;\r\n            }\r\n            _this.dispatchEvent(startEvent);\r\n            _this.dispatchEvent(endEvent);\r\n        }\r\n        function touchstart(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            event.preventDefault();\r\n            switch (event.touches.length) {\r\n            case 1:\r\n                _state = STATE.TOUCH_ROTATE;\r\n                _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\r\n                _movePrev.copy(_moveCurr);\r\n                break;\r\n            default:\r\n                _state = STATE.TOUCH_ZOOM_PAN;\r\n                var dx = event.touches[0].pageX - event.touches[1].pageX;\r\n                var dy = event.touches[0].pageY - event.touches[1].pageY;\r\n                _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\r\n                var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\r\n                var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\r\n                _panStart.copy(getMouseOnScreen(x, y));\r\n                _panEnd.copy(_panStart);\r\n                break;\r\n            }\r\n            _this.dispatchEvent(startEvent);\r\n        }\r\n        function touchmove(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            switch (event.touches.length) {\r\n            case 1:\r\n                _movePrev.copy(_moveCurr);\r\n                _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\r\n                break;\r\n            default:\r\n                var dx = event.touches[0].pageX - event.touches[1].pageX;\r\n                var dy = event.touches[0].pageY - event.touches[1].pageY;\r\n                _touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\r\n                var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\r\n                var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\r\n                _panEnd.copy(getMouseOnScreen(x, y));\r\n                break;\r\n            }\r\n        }\r\n        function touchend(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            switch (event.touches.length) {\r\n            case 0:\r\n                _state = STATE.NONE;\r\n                break;\r\n            case 1:\r\n                _state = STATE.TOUCH_ROTATE;\r\n                _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\r\n                _movePrev.copy(_moveCurr);\r\n                break;\r\n            }\r\n            _this.dispatchEvent(endEvent);\r\n        }\r\n        function contextmenu(event) {\r\n            if (_this.enabled === false)\r\n                return;\r\n            event.preventDefault();\r\n        }\r\n        this.dispose = function () {\r\n            this.domElement.removeEventListener('contextmenu', contextmenu, false);\r\n            this.domElement.removeEventListener('mousedown', mousedown, false);\r\n            this.domElement.removeEventListener('wheel', mousewheel, false);\r\n            this.domElement.removeEventListener('touchstart', touchstart, false);\r\n            this.domElement.removeEventListener('touchend', touchend, false);\r\n            this.domElement.removeEventListener('touchmove', touchmove, false);\r\n            document.removeEventListener('mousemove', mousemove, false);\r\n            document.removeEventListener('mouseup', mouseup, false);\r\n            window.removeEventListener('keydown', keydown, false);\r\n            window.removeEventListener('keyup', keyup, false);\r\n        };\r\n        this.domElement.addEventListener('contextmenu', contextmenu, false);\r\n        this.domElement.addEventListener('mousedown', mousedown, false);\r\n        this.domElement.addEventListener('wheel', mousewheel, false);\r\n        this.domElement.addEventListener('touchstart', touchstart, false);\r\n        this.domElement.addEventListener('touchend', touchend, false);\r\n        this.domElement.addEventListener('touchmove', touchmove, false);\r\n        window.addEventListener('keydown', keydown, false);\r\n        window.addEventListener('keyup', keyup, false);\r\n        this.handleResize();\r\n        this.update();\r\n    };\r\n    TrackballControls.prototype = Object.create(THREE.EventDispatcher.prototype);\r\n    TrackballControls.prototype.constructor = TrackballControls;\r\n\r\n    return threex.controls.TrackballControls = TrackballControls;\r\n});"]}