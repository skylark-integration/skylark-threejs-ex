{"version":3,"sources":["controls/TrackballControls.js"],"names":["define","THREE","TrackballControls","object","domElement","undefined","console","warn","document","error","_this","this","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","MIDDLE","RIGHT","target","Vector3","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","box","getBoundingClientRect","d","ownerDocument","documentElement","window","pageXOffset","clientLeft","pageYOffset","clientTop","vector","angle","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","mouseChange","objectUp","pan","getMouseOnScreen","pageX","pageY","set","getMouseOnCircle","keydown","event","removeEventListener","keyCode","keyup","addEventListener","mousedown","preventDefault","stopPropagation","button","state","copy","mousemove","mouseup","dispatchEvent","mousewheel","deltaMode","y","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","x","touchmove","touchend","contextmenu","rotateCamera","Quaternion","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","panCamera","lengthSq","scale_x","right","clientWidth","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","prototype","Object","create","EventDispatcher","constructor"],"mappings":";;;;;;;AAAAA,QACC,mBACC,SAASC,GA0rBV,OAlrBAA,EAAMC,kBAAoB,SAAWC,EAAQC,QAExBC,IAAfD,GAA2BE,QAAQC,KAAM,gFACzCH,IAAeI,UAAWF,QAAQG,MAAO,gIAE9C,IAAIC,EAAQC,KACRC,GAAUC,MAAQ,EAAGC,OAAQ,EAAGC,KAAM,EAAGC,IAAK,EAAGC,aAAc,EAAGC,eAAgB,GAEtFP,KAAKR,OAASA,EACdQ,KAAKP,WAAaA,EAIlBO,KAAKQ,SAAU,EAEfR,KAAKS,QAAWC,KAAM,EAAGC,IAAK,EAAGC,MAAO,EAAGC,OAAQ,GAEnDb,KAAKc,YAAc,EACnBd,KAAKe,UAAY,IACjBf,KAAKgB,SAAW,GAEhBhB,KAAKiB,UAAW,EAChBjB,KAAKkB,QAAS,EACdlB,KAAKmB,OAAQ,EAEbnB,KAAKoB,cAAe,EACpBpB,KAAKqB,qBAAuB,GAE5BrB,KAAKsB,YAAc,EACnBtB,KAAKuB,YAAcC,EAAAA,EAEnBxB,KAAKyB,MAAS,GAAU,GAAU,IAElCzB,KAAK0B,cAAiBC,KAAMrC,EAAMsC,MAAMzB,OAAQ0B,OAAQvC,EAAMsC,MAAMxB,KAAM0B,MAAOxC,EAAMsC,MAAMvB,KAI7FL,KAAK+B,OAAS,IAAIzC,EAAM0C,QAExB,IAEIC,EAAe,IAAI3C,EAAM0C,QACzBE,EAAW,EAEXC,EAASlC,EAAMC,KAClBkC,EAAYnC,EAAMC,KAElBmC,EAAO,IAAI/C,EAAM0C,QAEjBM,EAAY,IAAIhD,EAAMiD,QACtBC,EAAY,IAAIlD,EAAMiD,QAEtBE,EAAY,IAAInD,EAAM0C,QACtBU,EAAa,EAEbC,EAAa,IAAIrD,EAAMiD,QACvBK,EAAW,IAAItD,EAAMiD,QAErBM,EAA0B,EAC1BC,EAAwB,EAExBC,EAAY,IAAIzD,EAAMiD,QACtBS,EAAU,IAAI1D,EAAMiD,QAIrBvC,KAAKiD,QAAUjD,KAAK+B,OAAOmB,QAC3BlD,KAAKmD,UAAYnD,KAAKR,OAAO4D,SAASF,QACtClD,KAAKqD,IAAMrD,KAAKR,OAAO8D,GAAGJ,QAC1BlD,KAAKuD,MAAQvD,KAAKR,OAAOgE,KAIzB,IAAIC,GAAgBC,KAAM,UACtBC,GAAeD,KAAM,SACrBE,GAAaF,KAAM,OAKvB1D,KAAK6D,aAAe,WAEnB,IAAIC,EAAM9D,KAAKP,WAAWsE,wBAEtBC,EAAIhE,KAAKP,WAAWwE,cAAcC,gBACtClE,KAAKS,OAAOC,KAAOoD,EAAIpD,KAAOyD,OAAOC,YAAcJ,EAAEK,WACrDrE,KAAKS,OAAOE,IAAMmD,EAAInD,IAAMwD,OAAOG,YAAcN,EAAEO,UACnDvE,KAAKS,OAAOG,MAAQkD,EAAIlD,MACxBZ,KAAKS,OAAOI,OAASiD,EAAIjD,QAI1B,IAEK2D,EAwCHC,EANGC,EACHC,EACAC,EACAC,EACAC,EACAC,EAgHGC,EACHC,EACAC,EA3JEC,GAECX,EAAS,IAAIlF,EAAMiD,QAEhB,SAA2B6C,EAAOC,GAOxC,OALAb,EAAOc,KACJF,EAAQrF,EAAMU,OAAOC,MAASX,EAAMU,OAAOG,OAC3CyE,EAAQtF,EAAMU,OAAOE,KAAQZ,EAAMU,OAAOI,QAGtC2D,IAMLe,EAAqB,WAExB,IAAIf,EAAS,IAAIlF,EAAMiD,QAEvB,OAAO,SAA2B6C,EAAOC,GAOxC,OALAb,EAAOc,KACFF,EAA6B,GAArBrF,EAAMU,OAAOG,MAAcb,EAAMU,OAAOC,OAAgC,GAArBX,EAAMU,OAAOG,QACxEb,EAAMU,OAAOI,OAAS,GAAMd,EAAMU,OAAOE,IAAM0E,IAAYtF,EAAMU,OAAOG,OAGtE4D,GAXc,GA8RvB,SAASgB,EAASC,IAEM,IAAlB1F,EAAMS,UAEX2D,OAAOuB,oBAAqB,UAAWF,GAElCpD,IAAcnC,EAAMC,OAIbuF,EAAME,UAAY5F,EAAM0B,KAAMxB,EAAME,SAAcJ,EAAMkB,SAIxDwE,EAAME,UAAY5F,EAAM0B,KAAMxB,EAAMG,OAAYL,EAAMmB,OAItDuE,EAAME,UAAY5F,EAAM0B,KAAMxB,EAAMI,MAAWN,EAAMoB,QAEhEiB,EAAYnC,EAAMI,KAJlB+B,EAAYnC,EAAMG,KAJlBgC,EAAYnC,EAAME,SAcpB,SAASyF,KAEe,IAAlB7F,EAAMS,UAEX4B,EAAYnC,EAAMC,KAElBiE,OAAO0B,iBAAkB,UAAWL,GAAS,IAI9C,SAASM,EAAWL,GAEnB,IAAuB,IAAlB1F,EAAMS,QAAX,CAKA,GAHAiF,EAAMM,iBACNN,EAAMO,kBAED7D,IAAWlC,EAAMC,KAErB,OAASuF,EAAMQ,QAEd,KAAKlG,EAAM2B,aAAaC,KACvBQ,EAASlC,EAAME,OACf,MAED,KAAKJ,EAAM2B,aAAaG,OACvBM,EAASlC,EAAMG,KACf,MAED,KAAKL,EAAM2B,aAAaI,MACvBK,EAASlC,EAAMI,IACf,MAED,QACC8B,EAASlC,EAAMC,KAMlB,IAAIgG,EAAU9D,IAAcnC,EAAMC,KAASkC,EAAYD,EAElD+D,IAAUjG,EAAME,QAAYJ,EAAMkB,SAK3BiF,IAAUjG,EAAMG,MAAUL,EAAMmB,OAKhCgF,IAAUjG,EAAMI,KAASN,EAAMoB,QAE1C4B,EAAUoD,KAAMhB,EAAkBM,EAAML,MAAOK,EAAMJ,QACrDrC,EAAQmD,KAAMpD,KANdJ,EAAWwD,KAAMhB,EAAkBM,EAAML,MAAOK,EAAMJ,QACtDzC,EAASuD,KAAMxD,KANfH,EAAU2D,KAAMZ,EAAkBE,EAAML,MAAOK,EAAMJ,QACrD/C,EAAU6D,KAAM3D,IAcjB3C,SAASgG,iBAAkB,YAAaO,GAAW,GACnDvG,SAASgG,iBAAkB,UAAWQ,GAAS,GAE/CtG,EAAMuG,cAAe3C,IAItB,SAASyC,EAAWX,GAEnB,IAAuB,IAAlB1F,EAAMS,QAAX,CAEAiF,EAAMM,iBACNN,EAAMO,kBAEN,IAAIE,EAAU9D,IAAcnC,EAAMC,KAASkC,EAAYD,EAElD+D,IAAUjG,EAAME,QAAYJ,EAAMkB,SAK3BiF,IAAUjG,EAAMG,MAAUL,EAAMmB,OAIhCgF,IAAUjG,EAAMI,KAASN,EAAMoB,OAE1C6B,EAAQmD,KAAMhB,EAAkBM,EAAML,MAAOK,EAAMJ,QAJnDzC,EAASuD,KAAMhB,EAAkBM,EAAML,MAAOK,EAAMJ,SALpD/C,EAAU6D,KAAM3D,GAChBA,EAAU2D,KAAMZ,EAAkBE,EAAML,MAAOK,EAAMJ,UAcvD,SAASgB,EAASZ,IAEM,IAAlB1F,EAAMS,UAEXiF,EAAMM,iBACNN,EAAMO,kBAEN7D,EAASlC,EAAMC,KAEfL,SAAS6F,oBAAqB,YAAaU,GAC3CvG,SAAS6F,oBAAqB,UAAWW,GACzCtG,EAAMuG,cAAe1C,IAItB,SAAS2C,EAAYd,GAEpB,IAAuB,IAAlB1F,EAAMS,UAEW,IAAjBT,EAAMmB,OAAX,CAKA,OAHAuE,EAAMM,iBACNN,EAAMO,kBAEGP,EAAMe,WAEd,KAAK,EAEJ7D,EAAW8D,GAAoB,KAAfhB,EAAMiB,OACtB,MAED,KAAK,EAEJ/D,EAAW8D,GAAoB,IAAfhB,EAAMiB,OACtB,MAED,QAEC/D,EAAW8D,GAAoB,MAAfhB,EAAMiB,OAKxB3G,EAAMuG,cAAe3C,GACrB5D,EAAMuG,cAAe1C,IAItB,SAAS+C,EAAYlB,GAEpB,IAAuB,IAAlB1F,EAAMS,QAAX,CAIA,OAFAiF,EAAMM,iBAEGN,EAAMmB,QAAQC,QAEtB,KAAK,EACJ1E,EAASlC,EAAMK,aACfkC,EAAU2D,KAAMZ,EAAkBE,EAAMmB,QAAS,GAAIxB,MAAOK,EAAMmB,QAAS,GAAIvB,QAC/E/C,EAAU6D,KAAM3D,GAChB,MAED,QACCL,EAASlC,EAAMM,eACf,IAAIuG,EAAKrB,EAAMmB,QAAS,GAAIxB,MAAQK,EAAMmB,QAAS,GAAIxB,MACnD2B,EAAKtB,EAAMmB,QAAS,GAAIvB,MAAQI,EAAMmB,QAAS,GAAIvB,MACvDvC,EAAwBD,EAA0BmE,KAAKC,KAAMH,EAAKA,EAAKC,EAAKA,GAE5E,IAAIG,GAAMzB,EAAMmB,QAAS,GAAIxB,MAAQK,EAAMmB,QAAS,GAAIxB,OAAU,EAC9DqB,GAAMhB,EAAMmB,QAAS,GAAIvB,MAAQI,EAAMmB,QAAS,GAAIvB,OAAU,EAClEtC,EAAUoD,KAAMhB,EAAkB+B,EAAGT,IACrCzD,EAAQmD,KAAMpD,GAKhBhD,EAAMuG,cAAe3C,IAItB,SAASwD,EAAW1B,GAEnB,IAAuB,IAAlB1F,EAAMS,QAKX,OAHAiF,EAAMM,iBACNN,EAAMO,kBAEGP,EAAMmB,QAAQC,QAEtB,KAAK,EACJvE,EAAU6D,KAAM3D,GAChBA,EAAU2D,KAAMZ,EAAkBE,EAAMmB,QAAS,GAAIxB,MAAOK,EAAMmB,QAAS,GAAIvB,QAC/E,MAED,QACC,IAAIyB,EAAKrB,EAAMmB,QAAS,GAAIxB,MAAQK,EAAMmB,QAAS,GAAIxB,MACnD2B,EAAKtB,EAAMmB,QAAS,GAAIvB,MAAQI,EAAMmB,QAAS,GAAIvB,MACvDvC,EAAwBkE,KAAKC,KAAMH,EAAKA,EAAKC,EAAKA,GAElD,IAAIG,GAAMzB,EAAMmB,QAAS,GAAIxB,MAAQK,EAAMmB,QAAS,GAAIxB,OAAU,EAC9DqB,GAAMhB,EAAMmB,QAAS,GAAIvB,MAAQI,EAAMmB,QAAS,GAAIvB,OAAU,EAClErC,EAAQmD,KAAMhB,EAAkB+B,EAAGT,KAOtC,SAASW,EAAU3B,GAElB,IAAuB,IAAlB1F,EAAMS,QAAX,CAEA,OAASiF,EAAMmB,QAAQC,QAEtB,KAAK,EACJ1E,EAASlC,EAAMC,KACf,MAED,KAAK,EACJiC,EAASlC,EAAMK,aACfkC,EAAU2D,KAAMZ,EAAkBE,EAAMmB,QAAS,GAAIxB,MAAOK,EAAMmB,QAAS,GAAIvB,QAC/E/C,EAAU6D,KAAM3D,GAKlBzC,EAAMuG,cAAe1C,IAItB,SAASyD,EAAa5B,IAEE,IAAlB1F,EAAMS,SAEXiF,EAAMM,iBAzgBP/F,KAAKsH,cAEA5C,EAAO,IAAIpF,EAAM0C,QACpB2C,EAAa,IAAIrF,EAAMiI,WACvB3C,EAAe,IAAItF,EAAM0C,QACzB6C,EAAoB,IAAIvF,EAAM0C,QAC9B8C,EAA0B,IAAIxF,EAAM0C,QACpC+C,EAAgB,IAAIzF,EAAM0C,QAGpB,WAEN+C,EAAcO,IAAK9C,EAAU0E,EAAI5E,EAAU4E,EAAG1E,EAAUiE,EAAInE,EAAUmE,EAAG,IACzEhC,EAAQM,EAAc8B,WAIrBxE,EAAK8D,KAAMpG,EAAMP,OAAO4D,UAAWoE,IAAKzH,EAAMgC,QAE9C6C,EAAauB,KAAM9D,GAAOoF,YAC1B5C,EAAkBsB,KAAMpG,EAAMP,OAAO8D,IAAKmE,YAC1C3C,EAAwB4C,aAAc7C,EAAmBD,GAAe6C,YAExE5C,EAAkB8C,UAAWnF,EAAUiE,EAAInE,EAAUmE,GACrD3B,EAAwB6C,UAAWnF,EAAU0E,EAAI5E,EAAU4E,GAE3DnC,EAAcoB,KAAMtB,EAAkB+C,IAAK9C,IAE3CJ,EAAKgD,aAAc3C,EAAe1C,GAAOoF,YAEzChD,GAAS1E,EAAMe,YACf6D,EAAWkD,iBAAkBnD,EAAMD,GAEnCpC,EAAKyF,gBAAiBnD,GACtB5E,EAAMP,OAAO8D,GAAGwE,gBAAiBnD,GAEjClC,EAAU0D,KAAMzB,GAChBhC,EAAa+B,IAEA1E,EAAMqB,cAAgBsB,IAEnCA,GAAcsE,KAAKC,KAAM,EAAMlH,EAAMsB,sBACrCgB,EAAK8D,KAAMpG,EAAMP,OAAO4D,UAAWoE,IAAKzH,EAAMgC,QAC9C4C,EAAWkD,iBAAkBpF,EAAWC,GACxCL,EAAKyF,gBAAiBnD,GACtB5E,EAAMP,OAAO8D,GAAGwE,gBAAiBnD,IAIlCrC,EAAU6D,KAAM3D,KAOlBxC,KAAK+H,WAAa,WAEjB,IAAIC,EAEC7F,IAAWlC,EAAMM,gBAErByH,EAASnF,EAA0BC,EACnCD,EAA0BC,EAErB/C,EAAMP,OAAOyI,oBAEjB5F,EAAK6F,eAAgBF,GAEVjI,EAAMP,OAAO2I,sBAExBpI,EAAMP,OAAOgE,MAAQwE,EACrBjI,EAAMP,OAAO4I,0BAIbzI,QAAQC,KAAM,sDAQC,KAFhBoI,EAAS,GAAQpF,EAAS6D,EAAI9D,EAAW8D,GAAM1G,EAAMgB,YAE9BiH,EAAS,IAE1BjI,EAAMP,OAAOyI,oBAEjB5F,EAAK6F,eAAgBF,GAEVjI,EAAMP,OAAO2I,sBAExBpI,EAAMP,OAAOgE,MAAQwE,EACrBjI,EAAMP,OAAO4I,0BAIbzI,QAAQC,KAAM,qDAMXG,EAAMqB,aAEVuB,EAAWwD,KAAMvD,GAIjBD,EAAW8D,IAAO7D,EAAS6D,EAAI9D,EAAW8D,GAAMzG,KAAKqB,uBAQxDrB,KAAKqI,WAEArD,EAAc,IAAI1F,EAAMiD,QAC3B0C,EAAW,IAAI3F,EAAM0C,QACrBkD,EAAM,IAAI5F,EAAM0C,QAEV,WAIN,GAFAgD,EAAYmB,KAAMnD,GAAUwE,IAAKzE,GAE5BiC,EAAYsD,WAAa,CAE7B,GAAKvI,EAAMP,OAAO2I,qBAAuB,CAExC,IAAII,GAAYxI,EAAMP,OAAOgJ,MAAQzI,EAAMP,OAAOkB,MAASX,EAAMP,OAAOgE,KAAOzD,EAAMN,WAAWgJ,YAC5FC,GAAY3I,EAAMP,OAAOmB,IAAMZ,EAAMP,OAAOmJ,QAAW5I,EAAMP,OAAOgE,KAAOzD,EAAMN,WAAWgJ,YAEhGzD,EAAYkC,GAAKqB,EACjBvD,EAAYyB,GAAKiC,EAIlB1D,EAAYkD,eAAgB7F,EAAKwE,SAAW9G,EAAMiB,UAElDkE,EAAIiB,KAAM9D,GAAOuG,MAAO7I,EAAMP,OAAO8D,IAAKqE,UAAW3C,EAAYkC,GACjEhC,EAAI0C,IAAK3C,EAASkB,KAAMpG,EAAMP,OAAO8D,IAAKqE,UAAW3C,EAAYyB,IAEjE1G,EAAMP,OAAO4D,SAASwE,IAAK1C,GAC3BnF,EAAMgC,OAAO6F,IAAK1C,GAEbnF,EAAMqB,aAEV2B,EAAUoD,KAAMnD,GAIhBD,EAAU6E,IAAK5C,EAAY6D,WAAY7F,EAASD,GAAYmF,eAAgBnI,EAAMsB,0BAUtFrB,KAAK8I,eAAiB,WAEd/I,EAAMmB,QAAYnB,EAAMoB,QAEzBkB,EAAKiG,WAAavI,EAAMwB,YAAcxB,EAAMwB,cAEhDxB,EAAMP,OAAO4D,SAAS2F,WAAYhJ,EAAMgC,OAAQM,EAAKsF,UAAW5H,EAAMwB,cACtEoB,EAAWwD,KAAMvD,IAIbP,EAAKiG,WAAavI,EAAMuB,YAAcvB,EAAMuB,cAEhDvB,EAAMP,OAAO4D,SAAS2F,WAAYhJ,EAAMgC,OAAQM,EAAKsF,UAAW5H,EAAMuB,cACtEqB,EAAWwD,KAAMvD,MAQpB5C,KAAKgJ,OAAS,WAEb3G,EAAKwG,WAAY9I,EAAMP,OAAO4D,SAAUrD,EAAMgC,QAEvChC,EAAMkB,UAEZlB,EAAMuH,eAIAvH,EAAMmB,QAEZnB,EAAMgI,aAIAhI,EAAMoB,OAEZpB,EAAMsI,YAIPtI,EAAMP,OAAO4D,SAAS2F,WAAYhJ,EAAMgC,OAAQM,GAE3CtC,EAAMP,OAAOyI,qBAEjBlI,EAAM+I,iBAEN/I,EAAMP,OAAOyJ,OAAQlJ,EAAMgC,QAEtBE,EAAaiH,kBAAmBnJ,EAAMP,OAAO4D,UA9S1C,OAgTPrD,EAAMuG,cAAe7C,GAErBxB,EAAakE,KAAMpG,EAAMP,OAAO4D,YAItBrD,EAAMP,OAAO2I,sBAExBpI,EAAMP,OAAOyJ,OAAQlJ,EAAMgC,SAEtBE,EAAaiH,kBAAmBnJ,EAAMP,OAAO4D,UA1T1C,MA0T8DlB,IAAanC,EAAMP,OAAOgE,QAE/FzD,EAAMuG,cAAe7C,GAErBxB,EAAakE,KAAMpG,EAAMP,OAAO4D,UAChClB,EAAWnC,EAAMP,OAAOgE,OAMzB7D,QAAQC,KAAM,qDAMhBI,KAAKmJ,MAAQ,WAEZhH,EAASlC,EAAMC,KACfkC,EAAYnC,EAAMC,KAElBH,EAAMgC,OAAOoE,KAAMpG,EAAMkD,SACzBlD,EAAMP,OAAO4D,SAAS+C,KAAMpG,EAAMoD,WAClCpD,EAAMP,OAAO8D,GAAG6C,KAAMpG,EAAMsD,KAC5BtD,EAAMP,OAAOgE,KAAOzD,EAAMwD,MAE1BxD,EAAMP,OAAO4I,yBAEb/F,EAAKwG,WAAY9I,EAAMP,OAAO4D,SAAUrD,EAAMgC,QAE9ChC,EAAMP,OAAOyJ,OAAQlJ,EAAMgC,QAE3BhC,EAAMuG,cAAe7C,GAErBxB,EAAakE,KAAMpG,EAAMP,OAAO4D,UAChClB,EAAWnC,EAAMP,OAAOgE,MAsQzBxD,KAAKoJ,QAAU,WAEdpJ,KAAKP,WAAWiG,oBAAqB,cAAe2B,GAAa,GACjErH,KAAKP,WAAWiG,oBAAqB,YAAaI,GAAW,GAC7D9F,KAAKP,WAAWiG,oBAAqB,QAASa,GAAY,GAE1DvG,KAAKP,WAAWiG,oBAAqB,aAAciB,GAAY,GAC/D3G,KAAKP,WAAWiG,oBAAqB,WAAY0B,GAAU,GAC3DpH,KAAKP,WAAWiG,oBAAqB,YAAayB,GAAW,GAE7DtH,SAAS6F,oBAAqB,YAAaU,GAAW,GACtDvG,SAAS6F,oBAAqB,UAAWW,GAAS,GAElDlC,OAAOuB,oBAAqB,UAAWF,GAAS,GAChDrB,OAAOuB,oBAAqB,QAASE,GAAO,IAI7C5F,KAAKP,WAAWoG,iBAAkB,cAAewB,GAAa,GAC9DrH,KAAKP,WAAWoG,iBAAkB,YAAaC,GAAW,GAC1D9F,KAAKP,WAAWoG,iBAAkB,QAASU,GAAY,GAEvDvG,KAAKP,WAAWoG,iBAAkB,aAAcc,GAAY,GAC5D3G,KAAKP,WAAWoG,iBAAkB,WAAYuB,GAAU,GACxDpH,KAAKP,WAAWoG,iBAAkB,YAAasB,GAAW,GAE1DhD,OAAO0B,iBAAkB,UAAWL,GAAS,GAC7CrB,OAAO0B,iBAAkB,QAASD,GAAO,GAEzC5F,KAAK6D,eAGL7D,KAAKgJ,UAIN1J,EAAMC,kBAAkB8J,UAAYC,OAAOC,OAAQjK,EAAMkK,gBAAgBH,WACzE/J,EAAMC,kBAAkB8J,UAAUI,YAAcnK,EAAMC,kBAE/CD,EAAMC","file":"../../controls/TrackballControls.js","sourcesContent":["define([\n\t\"skylark-threejs\"\n],function(THREE){\n\t/**\n\t * @author Eberhard Graether / http://egraether.com/\n\t * @author Mark Lundin \t/ http://mark-lundin.com\n\t * @author Simone Manini / http://daron1337.github.io\n\t * @author Luca Antiga \t/ http://lantiga.github.io\n\t */\n\n\tTHREE.TrackballControls = function ( object, domElement ) {\n\n\t\tif ( domElement === undefined ) console.warn( 'THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tif ( domElement === document ) console.error( 'THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\t\tvar _this = this;\n\t\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\n\t\t// API\n\n\t\tthis.enabled = true;\n\n\t\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n\t\tthis.rotateSpeed = 1.0;\n\t\tthis.zoomSpeed = 1.2;\n\t\tthis.panSpeed = 0.3;\n\n\t\tthis.noRotate = false;\n\t\tthis.noZoom = false;\n\t\tthis.noPan = false;\n\n\t\tthis.staticMoving = false;\n\t\tthis.dynamicDampingFactor = 0.2;\n\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\n\n\t\tthis.mouseButtons = { LEFT: THREE.MOUSE.ROTATE, MIDDLE: THREE.MOUSE.ZOOM, RIGHT: THREE.MOUSE.PAN };\n\n\t\t// internals\n\n\t\tthis.target = new THREE.Vector3();\n\n\t\tvar EPS = 0.000001;\n\n\t\tvar lastPosition = new THREE.Vector3();\n\t\tvar lastZoom = 1;\n\n\t\tvar _state = STATE.NONE,\n\t\t\t_keyState = STATE.NONE,\n\n\t\t\t_eye = new THREE.Vector3(),\n\n\t\t\t_movePrev = new THREE.Vector2(),\n\t\t\t_moveCurr = new THREE.Vector2(),\n\n\t\t\t_lastAxis = new THREE.Vector3(),\n\t\t\t_lastAngle = 0,\n\n\t\t\t_zoomStart = new THREE.Vector2(),\n\t\t\t_zoomEnd = new THREE.Vector2(),\n\n\t\t\t_touchZoomDistanceStart = 0,\n\t\t\t_touchZoomDistanceEnd = 0,\n\n\t\t\t_panStart = new THREE.Vector2(),\n\t\t\t_panEnd = new THREE.Vector2();\n\n\t\t// for reset\n\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.up0 = this.object.up.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// events\n\n\t\tvar changeEvent = { type: 'change' };\n\t\tvar startEvent = { type: 'start' };\n\t\tvar endEvent = { type: 'end' };\n\n\n\t\t// methods\n\n\t\tthis.handleResize = function () {\n\n\t\t\tvar box = this.domElement.getBoundingClientRect();\n\t\t\t// adjustments come from similar code in the jquery offset() function\n\t\t\tvar d = this.domElement.ownerDocument.documentElement;\n\t\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\n\t\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\n\t\t\tthis.screen.width = box.width;\n\t\t\tthis.screen.height = box.height;\n\n\t\t};\n\n\t\tvar getMouseOnScreen = ( function () {\n\n\t\t\tvar vector = new THREE.Vector2();\n\n\t\t\treturn function getMouseOnScreen( pageX, pageY ) {\n\n\t\t\t\tvector.set(\n\t\t\t\t\t( pageX - _this.screen.left ) / _this.screen.width,\n\t\t\t\t\t( pageY - _this.screen.top ) / _this.screen.height\n\t\t\t\t);\n\n\t\t\t\treturn vector;\n\n\t\t\t};\n\n\t\t}() );\n\n\t\tvar getMouseOnCircle = ( function () {\n\n\t\t\tvar vector = new THREE.Vector2();\n\n\t\t\treturn function getMouseOnCircle( pageX, pageY ) {\n\n\t\t\t\tvector.set(\n\t\t\t\t\t( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ),\n\t\t\t\t\t( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional\n\t\t\t\t);\n\n\t\t\t\treturn vector;\n\n\t\t\t};\n\n\t\t}() );\n\n\t\tthis.rotateCamera = ( function () {\n\n\t\t\tvar axis = new THREE.Vector3(),\n\t\t\t\tquaternion = new THREE.Quaternion(),\n\t\t\t\teyeDirection = new THREE.Vector3(),\n\t\t\t\tobjectUpDirection = new THREE.Vector3(),\n\t\t\t\tobjectSidewaysDirection = new THREE.Vector3(),\n\t\t\t\tmoveDirection = new THREE.Vector3(),\n\t\t\t\tangle;\n\n\t\t\treturn function rotateCamera() {\n\n\t\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\n\t\t\t\tangle = moveDirection.length();\n\n\t\t\t\tif ( angle ) {\n\n\t\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\n\t\t\t\t\teyeDirection.copy( _eye ).normalize();\n\t\t\t\t\tobjectUpDirection.copy( _this.object.up ).normalize();\n\t\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\n\n\t\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\n\t\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\n\n\t\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\n\n\t\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\n\n\t\t\t\t\tangle *= _this.rotateSpeed;\n\t\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\n\n\t\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t\t_lastAxis.copy( axis );\n\t\t\t\t\t_lastAngle = angle;\n\n\t\t\t\t} else if ( ! _this.staticMoving && _lastAngle ) {\n\n\t\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor );\n\t\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\t\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\n\t\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t}\n\n\t\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t\t};\n\n\t\t}() );\n\n\n\t\tthis.zoomCamera = function () {\n\n\t\t\tvar factor;\n\n\t\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\n\n\t\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n\t\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n\t\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\t_this.object.zoom *= factor;\n\t\t\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\n\n\t\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\n\n\t\t\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\t\t_this.object.zoom /= factor;\n\t\t\t\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.panCamera = ( function () {\n\n\t\t\tvar mouseChange = new THREE.Vector2(),\n\t\t\t\tobjectUp = new THREE.Vector3(),\n\t\t\t\tpan = new THREE.Vector3();\n\n\t\t\treturn function panCamera() {\n\n\t\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\n\n\t\t\t\tif ( mouseChange.lengthSq() ) {\n\n\t\t\t\t\tif ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\t\tvar scale_x = ( _this.object.right - _this.object.left ) / _this.object.zoom / _this.domElement.clientWidth;\n\t\t\t\t\t\tvar scale_y = ( _this.object.top - _this.object.bottom ) / _this.object.zoom / _this.domElement.clientWidth;\n\n\t\t\t\t\t\tmouseChange.x *= scale_x;\n\t\t\t\t\t\tmouseChange.y *= scale_y;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmouseChange.multiplyScalar( _eye.length() * _this.panSpeed );\n\n\t\t\t\t\tpan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x );\n\t\t\t\t\tpan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) );\n\n\t\t\t\t\t_this.object.position.add( pan );\n\t\t\t\t\t_this.target.add( pan );\n\n\t\t\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t\t\t_panStart.copy( _panEnd );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}() );\n\n\t\tthis.checkDistances = function () {\n\n\t\t\tif ( ! _this.noZoom || ! _this.noPan ) {\n\n\t\t\t\tif ( _eye.lengthSq() > _this.maxDistance * _this.maxDistance ) {\n\n\t\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) );\n\t\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t\t}\n\n\t\t\t\tif ( _eye.lengthSq() < _this.minDistance * _this.minDistance ) {\n\n\t\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) );\n\t\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.update = function () {\n\n\t\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\t\tif ( ! _this.noRotate ) {\n\n\t\t\t\t_this.rotateCamera();\n\n\t\t\t}\n\n\t\t\tif ( ! _this.noZoom ) {\n\n\t\t\t\t_this.zoomCamera();\n\n\t\t\t}\n\n\t\t\tif ( ! _this.noPan ) {\n\n\t\t\t\t_this.panCamera();\n\n\t\t\t}\n\n\t\t\t_this.object.position.addVectors( _this.target, _eye );\n\n\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t_this.checkDistances();\n\n\t\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ) {\n\n\t\t\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\t\t\tlastPosition.copy( _this.object.position );\n\n\t\t\t\t}\n\n\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS || lastZoom !== _this.object.zoom ) {\n\n\t\t\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\t\t\tlastPosition.copy( _this.object.position );\n\t\t\t\t\tlastZoom = _this.object.zoom;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\t_state = STATE.NONE;\n\t\t\t_keyState = STATE.NONE;\n\n\t\t\t_this.target.copy( _this.target0 );\n\t\t\t_this.object.position.copy( _this.position0 );\n\t\t\t_this.object.up.copy( _this.up0 );\n\t\t\t_this.object.zoom = _this.zoom0;\n\n\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\tlastPosition.copy( _this.object.position );\n\t\t\tlastZoom = _this.object.zoom;\n\n\t\t};\n\n\t\t// listeners\n\n\t\tfunction keydown( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\twindow.removeEventListener( 'keydown', keydown );\n\n\t\t\tif ( _keyState !== STATE.NONE ) {\n\n\t\t\t\treturn;\n\n\t\t\t} else if ( event.keyCode === _this.keys[ STATE.ROTATE ] && ! _this.noRotate ) {\n\n\t\t\t\t_keyState = STATE.ROTATE;\n\n\t\t\t} else if ( event.keyCode === _this.keys[ STATE.ZOOM ] && ! _this.noZoom ) {\n\n\t\t\t\t_keyState = STATE.ZOOM;\n\n\t\t\t} else if ( event.keyCode === _this.keys[ STATE.PAN ] && ! _this.noPan ) {\n\n\t\t\t\t_keyState = STATE.PAN;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction keyup() {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\t_keyState = STATE.NONE;\n\n\t\t\twindow.addEventListener( 'keydown', keydown, false );\n\n\t\t}\n\n\t\tfunction mousedown( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tif ( _state === STATE.NONE ) {\n\n\t\t\t\tswitch ( event.button ) {\n\n\t\t\t\t\tcase _this.mouseButtons.LEFT:\n\t\t\t\t\t\t_state = STATE.ROTATE;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase _this.mouseButtons.MIDDLE:\n\t\t\t\t\t\t_state = STATE.ZOOM;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase _this.mouseButtons.RIGHT:\n\t\t\t\t\t\t_state = STATE.PAN;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t_state = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t\t_zoomEnd.copy( _zoomStart );\n\n\t\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t\t_panEnd.copy( _panStart );\n\n\t\t\t}\n\n\t\t\tdocument.addEventListener( 'mousemove', mousemove, false );\n\t\t\tdocument.addEventListener( 'mouseup', mouseup, false );\n\n\t\t\t_this.dispatchEvent( startEvent );\n\n\t\t}\n\n\t\tfunction mousemove( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\n\t\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction mouseup( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\t_state = STATE.NONE;\n\n\t\t\tdocument.removeEventListener( 'mousemove', mousemove );\n\t\t\tdocument.removeEventListener( 'mouseup', mouseup );\n\t\t\t_this.dispatchEvent( endEvent );\n\n\t\t}\n\n\t\tfunction mousewheel( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tif ( _this.noZoom === true ) return;\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tswitch ( event.deltaMode ) {\n\n\t\t\t\tcase 2:\n\t\t\t\t\t// Zoom in pages\n\t\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\t// Zoom in lines\n\t\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// undefined, 0, assume pixels\n\t\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\t_this.dispatchEvent( startEvent );\n\t\t\t_this.dispatchEvent( endEvent );\n\n\t\t}\n\n\t\tfunction touchstart( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tswitch ( event.touches.length ) {\n\n\t\t\t\tcase 1:\n\t\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault: // 2 or more\n\t\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t\t_panEnd.copy( _panStart );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\t_this.dispatchEvent( startEvent );\n\n\t\t}\n\n\t\tfunction touchmove( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tswitch ( event.touches.length ) {\n\n\t\t\t\tcase 1:\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault: // 2 or more\n\t\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction touchend( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tswitch ( event.touches.length ) {\n\n\t\t\t\tcase 0:\n\t\t\t\t\t_state = STATE.NONE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\t_this.dispatchEvent( endEvent );\n\n\t\t}\n\n\t\tfunction contextmenu( event ) {\n\n\t\t\tif ( _this.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tthis.dispose = function () {\n\n\t\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\t\tthis.domElement.removeEventListener( 'mousedown', mousedown, false );\n\t\t\tthis.domElement.removeEventListener( 'wheel', mousewheel, false );\n\n\t\t\tthis.domElement.removeEventListener( 'touchstart', touchstart, false );\n\t\t\tthis.domElement.removeEventListener( 'touchend', touchend, false );\n\t\t\tthis.domElement.removeEventListener( 'touchmove', touchmove, false );\n\n\t\t\tdocument.removeEventListener( 'mousemove', mousemove, false );\n\t\t\tdocument.removeEventListener( 'mouseup', mouseup, false );\n\n\t\t\twindow.removeEventListener( 'keydown', keydown, false );\n\t\t\twindow.removeEventListener( 'keyup', keyup, false );\n\n\t\t};\n\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.addEventListener( 'mousedown', mousedown, false );\n\t\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\n\n\t\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\n\t\tthis.domElement.addEventListener( 'touchend', touchend, false );\n\t\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\n\n\t\twindow.addEventListener( 'keydown', keydown, false );\n\t\twindow.addEventListener( 'keyup', keyup, false );\n\n\t\tthis.handleResize();\n\n\t\t// force an update at start\n\t\tthis.update();\n\n\t};\n\n\tTHREE.TrackballControls.prototype = Object.create( THREE.EventDispatcher.prototype );\n\tTHREE.TrackballControls.prototype.constructor = THREE.TrackballControls;\n\n\treturn THREE.TrackballControls;\n});\n"]}