{"version":3,"sources":["controls/TransformControls.js"],"names":["define","THREE","threex","TransformControls","camera","domElement","undefined","console","warn","document","Object3D","call","this","visible","_gizmo","TransformControlsGizmo","add","_plane","TransformControlsPlane","scope","defineProperty","changeEvent","type","mouseDownEvent","mouseUpEvent","mode","objectChangeEvent","ray","Raycaster","_tempVector","Vector3","_tempVector2","_tempQuaternion","Quaternion","_unit","X","Y","Z","pointStart","pointEnd","offset","rotationAxis","startNorm","endNorm","rotationAngle","cameraPosition","cameraQuaternion","cameraScale","parentPosition","parentQuaternion","parentQuaternionInv","parentScale","worldPositionStart","worldQuaternionStart","worldScaleStart","worldPosition","worldQuaternion","worldQuaternionInv","worldScale","eye","positionStart","quaternionStart","scaleStart","propName","defaultValue","propValue","Object","get","set","value","dispatchEvent","getPointer","event","pointerLockElement","x","y","button","pointer","changedTouches","rect","getBoundingClientRect","clientX","left","width","clientY","top","height","onPointerHover","enabled","pointerHover","onPointerDown","addEventListener","onPointerMove","pointerDown","pointerMove","onPointerUp","removeEventListener","pointerUp","dispose","traverse","child","geometry","material","attach","object","detach","axis","updateMatrixWorld","parent","error","matrixWorld","decompose","copy","inverse","sub","normalize","prototype","dragging","setFromCamera","intersect","intersectObjects","picker","children","name","planeIntersect","space","snap","rotationSnap","rotation","Math","round","z","position","quaternion","scale","point","applyQuaternion","indexOf","divide","translationSnap","search","setFromMatrixPosition","d","length","dot","multiply","scaleSnap","ROTATION_SPEED","distanceTo","angleTo","cross","setFromAxisAngle","getMode","setMode","setTranslationSnap","setRotationSnap","setScaleSnap","setSize","size","setSpace","update","assign","create","constructor","isTransformControls","controls"],"mappings":"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","file":"../../controls/TransformControls.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var TransformControls = function (camera, domElement) {\r\n        if (domElement === undefined) {\r\n            console.warn('THREE.TransformControls: The second parameter \"domElement\" is now mandatory.');\r\n            domElement = document;\r\n        }\r\n        THREE.Object3D.call(this);\r\n        this.visible = false;\r\n        this.domElement = domElement;\r\n        var _gizmo = new TransformControlsGizmo();\r\n        this.add(_gizmo);\r\n        var _plane = new TransformControlsPlane();\r\n        this.add(_plane);\r\n        var scope = this;\r\n        defineProperty('camera', camera);\r\n        defineProperty('object', undefined);\r\n        defineProperty('enabled', true);\r\n        defineProperty('axis', null);\r\n        defineProperty('mode', 'translate');\r\n        defineProperty('translationSnap', null);\r\n        defineProperty('rotationSnap', null);\r\n        defineProperty('scaleSnap', null);\r\n        defineProperty('space', 'world');\r\n        defineProperty('size', 1);\r\n        defineProperty('dragging', false);\r\n        defineProperty('showX', true);\r\n        defineProperty('showY', true);\r\n        defineProperty('showZ', true);\r\n        var changeEvent = { type: 'change' };\r\n        var mouseDownEvent = { type: 'mouseDown' };\r\n        var mouseUpEvent = {\r\n            type: 'mouseUp',\r\n            mode: scope.mode\r\n        };\r\n        var objectChangeEvent = { type: 'objectChange' };\r\n        var ray = new THREE.Raycaster();\r\n        var _tempVector = new THREE.Vector3();\r\n        var _tempVector2 = new THREE.Vector3();\r\n        var _tempQuaternion = new THREE.Quaternion();\r\n        var _unit = {\r\n            X: new THREE.Vector3(1, 0, 0),\r\n            Y: new THREE.Vector3(0, 1, 0),\r\n            Z: new THREE.Vector3(0, 0, 1)\r\n        };\r\n        var pointStart = new THREE.Vector3();\r\n        var pointEnd = new THREE.Vector3();\r\n        var offset = new THREE.Vector3();\r\n        var rotationAxis = new THREE.Vector3();\r\n        var startNorm = new THREE.Vector3();\r\n        var endNorm = new THREE.Vector3();\r\n        var rotationAngle = 0;\r\n        var cameraPosition = new THREE.Vector3();\r\n        var cameraQuaternion = new THREE.Quaternion();\r\n        var cameraScale = new THREE.Vector3();\r\n        var parentPosition = new THREE.Vector3();\r\n        var parentQuaternion = new THREE.Quaternion();\r\n        var parentQuaternionInv = new THREE.Quaternion();\r\n        var parentScale = new THREE.Vector3();\r\n        var worldPositionStart = new THREE.Vector3();\r\n        var worldQuaternionStart = new THREE.Quaternion();\r\n        var worldScaleStart = new THREE.Vector3();\r\n        var worldPosition = new THREE.Vector3();\r\n        var worldQuaternion = new THREE.Quaternion();\r\n        var worldQuaternionInv = new THREE.Quaternion();\r\n        var worldScale = new THREE.Vector3();\r\n        var eye = new THREE.Vector3();\r\n        var positionStart = new THREE.Vector3();\r\n        var quaternionStart = new THREE.Quaternion();\r\n        var scaleStart = new THREE.Vector3();\r\n        defineProperty('worldPosition', worldPosition);\r\n        defineProperty('worldPositionStart', worldPositionStart);\r\n        defineProperty('worldQuaternion', worldQuaternion);\r\n        defineProperty('worldQuaternionStart', worldQuaternionStart);\r\n        defineProperty('cameraPosition', cameraPosition);\r\n        defineProperty('cameraQuaternion', cameraQuaternion);\r\n        defineProperty('pointStart', pointStart);\r\n        defineProperty('pointEnd', pointEnd);\r\n        defineProperty('rotationAxis', rotationAxis);\r\n        defineProperty('rotationAngle', rotationAngle);\r\n        defineProperty('eye', eye);\r\n        {\r\n            domElement.addEventListener('mousedown', onPointerDown, false);\r\n            domElement.addEventListener('touchstart', onPointerDown, false);\r\n            domElement.addEventListener('mousemove', onPointerHover, false);\r\n            domElement.addEventListener('touchmove', onPointerHover, false);\r\n            domElement.addEventListener('touchmove', onPointerMove, false);\r\n            document.addEventListener('mouseup', onPointerUp, false);\r\n            domElement.addEventListener('touchend', onPointerUp, false);\r\n            domElement.addEventListener('touchcancel', onPointerUp, false);\r\n            domElement.addEventListener('touchleave', onPointerUp, false);\r\n        }\r\n        this.dispose = function () {\r\n            domElement.removeEventListener('mousedown', onPointerDown);\r\n            domElement.removeEventListener('touchstart', onPointerDown);\r\n            domElement.removeEventListener('mousemove', onPointerHover);\r\n            document.removeEventListener('mousemove', onPointerMove);\r\n            domElement.removeEventListener('touchmove', onPointerHover);\r\n            domElement.removeEventListener('touchmove', onPointerMove);\r\n            document.removeEventListener('mouseup', onPointerUp);\r\n            domElement.removeEventListener('touchend', onPointerUp);\r\n            domElement.removeEventListener('touchcancel', onPointerUp);\r\n            domElement.removeEventListener('touchleave', onPointerUp);\r\n            this.traverse(function (child) {\r\n                if (child.geometry)\r\n                    child.geometry.dispose();\r\n                if (child.material)\r\n                    child.material.dispose();\r\n            });\r\n        };\r\n        this.attach = function (object) {\r\n            this.object = object;\r\n            this.visible = true;\r\n            return this;\r\n        };\r\n        this.detach = function () {\r\n            this.object = undefined;\r\n            this.visible = false;\r\n            this.axis = null;\r\n            return this;\r\n        };\r\n        function defineProperty(propName, defaultValue) {\r\n            var propValue = defaultValue;\r\n            Object.defineProperty(scope, propName, {\r\n                get: function () {\r\n                    return propValue !== undefined ? propValue : defaultValue;\r\n                },\r\n                set: function (value) {\r\n                    if (propValue !== value) {\r\n                        propValue = value;\r\n                        _plane[propName] = value;\r\n                        _gizmo[propName] = value;\r\n                        scope.dispatchEvent({\r\n                            type: propName + '-changed',\r\n                            value: value\r\n                        });\r\n                        scope.dispatchEvent(changeEvent);\r\n                    }\r\n                }\r\n            });\r\n            scope[propName] = defaultValue;\r\n            _plane[propName] = defaultValue;\r\n            _gizmo[propName] = defaultValue;\r\n        }\r\n        this.updateMatrixWorld = function () {\r\n            if (this.object !== undefined) {\r\n                this.object.updateMatrixWorld();\r\n                if (this.object.parent === null) {\r\n                    console.error('TransformControls: The attached 3D object must be THREE part of the scene graph.');\r\n                } else {\r\n                    this.object.parent.matrixWorld.decompose(parentPosition, parentQuaternion, parentScale);\r\n                }\r\n                this.object.matrixWorld.decompose(worldPosition, worldQuaternion, worldScale);\r\n                parentQuaternionInv.copy(parentQuaternion).inverse();\r\n                worldQuaternionInv.copy(worldQuaternion).inverse();\r\n            }\r\n            this.camera.updateMatrixWorld();\r\n            this.camera.matrixWorld.decompose(cameraPosition, cameraQuaternion, cameraScale);\r\n            eye.copy(cameraPosition).sub(worldPosition).normalize();\r\n            THREE.Object3D.prototype.updateMatrixWorld.call(this);\r\n        };\r\n        this.pointerHover = function (pointer) {\r\n            if (this.object === undefined || this.dragging === true || pointer.button !== undefined && pointer.button !== 0)\r\n                return;\r\n            ray.setFromCamera(pointer, this.camera);\r\n            var intersect = ray.intersectObjects(_gizmo.picker[this.mode].children, true)[0] || false;\r\n            if (intersect) {\r\n                this.axis = intersect.object.name;\r\n            } else {\r\n                this.axis = null;\r\n            }\r\n        };\r\n        this.pointerDown = function (pointer) {\r\n            if (this.object === undefined || this.dragging === true || pointer.button !== undefined && pointer.button !== 0)\r\n                return;\r\n            if ((pointer.button === 0 || pointer.button === undefined) && this.axis !== null) {\r\n                ray.setFromCamera(pointer, this.camera);\r\n                var planeIntersect = ray.intersectObjects([_plane], true)[0] || false;\r\n                if (planeIntersect) {\r\n                    var space = this.space;\r\n                    if (this.mode === 'scale') {\r\n                        space = 'local';\r\n                    } else if (this.axis === 'E' || this.axis === 'XYZE' || this.axis === 'XYZ') {\r\n                        space = 'world';\r\n                    }\r\n                    if (space === 'local' && this.mode === 'rotate') {\r\n                        var snap = this.rotationSnap;\r\n                        if (this.axis === 'X' && snap)\r\n                            this.object.rotation.x = Math.round(this.object.rotation.x / snap) * snap;\r\n                        if (this.axis === 'Y' && snap)\r\n                            this.object.rotation.y = Math.round(this.object.rotation.y / snap) * snap;\r\n                        if (this.axis === 'Z' && snap)\r\n                            this.object.rotation.z = Math.round(this.object.rotation.z / snap) * snap;\r\n                    }\r\n                    this.object.updateMatrixWorld();\r\n                    this.object.parent.updateMatrixWorld();\r\n                    positionStart.copy(this.object.position);\r\n                    quaternionStart.copy(this.object.quaternion);\r\n                    scaleStart.copy(this.object.scale);\r\n                    this.object.matrixWorld.decompose(worldPositionStart, worldQuaternionStart, worldScaleStart);\r\n                    pointStart.copy(planeIntersect.point).sub(worldPositionStart);\r\n                }\r\n                this.dragging = true;\r\n                mouseDownEvent.mode = this.mode;\r\n                this.dispatchEvent(mouseDownEvent);\r\n            }\r\n        };\r\n        this.pointerMove = function (pointer) {\r\n            var axis = this.axis;\r\n            var mode = this.mode;\r\n            var object = this.object;\r\n            var space = this.space;\r\n            if (mode === 'scale') {\r\n                space = 'local';\r\n            } else if (axis === 'E' || axis === 'XYZE' || axis === 'XYZ') {\r\n                space = 'world';\r\n            }\r\n            if (object === undefined || axis === null || this.dragging === false || pointer.button !== undefined && pointer.button !== 0)\r\n                return;\r\n            ray.setFromCamera(pointer, this.camera);\r\n            var planeIntersect = ray.intersectObjects([_plane], true)[0] || false;\r\n            if (planeIntersect === false)\r\n                return;\r\n            pointEnd.copy(planeIntersect.point).sub(worldPositionStart);\r\n            if (mode === 'translate') {\r\n                offset.copy(pointEnd).sub(pointStart);\r\n                if (space === 'local' && axis !== 'XYZ') {\r\n                    offset.applyQuaternion(worldQuaternionInv);\r\n                }\r\n                if (axis.indexOf('X') === -1)\r\n                    offset.x = 0;\r\n                if (axis.indexOf('Y') === -1)\r\n                    offset.y = 0;\r\n                if (axis.indexOf('Z') === -1)\r\n                    offset.z = 0;\r\n                if (space === 'local' && axis !== 'XYZ') {\r\n                    offset.applyQuaternion(quaternionStart).divide(parentScale);\r\n                } else {\r\n                    offset.applyQuaternion(parentQuaternionInv).divide(parentScale);\r\n                }\r\n                object.position.copy(offset).add(positionStart);\r\n                if (this.translationSnap) {\r\n                    if (space === 'local') {\r\n                        object.position.applyQuaternion(_tempQuaternion.copy(quaternionStart).inverse());\r\n                        if (axis.search('X') !== -1) {\r\n                            object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\r\n                        }\r\n                        if (axis.search('Y') !== -1) {\r\n                            object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\r\n                        }\r\n                        if (axis.search('Z') !== -1) {\r\n                            object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\r\n                        }\r\n                        object.position.applyQuaternion(quaternionStart);\r\n                    }\r\n                    if (space === 'world') {\r\n                        if (object.parent) {\r\n                            object.position.add(_tempVector.setFromMatrixPosition(object.parent.matrixWorld));\r\n                        }\r\n                        if (axis.search('X') !== -1) {\r\n                            object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\r\n                        }\r\n                        if (axis.search('Y') !== -1) {\r\n                            object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\r\n                        }\r\n                        if (axis.search('Z') !== -1) {\r\n                            object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\r\n                        }\r\n                        if (object.parent) {\r\n                            object.position.sub(_tempVector.setFromMatrixPosition(object.parent.matrixWorld));\r\n                        }\r\n                    }\r\n                }\r\n            } else if (mode === 'scale') {\r\n                if (axis.search('XYZ') !== -1) {\r\n                    var d = pointEnd.length() / pointStart.length();\r\n                    if (pointEnd.dot(pointStart) < 0)\r\n                        d *= -1;\r\n                    _tempVector2.set(d, d, d);\r\n                } else {\r\n                    _tempVector.copy(pointStart);\r\n                    _tempVector2.copy(pointEnd);\r\n                    _tempVector.applyQuaternion(worldQuaternionInv);\r\n                    _tempVector2.applyQuaternion(worldQuaternionInv);\r\n                    _tempVector2.divide(_tempVector);\r\n                    if (axis.search('X') === -1) {\r\n                        _tempVector2.x = 1;\r\n                    }\r\n                    if (axis.search('Y') === -1) {\r\n                        _tempVector2.y = 1;\r\n                    }\r\n                    if (axis.search('Z') === -1) {\r\n                        _tempVector2.z = 1;\r\n                    }\r\n                }\r\n                object.scale.copy(scaleStart).multiply(_tempVector2);\r\n                if (this.scaleSnap) {\r\n                    if (axis.search('X') !== -1) {\r\n                        object.scale.x = Math.round(object.scale.x / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\r\n                    }\r\n                    if (axis.search('Y') !== -1) {\r\n                        object.scale.y = Math.round(object.scale.y / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\r\n                    }\r\n                    if (axis.search('Z') !== -1) {\r\n                        object.scale.z = Math.round(object.scale.z / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\r\n                    }\r\n                }\r\n            } else if (mode === 'rotate') {\r\n                offset.copy(pointEnd).sub(pointStart);\r\n                var ROTATION_SPEED = 20 / worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));\r\n                if (axis === 'E') {\r\n                    rotationAxis.copy(eye);\r\n                    rotationAngle = pointEnd.angleTo(pointStart);\r\n                    startNorm.copy(pointStart).normalize();\r\n                    endNorm.copy(pointEnd).normalize();\r\n                    rotationAngle *= endNorm.cross(startNorm).dot(eye) < 0 ? 1 : -1;\r\n                } else if (axis === 'XYZE') {\r\n                    rotationAxis.copy(offset).cross(eye).normalize();\r\n                    rotationAngle = offset.dot(_tempVector.copy(rotationAxis).cross(this.eye)) * ROTATION_SPEED;\r\n                } else if (axis === 'X' || axis === 'Y' || axis === 'Z') {\r\n                    rotationAxis.copy(_unit[axis]);\r\n                    _tempVector.copy(_unit[axis]);\r\n                    if (space === 'local') {\r\n                        _tempVector.applyQuaternion(worldQuaternion);\r\n                    }\r\n                    rotationAngle = offset.dot(_tempVector.cross(eye).normalize()) * ROTATION_SPEED;\r\n                }\r\n                if (this.rotationSnap)\r\n                    rotationAngle = Math.round(rotationAngle / this.rotationSnap) * this.rotationSnap;\r\n                this.rotationAngle = rotationAngle;\r\n                if (space === 'local' && axis !== 'E' && axis !== 'XYZE') {\r\n                    object.quaternion.copy(quaternionStart);\r\n                    object.quaternion.multiply(_tempQuaternion.setFromAxisAngle(rotationAxis, rotationAngle)).normalize();\r\n                } else {\r\n                    rotationAxis.applyQuaternion(parentQuaternionInv);\r\n                    object.quaternion.copy(_tempQuaternion.setFromAxisAngle(rotationAxis, rotationAngle));\r\n                    object.quaternion.multiply(quaternionStart).normalize();\r\n                }\r\n            }\r\n            this.dispatchEvent(changeEvent);\r\n            this.dispatchEvent(objectChangeEvent);\r\n        };\r\n        this.pointerUp = function (pointer) {\r\n            if (pointer.button !== undefined && pointer.button !== 0)\r\n                return;\r\n            if (this.dragging && this.axis !== null) {\r\n                mouseUpEvent.mode = this.mode;\r\n                this.dispatchEvent(mouseUpEvent);\r\n            }\r\n            this.dragging = false;\r\n            if (pointer.button === undefined)\r\n                this.axis = null;\r\n        };\r\n        function getPointer(event) {\r\n            if (document.pointerLockElement) {\r\n                return {\r\n                    x: 0,\r\n                    y: 0,\r\n                    button: event.button\r\n                };\r\n            } else {\r\n                var pointer = event.changedTouches ? event.changedTouches[0] : event;\r\n                var rect = domElement.getBoundingClientRect();\r\n                return {\r\n                    x: (pointer.clientX - rect.left) / rect.width * 2 - 1,\r\n                    y: -(pointer.clientY - rect.top) / rect.height * 2 + 1,\r\n                    button: event.button\r\n                };\r\n            }\r\n        }\r\n        function onPointerHover(event) {\r\n            if (!scope.enabled)\r\n                return;\r\n            scope.pointerHover(getPointer(event));\r\n        }\r\n        function onPointerDown(event) {\r\n            if (!scope.enabled)\r\n                return;\r\n            document.addEventListener('mousemove', onPointerMove, false);\r\n            scope.pointerHover(getPointer(event));\r\n            scope.pointerDown(getPointer(event));\r\n        }\r\n        function onPointerMove(event) {\r\n            if (!scope.enabled)\r\n                return;\r\n            scope.pointerMove(getPointer(event));\r\n        }\r\n        function onPointerUp(event) {\r\n            if (!scope.enabled)\r\n                return;\r\n            document.removeEventListener('mousemove', onPointerMove, false);\r\n            scope.pointerUp(getPointer(event));\r\n        }\r\n        this.getMode = function () {\r\n            return scope.mode;\r\n        };\r\n        this.setMode = function (mode) {\r\n            scope.mode = mode;\r\n        };\r\n        this.setTranslationSnap = function (translationSnap) {\r\n            scope.translationSnap = translationSnap;\r\n        };\r\n        this.setRotationSnap = function (rotationSnap) {\r\n            scope.rotationSnap = rotationSnap;\r\n        };\r\n        this.setScaleSnap = function (scaleSnap) {\r\n            scope.scaleSnap = scaleSnap;\r\n        };\r\n        this.setSize = function (size) {\r\n            scope.size = size;\r\n        };\r\n        this.setSpace = function (space) {\r\n            scope.space = space;\r\n        };\r\n        this.update = function () {\r\n            console.warn('THREE.TransformControls: update function has no more functionality and therefore has been deprecated.');\r\n        };\r\n    };\r\n    TransformControls.prototype = Object.assign(Object.create(THREE.Object3D.prototype), {\r\n        constructor: TransformControls,\r\n        isTransformControls: true\r\n    });\r\n\r\n    return threex.controls.TransformControls = TransformControls;\r\n});"]}