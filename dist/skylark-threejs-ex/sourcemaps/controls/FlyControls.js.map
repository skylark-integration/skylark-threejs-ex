{"version":3,"sources":["controls/FlyControls.js"],"names":["define","THREE","FlyControls","object","domElement","bind","scope","fn","apply","arguments","contextmenu","event","preventDefault","undefined","console","warn","document","this","setAttribute","movementSpeed","rollSpeed","dragToLook","autoForward","tmpQuaternion","Quaternion","mouseStatus","moveState","up","down","left","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","Vector3","rotationVector","keydown","altKey","keyCode","movementSpeedMultiplier","updateMovementVector","updateRotationVector","keyup","mousedown","focus","stopPropagation","button","mousemove","container","getContainerDimensions","halfWidth","size","halfHeight","pageX","offset","pageY","mouseup","update","delta","moveMult","rotMult","translateX","x","translateY","y","translateZ","z","set","normalize","quaternion","multiply","rotation","setFromQuaternion","order","offsetWidth","offsetHeight","offsetLeft","offsetTop","window","innerWidth","innerHeight","dispose","removeEventListener","_mousedown","_mousemove","_mouseup","_keydown","_keyup","addEventListener"],"mappings":"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","file":"../../controls/FlyControls.js","sourcesContent":["define([\n\t\"skylark-threejs\"\n],function(THREE){\n\t/**\n\t * @author James Baicoianu / http://www.baicoianu.com/\n\t */\n\n\tTHREE.FlyControls = function ( object, domElement ) {\n\n\t\tif ( domElement === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.FlyControls: The second parameter \"domElement\" is now mandatory.' );\n\t\t\tdomElement = document;\n\n\t\t}\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\n\t\tif ( domElement ) this.domElement.setAttribute( 'tabindex', - 1 );\n\n\t\t// API\n\n\t\tthis.movementSpeed = 1.0;\n\t\tthis.rollSpeed = 0.005;\n\n\t\tthis.dragToLook = false;\n\t\tthis.autoForward = false;\n\n\t\t// disable default target object behavior\n\n\t\t// internals\n\n\t\tthis.tmpQuaternion = new THREE.Quaternion();\n\n\t\tthis.mouseStatus = 0;\n\n\t\tthis.moveState = { up: 0, down: 0, left: 0, right: 0, forward: 0, back: 0, pitchUp: 0, pitchDown: 0, yawLeft: 0, yawRight: 0, rollLeft: 0, rollRight: 0 };\n\t\tthis.moveVector = new THREE.Vector3( 0, 0, 0 );\n\t\tthis.rotationVector = new THREE.Vector3( 0, 0, 0 );\n\n\t\tthis.keydown = function ( event ) {\n\n\t\t\tif ( event.altKey ) {\n\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\t//event.preventDefault();\n\n\t\t\tswitch ( event.keyCode ) {\n\n\t\t\t\tcase 16: /* shift */ this.movementSpeedMultiplier = .1; break;\n\n\t\t\t\tcase 87: /*W*/ this.moveState.forward = 1; break;\n\t\t\t\tcase 83: /*S*/ this.moveState.back = 1; break;\n\n\t\t\t\tcase 65: /*A*/ this.moveState.left = 1; break;\n\t\t\t\tcase 68: /*D*/ this.moveState.right = 1; break;\n\n\t\t\t\tcase 82: /*R*/ this.moveState.up = 1; break;\n\t\t\t\tcase 70: /*F*/ this.moveState.down = 1; break;\n\n\t\t\t\tcase 38: /*up*/ this.moveState.pitchUp = 1; break;\n\t\t\t\tcase 40: /*down*/ this.moveState.pitchDown = 1; break;\n\n\t\t\t\tcase 37: /*left*/ this.moveState.yawLeft = 1; break;\n\t\t\t\tcase 39: /*right*/ this.moveState.yawRight = 1; break;\n\n\t\t\t\tcase 81: /*Q*/ this.moveState.rollLeft = 1; break;\n\t\t\t\tcase 69: /*E*/ this.moveState.rollRight = 1; break;\n\n\t\t\t}\n\n\t\t\tthis.updateMovementVector();\n\t\t\tthis.updateRotationVector();\n\n\t\t};\n\n\t\tthis.keyup = function ( event ) {\n\n\t\t\tswitch ( event.keyCode ) {\n\n\t\t\t\tcase 16: /* shift */ this.movementSpeedMultiplier = 1; break;\n\n\t\t\t\tcase 87: /*W*/ this.moveState.forward = 0; break;\n\t\t\t\tcase 83: /*S*/ this.moveState.back = 0; break;\n\n\t\t\t\tcase 65: /*A*/ this.moveState.left = 0; break;\n\t\t\t\tcase 68: /*D*/ this.moveState.right = 0; break;\n\n\t\t\t\tcase 82: /*R*/ this.moveState.up = 0; break;\n\t\t\t\tcase 70: /*F*/ this.moveState.down = 0; break;\n\n\t\t\t\tcase 38: /*up*/ this.moveState.pitchUp = 0; break;\n\t\t\t\tcase 40: /*down*/ this.moveState.pitchDown = 0; break;\n\n\t\t\t\tcase 37: /*left*/ this.moveState.yawLeft = 0; break;\n\t\t\t\tcase 39: /*right*/ this.moveState.yawRight = 0; break;\n\n\t\t\t\tcase 81: /*Q*/ this.moveState.rollLeft = 0; break;\n\t\t\t\tcase 69: /*E*/ this.moveState.rollRight = 0; break;\n\n\t\t\t}\n\n\t\t\tthis.updateMovementVector();\n\t\t\tthis.updateRotationVector();\n\n\t\t};\n\n\t\tthis.mousedown = function ( event ) {\n\n\t\t\tif ( this.domElement !== document ) {\n\n\t\t\t\tthis.domElement.focus();\n\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tif ( this.dragToLook ) {\n\n\t\t\t\tthis.mouseStatus ++;\n\n\t\t\t} else {\n\n\t\t\t\tswitch ( event.button ) {\n\n\t\t\t\t\tcase 0: this.moveState.forward = 1; break;\n\t\t\t\t\tcase 2: this.moveState.back = 1; break;\n\n\t\t\t\t}\n\n\t\t\t\tthis.updateMovementVector();\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.mousemove = function ( event ) {\n\n\t\t\tif ( ! this.dragToLook || this.mouseStatus > 0 ) {\n\n\t\t\t\tvar container = this.getContainerDimensions();\n\t\t\t\tvar halfWidth = container.size[ 0 ] / 2;\n\t\t\t\tvar halfHeight = container.size[ 1 ] / 2;\n\n\t\t\t\tthis.moveState.yawLeft = - ( ( event.pageX - container.offset[ 0 ] ) - halfWidth ) / halfWidth;\n\t\t\t\tthis.moveState.pitchDown = ( ( event.pageY - container.offset[ 1 ] ) - halfHeight ) / halfHeight;\n\n\t\t\t\tthis.updateRotationVector();\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.mouseup = function ( event ) {\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tif ( this.dragToLook ) {\n\n\t\t\t\tthis.mouseStatus --;\n\n\t\t\t\tthis.moveState.yawLeft = this.moveState.pitchDown = 0;\n\n\t\t\t} else {\n\n\t\t\t\tswitch ( event.button ) {\n\n\t\t\t\t\tcase 0: this.moveState.forward = 0; break;\n\t\t\t\t\tcase 2: this.moveState.back = 0; break;\n\n\t\t\t\t}\n\n\t\t\t\tthis.updateMovementVector();\n\n\t\t\t}\n\n\t\t\tthis.updateRotationVector();\n\n\t\t};\n\n\t\tthis.update = function ( delta ) {\n\n\t\t\tvar moveMult = delta * this.movementSpeed;\n\t\t\tvar rotMult = delta * this.rollSpeed;\n\n\t\t\tthis.object.translateX( this.moveVector.x * moveMult );\n\t\t\tthis.object.translateY( this.moveVector.y * moveMult );\n\t\t\tthis.object.translateZ( this.moveVector.z * moveMult );\n\n\t\t\tthis.tmpQuaternion.set( this.rotationVector.x * rotMult, this.rotationVector.y * rotMult, this.rotationVector.z * rotMult, 1 ).normalize();\n\t\t\tthis.object.quaternion.multiply( this.tmpQuaternion );\n\n\t\t\t// expose the rotation vector for convenience\n\t\t\tthis.object.rotation.setFromQuaternion( this.object.quaternion, this.object.rotation.order );\n\n\n\t\t};\n\n\t\tthis.updateMovementVector = function () {\n\n\t\t\tvar forward = ( this.moveState.forward || ( this.autoForward && ! this.moveState.back ) ) ? 1 : 0;\n\n\t\t\tthis.moveVector.x = ( - this.moveState.left + this.moveState.right );\n\t\t\tthis.moveVector.y = ( - this.moveState.down + this.moveState.up );\n\t\t\tthis.moveVector.z = ( - forward + this.moveState.back );\n\n\t\t\t//console.log( 'move:', [ this.moveVector.x, this.moveVector.y, this.moveVector.z ] );\n\n\t\t};\n\n\t\tthis.updateRotationVector = function () {\n\n\t\t\tthis.rotationVector.x = ( - this.moveState.pitchDown + this.moveState.pitchUp );\n\t\t\tthis.rotationVector.y = ( - this.moveState.yawRight + this.moveState.yawLeft );\n\t\t\tthis.rotationVector.z = ( - this.moveState.rollRight + this.moveState.rollLeft );\n\n\t\t\t//console.log( 'rotate:', [ this.rotationVector.x, this.rotationVector.y, this.rotationVector.z ] );\n\n\t\t};\n\n\t\tthis.getContainerDimensions = function () {\n\n\t\t\tif ( this.domElement != document ) {\n\n\t\t\t\treturn {\n\t\t\t\t\tsize: [ this.domElement.offsetWidth, this.domElement.offsetHeight ],\n\t\t\t\t\toffset: [ this.domElement.offsetLeft, this.domElement.offsetTop ]\n\t\t\t\t};\n\n\t\t\t} else {\n\n\t\t\t\treturn {\n\t\t\t\t\tsize: [ window.innerWidth, window.innerHeight ],\n\t\t\t\t\toffset: [ 0, 0 ]\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t};\n\n\t\tfunction bind( scope, fn ) {\n\n\t\t\treturn function () {\n\n\t\t\t\tfn.apply( scope, arguments );\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction contextmenu( event ) {\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tthis.dispose = function () {\n\n\t\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\t\tthis.domElement.removeEventListener( 'mousedown', _mousedown, false );\n\t\t\tthis.domElement.removeEventListener( 'mousemove', _mousemove, false );\n\t\t\tthis.domElement.removeEventListener( 'mouseup', _mouseup, false );\n\n\t\t\twindow.removeEventListener( 'keydown', _keydown, false );\n\t\t\twindow.removeEventListener( 'keyup', _keyup, false );\n\n\t\t};\n\n\t\tvar _mousemove = bind( this, this.mousemove );\n\t\tvar _mousedown = bind( this, this.mousedown );\n\t\tvar _mouseup = bind( this, this.mouseup );\n\t\tvar _keydown = bind( this, this.keydown );\n\t\tvar _keyup = bind( this, this.keyup );\n\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\n\t\tthis.domElement.addEventListener( 'mousemove', _mousemove, false );\n\t\tthis.domElement.addEventListener( 'mousedown', _mousedown, false );\n\t\tthis.domElement.addEventListener( 'mouseup', _mouseup, false );\n\n\t\twindow.addEventListener( 'keydown', _keydown, false );\n\t\twindow.addEventListener( 'keyup', _keyup, false );\n\n\t\tthis.updateMovementVector();\n\t\tthis.updateRotationVector();\n\n\t};\n\n\treturn THREE.FlyControls;\n});\n"]}