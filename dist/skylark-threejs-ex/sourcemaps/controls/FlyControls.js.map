{"version":3,"sources":["controls/FlyControls.js"],"names":["define","THREE","threex","controls","FlyControls","object","domElement","bind","scope","fn","apply","arguments","contextmenu","event","preventDefault","undefined","console","warn","document","this","setAttribute","movementSpeed","rollSpeed","dragToLook","autoForward","tmpQuaternion","Quaternion","mouseStatus","moveState","up","down","left","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","Vector3","rotationVector","keydown","altKey","keyCode","movementSpeedMultiplier","updateMovementVector","updateRotationVector","keyup","mousedown","focus","stopPropagation","button","mousemove","container","getContainerDimensions","halfWidth","size","halfHeight","pageX","offset","pageY","mouseup","update","delta","moveMult","rotMult","translateX","x","translateY","y","translateZ","z","set","normalize","quaternion","multiply","rotation","setFromQuaternion","order","offsetWidth","offsetHeight","offsetLeft","offsetTop","window","innerWidth","innerHeight","dispose","removeEventListener","_mousedown","_mousemove","_mouseup","_keydown","_keyup","addEventListener"],"mappings":";;;;;;;AAAAA,QACI,kBACA,aACD,SACCC,EACAC,GAEA,aA0PA,OAAOA,EAAOC,SAASC,YAzPL,SAAUC,EAAQC,GA2NhC,SAASC,EAAKC,EAAOC,GACjB,OAAO,WACHA,EAAGC,MAAMF,EAAOG,YAGxB,SAASC,EAAYC,GACjBA,EAAMC,sBAhOSC,IAAfT,IACAU,QAAQC,KAAK,0EACbX,EAAaY,UAEjBC,KAAKd,OAASA,EACdc,KAAKb,WAAaA,EACdA,GACAa,KAAKb,WAAWc,aAAa,YAAa,GAC9CD,KAAKE,cAAgB,EACrBF,KAAKG,UAAY,KACjBH,KAAKI,YAAa,EAClBJ,KAAKK,aAAc,EACnBL,KAAKM,cAAgB,IAAIxB,EAAMyB,WAC/BP,KAAKQ,YAAc,EACnBR,KAAKS,WACDC,GAAI,EACJC,KAAM,EACNC,KAAM,EACNC,MAAO,EACPC,QAAS,EACTC,KAAM,EACNC,QAAS,EACTC,UAAW,EACXC,QAAS,EACTC,SAAU,EACVC,SAAU,EACVC,UAAW,GAEfrB,KAAKsB,WAAa,IAAIxC,EAAMyC,QAAQ,EAAG,EAAG,GAC1CvB,KAAKwB,eAAiB,IAAI1C,EAAMyC,QAAQ,EAAG,EAAG,GAC9CvB,KAAKyB,QAAU,SAAU/B,GACrB,IAAIA,EAAMgC,OAAV,CAGA,OAAQhC,EAAMiC,SACd,KAAK,GACD3B,KAAK4B,wBAA0B,GAC/B,MACJ,KAAK,GACD5B,KAAKS,UAAUK,QAAU,EACzB,MACJ,KAAK,GACDd,KAAKS,UAAUM,KAAO,EACtB,MACJ,KAAK,GACDf,KAAKS,UAAUG,KAAO,EACtB,MACJ,KAAK,GACDZ,KAAKS,UAAUI,MAAQ,EACvB,MACJ,KAAK,GACDb,KAAKS,UAAUC,GAAK,EACpB,MACJ,KAAK,GACDV,KAAKS,UAAUE,KAAO,EACtB,MACJ,KAAK,GACDX,KAAKS,UAAUO,QAAU,EACzB,MACJ,KAAK,GACDhB,KAAKS,UAAUQ,UAAY,EAC3B,MACJ,KAAK,GACDjB,KAAKS,UAAUS,QAAU,EACzB,MACJ,KAAK,GACDlB,KAAKS,UAAUU,SAAW,EAC1B,MACJ,KAAK,GACDnB,KAAKS,UAAUW,SAAW,EAC1B,MACJ,KAAK,GACDpB,KAAKS,UAAUY,UAAY,EAG/BrB,KAAK6B,uBACL7B,KAAK8B,yBAET9B,KAAK+B,MAAQ,SAAUrC,GACnB,OAAQA,EAAMiC,SACd,KAAK,GACD3B,KAAK4B,wBAA0B,EAC/B,MACJ,KAAK,GACD5B,KAAKS,UAAUK,QAAU,EACzB,MACJ,KAAK,GACDd,KAAKS,UAAUM,KAAO,EACtB,MACJ,KAAK,GACDf,KAAKS,UAAUG,KAAO,EACtB,MACJ,KAAK,GACDZ,KAAKS,UAAUI,MAAQ,EACvB,MACJ,KAAK,GACDb,KAAKS,UAAUC,GAAK,EACpB,MACJ,KAAK,GACDV,KAAKS,UAAUE,KAAO,EACtB,MACJ,KAAK,GACDX,KAAKS,UAAUO,QAAU,EACzB,MACJ,KAAK,GACDhB,KAAKS,UAAUQ,UAAY,EAC3B,MACJ,KAAK,GACDjB,KAAKS,UAAUS,QAAU,EACzB,MACJ,KAAK,GACDlB,KAAKS,UAAUU,SAAW,EAC1B,MACJ,KAAK,GACDnB,KAAKS,UAAUW,SAAW,EAC1B,MACJ,KAAK,GACDpB,KAAKS,UAAUY,UAAY,EAG/BrB,KAAK6B,uBACL7B,KAAK8B,wBAET9B,KAAKgC,UAAY,SAAUtC,GAMvB,GALIM,KAAKb,aAAeY,UACpBC,KAAKb,WAAW8C,QAEpBvC,EAAMC,iBACND,EAAMwC,kBACFlC,KAAKI,WACLJ,KAAKQ,kBACF,CACH,OAAQd,EAAMyC,QACd,KAAK,EACDnC,KAAKS,UAAUK,QAAU,EACzB,MACJ,KAAK,EACDd,KAAKS,UAAUM,KAAO,EAG1Bf,KAAK6B,yBAGb7B,KAAKoC,UAAY,SAAU1C,GACvB,IAAKM,KAAKI,YAAcJ,KAAKQ,YAAc,EAAG,CAC1C,IAAI6B,EAAYrC,KAAKsC,yBACjBC,EAAYF,EAAUG,KAAK,GAAK,EAChCC,EAAaJ,EAAUG,KAAK,GAAK,EACrCxC,KAAKS,UAAUS,UAAYxB,EAAMgD,MAAQL,EAAUM,OAAO,GAAKJ,GAAaA,EAC5EvC,KAAKS,UAAUQ,WAAavB,EAAMkD,MAAQP,EAAUM,OAAO,GAAKF,GAAcA,EAC9EzC,KAAK8B,yBAGb9B,KAAK6C,QAAU,SAAUnD,GAGrB,GAFAA,EAAMC,iBACND,EAAMwC,kBACFlC,KAAKI,WACLJ,KAAKQ,cACLR,KAAKS,UAAUS,QAAUlB,KAAKS,UAAUQ,UAAY,MACjD,CACH,OAAQvB,EAAMyC,QACd,KAAK,EACDnC,KAAKS,UAAUK,QAAU,EACzB,MACJ,KAAK,EACDd,KAAKS,UAAUM,KAAO,EAG1Bf,KAAK6B,uBAET7B,KAAK8B,wBAET9B,KAAK8C,OAAS,SAAUC,GACpB,IAAIC,EAAWD,EAAQ/C,KAAKE,cACxB+C,EAAUF,EAAQ/C,KAAKG,UAC3BH,KAAKd,OAAOgE,WAAWlD,KAAKsB,WAAW6B,EAAIH,GAC3ChD,KAAKd,OAAOkE,WAAWpD,KAAKsB,WAAW+B,EAAIL,GAC3ChD,KAAKd,OAAOoE,WAAWtD,KAAKsB,WAAWiC,EAAIP,GAC3ChD,KAAKM,cAAckD,IAAIxD,KAAKwB,eAAe2B,EAAIF,EAASjD,KAAKwB,eAAe6B,EAAIJ,EAASjD,KAAKwB,eAAe+B,EAAIN,EAAS,GAAGQ,YAC7HzD,KAAKd,OAAOwE,WAAWC,SAAS3D,KAAKM,eACrCN,KAAKd,OAAO0E,SAASC,kBAAkB7D,KAAKd,OAAOwE,WAAY1D,KAAKd,OAAO0E,SAASE,QAExF9D,KAAK6B,qBAAuB,WACxB,IAAIf,EAAUd,KAAKS,UAAUK,SAAWd,KAAKK,cAAgBL,KAAKS,UAAUM,KAAO,EAAI,EACvFf,KAAKsB,WAAW6B,GAAKnD,KAAKS,UAAUG,KAAOZ,KAAKS,UAAUI,MAC1Db,KAAKsB,WAAW+B,GAAKrD,KAAKS,UAAUE,KAAOX,KAAKS,UAAUC,GAC1DV,KAAKsB,WAAWiC,GAAKzC,EAAUd,KAAKS,UAAUM,MAElDf,KAAK8B,qBAAuB,WACxB9B,KAAKwB,eAAe2B,GAAKnD,KAAKS,UAAUQ,UAAYjB,KAAKS,UAAUO,QACnEhB,KAAKwB,eAAe6B,GAAKrD,KAAKS,UAAUU,SAAWnB,KAAKS,UAAUS,QAClElB,KAAKwB,eAAe+B,GAAKvD,KAAKS,UAAUY,UAAYrB,KAAKS,UAAUW,UAEvEpB,KAAKsC,uBAAyB,WAC1B,OAAItC,KAAKb,YAAcY,UAEfyC,MACIxC,KAAKb,WAAW4E,YAChB/D,KAAKb,WAAW6E,cAEpBrB,QACI3C,KAAKb,WAAW8E,WAChBjE,KAAKb,WAAW+E,aAKpB1B,MACI2B,OAAOC,WACPD,OAAOE,aAEX1B,QACI,EACA,KAahB3C,KAAKsE,QAAU,WACXtE,KAAKb,WAAWoF,oBAAoB,cAAe9E,GAAa,GAChEO,KAAKb,WAAWoF,oBAAoB,YAAaC,GAAY,GAC7DxE,KAAKb,WAAWoF,oBAAoB,YAAaE,GAAY,GAC7DzE,KAAKb,WAAWoF,oBAAoB,UAAWG,GAAU,GACzDP,OAAOI,oBAAoB,UAAWI,GAAU,GAChDR,OAAOI,oBAAoB,QAASK,GAAQ,IAEhD,IAAIH,EAAarF,EAAKY,KAAMA,KAAKoC,WAC7BoC,EAAapF,EAAKY,KAAMA,KAAKgC,WAC7B0C,EAAWtF,EAAKY,KAAMA,KAAK6C,SAC3B8B,EAAWvF,EAAKY,KAAMA,KAAKyB,SAC3BmD,EAASxF,EAAKY,KAAMA,KAAK+B,OAC7B/B,KAAKb,WAAW0F,iBAAiB,cAAepF,GAAa,GAC7DO,KAAKb,WAAW0F,iBAAiB,YAAaJ,GAAY,GAC1DzE,KAAKb,WAAW0F,iBAAiB,YAAaL,GAAY,GAC1DxE,KAAKb,WAAW0F,iBAAiB,UAAWH,GAAU,GACtDP,OAAOU,iBAAiB,UAAWF,GAAU,GAC7CR,OAAOU,iBAAiB,QAASD,GAAQ,GACzC5E,KAAK6B,uBACL7B,KAAK8B","file":"../../controls/FlyControls.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var FlyControls = function (object, domElement) {\r\n        if (domElement === undefined) {\r\n            console.warn('THREE.FlyControls: The second parameter \"domElement\" is now mandatory.');\r\n            domElement = document;\r\n        }\r\n        this.object = object;\r\n        this.domElement = domElement;\r\n        if (domElement)\r\n            this.domElement.setAttribute('tabindex', -1);\r\n        this.movementSpeed = 1;\r\n        this.rollSpeed = 0.005;\r\n        this.dragToLook = false;\r\n        this.autoForward = false;\r\n        this.tmpQuaternion = new THREE.Quaternion();\r\n        this.mouseStatus = 0;\r\n        this.moveState = {\r\n            up: 0,\r\n            down: 0,\r\n            left: 0,\r\n            right: 0,\r\n            forward: 0,\r\n            back: 0,\r\n            pitchUp: 0,\r\n            pitchDown: 0,\r\n            yawLeft: 0,\r\n            yawRight: 0,\r\n            rollLeft: 0,\r\n            rollRight: 0\r\n        };\r\n        this.moveVector = new THREE.Vector3(0, 0, 0);\r\n        this.rotationVector = new THREE.Vector3(0, 0, 0);\r\n        this.keydown = function (event) {\r\n            if (event.altKey) {\r\n                return;\r\n            }\r\n            switch (event.keyCode) {\r\n            case 16:\r\n                this.movementSpeedMultiplier = 0.1;\r\n                break;\r\n            case 87:\r\n                this.moveState.forward = 1;\r\n                break;\r\n            case 83:\r\n                this.moveState.back = 1;\r\n                break;\r\n            case 65:\r\n                this.moveState.left = 1;\r\n                break;\r\n            case 68:\r\n                this.moveState.right = 1;\r\n                break;\r\n            case 82:\r\n                this.moveState.up = 1;\r\n                break;\r\n            case 70:\r\n                this.moveState.down = 1;\r\n                break;\r\n            case 38:\r\n                this.moveState.pitchUp = 1;\r\n                break;\r\n            case 40:\r\n                this.moveState.pitchDown = 1;\r\n                break;\r\n            case 37:\r\n                this.moveState.yawLeft = 1;\r\n                break;\r\n            case 39:\r\n                this.moveState.yawRight = 1;\r\n                break;\r\n            case 81:\r\n                this.moveState.rollLeft = 1;\r\n                break;\r\n            case 69:\r\n                this.moveState.rollRight = 1;\r\n                break;\r\n            }\r\n            this.updateMovementVector();\r\n            this.updateRotationVector();\r\n        };\r\n        this.keyup = function (event) {\r\n            switch (event.keyCode) {\r\n            case 16:\r\n                this.movementSpeedMultiplier = 1;\r\n                break;\r\n            case 87:\r\n                this.moveState.forward = 0;\r\n                break;\r\n            case 83:\r\n                this.moveState.back = 0;\r\n                break;\r\n            case 65:\r\n                this.moveState.left = 0;\r\n                break;\r\n            case 68:\r\n                this.moveState.right = 0;\r\n                break;\r\n            case 82:\r\n                this.moveState.up = 0;\r\n                break;\r\n            case 70:\r\n                this.moveState.down = 0;\r\n                break;\r\n            case 38:\r\n                this.moveState.pitchUp = 0;\r\n                break;\r\n            case 40:\r\n                this.moveState.pitchDown = 0;\r\n                break;\r\n            case 37:\r\n                this.moveState.yawLeft = 0;\r\n                break;\r\n            case 39:\r\n                this.moveState.yawRight = 0;\r\n                break;\r\n            case 81:\r\n                this.moveState.rollLeft = 0;\r\n                break;\r\n            case 69:\r\n                this.moveState.rollRight = 0;\r\n                break;\r\n            }\r\n            this.updateMovementVector();\r\n            this.updateRotationVector();\r\n        };\r\n        this.mousedown = function (event) {\r\n            if (this.domElement !== document) {\r\n                this.domElement.focus();\r\n            }\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            if (this.dragToLook) {\r\n                this.mouseStatus++;\r\n            } else {\r\n                switch (event.button) {\r\n                case 0:\r\n                    this.moveState.forward = 1;\r\n                    break;\r\n                case 2:\r\n                    this.moveState.back = 1;\r\n                    break;\r\n                }\r\n                this.updateMovementVector();\r\n            }\r\n        };\r\n        this.mousemove = function (event) {\r\n            if (!this.dragToLook || this.mouseStatus > 0) {\r\n                var container = this.getContainerDimensions();\r\n                var halfWidth = container.size[0] / 2;\r\n                var halfHeight = container.size[1] / 2;\r\n                this.moveState.yawLeft = -(event.pageX - container.offset[0] - halfWidth) / halfWidth;\r\n                this.moveState.pitchDown = (event.pageY - container.offset[1] - halfHeight) / halfHeight;\r\n                this.updateRotationVector();\r\n            }\r\n        };\r\n        this.mouseup = function (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            if (this.dragToLook) {\r\n                this.mouseStatus--;\r\n                this.moveState.yawLeft = this.moveState.pitchDown = 0;\r\n            } else {\r\n                switch (event.button) {\r\n                case 0:\r\n                    this.moveState.forward = 0;\r\n                    break;\r\n                case 2:\r\n                    this.moveState.back = 0;\r\n                    break;\r\n                }\r\n                this.updateMovementVector();\r\n            }\r\n            this.updateRotationVector();\r\n        };\r\n        this.update = function (delta) {\r\n            var moveMult = delta * this.movementSpeed;\r\n            var rotMult = delta * this.rollSpeed;\r\n            this.object.translateX(this.moveVector.x * moveMult);\r\n            this.object.translateY(this.moveVector.y * moveMult);\r\n            this.object.translateZ(this.moveVector.z * moveMult);\r\n            this.tmpQuaternion.set(this.rotationVector.x * rotMult, this.rotationVector.y * rotMult, this.rotationVector.z * rotMult, 1).normalize();\r\n            this.object.quaternion.multiply(this.tmpQuaternion);\r\n            this.object.rotation.setFromQuaternion(this.object.quaternion, this.object.rotation.order);\r\n        };\r\n        this.updateMovementVector = function () {\r\n            var forward = this.moveState.forward || this.autoForward && !this.moveState.back ? 1 : 0;\r\n            this.moveVector.x = -this.moveState.left + this.moveState.right;\r\n            this.moveVector.y = -this.moveState.down + this.moveState.up;\r\n            this.moveVector.z = -forward + this.moveState.back;\r\n        };\r\n        this.updateRotationVector = function () {\r\n            this.rotationVector.x = -this.moveState.pitchDown + this.moveState.pitchUp;\r\n            this.rotationVector.y = -this.moveState.yawRight + this.moveState.yawLeft;\r\n            this.rotationVector.z = -this.moveState.rollRight + this.moveState.rollLeft;\r\n        };\r\n        this.getContainerDimensions = function () {\r\n            if (this.domElement != document) {\r\n                return {\r\n                    size: [\r\n                        this.domElement.offsetWidth,\r\n                        this.domElement.offsetHeight\r\n                    ],\r\n                    offset: [\r\n                        this.domElement.offsetLeft,\r\n                        this.domElement.offsetTop\r\n                    ]\r\n                };\r\n            } else {\r\n                return {\r\n                    size: [\r\n                        window.innerWidth,\r\n                        window.innerHeight\r\n                    ],\r\n                    offset: [\r\n                        0,\r\n                        0\r\n                    ]\r\n                };\r\n            }\r\n        };\r\n        function bind(scope, fn) {\r\n            return function () {\r\n                fn.apply(scope, arguments);\r\n            };\r\n        }\r\n        function contextmenu(event) {\r\n            event.preventDefault();\r\n        }\r\n        this.dispose = function () {\r\n            this.domElement.removeEventListener('contextmenu', contextmenu, false);\r\n            this.domElement.removeEventListener('mousedown', _mousedown, false);\r\n            this.domElement.removeEventListener('mousemove', _mousemove, false);\r\n            this.domElement.removeEventListener('mouseup', _mouseup, false);\r\n            window.removeEventListener('keydown', _keydown, false);\r\n            window.removeEventListener('keyup', _keyup, false);\r\n        };\r\n        var _mousemove = bind(this, this.mousemove);\r\n        var _mousedown = bind(this, this.mousedown);\r\n        var _mouseup = bind(this, this.mouseup);\r\n        var _keydown = bind(this, this.keydown);\r\n        var _keyup = bind(this, this.keyup);\r\n        this.domElement.addEventListener('contextmenu', contextmenu, false);\r\n        this.domElement.addEventListener('mousemove', _mousemove, false);\r\n        this.domElement.addEventListener('mousedown', _mousedown, false);\r\n        this.domElement.addEventListener('mouseup', _mouseup, false);\r\n        window.addEventListener('keydown', _keydown, false);\r\n        window.addEventListener('keyup', _keyup, false);\r\n        this.updateMovementVector();\r\n        this.updateRotationVector();\r\n    };\r\n    return threex.controls.FlyControls = FlyControls;\r\n});"]}