{"version":3,"sources":["controls/FlyControls.js"],"names":["define","THREE","object","domElement","bind","scope","fn","apply","arguments","contextmenu","event","preventDefault","undefined","console","warn","document","this","setAttribute","movementSpeed","rollSpeed","dragToLook","autoForward","tmpQuaternion","Quaternion","mouseStatus","moveState","up","down","left","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","Vector3","rotationVector","keydown","altKey","keyCode","movementSpeedMultiplier","updateMovementVector","updateRotationVector","keyup","mousedown","focus","stopPropagation","button","mousemove","container","getContainerDimensions","halfWidth","size","halfHeight","pageX","offset","pageY","mouseup","update","delta","moveMult","rotMult","translateX","x","translateY","y","translateZ","z","set","normalize","quaternion","multiply","rotation","setFromQuaternion","order","offsetWidth","offsetHeight","offsetLeft","offsetTop","window","innerWidth","innerHeight","dispose","removeEventListener","_mousedown","_mousemove","_mouseup","_keydown","_keyup","addEventListener"],"mappings":"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","file":"../../controls/FlyControls.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    var FlyControls = function (object, domElement) {\n        if (domElement === undefined) {\n            console.warn('THREE.FlyControls: The second parameter \"domElement\" is now mandatory.');\n            domElement = document;\n        }\n        this.object = object;\n        this.domElement = domElement;\n        if (domElement)\n            this.domElement.setAttribute('tabindex', -1);\n        this.movementSpeed = 1;\n        this.rollSpeed = 0.005;\n        this.dragToLook = false;\n        this.autoForward = false;\n        this.tmpQuaternion = new THREE.Quaternion();\n        this.mouseStatus = 0;\n        this.moveState = {\n            up: 0,\n            down: 0,\n            left: 0,\n            right: 0,\n            forward: 0,\n            back: 0,\n            pitchUp: 0,\n            pitchDown: 0,\n            yawLeft: 0,\n            yawRight: 0,\n            rollLeft: 0,\n            rollRight: 0\n        };\n        this.moveVector = new THREE.Vector3(0, 0, 0);\n        this.rotationVector = new THREE.Vector3(0, 0, 0);\n        this.keydown = function (event) {\n            if (event.altKey) {\n                return;\n            }\n            switch (event.keyCode) {\n            case 16:\n                this.movementSpeedMultiplier = 0.1;\n                break;\n            case 87:\n                this.moveState.forward = 1;\n                break;\n            case 83:\n                this.moveState.back = 1;\n                break;\n            case 65:\n                this.moveState.left = 1;\n                break;\n            case 68:\n                this.moveState.right = 1;\n                break;\n            case 82:\n                this.moveState.up = 1;\n                break;\n            case 70:\n                this.moveState.down = 1;\n                break;\n            case 38:\n                this.moveState.pitchUp = 1;\n                break;\n            case 40:\n                this.moveState.pitchDown = 1;\n                break;\n            case 37:\n                this.moveState.yawLeft = 1;\n                break;\n            case 39:\n                this.moveState.yawRight = 1;\n                break;\n            case 81:\n                this.moveState.rollLeft = 1;\n                break;\n            case 69:\n                this.moveState.rollRight = 1;\n                break;\n            }\n            this.updateMovementVector();\n            this.updateRotationVector();\n        };\n        this.keyup = function (event) {\n            switch (event.keyCode) {\n            case 16:\n                this.movementSpeedMultiplier = 1;\n                break;\n            case 87:\n                this.moveState.forward = 0;\n                break;\n            case 83:\n                this.moveState.back = 0;\n                break;\n            case 65:\n                this.moveState.left = 0;\n                break;\n            case 68:\n                this.moveState.right = 0;\n                break;\n            case 82:\n                this.moveState.up = 0;\n                break;\n            case 70:\n                this.moveState.down = 0;\n                break;\n            case 38:\n                this.moveState.pitchUp = 0;\n                break;\n            case 40:\n                this.moveState.pitchDown = 0;\n                break;\n            case 37:\n                this.moveState.yawLeft = 0;\n                break;\n            case 39:\n                this.moveState.yawRight = 0;\n                break;\n            case 81:\n                this.moveState.rollLeft = 0;\n                break;\n            case 69:\n                this.moveState.rollRight = 0;\n                break;\n            }\n            this.updateMovementVector();\n            this.updateRotationVector();\n        };\n        this.mousedown = function (event) {\n            if (this.domElement !== document) {\n                this.domElement.focus();\n            }\n            event.preventDefault();\n            event.stopPropagation();\n            if (this.dragToLook) {\n                this.mouseStatus++;\n            } else {\n                switch (event.button) {\n                case 0:\n                    this.moveState.forward = 1;\n                    break;\n                case 2:\n                    this.moveState.back = 1;\n                    break;\n                }\n                this.updateMovementVector();\n            }\n        };\n        this.mousemove = function (event) {\n            if (!this.dragToLook || this.mouseStatus > 0) {\n                var container = this.getContainerDimensions();\n                var halfWidth = container.size[0] / 2;\n                var halfHeight = container.size[1] / 2;\n                this.moveState.yawLeft = -(event.pageX - container.offset[0] - halfWidth) / halfWidth;\n                this.moveState.pitchDown = (event.pageY - container.offset[1] - halfHeight) / halfHeight;\n                this.updateRotationVector();\n            }\n        };\n        this.mouseup = function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            if (this.dragToLook) {\n                this.mouseStatus--;\n                this.moveState.yawLeft = this.moveState.pitchDown = 0;\n            } else {\n                switch (event.button) {\n                case 0:\n                    this.moveState.forward = 0;\n                    break;\n                case 2:\n                    this.moveState.back = 0;\n                    break;\n                }\n                this.updateMovementVector();\n            }\n            this.updateRotationVector();\n        };\n        this.update = function (delta) {\n            var moveMult = delta * this.movementSpeed;\n            var rotMult = delta * this.rollSpeed;\n            this.object.translateX(this.moveVector.x * moveMult);\n            this.object.translateY(this.moveVector.y * moveMult);\n            this.object.translateZ(this.moveVector.z * moveMult);\n            this.tmpQuaternion.set(this.rotationVector.x * rotMult, this.rotationVector.y * rotMult, this.rotationVector.z * rotMult, 1).normalize();\n            this.object.quaternion.multiply(this.tmpQuaternion);\n            this.object.rotation.setFromQuaternion(this.object.quaternion, this.object.rotation.order);\n        };\n        this.updateMovementVector = function () {\n            var forward = this.moveState.forward || this.autoForward && !this.moveState.back ? 1 : 0;\n            this.moveVector.x = -this.moveState.left + this.moveState.right;\n            this.moveVector.y = -this.moveState.down + this.moveState.up;\n            this.moveVector.z = -forward + this.moveState.back;\n        };\n        this.updateRotationVector = function () {\n            this.rotationVector.x = -this.moveState.pitchDown + this.moveState.pitchUp;\n            this.rotationVector.y = -this.moveState.yawRight + this.moveState.yawLeft;\n            this.rotationVector.z = -this.moveState.rollRight + this.moveState.rollLeft;\n        };\n        this.getContainerDimensions = function () {\n            if (this.domElement != document) {\n                return {\n                    size: [\n                        this.domElement.offsetWidth,\n                        this.domElement.offsetHeight\n                    ],\n                    offset: [\n                        this.domElement.offsetLeft,\n                        this.domElement.offsetTop\n                    ]\n                };\n            } else {\n                return {\n                    size: [\n                        window.innerWidth,\n                        window.innerHeight\n                    ],\n                    offset: [\n                        0,\n                        0\n                    ]\n                };\n            }\n        };\n        function bind(scope, fn) {\n            return function () {\n                fn.apply(scope, arguments);\n            };\n        }\n        function contextmenu(event) {\n            event.preventDefault();\n        }\n        this.dispose = function () {\n            this.domElement.removeEventListener('contextmenu', contextmenu, false);\n            this.domElement.removeEventListener('mousedown', _mousedown, false);\n            this.domElement.removeEventListener('mousemove', _mousemove, false);\n            this.domElement.removeEventListener('mouseup', _mouseup, false);\n            window.removeEventListener('keydown', _keydown, false);\n            window.removeEventListener('keyup', _keyup, false);\n        };\n        var _mousemove = bind(this, this.mousemove);\n        var _mousedown = bind(this, this.mousedown);\n        var _mouseup = bind(this, this.mouseup);\n        var _keydown = bind(this, this.keydown);\n        var _keyup = bind(this, this.keyup);\n        this.domElement.addEventListener('contextmenu', contextmenu, false);\n        this.domElement.addEventListener('mousemove', _mousemove, false);\n        this.domElement.addEventListener('mousedown', _mousedown, false);\n        this.domElement.addEventListener('mouseup', _mouseup, false);\n        window.addEventListener('keydown', _keydown, false);\n        window.addEventListener('keyup', _keyup, false);\n        this.updateMovementVector();\n        this.updateRotationVector();\n    };\n    return FlyControls;\n});"]}