{"version":3,"sources":["controls/FirstPersonControls.js"],"names":["define","THREE","FirstPersonControls","object","domElement","undefined","console","warn","document","this","enabled","movementSpeed","lookSpeed","lookVertical","autoForward","activeLook","heightSpeed","heightCoef","heightMin","heightMax","constrainVertical","verticalMin","verticalMax","Math","PI","mouseDragOn","autoSpeedFactor","mouseX","mouseY","moveForward","moveBackward","moveLeft","moveRight","viewHalfX","viewHalfY","targetPosition","lat","lon","lookDirection","Vector3","spherical","Spherical","target","contextmenu","event","preventDefault","setAttribute","handleResize","window","innerWidth","innerHeight","offsetWidth","offsetHeight","onMouseDown","focus","stopPropagation","button","onMouseUp","onMouseMove","pageX","pageY","offsetLeft","offsetTop","onKeyDown","keyCode","moveUp","moveDown","onKeyUp","lookAt","x","y","z","isVector3","copy","set","setOrientation","update","delta","heightDelta","MathUtils","clamp","position","actualMoveSpeed","translateZ","translateX","translateY","actualLookSpeed","verticalLookRatio","max","min","phi","degToRad","theta","mapLinear","setFromSphericalCoords","add","dispose","removeEventListener","_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown","_onKeyUp","bind","scope","fn","apply","arguments","controls","quaternion","applyQuaternion","setFromVector3","radToDeg","addEventListener"],"mappings":"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","file":"../../controls/FirstPersonControls.js","sourcesContent":["define([\n\t\"skylark-threejs\"\n],function(THREE){\n\t/**\n\t * @author mrdoob / http://mrdoob.com/\n\t * @author alteredq / http://alteredqualia.com/\n\t * @author paulirish / http://paulirish.com/\n\t */\n\n\tTHREE.FirstPersonControls = function ( object, domElement ) {\n\n\t\tif ( domElement === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.FirstPersonControls: The second parameter \"domElement\" is now mandatory.' );\n\t\t\tdomElement = document;\n\n\t\t}\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\n\t\t// API\n\n\t\tthis.enabled = true;\n\n\t\tthis.movementSpeed = 1.0;\n\t\tthis.lookSpeed = 0.005;\n\n\t\tthis.lookVertical = true;\n\t\tthis.autoForward = false;\n\n\t\tthis.activeLook = true;\n\n\t\tthis.heightSpeed = false;\n\t\tthis.heightCoef = 1.0;\n\t\tthis.heightMin = 0.0;\n\t\tthis.heightMax = 1.0;\n\n\t\tthis.constrainVertical = false;\n\t\tthis.verticalMin = 0;\n\t\tthis.verticalMax = Math.PI;\n\n\t\tthis.mouseDragOn = false;\n\n\t\t// internals\n\n\t\tthis.autoSpeedFactor = 0.0;\n\n\t\tthis.mouseX = 0;\n\t\tthis.mouseY = 0;\n\n\t\tthis.moveForward = false;\n\t\tthis.moveBackward = false;\n\t\tthis.moveLeft = false;\n\t\tthis.moveRight = false;\n\n\t\tthis.viewHalfX = 0;\n\t\tthis.viewHalfY = 0;\n\n\t\t// private variables\n\n\t\tvar lat = 0;\n\t\tvar lon = 0;\n\n\t\tvar lookDirection = new THREE.Vector3();\n\t\tvar spherical = new THREE.Spherical();\n\t\tvar target = new THREE.Vector3();\n\n\t\t//\n\n\t\tif ( this.domElement !== document ) {\n\n\t\t\tthis.domElement.setAttribute( 'tabindex', - 1 );\n\n\t\t}\n\n\t\t//\n\n\t\tthis.handleResize = function () {\n\n\t\t\tif ( this.domElement === document ) {\n\n\t\t\t\tthis.viewHalfX = window.innerWidth / 2;\n\t\t\t\tthis.viewHalfY = window.innerHeight / 2;\n\n\t\t\t} else {\n\n\t\t\t\tthis.viewHalfX = this.domElement.offsetWidth / 2;\n\t\t\t\tthis.viewHalfY = this.domElement.offsetHeight / 2;\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.onMouseDown = function ( event ) {\n\n\t\t\tif ( this.domElement !== document ) {\n\n\t\t\t\tthis.domElement.focus();\n\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tif ( this.activeLook ) {\n\n\t\t\t\tswitch ( event.button ) {\n\n\t\t\t\t\tcase 0: this.moveForward = true; break;\n\t\t\t\t\tcase 2: this.moveBackward = true; break;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.mouseDragOn = true;\n\n\t\t};\n\n\t\tthis.onMouseUp = function ( event ) {\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tif ( this.activeLook ) {\n\n\t\t\t\tswitch ( event.button ) {\n\n\t\t\t\t\tcase 0: this.moveForward = false; break;\n\t\t\t\t\tcase 2: this.moveBackward = false; break;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.mouseDragOn = false;\n\n\t\t};\n\n\t\tthis.onMouseMove = function ( event ) {\n\n\t\t\tif ( this.domElement === document ) {\n\n\t\t\t\tthis.mouseX = event.pageX - this.viewHalfX;\n\t\t\t\tthis.mouseY = event.pageY - this.viewHalfY;\n\n\t\t\t} else {\n\n\t\t\t\tthis.mouseX = event.pageX - this.domElement.offsetLeft - this.viewHalfX;\n\t\t\t\tthis.mouseY = event.pageY - this.domElement.offsetTop - this.viewHalfY;\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.onKeyDown = function ( event ) {\n\n\t\t\t//event.preventDefault();\n\n\t\t\tswitch ( event.keyCode ) {\n\n\t\t\t\tcase 38: /*up*/\n\t\t\t\tcase 87: /*W*/ this.moveForward = true; break;\n\n\t\t\t\tcase 37: /*left*/\n\t\t\t\tcase 65: /*A*/ this.moveLeft = true; break;\n\n\t\t\t\tcase 40: /*down*/\n\t\t\t\tcase 83: /*S*/ this.moveBackward = true; break;\n\n\t\t\t\tcase 39: /*right*/\n\t\t\t\tcase 68: /*D*/ this.moveRight = true; break;\n\n\t\t\t\tcase 82: /*R*/ this.moveUp = true; break;\n\t\t\t\tcase 70: /*F*/ this.moveDown = true; break;\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.onKeyUp = function ( event ) {\n\n\t\t\tswitch ( event.keyCode ) {\n\n\t\t\t\tcase 38: /*up*/\n\t\t\t\tcase 87: /*W*/ this.moveForward = false; break;\n\n\t\t\t\tcase 37: /*left*/\n\t\t\t\tcase 65: /*A*/ this.moveLeft = false; break;\n\n\t\t\t\tcase 40: /*down*/\n\t\t\t\tcase 83: /*S*/ this.moveBackward = false; break;\n\n\t\t\t\tcase 39: /*right*/\n\t\t\t\tcase 68: /*D*/ this.moveRight = false; break;\n\n\t\t\t\tcase 82: /*R*/ this.moveUp = false; break;\n\t\t\t\tcase 70: /*F*/ this.moveDown = false; break;\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.lookAt = function ( x, y, z ) {\n\n\t\t\tif ( x.isVector3 ) {\n\n\t\t\t\ttarget.copy( x );\n\n\t\t\t} else {\n\n\t\t\t\ttarget.set( x, y, z );\n\n\t\t\t}\n\n\t\t\tthis.object.lookAt( target );\n\n\t\t\tsetOrientation( this );\n\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.update = function () {\n\n\t\t\tvar targetPosition = new THREE.Vector3();\n\n\t\t\treturn function update( delta ) {\n\n\t\t\t\tif ( this.enabled === false ) return;\n\n\t\t\t\tif ( this.heightSpeed ) {\n\n\t\t\t\t\tvar y = THREE.MathUtils.clamp( this.object.position.y, this.heightMin, this.heightMax );\n\t\t\t\t\tvar heightDelta = y - this.heightMin;\n\n\t\t\t\t\tthis.autoSpeedFactor = delta * ( heightDelta * this.heightCoef );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis.autoSpeedFactor = 0.0;\n\n\t\t\t\t}\n\n\t\t\t\tvar actualMoveSpeed = delta * this.movementSpeed;\n\n\t\t\t\tif ( this.moveForward || ( this.autoForward && ! this.moveBackward ) ) this.object.translateZ( - ( actualMoveSpeed + this.autoSpeedFactor ) );\n\t\t\t\tif ( this.moveBackward ) this.object.translateZ( actualMoveSpeed );\n\n\t\t\t\tif ( this.moveLeft ) this.object.translateX( - actualMoveSpeed );\n\t\t\t\tif ( this.moveRight ) this.object.translateX( actualMoveSpeed );\n\n\t\t\t\tif ( this.moveUp ) this.object.translateY( actualMoveSpeed );\n\t\t\t\tif ( this.moveDown ) this.object.translateY( - actualMoveSpeed );\n\n\t\t\t\tvar actualLookSpeed = delta * this.lookSpeed;\n\n\t\t\t\tif ( ! this.activeLook ) {\n\n\t\t\t\t\tactualLookSpeed = 0;\n\n\t\t\t\t}\n\n\t\t\t\tvar verticalLookRatio = 1;\n\n\t\t\t\tif ( this.constrainVertical ) {\n\n\t\t\t\t\tverticalLookRatio = Math.PI / ( this.verticalMax - this.verticalMin );\n\n\t\t\t\t}\n\n\t\t\t\tlon -= this.mouseX * actualLookSpeed;\n\t\t\t\tif ( this.lookVertical ) lat -= this.mouseY * actualLookSpeed * verticalLookRatio;\n\n\t\t\t\tlat = Math.max( - 85, Math.min( 85, lat ) );\n\n\t\t\t\tvar phi = THREE.MathUtils.degToRad( 90 - lat );\n\t\t\t\tvar theta = THREE.MathUtils.degToRad( lon );\n\n\t\t\t\tif ( this.constrainVertical ) {\n\n\t\t\t\t\tphi = THREE.MathUtils.mapLinear( phi, 0, Math.PI, this.verticalMin, this.verticalMax );\n\n\t\t\t\t}\n\n\t\t\t\tvar position = this.object.position;\n\n\t\t\t\ttargetPosition.setFromSphericalCoords( 1, phi, theta ).add( position );\n\n\t\t\t\tthis.object.lookAt( targetPosition );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction contextmenu( event ) {\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tthis.dispose = function () {\n\n\t\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\t\tthis.domElement.removeEventListener( 'mousedown', _onMouseDown, false );\n\t\t\tthis.domElement.removeEventListener( 'mousemove', _onMouseMove, false );\n\t\t\tthis.domElement.removeEventListener( 'mouseup', _onMouseUp, false );\n\n\t\t\twindow.removeEventListener( 'keydown', _onKeyDown, false );\n\t\t\twindow.removeEventListener( 'keyup', _onKeyUp, false );\n\n\t\t};\n\n\t\tvar _onMouseMove = bind( this, this.onMouseMove );\n\t\tvar _onMouseDown = bind( this, this.onMouseDown );\n\t\tvar _onMouseUp = bind( this, this.onMouseUp );\n\t\tvar _onKeyDown = bind( this, this.onKeyDown );\n\t\tvar _onKeyUp = bind( this, this.onKeyUp );\n\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.addEventListener( 'mousemove', _onMouseMove, false );\n\t\tthis.domElement.addEventListener( 'mousedown', _onMouseDown, false );\n\t\tthis.domElement.addEventListener( 'mouseup', _onMouseUp, false );\n\n\t\twindow.addEventListener( 'keydown', _onKeyDown, false );\n\t\twindow.addEventListener( 'keyup', _onKeyUp, false );\n\n\t\tfunction bind( scope, fn ) {\n\n\t\t\treturn function () {\n\n\t\t\t\tfn.apply( scope, arguments );\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction setOrientation( controls ) {\n\n\t\t\tvar quaternion = controls.object.quaternion;\n\n\t\t\tlookDirection.set( 0, 0, - 1 ).applyQuaternion( quaternion );\n\t\t\tspherical.setFromVector3( lookDirection );\n\n\t\t\tlat = 90 - THREE.MathUtils.radToDeg( spherical.phi );\n\t\t\tlon = THREE.MathUtils.radToDeg( spherical.theta );\n\n\t\t}\n\n\t\tthis.handleResize();\n\n\t\tsetOrientation( this );\n\n\t};\n\n\treturn THREE.FirstPersonControls;\n});\n"]}