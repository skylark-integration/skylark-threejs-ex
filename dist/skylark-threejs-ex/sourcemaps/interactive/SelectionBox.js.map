{"version":3,"sources":["interactive/SelectionBox.js"],"names":["define","THREE","threex","SelectionBox","frustum","Frustum","center","Vector3","tmpPoint","vecNear","vecTopLeft","vecTopRight","vecDownRight","vecDownLeft","vecFarTopLeft","vecFarTopRight","vecFarDownRight","vecFarDownLeft","vectemp1","vectemp2","vectemp3","camera","scene","deep","this","startPoint","endPoint","collection","Number","MAX_VALUE","prototype","select","updateFrustum","searchChildInFrustum","updateProjectionMatrix","updateMatrixWorld","isPerspectiveCamera","copy","x","Math","min","y","max","position","set","unproject","sub","normalize","multiplyScalar","add","planes","setFromCoplanarPoints","normal","isOrthographicCamera","equals","addScalar","EPSILON","left","top","right","down","console","error","object","isMesh","isLine","isPoints","undefined","material","geometry","boundingSphere","computeBoundingSphere","applyMatrix4","matrixWorld","containsPoint","push","children","length","interactive"],"mappings":"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","file":"../../interactive/SelectionBox.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    \"../threex\"\n], function (\n    THREE,\n    threex\n) {\n    'use strict';\n    var SelectionBox = function () {\n        var frustum = new THREE.Frustum();\n        var center = new THREE.Vector3();\n        var tmpPoint = new THREE.Vector3();\n        var vecNear = new THREE.Vector3();\n        var vecTopLeft = new THREE.Vector3();\n        var vecTopRight = new THREE.Vector3();\n        var vecDownRight = new THREE.Vector3();\n        var vecDownLeft = new THREE.Vector3();\n        var vecFarTopLeft = new THREE.Vector3();\n        var vecFarTopRight = new THREE.Vector3();\n        var vecFarDownRight = new THREE.Vector3();\n        var vecFarDownLeft = new THREE.Vector3();\n        var vectemp1 = new THREE.Vector3();\n        var vectemp2 = new THREE.Vector3();\n        var vectemp3 = new THREE.Vector3();\n        function SelectionBox(camera, scene, deep) {\n            this.camera = camera;\n            this.scene = scene;\n            this.startPoint = new THREE.Vector3();\n            this.endPoint = new THREE.Vector3();\n            this.collection = [];\n            this.deep = deep || Number.MAX_VALUE;\n        }\n        SelectionBox.prototype.select = function (startPoint, endPoint) {\n            this.startPoint = startPoint || this.startPoint;\n            this.endPoint = endPoint || this.endPoint;\n            this.collection = [];\n            this.updateFrustum(this.startPoint, this.endPoint);\n            this.searchChildInFrustum(frustum, this.scene);\n            return this.collection;\n        };\n        SelectionBox.prototype.updateFrustum = function (startPoint, endPoint) {\n            startPoint = startPoint || this.startPoint;\n            endPoint = endPoint || this.endPoint;\n            this.camera.updateProjectionMatrix();\n            this.camera.updateMatrixWorld();\n            if (this.camera.isPerspectiveCamera) {\n                tmpPoint.copy(startPoint);\n                tmpPoint.x = Math.min(startPoint.x, endPoint.x);\n                tmpPoint.y = Math.max(startPoint.y, endPoint.y);\n                endPoint.x = Math.max(startPoint.x, endPoint.x);\n                endPoint.y = Math.min(startPoint.y, endPoint.y);\n                vecNear.copy(this.camera.position);\n                vecTopLeft.copy(tmpPoint);\n                vecTopRight.set(endPoint.x, tmpPoint.y, 0);\n                vecDownRight.copy(endPoint);\n                vecDownLeft.set(tmpPoint.x, endPoint.y, 0);\n                vecTopLeft.unproject(this.camera);\n                vecTopRight.unproject(this.camera);\n                vecDownRight.unproject(this.camera);\n                vecDownLeft.unproject(this.camera);\n                vectemp1.copy(vecTopLeft).sub(vecNear);\n                vectemp2.copy(vecTopRight).sub(vecNear);\n                vectemp3.copy(vecDownRight).sub(vecNear);\n                vectemp1.normalize();\n                vectemp2.normalize();\n                vectemp3.normalize();\n                vectemp1.multiplyScalar(this.deep);\n                vectemp2.multiplyScalar(this.deep);\n                vectemp3.multiplyScalar(this.deep);\n                vectemp1.add(vecNear);\n                vectemp2.add(vecNear);\n                vectemp3.add(vecNear);\n                var planes = frustum.planes;\n                planes[0].setFromCoplanarPoints(vecNear, vecTopLeft, vecTopRight);\n                planes[1].setFromCoplanarPoints(vecNear, vecTopRight, vecDownRight);\n                planes[2].setFromCoplanarPoints(vecDownRight, vecDownLeft, vecNear);\n                planes[3].setFromCoplanarPoints(vecDownLeft, vecTopLeft, vecNear);\n                planes[4].setFromCoplanarPoints(vecTopRight, vecDownRight, vecDownLeft);\n                planes[5].setFromCoplanarPoints(vectemp3, vectemp2, vectemp1);\n                planes[5].normal.multiplyScalar(-1);\n            } else if (this.camera.isOrthographicCamera) {\n                if (startPoint.equals(endPoint))\n                    endPoint.addScalar(Number.EPSILON);\n                var left = Math.min(startPoint.x, endPoint.x);\n                var top = Math.max(startPoint.y, endPoint.y);\n                var right = Math.max(startPoint.x, endPoint.x);\n                var down = Math.min(startPoint.y, endPoint.y);\n                vecTopLeft.set(left, top, -1);\n                vecTopRight.set(right, top, -1);\n                vecDownRight.set(right, down, -1);\n                vecDownLeft.set(left, down, -1);\n                vecFarTopLeft.set(left, top, 1);\n                vecFarTopRight.set(right, top, 1);\n                vecFarDownRight.set(right, down, 1);\n                vecFarDownLeft.set(left, down, 1);\n                vecTopLeft.unproject(this.camera);\n                vecTopRight.unproject(this.camera);\n                vecDownRight.unproject(this.camera);\n                vecDownLeft.unproject(this.camera);\n                vecFarTopLeft.unproject(this.camera);\n                vecFarTopRight.unproject(this.camera);\n                vecFarDownRight.unproject(this.camera);\n                vecFarDownLeft.unproject(this.camera);\n                var planes = frustum.planes;\n                planes[0].setFromCoplanarPoints(vecTopLeft, vecFarTopLeft, vecFarTopRight);\n                planes[1].setFromCoplanarPoints(vecTopRight, vecFarTopRight, vecFarDownRight);\n                planes[2].setFromCoplanarPoints(vecFarDownRight, vecFarDownLeft, vecDownLeft);\n                planes[3].setFromCoplanarPoints(vecFarDownLeft, vecFarTopLeft, vecTopLeft);\n                planes[4].setFromCoplanarPoints(vecTopRight, vecDownRight, vecDownLeft);\n                planes[5].setFromCoplanarPoints(vecFarDownRight, vecFarTopRight, vecFarTopLeft);\n                planes[5].normal.multiplyScalar(-1);\n            } else {\n                console.error('THREE.SelectionBox: Unsupported camera type.');\n            }\n        };\n        SelectionBox.prototype.searchChildInFrustum = function (frustum, object) {\n            if (object.isMesh || object.isLine || object.isPoints) {\n                if (object.material !== undefined) {\n                    if (object.geometry.boundingSphere === null)\n                        object.geometry.computeBoundingSphere();\n                    center.copy(object.geometry.boundingSphere.center);\n                    center.applyMatrix4(object.matrixWorld);\n                    if (frustum.containsPoint(center)) {\n                        this.collection.push(object);\n                    }\n                }\n            }\n            if (object.children.length > 0) {\n                for (var x = 0; x < object.children.length; x++) {\n                    this.searchChildInFrustum(frustum, object.children[x]);\n                }\n            }\n        };\n        return SelectionBox;\n    }();\n\n    return threex.interactive.SelectionBox  =SelectionBox;\n});"]}