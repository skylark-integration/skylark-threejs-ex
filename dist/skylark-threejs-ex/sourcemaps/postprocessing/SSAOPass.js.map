{"version":3,"sources":["postprocessing/SSAOPass.js"],"names":["define","THREE","threex","Pass","SimplexNoise","SSAOShader","CopyShader","SSAOPass","scene","camera","width","height","call","this","undefined","clear","kernelRadius","kernelSize","kernel","noiseTexture","output","minDistance","maxDistance","generateSampleKernel","generateRandomKernelRotations","depthTexture","DepthTexture","type","UnsignedShortType","minFilter","NearestFilter","maxFilter","beautyRenderTarget","WebGLRenderTarget","LinearFilter","magFilter","format","RGBAFormat","depthBuffer","normalRenderTarget","ssaoRenderTarget","blurRenderTarget","clone","console","error","ssaoMaterial","ShaderMaterial","defines","Object","assign","uniforms","UniformsUtils","vertexShader","fragmentShader","blending","NoBlending","value","texture","near","far","set","copy","projectionMatrix","getInverse","normalMaterial","MeshNormalMaterial","blurMaterial","SSAOBlurShader","depthRenderMaterial","SSAODepthShader","copyMaterial","transparent","depthTest","depthWrite","blendSrc","DstColorFactor","blendDst","ZeroFactor","blendEquation","AddEquation","blendSrcAlpha","DstAlphaFactor","blendDstAlpha","blendEquationAlpha","fsQuad","FullScreenQuad","originalClearColor","Color","prototype","create","constructor","dispose","render","renderer","writeBuffer","setRenderTarget","renderOverride","renderPass","OUTPUT","SSAO","renderToScreen","Blur","Beauty","Depth","Normal","Default","CustomBlending","warn","passMaterial","renderTarget","clearColor","clearAlpha","getClearColor","originalClearAlpha","getClearAlpha","originalAutoClear","autoClear","setClearColor","setClearAlpha","material","overrideMaterial","setSize","i","sample","Vector3","x","Math","random","y","z","normalize","scale","MathUtils","lerp","multiplyScalar","push","simplex","data","Float32Array","size","stride","noise","noise3d","DataTexture","FloatType","wrapS","RepeatWrapping","wrapT","postprocessing"],"mappings":"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","file":"../../postprocessing/SSAOPass.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\",\r\n    './Pass',\r\n    '../math/SimplexNoise',\r\n    '../shaders/SSAOShader',\r\n    '../shaders/CopyShader'\r\n], function (\r\n    THREE, \r\n    threex,\r\n    Pass, \r\n    SimplexNoise, \r\n    SSAOShader, \r\n    CopyShader\r\n) {\r\n    'use strict';\r\n    var SSAOPass = function (scene, camera, width, height) {\r\n        Pass.call(this);\r\n        this.width = width !== undefined ? width : 512;\r\n        this.height = height !== undefined ? height : 512;\r\n        this.clear = true;\r\n        this.camera = camera;\r\n        this.scene = scene;\r\n        this.kernelRadius = 8;\r\n        this.kernelSize = 32;\r\n        this.kernel = [];\r\n        this.noiseTexture = null;\r\n        this.output = 0;\r\n        this.minDistance = 0.005;\r\n        this.maxDistance = 0.1;\r\n        this.generateSampleKernel();\r\n        this.generateRandomKernelRotations();\r\n        var depthTexture = new THREE.DepthTexture();\r\n        depthTexture.type = THREE.UnsignedShortType;\r\n        depthTexture.minFilter = THREE.NearestFilter;\r\n        depthTexture.maxFilter = THREE.NearestFilter;\r\n        this.beautyRenderTarget = new THREE.WebGLRenderTarget(this.width, this.height, {\r\n            minFilter: THREE.LinearFilter,\r\n            magFilter: THREE.LinearFilter,\r\n            format: THREE.RGBAFormat,\r\n            depthTexture: depthTexture,\r\n            depthBuffer: true\r\n        });\r\n        this.normalRenderTarget = new THREE.WebGLRenderTarget(this.width, this.height, {\r\n            minFilter: THREE.NearestFilter,\r\n            magFilter: THREE.NearestFilter,\r\n            format: THREE.RGBAFormat\r\n        });\r\n        this.ssaoRenderTarget = new THREE.WebGLRenderTarget(this.width, this.height, {\r\n            minFilter: THREE.LinearFilter,\r\n            magFilter: THREE.LinearFilter,\r\n            format: THREE.RGBAFormat\r\n        });\r\n        this.blurRenderTarget = this.ssaoRenderTarget.clone();\r\n        if (SSAOShader === undefined) {\r\n            console.error('THREE.SSAOPass: The pass relies on SSAOShader.');\r\n        }\r\n        this.ssaoMaterial = new THREE.ShaderMaterial({\r\n            defines: Object.assign({}, SSAOShader.defines),\r\n            uniforms: THREE.UniformsUtils.clone(SSAOShader.uniforms),\r\n            vertexShader: SSAOShader.vertexShader,\r\n            fragmentShader: SSAOShader.fragmentShader,\r\n            blending: THREE.NoBlending\r\n        });\r\n        this.ssaoMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\r\n        this.ssaoMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture;\r\n        this.ssaoMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\r\n        this.ssaoMaterial.uniforms['tNoise'].value = this.noiseTexture;\r\n        this.ssaoMaterial.uniforms['kernel'].value = this.kernel;\r\n        this.ssaoMaterial.uniforms['cameraNear'].value = this.camera.near;\r\n        this.ssaoMaterial.uniforms['cameraFar'].value = this.camera.far;\r\n        this.ssaoMaterial.uniforms['resolution'].value.set(this.width, this.height);\r\n        this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\r\n        this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.getInverse(this.camera.projectionMatrix);\r\n        this.normalMaterial = new THREE.MeshNormalMaterial();\r\n        this.normalMaterial.blending = THREE.NoBlending;\r\n        this.blurMaterial = new THREE.ShaderMaterial({\r\n            defines: Object.assign({}, SSAOBlurShader.defines),\r\n            uniforms: THREE.UniformsUtils.clone(SSAOBlurShader.uniforms),\r\n            vertexShader: SSAOBlurShader.vertexShader,\r\n            fragmentShader: SSAOBlurShader.fragmentShader\r\n        });\r\n        this.blurMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\r\n        this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height);\r\n        this.depthRenderMaterial = new THREE.ShaderMaterial({\r\n            defines: Object.assign({}, SSAODepthShader.defines),\r\n            uniforms: THREE.UniformsUtils.clone(SSAODepthShader.uniforms),\r\n            vertexShader: SSAODepthShader.vertexShader,\r\n            fragmentShader: SSAODepthShader.fragmentShader,\r\n            blending: THREE.NoBlending\r\n        });\r\n        this.depthRenderMaterial.uniforms['tDepth'].value = this.beautyRenderTarget.depthTexture;\r\n        this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\r\n        this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far;\r\n        this.copyMaterial = new THREE.ShaderMaterial({\r\n            uniforms: THREE.UniformsUtils.clone(CopyShader.uniforms),\r\n            vertexShader: CopyShader.vertexShader,\r\n            fragmentShader: CopyShader.fragmentShader,\r\n            transparent: true,\r\n            depthTest: false,\r\n            depthWrite: false,\r\n            blendSrc: THREE.DstColorFactor,\r\n            blendDst: THREE.ZeroFactor,\r\n            blendEquation: THREE.AddEquation,\r\n            blendSrcAlpha: THREE.DstAlphaFactor,\r\n            blendDstAlpha: THREE.ZeroFactor,\r\n            blendEquationAlpha: THREE.AddEquation\r\n        });\r\n        this.fsQuad = new Pass.FullScreenQuad(null);\r\n        this.originalClearColor = new THREE.Color();\r\n    };\r\n    SSAOPass.prototype = Object.assign(Object.create(Pass.prototype), {\r\n        constructor: SSAOPass,\r\n        dispose: function () {\r\n            this.beautyRenderTarget.dispose();\r\n            this.normalRenderTarget.dispose();\r\n            this.ssaoRenderTarget.dispose();\r\n            this.blurRenderTarget.dispose();\r\n            this.normalMaterial.dispose();\r\n            this.blurMaterial.dispose();\r\n            this.copyMaterial.dispose();\r\n            this.depthRenderMaterial.dispose();\r\n            this.fsQuad.dispose();\r\n        },\r\n        render: function (renderer, writeBuffer) {\r\n            renderer.setRenderTarget(this.beautyRenderTarget);\r\n            renderer.clear();\r\n            renderer.render(this.scene, this.camera);\r\n            this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 7829503, 1);\r\n            this.ssaoMaterial.uniforms['kernelRadius'].value = this.kernelRadius;\r\n            this.ssaoMaterial.uniforms['minDistance'].value = this.minDistance;\r\n            this.ssaoMaterial.uniforms['maxDistance'].value = this.maxDistance;\r\n            this.renderPass(renderer, this.ssaoMaterial, this.ssaoRenderTarget);\r\n            this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget);\r\n            switch (this.output) {\r\n            case SSAOPass.OUTPUT.SSAO:\r\n                this.copyMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\r\n                this.copyMaterial.blending = THREE.NoBlending;\r\n                this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\r\n                break;\r\n            case SSAOPass.OUTPUT.Blur:\r\n                this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\r\n                this.copyMaterial.blending = THREE.NoBlending;\r\n                this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\r\n                break;\r\n            case SSAOPass.OUTPUT.Beauty:\r\n                this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\r\n                this.copyMaterial.blending = THREE.NoBlending;\r\n                this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\r\n                break;\r\n            case SSAOPass.OUTPUT.Depth:\r\n                this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\r\n                break;\r\n            case SSAOPass.OUTPUT.Normal:\r\n                this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\r\n                this.copyMaterial.blending = THREE.NoBlending;\r\n                this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\r\n                break;\r\n            case SSAOPass.OUTPUT.Default:\r\n                this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\r\n                this.copyMaterial.blending = THREE.NoBlending;\r\n                this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\r\n                this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\r\n                this.copyMaterial.blending = THREE.CustomBlending;\r\n                this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\r\n                break;\r\n            default:\r\n                console.warn('THREE.SSAOPass: Unknown output type.');\r\n            }\r\n        },\r\n        renderPass: function (renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\r\n            this.originalClearColor.copy(renderer.getClearColor());\r\n            var originalClearAlpha = renderer.getClearAlpha();\r\n            var originalAutoClear = renderer.autoClear;\r\n            renderer.setRenderTarget(renderTarget);\r\n            renderer.autoClear = false;\r\n            if (clearColor !== undefined && clearColor !== null) {\r\n                renderer.setClearColor(clearColor);\r\n                renderer.setClearAlpha(clearAlpha || 0);\r\n                renderer.clear();\r\n            }\r\n            this.fsQuad.material = passMaterial;\r\n            this.fsQuad.render(renderer);\r\n            renderer.autoClear = originalAutoClear;\r\n            renderer.setClearColor(this.originalClearColor);\r\n            renderer.setClearAlpha(originalClearAlpha);\r\n        },\r\n        renderOverride: function (renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\r\n            this.originalClearColor.copy(renderer.getClearColor());\r\n            var originalClearAlpha = renderer.getClearAlpha();\r\n            var originalAutoClear = renderer.autoClear;\r\n            renderer.setRenderTarget(renderTarget);\r\n            renderer.autoClear = false;\r\n            clearColor = overrideMaterial.clearColor || clearColor;\r\n            clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\r\n            if (clearColor !== undefined && clearColor !== null) {\r\n                renderer.setClearColor(clearColor);\r\n                renderer.setClearAlpha(clearAlpha || 0);\r\n                renderer.clear();\r\n            }\r\n            this.scene.overrideMaterial = overrideMaterial;\r\n            renderer.render(this.scene, this.camera);\r\n            this.scene.overrideMaterial = null;\r\n            renderer.autoClear = originalAutoClear;\r\n            renderer.setClearColor(this.originalClearColor);\r\n            renderer.setClearAlpha(originalClearAlpha);\r\n        },\r\n        setSize: function (width, height) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.beautyRenderTarget.setSize(width, height);\r\n            this.ssaoRenderTarget.setSize(width, height);\r\n            this.normalRenderTarget.setSize(width, height);\r\n            this.blurRenderTarget.setSize(width, height);\r\n            this.ssaoMaterial.uniforms['resolution'].value.set(width, height);\r\n            this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\r\n            this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.getInverse(this.camera.projectionMatrix);\r\n            this.blurMaterial.uniforms['resolution'].value.set(width, height);\r\n        },\r\n        generateSampleKernel: function () {\r\n            var kernelSize = this.kernelSize;\r\n            var kernel = this.kernel;\r\n            for (var i = 0; i < kernelSize; i++) {\r\n                var sample = new THREE.Vector3();\r\n                sample.x = Math.random() * 2 - 1;\r\n                sample.y = Math.random() * 2 - 1;\r\n                sample.z = Math.random();\r\n                sample.normalize();\r\n                var scale = i / kernelSize;\r\n                scale = THREE.MathUtils.lerp(0.1, 1, scale * scale);\r\n                sample.multiplyScalar(scale);\r\n                kernel.push(sample);\r\n            }\r\n        },\r\n        generateRandomKernelRotations: function () {\r\n            var width = 4, height = 4;\r\n            if (SimplexNoise === undefined) {\r\n                console.error('THREE.SSAOPass: The pass relies on SimplexNoise.');\r\n            }\r\n            var simplex = new SimplexNoise();\r\n            var size = width * height;\r\n            var data = new Float32Array(size * 4);\r\n            for (var i = 0; i < size; i++) {\r\n                var stride = i * 4;\r\n                var x = Math.random() * 2 - 1;\r\n                var y = Math.random() * 2 - 1;\r\n                var z = 0;\r\n                var noise = simplex.noise3d(x, y, z);\r\n                data[stride] = noise;\r\n                data[stride + 1] = noise;\r\n                data[stride + 2] = noise;\r\n                data[stride + 3] = 1;\r\n            }\r\n            this.noiseTexture = new THREE.DataTexture(data, width, height, THREE.RGBAFormat, THREE.FloatType);\r\n            this.noiseTexture.wrapS = THREE.RepeatWrapping;\r\n            this.noiseTexture.wrapT = THREE.RepeatWrapping;\r\n        }\r\n    });\r\n    SSAOPass.OUTPUT = {\r\n        'Default': 0,\r\n        'SSAO': 1,\r\n        'Blur': 2,\r\n        'Beauty': 3,\r\n        'Depth': 4,\r\n        'Normal': 5\r\n    };\r\n    return threex.postprocessing.SSAOPass = SSAOPass;\r\n});"]}