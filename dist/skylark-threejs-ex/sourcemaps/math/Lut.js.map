{"version":3,"sources":["math/Lut.js"],"names":["define","THREE","Lut","colormap","numberofcolors","this","lut","setColorMap","prototype","constructor","map","n","minV","maxV","set","value","copy","setMin","min","setMax","max","ColorMapKeywords","rainbow","step","length","i","j","minColor","Color","maxColor","color","lerp","push","getColor","alpha","colorPosition","Math","round","addColorMap","colormapName","arrayOfColors","createCanvas","canvas","document","createElement","width","height","updateCanvas","ctx","getContext","imageData","getImageData","data","k","r","g","b","putImageData","cooltowarm","blackbody","grayscale"],"mappings":";;;;;;;AAAAA,QACI,mBACD,SAAUC,GACT,aACA,IAAIC,EAAM,SAAUC,EAAUC,GAG1B,OAFAC,KAAKC,OACLD,KAAKE,YAAYJ,EAAUC,GACpBC,MAEXH,EAAIM,WACAC,YAAaP,EACbI,OACAI,OACAC,EAAG,IACHC,KAAM,EACNC,KAAM,EACNC,IAAK,SAAUC,GAIX,OAHIA,aAAiBb,GACjBG,KAAKW,KAAKD,GAEPV,MAEXY,OAAQ,SAAUC,GAEd,OADAb,KAAKO,KAAOM,EACLb,MAEXc,OAAQ,SAAUC,GAEd,OADAf,KAAKQ,KAAOO,EACLf,MAEXE,YAAa,SAAUJ,EAAUC,GAC7BC,KAAKK,IAAMW,EAAiBlB,IAAakB,EAAiBC,QAC1DjB,KAAKM,EAAIP,GAAkB,GAC3B,IAAImB,EAAO,EAAIlB,KAAKM,EACpBN,KAAKC,IAAIkB,OAAS,EAClB,IAAK,IAAIC,EAAI,EAAGA,GAAK,EAAGA,GAAKF,EACzB,IAAK,IAAIG,EAAI,EAAGA,EAAIrB,KAAKK,IAAIc,OAAS,EAAGE,IACrC,GAAID,GAAKpB,KAAKK,IAAIgB,GAAG,IAAMD,EAAIpB,KAAKK,IAAIgB,EAAI,GAAG,GAAI,CAC/C,IAAIR,EAAMb,KAAKK,IAAIgB,GAAG,GAClBN,EAAMf,KAAKK,IAAIgB,EAAI,GAAG,GACtBC,EAAW,IAAI1B,EAAM2B,MAAMvB,KAAKK,IAAIgB,GAAG,IACvCG,EAAW,IAAI5B,EAAM2B,MAAMvB,KAAKK,IAAIgB,EAAI,GAAG,IAC3CI,EAAQH,EAASI,KAAKF,GAAWJ,EAAIP,IAAQE,EAAMF,IACvDb,KAAKC,IAAI0B,KAAKF,GAI1B,OAAOzB,MAEXW,KAAM,SAAUV,GAMZ,OALAD,KAAKC,IAAMA,EAAIA,IACfD,KAAKK,IAAMJ,EAAII,IACfL,KAAKM,EAAIL,EAAIK,EACbN,KAAKO,KAAON,EAAIM,KAChBP,KAAKQ,KAAOP,EAAIO,KACTR,MAEX4B,SAAU,SAAUC,GACZA,GAAS7B,KAAKO,KACdsB,EAAQ7B,KAAKO,KACNsB,GAAS7B,KAAKQ,OACrBqB,EAAQ7B,KAAKQ,MAEjBqB,GAASA,EAAQ7B,KAAKO,OAASP,KAAKQ,KAAOR,KAAKO,MAChD,IAAIuB,EAAgBC,KAAKC,MAAMH,EAAQ7B,KAAKM,GAE5C,OADAwB,GAAiB9B,KAAKM,IAAIwB,GAAiB,GACpC9B,KAAKC,IAAI6B,IAEpBG,YAAa,SAAUC,EAAcC,GACjCnB,EAAiBkB,GAAgBC,GAErCC,aAAc,WACV,IAAIC,EAASC,SAASC,cAAc,UAIpC,OAHAF,EAAOG,MAAQ,EACfH,EAAOI,OAASzC,KAAKM,EACrBN,KAAK0C,aAAaL,GACXA,GAEXK,aAAc,SAAUL,GAMpB,IALA,IAAIM,EAAMN,EAAOO,WAAW,MAAQf,OAAO,IACvCgB,EAAYF,EAAIG,aAAa,EAAG,EAAG,EAAG9C,KAAKM,GAC3CyC,EAAOF,EAAUE,KACjBC,EAAI,EACJ9B,EAAO,EAAIlB,KAAKM,EACXc,EAAI,EAAGA,GAAK,EAAGA,GAAKF,EACzB,IAAK,IAAIG,EAAIrB,KAAKK,IAAIc,OAAS,EAAGE,GAAK,EAAGA,IACtC,GAAID,EAAIpB,KAAKK,IAAIgB,GAAG,IAAMD,GAAKpB,KAAKK,IAAIgB,EAAI,GAAG,GAAI,CAC/C,IAAIR,EAAMb,KAAKK,IAAIgB,EAAI,GAAG,GACtBN,EAAMf,KAAKK,IAAIgB,GAAG,GAClBC,EAAW,IAAI1B,EAAM2B,MAAMvB,KAAKK,IAAIgB,EAAI,GAAG,IAC3CG,EAAW,IAAI5B,EAAM2B,MAAMvB,KAAKK,IAAIgB,GAAG,IACvCI,EAAQH,EAASI,KAAKF,GAAWJ,EAAIP,IAAQE,EAAMF,IACvDkC,EAAS,EAAJC,GAASjB,KAAKC,MAAgB,IAAVP,EAAMwB,GAC/BF,EAAS,EAAJC,EAAQ,GAAKjB,KAAKC,MAAgB,IAAVP,EAAMyB,GACnCH,EAAS,EAAJC,EAAQ,GAAKjB,KAAKC,MAAgB,IAAVP,EAAM0B,GACnCJ,EAAS,EAAJC,EAAQ,GAAK,IAClBA,GAAK,EAKjB,OADAL,EAAIS,aAAaP,EAAW,EAAG,GACxBR,IAGf,IAAIrB,GACAC,UAEQ,EACA,MAGA,GACA,QAGA,GACA,QAGA,GACA,WAGA,EACA,WAGRoC,aAEQ,EACA,UAGA,GACA,WAGA,GACA,WAGA,GACA,WAGA,EACA,WAGRC,YAEQ,EACA,IAGA,GACA,UAGA,GACA,WAGA,GACA,WAGA,EACA,WAGRC,YAEQ,EACA,IAGA,GACA,UAGA,GACA,UAGA,GACA,WAGA,EACA,YAKZ,OAAO1D","file":"../../math/Lut.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    var Lut = function (colormap, numberofcolors) {\n        this.lut = [];\n        this.setColorMap(colormap, numberofcolors);\n        return this;\n    };\n    Lut.prototype = {\n        constructor: Lut,\n        lut: [],\n        map: [],\n        n: 256,\n        minV: 0,\n        maxV: 1,\n        set: function (value) {\n            if (value instanceof Lut) {\n                this.copy(value);\n            }\n            return this;\n        },\n        setMin: function (min) {\n            this.minV = min;\n            return this;\n        },\n        setMax: function (max) {\n            this.maxV = max;\n            return this;\n        },\n        setColorMap: function (colormap, numberofcolors) {\n            this.map = ColorMapKeywords[colormap] || ColorMapKeywords.rainbow;\n            this.n = numberofcolors || 32;\n            var step = 1 / this.n;\n            this.lut.length = 0;\n            for (var i = 0; i <= 1; i += step) {\n                for (var j = 0; j < this.map.length - 1; j++) {\n                    if (i >= this.map[j][0] && i < this.map[j + 1][0]) {\n                        var min = this.map[j][0];\n                        var max = this.map[j + 1][0];\n                        var minColor = new THREE.Color(this.map[j][1]);\n                        var maxColor = new THREE.Color(this.map[j + 1][1]);\n                        var color = minColor.lerp(maxColor, (i - min) / (max - min));\n                        this.lut.push(color);\n                    }\n                }\n            }\n            return this;\n        },\n        copy: function (lut) {\n            this.lut = lut.lut;\n            this.map = lut.map;\n            this.n = lut.n;\n            this.minV = lut.minV;\n            this.maxV = lut.maxV;\n            return this;\n        },\n        getColor: function (alpha) {\n            if (alpha <= this.minV) {\n                alpha = this.minV;\n            } else if (alpha >= this.maxV) {\n                alpha = this.maxV;\n            }\n            alpha = (alpha - this.minV) / (this.maxV - this.minV);\n            var colorPosition = Math.round(alpha * this.n);\n            colorPosition == this.n ? colorPosition -= 1 : colorPosition;\n            return this.lut[colorPosition];\n        },\n        addColorMap: function (colormapName, arrayOfColors) {\n            ColorMapKeywords[colormapName] = arrayOfColors;\n        },\n        createCanvas: function () {\n            var canvas = document.createElement('canvas');\n            canvas.width = 1;\n            canvas.height = this.n;\n            this.updateCanvas(canvas);\n            return canvas;\n        },\n        updateCanvas: function (canvas) {\n            var ctx = canvas.getContext('2d', { alpha: false });\n            var imageData = ctx.getImageData(0, 0, 1, this.n);\n            var data = imageData.data;\n            var k = 0;\n            var step = 1 / this.n;\n            for (var i = 1; i >= 0; i -= step) {\n                for (var j = this.map.length - 1; j >= 0; j--) {\n                    if (i < this.map[j][0] && i >= this.map[j - 1][0]) {\n                        var min = this.map[j - 1][0];\n                        var max = this.map[j][0];\n                        var minColor = new THREE.Color(this.map[j - 1][1]);\n                        var maxColor = new THREE.Color(this.map[j][1]);\n                        var color = minColor.lerp(maxColor, (i - min) / (max - min));\n                        data[k * 4] = Math.round(color.r * 255);\n                        data[k * 4 + 1] = Math.round(color.g * 255);\n                        data[k * 4 + 2] = Math.round(color.b * 255);\n                        data[k * 4 + 3] = 255;\n                        k += 1;\n                    }\n                }\n            }\n            ctx.putImageData(imageData, 0, 0);\n            return canvas;\n        }\n    };\n    var ColorMapKeywords = {\n        'rainbow': [\n            [\n                0,\n                255\n            ],\n            [\n                0.2,\n                65535\n            ],\n            [\n                0.5,\n                65280\n            ],\n            [\n                0.8,\n                16776960\n            ],\n            [\n                1,\n                16711680\n            ]\n        ],\n        'cooltowarm': [\n            [\n                0,\n                3952322\n            ],\n            [\n                0.2,\n                10206463\n            ],\n            [\n                0.5,\n                14474460\n            ],\n            [\n                0.8,\n                16163717\n            ],\n            [\n                1,\n                11797542\n            ]\n        ],\n        'blackbody': [\n            [\n                0,\n                0\n            ],\n            [\n                0.2,\n                7864320\n            ],\n            [\n                0.5,\n                15086080\n            ],\n            [\n                0.8,\n                16776960\n            ],\n            [\n                1,\n                16777215\n            ]\n        ],\n        'grayscale': [\n            [\n                0,\n                0\n            ],\n            [\n                0.2,\n                4210752\n            ],\n            [\n                0.5,\n                8355712\n            ],\n            [\n                0.8,\n                12566463\n            ],\n            [\n                1,\n                16777215\n            ]\n        ]\n    };\n    \n    return Lut;\n});"]}