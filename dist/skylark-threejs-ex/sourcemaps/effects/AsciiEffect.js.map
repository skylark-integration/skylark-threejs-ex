{"version":3,"sources":["effects/AsciiEffect.js"],"names":["define","threex","effects","AsciiEffect","renderer","charSet","options","undefined","width","height","bResolution","iScale","bColor","bAlpha","bBlock","bInvert","domElement","document","createElement","style","cursor","iWidth","iHeight","oImg","oAscii","appendChild","this","setSize","w","h","Math","round","fResolution","oCanvas","backgroundColor","rows","cells","color","cellSpacing","cellPadding","oStyle","display","whiteSpace","margin","padding","letterSpacing","fLetterSpacing","fontFamily","strFont","fontSize","fFontSize","lineHeight","fLineHeight","textAlign","textDecoration","initAsciiSize","render","scene","camera","canvasRenderer","oCtx","clearRect","drawImage","oCanvasImg","oImgData","getImageData","data","strChars","y","x","iCharIdx","fBrightness","iOffset","iRed","iGreen","iBlue","iAlpha","floor","aCharList","length","strThisChar","innerHTML","asciifyImage","aDefaultCharList","split","aDefaultColorCharList","getContext"],"mappings":"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","file":"../../effects/AsciiEffect.js","sourcesContent":["define([\n    \"../threex\",\n], function (threex) {\n    'use strict';\n    var AsciiEffect = function (renderer, charSet, options) {\n        charSet = charSet === undefined ? ' .:-=+*#%@' : charSet;\n        if (!options)\n            options = {};\n        var bResolution = !options['resolution'] ? 0.15 : options['resolution'];\n        var iScale = !options['scale'] ? 1 : options['scale'];\n        var bColor = !options['color'] ? false : options['color'];\n        var bAlpha = !options['alpha'] ? false : options['alpha'];\n        var bBlock = !options['block'] ? false : options['block'];\n        var bInvert = !options['invert'] ? false : options['invert'];\n        var strResolution = 'low';\n        var width, height;\n        var domElement = document.createElement('div');\n        domElement.style.cursor = 'default';\n        var oAscii = document.createElement('table');\n        domElement.appendChild(oAscii);\n        var iWidth, iHeight;\n        var oImg;\n        this.setSize = function (w, h) {\n            width = w;\n            height = h;\n            renderer.setSize(w, h);\n            initAsciiSize();\n        };\n        this.render = function (scene, camera) {\n            renderer.render(scene, camera);\n            asciifyImage(renderer, oAscii);\n        };\n        this.domElement = domElement;\n        function initAsciiSize() {\n            iWidth = Math.round(width * fResolution);\n            iHeight = Math.round(height * fResolution);\n            oCanvas.width = iWidth;\n            oCanvas.height = iHeight;\n            oImg = renderer.domElement;\n            if (oImg.style.backgroundColor) {\n                oAscii.rows[0].cells[0].style.backgroundColor = oImg.style.backgroundColor;\n                oAscii.rows[0].cells[0].style.color = oImg.style.color;\n            }\n            oAscii.cellSpacing = 0;\n            oAscii.cellPadding = 0;\n            var oStyle = oAscii.style;\n            oStyle.display = 'inline';\n            oStyle.width = Math.round(iWidth / fResolution * iScale) + 'px';\n            oStyle.height = Math.round(iHeight / fResolution * iScale) + 'px';\n            oStyle.whiteSpace = 'pre';\n            oStyle.margin = '0px';\n            oStyle.padding = '0px';\n            oStyle.letterSpacing = fLetterSpacing + 'px';\n            oStyle.fontFamily = strFont;\n            oStyle.fontSize = fFontSize + 'px';\n            oStyle.lineHeight = fLineHeight + 'px';\n            oStyle.textAlign = 'left';\n            oStyle.textDecoration = 'none';\n        }\n        var aDefaultCharList = ' .,:;i1tfLCG08@'.split('');\n        var aDefaultColorCharList = ' CGO08@'.split('');\n        var strFont = 'courier new, monospace';\n        var oCanvasImg = renderer.domElement;\n        var oCanvas = document.createElement('canvas');\n        if (!oCanvas.getContext) {\n            return;\n        }\n        var oCtx = oCanvas.getContext('2d');\n        if (!oCtx.getImageData) {\n            return;\n        }\n        var aCharList = bColor ? aDefaultColorCharList : aDefaultCharList;\n        if (charSet)\n            aCharList = charSet;\n        var fResolution = 0.5;\n        switch (strResolution) {\n        case 'low':\n            fResolution = 0.25;\n            break;\n        case 'medium':\n            fResolution = 0.5;\n            break;\n        case 'high':\n            fResolution = 1;\n            break;\n        }\n        if (bResolution)\n            fResolution = bResolution;\n        var fFontSize = 2 / fResolution * iScale;\n        var fLineHeight = 2 / fResolution * iScale;\n        var fLetterSpacing = 0;\n        if (strResolution == 'low') {\n            switch (iScale) {\n            case 1:\n                fLetterSpacing = -1;\n                break;\n            case 2:\n            case 3:\n                fLetterSpacing = -2.1;\n                break;\n            case 4:\n                fLetterSpacing = -3.1;\n                break;\n            case 5:\n                fLetterSpacing = -4.15;\n                break;\n            }\n        }\n        if (strResolution == 'medium') {\n            switch (iScale) {\n            case 1:\n                fLetterSpacing = 0;\n                break;\n            case 2:\n                fLetterSpacing = -1;\n                break;\n            case 3:\n                fLetterSpacing = -1.04;\n                break;\n            case 4:\n            case 5:\n                fLetterSpacing = -2.1;\n                break;\n            }\n        }\n        if (strResolution == 'high') {\n            switch (iScale) {\n            case 1:\n            case 2:\n                fLetterSpacing = 0;\n                break;\n            case 3:\n            case 4:\n            case 5:\n                fLetterSpacing = -1;\n                break;\n            }\n        }\n        function asciifyImage(canvasRenderer, oAscii) {\n            oCtx.clearRect(0, 0, iWidth, iHeight);\n            oCtx.drawImage(oCanvasImg, 0, 0, iWidth, iHeight);\n            var oImgData = oCtx.getImageData(0, 0, iWidth, iHeight).data;\n            var strChars = '';\n            for (var y = 0; y < iHeight; y += 2) {\n                for (var x = 0; x < iWidth; x++) {\n                    var iOffset = (y * iWidth + x) * 4;\n                    var iRed = oImgData[iOffset];\n                    var iGreen = oImgData[iOffset + 1];\n                    var iBlue = oImgData[iOffset + 2];\n                    var iAlpha = oImgData[iOffset + 3];\n                    var iCharIdx;\n                    var fBrightness;\n                    fBrightness = (0.3 * iRed + 0.59 * iGreen + 0.11 * iBlue) / 255;\n                    if (iAlpha == 0) {\n                        fBrightness = 1;\n                    }\n                    iCharIdx = Math.floor((1 - fBrightness) * (aCharList.length - 1));\n                    if (bInvert) {\n                        iCharIdx = aCharList.length - iCharIdx - 1;\n                    }\n                    var strThisChar = aCharList[iCharIdx];\n                    if (strThisChar === undefined || strThisChar == ' ')\n                        strThisChar = '&nbsp;';\n                    if (bColor) {\n                        strChars += \"<span style='\" + 'color:rgb(' + iRed + ',' + iGreen + ',' + iBlue + ');' + (bBlock ? 'background-color:rgb(' + iRed + ',' + iGreen + ',' + iBlue + ');' : '') + (bAlpha ? 'opacity:' + iAlpha / 255 + ';' : '') + \"'>\" + strThisChar + '</span>';\n                    } else {\n                        strChars += strThisChar;\n                    }\n                }\n                strChars += '<br/>';\n            }\n            oAscii.innerHTML = '<tr><td>' + strChars + '</td></tr>';\n        }\n    };\n\n    return threex.effects.AsciiEffect = AsciiEffect;\n});"]}