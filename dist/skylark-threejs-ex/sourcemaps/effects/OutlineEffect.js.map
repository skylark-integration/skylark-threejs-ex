{"version":3,"sources":["effects/OutlineEffect.js"],"names":["define","THREE","threex","effects","OutlineEffect","renderer","parameters","this","enabled","defaultThickness","undefined","defaultColor","Color","fromArray","defaultAlpha","defaultKeepAlive","cache","removeThresholdCount","originalMaterials","originalOnBeforeRenders","uniformsOutline","outlineThickness","value","outlineColor","outlineAlpha","vertexShader","join","fragmentShader","getOutlineMaterialFromCache","originalMaterial","data","uuid","material","ShaderMaterial","type","uniforms","UniformsUtils","merge","UniformsLib","side","BackSide","used","keepAlive","count","getOutlineMaterial","outlineMaterial","name","outlineParameters","userData","skinning","morphTargets","morphNormals","fog","toneMapped","premultipliedAlpha","displacementMap","visible","transparent","alpha","wireframe","depthTest","clippingPlanes","clipping","clipIntersection","clipShadows","version","updateOutlineMaterial","isCompatible","object","geometry","hasNormals","isBufferGeometry","attributes","normal","isMesh","setOutlineMaterial","Array","isArray","i","il","length","onBeforeRender","restoreOriginalMaterial","scene","camera","opacity","thickness","color","displacementScale","displacementBias","updateUniforms","render","renderTarget","forceClear","arguments","console","warn","setRenderTarget","clear","currentAutoClear","autoClear","renderOutline","currentSceneAutoUpdate","autoUpdate","currentSceneBackground","background","currentShadowMapEnabled","shadowMap","traverse","keys","Object","key","cleanupCache","domElement","depth","stencil","getPixelRatio","setPixelRatio","getSize","target","setSize","width","height","updateStyle","setViewport","x","y","setScissor","setScissorTest","boolean"],"mappings":"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","file":"../../effects/OutlineEffect.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    \"../threex\"\n], function (\n    THREE,\n    threex\n) {\n    'use strict';\n    var OutlineEffect = function (renderer, parameters) {\n        parameters = parameters || {};\n        this.enabled = true;\n        var defaultThickness = parameters.defaultThickness !== undefined ? parameters.defaultThickness : 0.003;\n        var defaultColor = new THREE.Color().fromArray(parameters.defaultColor !== undefined ? parameters.defaultColor : [\n            0,\n            0,\n            0\n        ]);\n        var defaultAlpha = parameters.defaultAlpha !== undefined ? parameters.defaultAlpha : 1;\n        var defaultKeepAlive = parameters.defaultKeepAlive !== undefined ? parameters.defaultKeepAlive : false;\n        var cache = {};\n        var removeThresholdCount = 60;\n        var originalMaterials = {};\n        var originalOnBeforeRenders = {};\n        var uniformsOutline = {\n            outlineThickness: { value: defaultThickness },\n            outlineColor: { value: defaultColor },\n            outlineAlpha: { value: defaultAlpha }\n        };\n        var vertexShader = [\n            '#include <common>',\n            '#include <uv_pars_vertex>',\n            '#include <displacementmap_pars_vertex>',\n            '#include <fog_pars_vertex>',\n            '#include <morphtarget_pars_vertex>',\n            '#include <skinning_pars_vertex>',\n            '#include <logdepthbuf_pars_vertex>',\n            '#include <clipping_planes_pars_vertex>',\n            'uniform float outlineThickness;',\n            'vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {',\n            '\\tfloat thickness = outlineThickness;',\n            '\\tconst float ratio = 1.0;',\n            '\\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );',\n            '\\tvec4 norm = normalize( pos - pos2 );',\n            '\\treturn pos + norm * thickness * pos.w * ratio;',\n            '}',\n            'void main() {',\n            '\\t#include <uv_vertex>',\n            '\\t#include <beginnormal_vertex>',\n            '\\t#include <morphnormal_vertex>',\n            '\\t#include <skinbase_vertex>',\n            '\\t#include <skinnormal_vertex>',\n            '\\t#include <begin_vertex>',\n            '\\t#include <morphtarget_vertex>',\n            '\\t#include <skinning_vertex>',\n            '\\t#include <displacementmap_vertex>',\n            '\\t#include <project_vertex>',\n            '\\tvec3 outlineNormal = - objectNormal;',\n            '\\tgl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );',\n            '\\t#include <logdepthbuf_vertex>',\n            '\\t#include <clipping_planes_vertex>',\n            '\\t#include <fog_vertex>',\n            '}'\n        ].join('\\n');\n        var fragmentShader = [\n            '#include <common>',\n            '#include <fog_pars_fragment>',\n            '#include <logdepthbuf_pars_fragment>',\n            '#include <clipping_planes_pars_fragment>',\n            'uniform vec3 outlineColor;',\n            'uniform float outlineAlpha;',\n            'void main() {',\n            '\\t#include <clipping_planes_fragment>',\n            '\\t#include <logdepthbuf_fragment>',\n            '\\tgl_FragColor = vec4( outlineColor, outlineAlpha );',\n            '\\t#include <tonemapping_fragment>',\n            '\\t#include <encodings_fragment>',\n            '\\t#include <fog_fragment>',\n            '\\t#include <premultiplied_alpha_fragment>',\n            '}'\n        ].join('\\n');\n        function createMaterial() {\n            return new THREE.ShaderMaterial({\n                type: 'OutlineEffect',\n                uniforms: THREE.UniformsUtils.merge([\n                    THREE.UniformsLib['fog'],\n                    THREE.UniformsLib['displacementmap'],\n                    uniformsOutline\n                ]),\n                vertexShader: vertexShader,\n                fragmentShader: fragmentShader,\n                side: THREE.BackSide\n            });\n        }\n        function getOutlineMaterialFromCache(originalMaterial) {\n            var data = cache[originalMaterial.uuid];\n            if (data === undefined) {\n                data = {\n                    material: createMaterial(),\n                    used: true,\n                    keepAlive: defaultKeepAlive,\n                    count: 0\n                };\n                cache[originalMaterial.uuid] = data;\n            }\n            data.used = true;\n            return data.material;\n        }\n        function getOutlineMaterial(originalMaterial) {\n            var outlineMaterial = getOutlineMaterialFromCache(originalMaterial);\n            originalMaterials[outlineMaterial.uuid] = originalMaterial;\n            updateOutlineMaterial(outlineMaterial, originalMaterial);\n            return outlineMaterial;\n        }\n        function isCompatible(object) {\n            var geometry = object.geometry;\n            var hasNormals = false;\n            if (object.geometry !== undefined) {\n                if (geometry.isBufferGeometry) {\n                    hasNormals = geometry.attributes.normal !== undefined;\n                } else {\n                    hasNormals = true;\n                }\n            }\n            return object.isMesh === true && object.material !== undefined && hasNormals === true;\n        }\n        function setOutlineMaterial(object) {\n            if (isCompatible(object) === false)\n                return;\n            if (Array.isArray(object.material)) {\n                for (var i = 0, il = object.material.length; i < il; i++) {\n                    object.material[i] = getOutlineMaterial(object.material[i]);\n                }\n            } else {\n                object.material = getOutlineMaterial(object.material);\n            }\n            originalOnBeforeRenders[object.uuid] = object.onBeforeRender;\n            object.onBeforeRender = onBeforeRender;\n        }\n        function restoreOriginalMaterial(object) {\n            if (isCompatible(object) === false)\n                return;\n            if (Array.isArray(object.material)) {\n                for (var i = 0, il = object.material.length; i < il; i++) {\n                    object.material[i] = originalMaterials[object.material[i].uuid];\n                }\n            } else {\n                object.material = originalMaterials[object.material.uuid];\n            }\n            object.onBeforeRender = originalOnBeforeRenders[object.uuid];\n        }\n        function onBeforeRender(renderer, scene, camera, geometry, material) {\n            var originalMaterial = originalMaterials[material.uuid];\n            if (originalMaterial === undefined)\n                return;\n            updateUniforms(material, originalMaterial);\n        }\n        function updateUniforms(material, originalMaterial) {\n            var outlineParameters = originalMaterial.userData.outlineParameters;\n            material.uniforms.outlineAlpha.value = originalMaterial.opacity;\n            if (outlineParameters !== undefined) {\n                if (outlineParameters.thickness !== undefined)\n                    material.uniforms.outlineThickness.value = outlineParameters.thickness;\n                if (outlineParameters.color !== undefined)\n                    material.uniforms.outlineColor.value.fromArray(outlineParameters.color);\n                if (outlineParameters.alpha !== undefined)\n                    material.uniforms.outlineAlpha.value = outlineParameters.alpha;\n            }\n            if (originalMaterial.displacementMap) {\n                material.uniforms.displacementMap.value = originalMaterial.displacementMap;\n                material.uniforms.displacementScale.value = originalMaterial.displacementScale;\n                material.uniforms.displacementBias.value = originalMaterial.displacementBias;\n            }\n        }\n        function updateOutlineMaterial(material, originalMaterial) {\n            if (material.name === 'invisible')\n                return;\n            var outlineParameters = originalMaterial.userData.outlineParameters;\n            material.skinning = originalMaterial.skinning;\n            material.morphTargets = originalMaterial.morphTargets;\n            material.morphNormals = originalMaterial.morphNormals;\n            material.fog = originalMaterial.fog;\n            material.toneMapped = originalMaterial.toneMapped;\n            material.premultipliedAlpha = originalMaterial.premultipliedAlpha;\n            material.displacementMap = originalMaterial.displacementMap;\n            if (outlineParameters !== undefined) {\n                if (originalMaterial.visible === false) {\n                    material.visible = false;\n                } else {\n                    material.visible = outlineParameters.visible !== undefined ? outlineParameters.visible : true;\n                }\n                material.transparent = outlineParameters.alpha !== undefined && outlineParameters.alpha < 1 ? true : originalMaterial.transparent;\n                if (outlineParameters.keepAlive !== undefined)\n                    cache[originalMaterial.uuid].keepAlive = outlineParameters.keepAlive;\n            } else {\n                material.transparent = originalMaterial.transparent;\n                material.visible = originalMaterial.visible;\n            }\n            if (originalMaterial.wireframe === true || originalMaterial.depthTest === false)\n                material.visible = false;\n            if (originalMaterial.clippingPlanes) {\n                material.clipping = true;\n                material.clippingPlanes = originalMaterial.clippingPlanes;\n                material.clipIntersection = originalMaterial.clipIntersection;\n                material.clipShadows = originalMaterial.clipShadows;\n            }\n            material.version = originalMaterial.version;\n        }\n        function cleanupCache() {\n            var keys;\n            keys = Object.keys(originalMaterials);\n            for (var i = 0, il = keys.length; i < il; i++) {\n                originalMaterials[keys[i]] = undefined;\n            }\n            keys = Object.keys(originalOnBeforeRenders);\n            for (var i = 0, il = keys.length; i < il; i++) {\n                originalOnBeforeRenders[keys[i]] = undefined;\n            }\n            keys = Object.keys(cache);\n            for (var i = 0, il = keys.length; i < il; i++) {\n                var key = keys[i];\n                if (cache[key].used === false) {\n                    cache[key].count++;\n                    if (cache[key].keepAlive === false && cache[key].count > removeThresholdCount) {\n                        delete cache[key];\n                    }\n                } else {\n                    cache[key].used = false;\n                    cache[key].count = 0;\n                }\n            }\n        }\n        this.render = function (scene, camera) {\n            var renderTarget;\n            var forceClear = false;\n            if (arguments[2] !== undefined) {\n                console.warn('THREE.OutlineEffect.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.');\n                renderTarget = arguments[2];\n            }\n            if (arguments[3] !== undefined) {\n                console.warn('THREE.OutlineEffect.render(): the forceClear argument has been removed. Use .clear() instead.');\n                forceClear = arguments[3];\n            }\n            if (renderTarget !== undefined)\n                renderer.setRenderTarget(renderTarget);\n            if (forceClear)\n                renderer.clear();\n            if (this.enabled === false) {\n                renderer.render(scene, camera);\n                return;\n            }\n            var currentAutoClear = renderer.autoClear;\n            renderer.autoClear = this.autoClear;\n            renderer.render(scene, camera);\n            renderer.autoClear = currentAutoClear;\n            this.renderOutline(scene, camera);\n        };\n        this.renderOutline = function (scene, camera) {\n            var currentAutoClear = renderer.autoClear;\n            var currentSceneAutoUpdate = scene.autoUpdate;\n            var currentSceneBackground = scene.background;\n            var currentShadowMapEnabled = renderer.shadowMap.enabled;\n            scene.autoUpdate = false;\n            scene.background = null;\n            renderer.autoClear = false;\n            renderer.shadowMap.enabled = false;\n            scene.traverse(setOutlineMaterial);\n            renderer.render(scene, camera);\n            scene.traverse(restoreOriginalMaterial);\n            cleanupCache();\n            scene.autoUpdate = currentSceneAutoUpdate;\n            scene.background = currentSceneBackground;\n            renderer.autoClear = currentAutoClear;\n            renderer.shadowMap.enabled = currentShadowMapEnabled;\n        };\n        this.autoClear = renderer.autoClear;\n        this.domElement = renderer.domElement;\n        this.shadowMap = renderer.shadowMap;\n        this.clear = function (color, depth, stencil) {\n            renderer.clear(color, depth, stencil);\n        };\n        this.getPixelRatio = function () {\n            return renderer.getPixelRatio();\n        };\n        this.setPixelRatio = function (value) {\n            renderer.setPixelRatio(value);\n        };\n        this.getSize = function (target) {\n            return renderer.getSize(target);\n        };\n        this.setSize = function (width, height, updateStyle) {\n            renderer.setSize(width, height, updateStyle);\n        };\n        this.setViewport = function (x, y, width, height) {\n            renderer.setViewport(x, y, width, height);\n        };\n        this.setScissor = function (x, y, width, height) {\n            renderer.setScissor(x, y, width, height);\n        };\n        this.setScissorTest = function (boolean) {\n            renderer.setScissorTest(boolean);\n        };\n        this.setRenderTarget = function (renderTarget) {\n            renderer.setRenderTarget(renderTarget);\n        };\n    };\n\n    return threex.effects.OutlineEffect = OutlineEffect;\n});"]}