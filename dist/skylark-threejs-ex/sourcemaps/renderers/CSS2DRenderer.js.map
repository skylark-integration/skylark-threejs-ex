{"version":3,"sources":["renderers/CSS2DRenderer.js"],"names":["define","THREE","CSS2DObject","element","Object3D","call","this","style","position","addEventListener","traverse","object","Element","parentNode","removeChild","prototype","Object","create","constructor","CSS2DRenderer","_width","_height","_widthHalf","_heightHalf","_this","vector","Vector3","viewMatrix","Matrix4","viewProjectionMatrix","cache","objects","WeakMap","domElement","document","createElement","overflow","getSize","width","height","setSize","a","b","renderObject","scene","camera","onBeforeRender","setFromMatrixPosition","matrixWorld","applyMatrix4","x","y","WebkitTransform","MozTransform","oTransform","transform","display","visible","z","objectData","distanceToCameraSquared","getDistanceToSquared","set","appendChild","onAfterRender","i","l","children","length","object1","object2","distanceToSquared","zOrder","sorted","result","push","filterAndFlatten","sort","get","zMax","zIndex","render","autoUpdate","updateMatrixWorld","parent","copy","matrixWorldInverse","multiplyMatrices","projectionMatrix"],"mappings":"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","file":"../../renderers/CSS2DRenderer.js","sourcesContent":["define([\n\t\"skylark-threejs\"\n],function(THREE){\n\t/**\n\t * @author mrdoob / http://mrdoob.com/\n\t */\n\n\tTHREE.CSS2DObject = function ( element ) {\n\n\t\tTHREE.Object3D.call( this );\n\n\t\tthis.element = element;\n\t\tthis.element.style.position = 'absolute';\n\n\t\tthis.addEventListener( 'removed', function () {\n\n\t\t\tthis.traverse( function ( object ) {\n\n\t\t\t\tif ( object.element instanceof Element && object.element.parentNode !== null ) {\n\n\t\t\t\t\tobject.element.parentNode.removeChild( object.element );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tTHREE.CSS2DObject.prototype = Object.create( THREE.Object3D.prototype );\n\tTHREE.CSS2DObject.prototype.constructor = THREE.CSS2DObject;\n\n\t//\n\n\tTHREE.CSS2DRenderer = function () {\n\n\t\tvar _this = this;\n\n\t\tvar _width, _height;\n\t\tvar _widthHalf, _heightHalf;\n\n\t\tvar vector = new THREE.Vector3();\n\t\tvar viewMatrix = new THREE.Matrix4();\n\t\tvar viewProjectionMatrix = new THREE.Matrix4();\n\n\t\tvar cache = {\n\t\t\tobjects: new WeakMap()\n\t\t};\n\n\t\tvar domElement = document.createElement( 'div' );\n\t\tdomElement.style.overflow = 'hidden';\n\n\t\tthis.domElement = domElement;\n\n\t\tthis.getSize = function () {\n\n\t\t\treturn {\n\t\t\t\twidth: _width,\n\t\t\t\theight: _height\n\t\t\t};\n\n\t\t};\n\n\t\tthis.setSize = function ( width, height ) {\n\n\t\t\t_width = width;\n\t\t\t_height = height;\n\n\t\t\t_widthHalf = _width / 2;\n\t\t\t_heightHalf = _height / 2;\n\n\t\t\tdomElement.style.width = width + 'px';\n\t\t\tdomElement.style.height = height + 'px';\n\n\t\t};\n\n\t\tvar renderObject = function ( object, scene, camera ) {\n\n\t\t\tif ( object instanceof THREE.CSS2DObject ) {\n\n\t\t\t\tobject.onBeforeRender( _this, scene, camera );\n\n\t\t\t\tvector.setFromMatrixPosition( object.matrixWorld );\n\t\t\t\tvector.applyMatrix4( viewProjectionMatrix );\n\n\t\t\t\tvar element = object.element;\n\t\t\t\tvar style = 'translate(-50%,-50%) translate(' + ( vector.x * _widthHalf + _widthHalf ) + 'px,' + ( - vector.y * _heightHalf + _heightHalf ) + 'px)';\n\n\t\t\t\telement.style.WebkitTransform = style;\n\t\t\t\telement.style.MozTransform = style;\n\t\t\t\telement.style.oTransform = style;\n\t\t\t\telement.style.transform = style;\n\n\t\t\t\telement.style.display = ( object.visible && vector.z >= - 1 && vector.z <= 1 ) ? '' : 'none';\n\n\t\t\t\tvar objectData = {\n\t\t\t\t\tdistanceToCameraSquared: getDistanceToSquared( camera, object )\n\t\t\t\t};\n\n\t\t\t\tcache.objects.set( object, objectData );\n\n\t\t\t\tif ( element.parentNode !== domElement ) {\n\n\t\t\t\t\tdomElement.appendChild( element );\n\n\t\t\t\t}\n\n\t\t\t\tobject.onAfterRender( _this, scene, camera );\n\n\t\t\t}\n\n\t\t\tfor ( var i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\t\trenderObject( object.children[ i ], scene, camera );\n\n\t\t\t}\n\n\t\t};\n\n\t\tvar getDistanceToSquared = function () {\n\n\t\t\tvar a = new THREE.Vector3();\n\t\t\tvar b = new THREE.Vector3();\n\n\t\t\treturn function ( object1, object2 ) {\n\n\t\t\t\ta.setFromMatrixPosition( object1.matrixWorld );\n\t\t\t\tb.setFromMatrixPosition( object2.matrixWorld );\n\n\t\t\t\treturn a.distanceToSquared( b );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tvar filterAndFlatten = function ( scene ) {\n\n\t\t\tvar result = [];\n\n\t\t\tscene.traverse( function ( object ) {\n\n\t\t\t\tif ( object instanceof THREE.CSS2DObject ) result.push( object );\n\n\t\t\t} );\n\n\t\t\treturn result;\n\n\t\t};\n\n\t\tvar zOrder = function ( scene ) {\n\n\t\t\tvar sorted = filterAndFlatten( scene ).sort( function ( a, b ) {\n\n\t\t\t\tvar distanceA = cache.objects.get( a ).distanceToCameraSquared;\n\t\t\t\tvar distanceB = cache.objects.get( b ).distanceToCameraSquared;\n\n\t\t\t\treturn distanceA - distanceB;\n\n\t\t\t} );\n\n\t\t\tvar zMax = sorted.length;\n\n\t\t\tfor ( var i = 0, l = sorted.length; i < l; i ++ ) {\n\n\t\t\t\tsorted[ i ].element.style.zIndex = zMax - i;\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.render = function ( scene, camera ) {\n\n\t\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t\tviewMatrix.copy( camera.matrixWorldInverse );\n\t\t\tviewProjectionMatrix.multiplyMatrices( camera.projectionMatrix, viewMatrix );\n\n\t\t\trenderObject( scene, scene, camera );\n\t\t\tzOrder( scene );\n\n\t\t};\n\n\t};\n\t\n\treturn THREE.CSS2DRenderer;\n});\n"]}