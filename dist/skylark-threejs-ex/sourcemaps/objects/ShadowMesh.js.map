{"version":3,"sources":["objects/ShadowMesh.js"],"names":["define","THREE","shadowMatrix","ShadowMesh","mesh","shadowMaterial","MeshBasicMaterial","color","transparent","opacity","depthWrite","Mesh","call","this","geometry","meshMatrix","matrixWorld","frustumCulled","matrixAutoUpdate","prototype","Object","create","constructor","update","Matrix4","plane","lightPosition4D","dot","normal","x","y","z","constant","w","sme","elements","matrix","multiplyMatrices"],"mappings":";;;;;;;AAAAA,QACI,mBACD,SAAUC,GACT,aACA,IAeQC,EAfJC,EAAa,SAAUC,GACvB,IAAIC,EAAiB,IAAIJ,EAAMK,mBAC3BC,MAAO,EACPC,aAAa,EACbC,QAAS,GACTC,YAAY,IAEhBT,EAAMU,KAAKC,KAAKC,KAAMT,EAAKU,SAAUT,GACrCQ,KAAKE,WAAaX,EAAKY,YACvBH,KAAKI,eAAgB,EACrBJ,KAAKK,kBAAmB,GA4B5B,OA1BAf,EAAWgB,UAAYC,OAAOC,OAAOpB,EAAMU,KAAKQ,YAC3BG,YAAcnB,EACnCA,EAAWgB,UAAUI,QACbrB,EAAe,IAAID,EAAMuB,QACtB,SAAUC,EAAOC,GACpB,IAAIC,EAAMF,EAAMG,OAAOC,EAAIH,EAAgBG,EAAIJ,EAAMG,OAAOE,EAAIJ,EAAgBI,EAAIL,EAAMG,OAAOG,EAAIL,EAAgBK,GAAKN,EAAMO,SAAWN,EAAgBO,EACvJC,EAAMhC,EAAaiC,SACvBD,EAAI,GAAKP,EAAMD,EAAgBG,EAAIJ,EAAMG,OAAOC,EAChDK,EAAI,IAAMR,EAAgBG,EAAIJ,EAAMG,OAAOE,EAC3CI,EAAI,IAAMR,EAAgBG,EAAIJ,EAAMG,OAAOG,EAC3CG,EAAI,KAAOR,EAAgBG,GAAKJ,EAAMO,SACtCE,EAAI,IAAMR,EAAgBI,EAAIL,EAAMG,OAAOC,EAC3CK,EAAI,GAAKP,EAAMD,EAAgBI,EAAIL,EAAMG,OAAOE,EAChDI,EAAI,IAAMR,EAAgBI,EAAIL,EAAMG,OAAOG,EAC3CG,EAAI,KAAOR,EAAgBI,GAAKL,EAAMO,SACtCE,EAAI,IAAMR,EAAgBK,EAAIN,EAAMG,OAAOC,EAC3CK,EAAI,IAAMR,EAAgBK,EAAIN,EAAMG,OAAOE,EAC3CI,EAAI,IAAMP,EAAMD,EAAgBK,EAAIN,EAAMG,OAAOG,EACjDG,EAAI,KAAOR,EAAgBK,GAAKN,EAAMO,SACtCE,EAAI,IAAMR,EAAgBO,EAAIR,EAAMG,OAAOC,EAC3CK,EAAI,IAAMR,EAAgBO,EAAIR,EAAMG,OAAOE,EAC3CI,EAAI,KAAOR,EAAgBO,EAAIR,EAAMG,OAAOG,EAC5CG,EAAI,IAAMP,EAAMD,EAAgBO,GAAKR,EAAMO,SAC3CnB,KAAKuB,OAAOC,iBAAiBnC,EAAcW,KAAKE,cAGjDZ","file":"../../objects/ShadowMesh.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    var ShadowMesh = function (mesh) {\n        var shadowMaterial = new THREE.MeshBasicMaterial({\n            color: 0,\n            transparent: true,\n            opacity: 0.6,\n            depthWrite: false\n        });\n        THREE.Mesh.call(this, mesh.geometry, shadowMaterial);\n        this.meshMatrix = mesh.matrixWorld;\n        this.frustumCulled = false;\n        this.matrixAutoUpdate = false;\n    };\n    ShadowMesh.prototype = Object.create(THREE.Mesh.prototype);\n    ShadowMesh.prototype.constructor = ShadowMesh;\n    ShadowMesh.prototype.update = function () {\n        var shadowMatrix = new THREE.Matrix4();\n        return function (plane, lightPosition4D) {\n            var dot = plane.normal.x * lightPosition4D.x + plane.normal.y * lightPosition4D.y + plane.normal.z * lightPosition4D.z + -plane.constant * lightPosition4D.w;\n            var sme = shadowMatrix.elements;\n            sme[0] = dot - lightPosition4D.x * plane.normal.x;\n            sme[4] = -lightPosition4D.x * plane.normal.y;\n            sme[8] = -lightPosition4D.x * plane.normal.z;\n            sme[12] = -lightPosition4D.x * -plane.constant;\n            sme[1] = -lightPosition4D.y * plane.normal.x;\n            sme[5] = dot - lightPosition4D.y * plane.normal.y;\n            sme[9] = -lightPosition4D.y * plane.normal.z;\n            sme[13] = -lightPosition4D.y * -plane.constant;\n            sme[2] = -lightPosition4D.z * plane.normal.x;\n            sme[6] = -lightPosition4D.z * plane.normal.y;\n            sme[10] = dot - lightPosition4D.z * plane.normal.z;\n            sme[14] = -lightPosition4D.z * -plane.constant;\n            sme[3] = -lightPosition4D.w * plane.normal.x;\n            sme[7] = -lightPosition4D.w * plane.normal.y;\n            sme[11] = -lightPosition4D.w * plane.normal.z;\n            sme[15] = dot - lightPosition4D.w * -plane.constant;\n            this.matrix.multiplyMatrices(shadowMatrix, this.meshMatrix);\n        };\n    }();\n    return ShadowMesh;\n});"]}