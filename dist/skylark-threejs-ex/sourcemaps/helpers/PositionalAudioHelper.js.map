{"version":3,"sources":["helpers/PositionalAudioHelper.js"],"names":["define","THREE","PositionalAudioHelper","audio","range","divisionsInnerAngle","divisionsOuterAngle","this","geometry","BufferGeometry","divisions","positions","Float32Array","setAttribute","BufferAttribute","materialInnerAngle","LineBasicMaterial","color","materialOuterAngle","Line","call","update","prototype","Object","create","constructor","i","stride","coneInnerAngle","MathUtils","degToRad","panner","coneOuterAngle","halfConeInnerAngle","halfConeOuterAngle","start","count","positionAttribute","attributes","position","generateSegment","from","to","materialIndex","step","setXYZ","Math","sin","cos","min","addGroup","clearGroups","needsUpdate","material","visible","dispose"],"mappings":";;;;;;;AAAAA,QACI,mBACD,SAAUC,GACT,aACA,SAASC,EAAsBC,EAAOC,EAAOC,EAAqBC,GAC9DC,KAAKJ,MAAQA,EACbI,KAAKH,MAAQA,GAAS,EACtBG,KAAKF,oBAAsBA,GAAuB,GAClDE,KAAKD,oBAAsBA,GAAuB,EAClD,IAAIE,EAAW,IAAIP,EAAMQ,eACrBC,EAAYH,KAAKF,oBAAiD,EAA3BE,KAAKD,oBAC5CK,EAAY,IAAIC,aAAmC,GAAT,EAAZF,EAAgB,IAClDF,EAASK,aAAa,WAAY,IAAIZ,EAAMa,gBAAgBH,EAAW,IACvE,IAAII,EAAqB,IAAId,EAAMe,mBAAoBC,MAAO,QAC1DC,EAAqB,IAAIjB,EAAMe,mBAAoBC,MAAO,WAC9DhB,EAAMkB,KAAKC,KAAKb,KAAMC,GAClBU,EACAH,IAEJR,KAAKc,SA+CT,OA7CAnB,EAAsBoB,UAAYC,OAAOC,OAAOvB,EAAMkB,KAAKG,WAC3DpB,EAAsBoB,UAAUG,YAAcvB,EAC9CA,EAAsBoB,UAAUD,OAAS,WACrC,IAUIK,EAAGC,EAVHxB,EAAQI,KAAKJ,MACbC,EAAQG,KAAKH,MACbC,EAAsBE,KAAKF,oBAC3BC,EAAsBC,KAAKD,oBAC3BsB,EAAiB3B,EAAM4B,UAAUC,SAAS3B,EAAM4B,OAAOH,gBACvDI,EAAiB/B,EAAM4B,UAAUC,SAAS3B,EAAM4B,OAAOC,gBACvDC,EAAqBL,EAAiB,EACtCM,EAAqBF,EAAiB,EACtCG,EAAQ,EACRC,EAAQ,EAER5B,EAAWD,KAAKC,SAChB6B,EAAoB7B,EAAS8B,WAAWC,SAE5C,SAASC,EAAgBC,EAAMC,EAAIhC,EAAWiC,GAC1C,IAAIC,GAAQF,EAAKD,GAAQ/B,EAGzB,IAFA2B,EAAkBQ,OAAOV,EAAO,EAAG,EAAG,GACtCC,IACKV,EAAIe,EAAMf,EAAIgB,EAAIhB,GAAKkB,EACxBjB,EAASQ,EAAQC,EACjBC,EAAkBQ,OAAOlB,EAAQmB,KAAKC,IAAIrB,GAAKtB,EAAO,EAAG0C,KAAKE,IAAItB,GAAKtB,GACvEiC,EAAkBQ,OAAOlB,EAAS,EAAGmB,KAAKC,IAAID,KAAKG,IAAIvB,EAAIkB,EAAMF,IAAOtC,EAAO,EAAG0C,KAAKE,IAAIF,KAAKG,IAAIvB,EAAIkB,EAAMF,IAAOtC,GACrHiC,EAAkBQ,OAAOlB,EAAS,EAAG,EAAG,EAAG,GAC3CS,GAAS,EAEb5B,EAAS0C,SAASf,EAAOC,EAAOO,GAChCR,GAASC,EACTA,EAAQ,EAdZ5B,EAAS2C,cAgBTX,GAAiBN,GAAqBD,EAAoB3B,EAAqB,GAC/EkC,GAAiBP,EAAoBA,EAAoB5B,EAAqB,GAC9EmC,EAAgBP,EAAoBC,EAAoB5B,EAAqB,GAC7E+B,EAAkBe,aAAc,EAC5BxB,IAAmBI,IACnBzB,KAAK8C,SAAS,GAAGC,SAAU,IAEnCpD,EAAsBoB,UAAUiC,QAAU,WACtChD,KAAKC,SAAS+C,UACdhD,KAAK8C,SAAS,GAAGE,UACjBhD,KAAK8C,SAAS,GAAGE,WAGdrD","file":"../../helpers/PositionalAudioHelper.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    function PositionalAudioHelper(audio, range, divisionsInnerAngle, divisionsOuterAngle) {\n        this.audio = audio;\n        this.range = range || 1;\n        this.divisionsInnerAngle = divisionsInnerAngle || 16;\n        this.divisionsOuterAngle = divisionsOuterAngle || 2;\n        var geometry = new THREE.BufferGeometry();\n        var divisions = this.divisionsInnerAngle + this.divisionsOuterAngle * 2;\n        var positions = new Float32Array((divisions * 3 + 3) * 3);\n        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n        var materialInnerAngle = new THREE.LineBasicMaterial({ color: 65280 });\n        var materialOuterAngle = new THREE.LineBasicMaterial({ color: 16776960 });\n        THREE.Line.call(this, geometry, [\n            materialOuterAngle,\n            materialInnerAngle\n        ]);\n        this.update();\n    }\n    PositionalAudioHelper.prototype = Object.create(THREE.Line.prototype);\n    PositionalAudioHelper.prototype.constructor = PositionalAudioHelper;\n    PositionalAudioHelper.prototype.update = function () {\n        var audio = this.audio;\n        var range = this.range;\n        var divisionsInnerAngle = this.divisionsInnerAngle;\n        var divisionsOuterAngle = this.divisionsOuterAngle;\n        var coneInnerAngle = THREE.MathUtils.degToRad(audio.panner.coneInnerAngle);\n        var coneOuterAngle = THREE.MathUtils.degToRad(audio.panner.coneOuterAngle);\n        var halfConeInnerAngle = coneInnerAngle / 2;\n        var halfConeOuterAngle = coneOuterAngle / 2;\n        var start = 0;\n        var count = 0;\n        var i, stride;\n        var geometry = this.geometry;\n        var positionAttribute = geometry.attributes.position;\n        geometry.clearGroups();\n        function generateSegment(from, to, divisions, materialIndex) {\n            var step = (to - from) / divisions;\n            positionAttribute.setXYZ(start, 0, 0, 0);\n            count++;\n            for (i = from; i < to; i += step) {\n                stride = start + count;\n                positionAttribute.setXYZ(stride, Math.sin(i) * range, 0, Math.cos(i) * range);\n                positionAttribute.setXYZ(stride + 1, Math.sin(Math.min(i + step, to)) * range, 0, Math.cos(Math.min(i + step, to)) * range);\n                positionAttribute.setXYZ(stride + 2, 0, 0, 0);\n                count += 3;\n            }\n            geometry.addGroup(start, count, materialIndex);\n            start += count;\n            count = 0;\n        }\n        generateSegment(-halfConeOuterAngle, -halfConeInnerAngle, divisionsOuterAngle, 0);\n        generateSegment(-halfConeInnerAngle, halfConeInnerAngle, divisionsInnerAngle, 1);\n        generateSegment(halfConeInnerAngle, halfConeOuterAngle, divisionsOuterAngle, 0);\n        positionAttribute.needsUpdate = true;\n        if (coneInnerAngle === coneOuterAngle)\n            this.material[0].visible = false;\n    };\n    PositionalAudioHelper.prototype.dispose = function () {\n        this.geometry.dispose();\n        this.material[0].dispose();\n        this.material[1].dispose();\n    };\n\n    return PositionalAudioHelper;\n});"]}