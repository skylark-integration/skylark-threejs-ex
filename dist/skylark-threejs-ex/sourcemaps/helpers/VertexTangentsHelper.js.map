{"version":3,"sources":["helpers/VertexTangentsHelper.js"],"names":["define","THREE","threex","_v1","Vector3","_v2","VertexTangentsHelper","object","size","hex","linewidth","this","undefined","color","width","objGeometry","geometry","isBufferGeometry","nTangents","attributes","tangent","count","BufferGeometry","positions","Float32BufferAttribute","setAttribute","LineSegments","call","LineBasicMaterial","matrixAutoUpdate","update","console","error","prototype","Object","create","constructor","updateMatrixWorld","matrixWorld","position","objPos","objTan","idx","j","jl","set","getX","getY","getZ","applyMatrix4","transformDirection","multiplyScalar","add","setXYZ","x","y","z","needsUpdate","helpers"],"mappings":";;;;;;;AAAAA,QACI,kBACA,aACD,SACCC,EACAC,GAEA,aACA,IAAIC,EAAM,IAAIF,EAAMG,QAChBC,EAAM,IAAIJ,EAAMG,QACpB,SAASE,EAAqBC,EAAQC,EAAMC,EAAKC,GAC7CC,KAAKJ,OAASA,EACdI,KAAKH,UAAgBI,IAATJ,EAAqBA,EAAO,EACxC,IAAIK,OAAgBD,IAARH,EAAoBA,EAAM,MAClCK,OAAsBF,IAAdF,EAA0BA,EAAY,EAC9CK,EAAcJ,KAAKJ,OAAOS,SAC9B,GAAMD,GAAeA,EAAYE,iBAAjC,CAIA,IAAIC,EAAYH,EAAYI,WAAWC,QAAQC,MAC3CL,EAAW,IAAIf,EAAMqB,eACrBC,EAAY,IAAItB,EAAMuB,uBAAmC,EAAZN,EAAgB,EAAG,GACpEF,EAASS,aAAa,WAAYF,GAClCtB,EAAMyB,aAAaC,KAAKhB,KAAMK,EAAU,IAAIf,EAAM2B,mBAC9Cf,MAAOA,EACPH,UAAWI,KAEfH,KAAKkB,kBAAmB,EACxBlB,KAAKmB,cAZDC,QAAQC,MAAM,gFAAiFjB,GAoCvG,OAtBAT,EAAqB2B,UAAYC,OAAOC,OAAOlC,EAAMyB,aAAaO,WAClE3B,EAAqB2B,UAAUG,YAAc9B,EAC7CA,EAAqB2B,UAAUH,OAAS,WACpCnB,KAAKJ,OAAO8B,mBAAkB,GAO9B,IANA,IAAIC,EAAc3B,KAAKJ,OAAO+B,YAC1BC,EAAW5B,KAAKK,SAASG,WAAWoB,SACpCxB,EAAcJ,KAAKJ,OAAOS,SAC1BwB,EAASzB,EAAYI,WAAWoB,SAChCE,EAAS1B,EAAYI,WAAWC,QAChCsB,EAAM,EACDC,EAAI,EAAGC,EAAKJ,EAAOnB,MAAOsB,EAAIC,EAAID,IACvCxC,EAAI0C,IAAIL,EAAOM,KAAKH,GAAIH,EAAOO,KAAKJ,GAAIH,EAAOQ,KAAKL,IAAIM,aAAaX,GACrEjC,EAAIwC,IAAIJ,EAAOK,KAAKH,GAAIF,EAAOM,KAAKJ,GAAIF,EAAOO,KAAKL,IACpDtC,EAAI6C,mBAAmBZ,GAAaa,eAAexC,KAAKH,MAAM4C,IAAIjD,GAClEoC,EAASc,OAAOX,EAAKvC,EAAImD,EAAGnD,EAAIoD,EAAGpD,EAAIqD,GACvCd,GAAY,EACZH,EAASc,OAAOX,EAAKrC,EAAIiD,EAAGjD,EAAIkD,EAAGlD,EAAImD,GACvCd,GAAY,EAEhBH,EAASkB,aAAc,GAGpBvD,EAAOwD,QAAQpD,qBAAuBA","file":"../../helpers/VertexTangentsHelper.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var _v1 = new THREE.Vector3();\r\n    var _v2 = new THREE.Vector3();\r\n    function VertexTangentsHelper(object, size, hex, linewidth) {\r\n        this.object = object;\r\n        this.size = size !== undefined ? size : 1;\r\n        var color = hex !== undefined ? hex : 65535;\r\n        var width = linewidth !== undefined ? linewidth : 1;\r\n        var objGeometry = this.object.geometry;\r\n        if (!(objGeometry && objGeometry.isBufferGeometry)) {\r\n            console.error('THREE.VertexTangentsHelper: geometry not an instance of THREE.BufferGeometry.', objGeometry);\r\n            return;\r\n        }\r\n        var nTangents = objGeometry.attributes.tangent.count;\r\n        var geometry = new THREE.BufferGeometry();\r\n        var positions = new THREE.Float32BufferAttribute(nTangents * 2 * 3, 3);\r\n        geometry.setAttribute('position', positions);\r\n        THREE.LineSegments.call(this, geometry, new THREE.LineBasicMaterial({\r\n            color: color,\r\n            linewidth: width\r\n        }));\r\n        this.matrixAutoUpdate = false;\r\n        this.update();\r\n    }\r\n    VertexTangentsHelper.prototype = Object.create(THREE.LineSegments.prototype);\r\n    VertexTangentsHelper.prototype.constructor = VertexTangentsHelper;\r\n    VertexTangentsHelper.prototype.update = function () {\r\n        this.object.updateMatrixWorld(true);\r\n        var matrixWorld = this.object.matrixWorld;\r\n        var position = this.geometry.attributes.position;\r\n        var objGeometry = this.object.geometry;\r\n        var objPos = objGeometry.attributes.position;\r\n        var objTan = objGeometry.attributes.tangent;\r\n        var idx = 0;\r\n        for (var j = 0, jl = objPos.count; j < jl; j++) {\r\n            _v1.set(objPos.getX(j), objPos.getY(j), objPos.getZ(j)).applyMatrix4(matrixWorld);\r\n            _v2.set(objTan.getX(j), objTan.getY(j), objTan.getZ(j));\r\n            _v2.transformDirection(matrixWorld).multiplyScalar(this.size).add(_v1);\r\n            position.setXYZ(idx, _v1.x, _v1.y, _v1.z);\r\n            idx = idx + 1;\r\n            position.setXYZ(idx, _v2.x, _v2.y, _v2.z);\r\n            idx = idx + 1;\r\n        }\r\n        position.needsUpdate = true;\r\n    };\r\n\r\n    return threex.helpers.VertexTangentsHelper = VertexTangentsHelper;\r\n});"]}