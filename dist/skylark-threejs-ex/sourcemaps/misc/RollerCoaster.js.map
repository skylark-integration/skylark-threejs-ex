{"version":3,"sources":["misc/RollerCoaster.js"],"names":["define","THREE","RollerCoasterGeometry","curve","divisions","BufferGeometry","call","this","vertices","normals","colors","color1","color2","up","Vector3","forward","right","quaternion","Quaternion","prevQuaternion","setFromAxisAngle","Math","PI","point","prevPoint","copy","getPointAt","step","PI2","sides","tube1","i","angle","push","sin","cos","tube2","vector","normal","drawShape","shape","color","set","applyQuaternion","j","length","add","x","y","z","vector1","vector2","vector3","vector4","normal1","normal2","normal3","normal4","extrudeShape","offset","jl","point1","point2","normalize","subVectors","crossVectors","atan2","setAttribute","BufferAttribute","Float32Array","prototype","Object","create","RollerCoasterLiftersGeometry","tangent","tube3","fromPoint","toPoint","getTangentAt","RollerCoasterShadowGeometry","SkyGeometry","random","size","TreesGeometry","landscape","raycaster","Raycaster","ray","direction","origin","intersections","intersectObject","height"],"mappings":"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","file":"../../misc/RollerCoaster.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    var RollerCoasterGeometry = function (curve, divisions) {\n        THREE.BufferGeometry.call(this);\n        var vertices = [];\n        var normals = [];\n        var colors = [];\n        var color1 = [\n            1,\n            1,\n            1\n        ];\n        var color2 = [\n            1,\n            1,\n            0\n        ];\n        var up = new THREE.Vector3(0, 1, 0);\n        var forward = new THREE.Vector3();\n        var right = new THREE.Vector3();\n        var quaternion = new THREE.Quaternion();\n        var prevQuaternion = new THREE.Quaternion();\n        prevQuaternion.setFromAxisAngle(up, Math.PI / 2);\n        var point = new THREE.Vector3();\n        var prevPoint = new THREE.Vector3();\n        prevPoint.copy(curve.getPointAt(0));\n        var step = [\n            new THREE.Vector3(-0.225, 0, 0),\n            new THREE.Vector3(0, -0.05, 0),\n            new THREE.Vector3(0, -0.175, 0),\n            new THREE.Vector3(0, -0.05, 0),\n            new THREE.Vector3(0.225, 0, 0),\n            new THREE.Vector3(0, -0.175, 0)\n        ];\n        var PI2 = Math.PI * 2;\n        var sides = 5;\n        var tube1 = [];\n        for (var i = 0; i < sides; i++) {\n            var angle = i / sides * PI2;\n            tube1.push(new THREE.Vector3(Math.sin(angle) * 0.06, Math.cos(angle) * 0.06, 0));\n        }\n        var sides = 6;\n        var tube2 = [];\n        for (var i = 0; i < sides; i++) {\n            var angle = i / sides * PI2;\n            tube2.push(new THREE.Vector3(Math.sin(angle) * 0.025, Math.cos(angle) * 0.025, 0));\n        }\n        var vector = new THREE.Vector3();\n        var normal = new THREE.Vector3();\n        function drawShape(shape, color) {\n            normal.set(0, 0, -1).applyQuaternion(quaternion);\n            for (var j = 0; j < shape.length; j++) {\n                vector.copy(shape[j]);\n                vector.applyQuaternion(quaternion);\n                vector.add(point);\n                vertices.push(vector.x, vector.y, vector.z);\n                normals.push(normal.x, normal.y, normal.z);\n                colors.push(color[0], color[1], color[2]);\n            }\n            normal.set(0, 0, 1).applyQuaternion(quaternion);\n            for (var j = shape.length - 1; j >= 0; j--) {\n                vector.copy(shape[j]);\n                vector.applyQuaternion(quaternion);\n                vector.add(point);\n                vertices.push(vector.x, vector.y, vector.z);\n                normals.push(normal.x, normal.y, normal.z);\n                colors.push(color[0], color[1], color[2]);\n            }\n        }\n        var vector1 = new THREE.Vector3();\n        var vector2 = new THREE.Vector3();\n        var vector3 = new THREE.Vector3();\n        var vector4 = new THREE.Vector3();\n        var normal1 = new THREE.Vector3();\n        var normal2 = new THREE.Vector3();\n        var normal3 = new THREE.Vector3();\n        var normal4 = new THREE.Vector3();\n        function extrudeShape(shape, offset, color) {\n            for (var j = 0, jl = shape.length; j < jl; j++) {\n                var point1 = shape[j];\n                var point2 = shape[(j + 1) % jl];\n                vector1.copy(point1).add(offset);\n                vector1.applyQuaternion(quaternion);\n                vector1.add(point);\n                vector2.copy(point2).add(offset);\n                vector2.applyQuaternion(quaternion);\n                vector2.add(point);\n                vector3.copy(point2).add(offset);\n                vector3.applyQuaternion(prevQuaternion);\n                vector3.add(prevPoint);\n                vector4.copy(point1).add(offset);\n                vector4.applyQuaternion(prevQuaternion);\n                vector4.add(prevPoint);\n                vertices.push(vector1.x, vector1.y, vector1.z);\n                vertices.push(vector2.x, vector2.y, vector2.z);\n                vertices.push(vector4.x, vector4.y, vector4.z);\n                vertices.push(vector2.x, vector2.y, vector2.z);\n                vertices.push(vector3.x, vector3.y, vector3.z);\n                vertices.push(vector4.x, vector4.y, vector4.z);\n                normal1.copy(point1);\n                normal1.applyQuaternion(quaternion);\n                normal1.normalize();\n                normal2.copy(point2);\n                normal2.applyQuaternion(quaternion);\n                normal2.normalize();\n                normal3.copy(point2);\n                normal3.applyQuaternion(prevQuaternion);\n                normal3.normalize();\n                normal4.copy(point1);\n                normal4.applyQuaternion(prevQuaternion);\n                normal4.normalize();\n                normals.push(normal1.x, normal1.y, normal1.z);\n                normals.push(normal2.x, normal2.y, normal2.z);\n                normals.push(normal4.x, normal4.y, normal4.z);\n                normals.push(normal2.x, normal2.y, normal2.z);\n                normals.push(normal3.x, normal3.y, normal3.z);\n                normals.push(normal4.x, normal4.y, normal4.z);\n                colors.push(color[0], color[1], color[2]);\n                colors.push(color[0], color[1], color[2]);\n                colors.push(color[0], color[1], color[2]);\n                colors.push(color[0], color[1], color[2]);\n                colors.push(color[0], color[1], color[2]);\n                colors.push(color[0], color[1], color[2]);\n            }\n        }\n        var offset = new THREE.Vector3();\n        for (var i = 1; i <= divisions; i++) {\n            point.copy(curve.getPointAt(i / divisions));\n            up.set(0, 1, 0);\n            forward.subVectors(point, prevPoint).normalize();\n            right.crossVectors(up, forward).normalize();\n            up.crossVectors(forward, right);\n            var angle = Math.atan2(forward.x, forward.z);\n            quaternion.setFromAxisAngle(up, angle);\n            if (i % 2 === 0) {\n                drawShape(step, color2);\n            }\n            extrudeShape(tube1, offset.set(0, -0.125, 0), color2);\n            extrudeShape(tube2, offset.set(0.2, 0, 0), color1);\n            extrudeShape(tube2, offset.set(-0.2, 0, 0), color1);\n            prevPoint.copy(point);\n            prevQuaternion.copy(quaternion);\n        }\n        this.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));\n        this.setAttribute('normal', new THREE.BufferAttribute(new Float32Array(normals), 3));\n        this.setAttribute('color', new THREE.BufferAttribute(new Float32Array(colors), 3));\n    };\n    RollerCoasterGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n    var RollerCoasterLiftersGeometry = function (curve, divisions) {\n        THREE.BufferGeometry.call(this);\n        var vertices = [];\n        var normals = [];\n        var quaternion = new THREE.Quaternion();\n        var up = new THREE.Vector3(0, 1, 0);\n        var point = new THREE.Vector3();\n        var tangent = new THREE.Vector3();\n        var tube1 = [\n            new THREE.Vector3(0, 0.05, -0.05),\n            new THREE.Vector3(0, 0.05, 0.05),\n            new THREE.Vector3(0, -0.05, 0)\n        ];\n        var tube2 = [\n            new THREE.Vector3(-0.05, 0, 0.05),\n            new THREE.Vector3(-0.05, 0, -0.05),\n            new THREE.Vector3(0.05, 0, 0)\n        ];\n        var tube3 = [\n            new THREE.Vector3(0.05, 0, -0.05),\n            new THREE.Vector3(0.05, 0, 0.05),\n            new THREE.Vector3(-0.05, 0, 0)\n        ];\n        var vector1 = new THREE.Vector3();\n        var vector2 = new THREE.Vector3();\n        var vector3 = new THREE.Vector3();\n        var vector4 = new THREE.Vector3();\n        var normal1 = new THREE.Vector3();\n        var normal2 = new THREE.Vector3();\n        var normal3 = new THREE.Vector3();\n        var normal4 = new THREE.Vector3();\n        function extrudeShape(shape, fromPoint, toPoint) {\n            for (var j = 0, jl = shape.length; j < jl; j++) {\n                var point1 = shape[j];\n                var point2 = shape[(j + 1) % jl];\n                vector1.copy(point1);\n                vector1.applyQuaternion(quaternion);\n                vector1.add(fromPoint);\n                vector2.copy(point2);\n                vector2.applyQuaternion(quaternion);\n                vector2.add(fromPoint);\n                vector3.copy(point2);\n                vector3.applyQuaternion(quaternion);\n                vector3.add(toPoint);\n                vector4.copy(point1);\n                vector4.applyQuaternion(quaternion);\n                vector4.add(toPoint);\n                vertices.push(vector1.x, vector1.y, vector1.z);\n                vertices.push(vector2.x, vector2.y, vector2.z);\n                vertices.push(vector4.x, vector4.y, vector4.z);\n                vertices.push(vector2.x, vector2.y, vector2.z);\n                vertices.push(vector3.x, vector3.y, vector3.z);\n                vertices.push(vector4.x, vector4.y, vector4.z);\n                normal1.copy(point1);\n                normal1.applyQuaternion(quaternion);\n                normal1.normalize();\n                normal2.copy(point2);\n                normal2.applyQuaternion(quaternion);\n                normal2.normalize();\n                normal3.copy(point2);\n                normal3.applyQuaternion(quaternion);\n                normal3.normalize();\n                normal4.copy(point1);\n                normal4.applyQuaternion(quaternion);\n                normal4.normalize();\n                normals.push(normal1.x, normal1.y, normal1.z);\n                normals.push(normal2.x, normal2.y, normal2.z);\n                normals.push(normal4.x, normal4.y, normal4.z);\n                normals.push(normal2.x, normal2.y, normal2.z);\n                normals.push(normal3.x, normal3.y, normal3.z);\n                normals.push(normal4.x, normal4.y, normal4.z);\n            }\n        }\n        var fromPoint = new THREE.Vector3();\n        var toPoint = new THREE.Vector3();\n        for (var i = 1; i <= divisions; i++) {\n            point.copy(curve.getPointAt(i / divisions));\n            tangent.copy(curve.getTangentAt(i / divisions));\n            var angle = Math.atan2(tangent.x, tangent.z);\n            quaternion.setFromAxisAngle(up, angle);\n            if (point.y > 10) {\n                fromPoint.set(-0.75, -0.35, 0);\n                fromPoint.applyQuaternion(quaternion);\n                fromPoint.add(point);\n                toPoint.set(0.75, -0.35, 0);\n                toPoint.applyQuaternion(quaternion);\n                toPoint.add(point);\n                extrudeShape(tube1, fromPoint, toPoint);\n                fromPoint.set(-0.7, -0.3, 0);\n                fromPoint.applyQuaternion(quaternion);\n                fromPoint.add(point);\n                toPoint.set(-0.7, -point.y, 0);\n                toPoint.applyQuaternion(quaternion);\n                toPoint.add(point);\n                extrudeShape(tube2, fromPoint, toPoint);\n                fromPoint.set(0.7, -0.3, 0);\n                fromPoint.applyQuaternion(quaternion);\n                fromPoint.add(point);\n                toPoint.set(0.7, -point.y, 0);\n                toPoint.applyQuaternion(quaternion);\n                toPoint.add(point);\n                extrudeShape(tube3, fromPoint, toPoint);\n            } else {\n                fromPoint.set(0, -0.2, 0);\n                fromPoint.applyQuaternion(quaternion);\n                fromPoint.add(point);\n                toPoint.set(0, -point.y, 0);\n                toPoint.applyQuaternion(quaternion);\n                toPoint.add(point);\n                extrudeShape(tube3, fromPoint, toPoint);\n            }\n        }\n        this.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));\n        this.setAttribute('normal', new THREE.BufferAttribute(new Float32Array(normals), 3));\n    };\n    RollerCoasterLiftersGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n    var RollerCoasterShadowGeometry = function (curve, divisions) {\n        THREE.BufferGeometry.call(this);\n        var vertices = [];\n        var up = new THREE.Vector3(0, 1, 0);\n        var forward = new THREE.Vector3();\n        var quaternion = new THREE.Quaternion();\n        var prevQuaternion = new THREE.Quaternion();\n        prevQuaternion.setFromAxisAngle(up, Math.PI / 2);\n        var point = new THREE.Vector3();\n        var prevPoint = new THREE.Vector3();\n        prevPoint.copy(curve.getPointAt(0));\n        prevPoint.y = 0;\n        var vector1 = new THREE.Vector3();\n        var vector2 = new THREE.Vector3();\n        var vector3 = new THREE.Vector3();\n        var vector4 = new THREE.Vector3();\n        for (var i = 1; i <= divisions; i++) {\n            point.copy(curve.getPointAt(i / divisions));\n            point.y = 0;\n            forward.subVectors(point, prevPoint);\n            var angle = Math.atan2(forward.x, forward.z);\n            quaternion.setFromAxisAngle(up, angle);\n            vector1.set(-0.3, 0, 0);\n            vector1.applyQuaternion(quaternion);\n            vector1.add(point);\n            vector2.set(0.3, 0, 0);\n            vector2.applyQuaternion(quaternion);\n            vector2.add(point);\n            vector3.set(0.3, 0, 0);\n            vector3.applyQuaternion(prevQuaternion);\n            vector3.add(prevPoint);\n            vector4.set(-0.3, 0, 0);\n            vector4.applyQuaternion(prevQuaternion);\n            vector4.add(prevPoint);\n            vertices.push(vector1.x, vector1.y, vector1.z);\n            vertices.push(vector2.x, vector2.y, vector2.z);\n            vertices.push(vector4.x, vector4.y, vector4.z);\n            vertices.push(vector2.x, vector2.y, vector2.z);\n            vertices.push(vector3.x, vector3.y, vector3.z);\n            vertices.push(vector4.x, vector4.y, vector4.z);\n            prevPoint.copy(point);\n            prevQuaternion.copy(quaternion);\n        }\n        this.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));\n    };\n    RollerCoasterShadowGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n    var SkyGeometry = function () {\n        THREE.BufferGeometry.call(this);\n        var vertices = [];\n        for (var i = 0; i < 100; i++) {\n            var x = Math.random() * 800 - 400;\n            var y = Math.random() * 50 + 50;\n            var z = Math.random() * 800 - 400;\n            var size = Math.random() * 40 + 20;\n            vertices.push(x - size, y, z - size);\n            vertices.push(x + size, y, z - size);\n            vertices.push(x - size, y, z + size);\n            vertices.push(x + size, y, z - size);\n            vertices.push(x + size, y, z + size);\n            vertices.push(x - size, y, z + size);\n        }\n        this.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));\n    };\n    SkyGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n    var TreesGeometry = function (landscape) {\n        THREE.BufferGeometry.call(this);\n        var vertices = [];\n        var colors = [];\n        var raycaster = new THREE.Raycaster();\n        raycaster.ray.direction.set(0, -1, 0);\n        for (var i = 0; i < 2000; i++) {\n            var x = Math.random() * 500 - 250;\n            var z = Math.random() * 500 - 250;\n            raycaster.ray.origin.set(x, 50, z);\n            var intersections = raycaster.intersectObject(landscape);\n            if (intersections.length === 0)\n                continue;\n            var y = intersections[0].point.y;\n            var height = Math.random() * 5 + 0.5;\n            var angle = Math.random() * Math.PI * 2;\n            vertices.push(x + Math.sin(angle), y, z + Math.cos(angle));\n            vertices.push(x, y + height, z);\n            vertices.push(x + Math.sin(angle + Math.PI), y, z + Math.cos(angle + Math.PI));\n            angle += Math.PI / 2;\n            vertices.push(x + Math.sin(angle), y, z + Math.cos(angle));\n            vertices.push(x, y + height, z);\n            vertices.push(x + Math.sin(angle + Math.PI), y, z + Math.cos(angle + Math.PI));\n            var random = Math.random() * 0.1;\n            for (var j = 0; j < 6; j++) {\n                colors.push(0.2 + random, 0.4 + random, 0);\n            }\n        }\n        this.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));\n        this.setAttribute('color', new THREE.BufferAttribute(new Float32Array(colors), 3));\n    };\n    TreesGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n    return {\n        RollerCoasterGeometry,\n        RollerCoasterLiftersGeometry,\n        RollerCoasterShadowGeometry,\n        SkyGeometry,\n        TreesGeometry\n    };\n});"]}