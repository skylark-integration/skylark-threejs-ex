{"version":3,"sources":["misc/MD2CharacterComplex.js"],"names":["define","THREE","MD2Loader","MorphBlendMesh","scope","this","loadTextures","baseUrl","textureUrls","textureLoader","TextureLoader","textures","i","length","load","checkLoadingComplete","mapping","UVMapping","name","encoding","sRGBEncoding","createPart","geometry","skinMap","materialWireframe","MeshLambertMaterial","color","wireframe","morphTargets","morphNormals","materialTexture","map","mesh","rotation","y","Math","PI","autoCreateAnimations","animationFPS","loadCounter","onLoadComplete","exponentialEaseOut","k","pow","scale","transitionFrames","maxSpeed","maxReverseSpeed","frontAcceleration","backAcceleration","frontDecceleration","angularSpeed","root","Object3D","meshBody","meshWeapon","controls","skinsBody","skinsWeapon","weapons","currentSkin","undefined","meshes","animations","speed","bodyOrientation","walkSpeed","crouchSpeed","activeAnimation","oldAnimation","enableShadows","enable","castShadow","receiveShadow","setVisible","visible","shareParts","original","set","position","add","push","loadParts","config","skins","weaponsTextures","loader","body","geo","boundingBox","Box3","setFromBufferAttribute","attributes","min","generateCallback","index","setPlaybackRate","rate","duration","baseDuration","setWireframe","wireframeEnabled","material","setSkin","setWeapon","activeWeapon","playAnimation","setAnimationTime","getAnimationTime","setAnimation","animationName","setAnimationWeight","blendCounter","update","delta","updateMovementModel","updateBehaviors","updateAnimations","mix","moveAnimation","idleAnimation","crouch","jump","attack","moveForward","moveBackward","moveLeft","moveRight","abs","setAnimationDirectionForward","setAnimationDirectionBackward","MathUtils","clamp","forwardDelta","x","sin","z","cos"],"mappings":"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","file":"../../misc/MD2CharacterComplex.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    '../loaders/MD2Loader',\n    './MorphBlendMesh'\n], function (\n    THREE, \n    MD2Loader, \n    MorphBlendMesh\n) {\n    'use strict';\n    var MD2CharacterComplex = function () {\n        var scope = this;\n        this.scale = 1;\n        this.animationFPS = 6;\n        this.transitionFrames = 15;\n        this.maxSpeed = 275;\n        this.maxReverseSpeed = -275;\n        this.frontAcceleration = 600;\n        this.backAcceleration = 600;\n        this.frontDecceleration = 600;\n        this.angularSpeed = 2.5;\n        this.root = new THREE.Object3D();\n        this.meshBody = null;\n        this.meshWeapon = null;\n        this.controls = null;\n        this.skinsBody = [];\n        this.skinsWeapon = [];\n        this.weapons = [];\n        this.currentSkin = undefined;\n        this.onLoadComplete = function () {\n        };\n        this.meshes = [];\n        this.animations = {};\n        this.loadCounter = 0;\n        this.speed = 0;\n        this.bodyOrientation = 0;\n        this.walkSpeed = this.maxSpeed;\n        this.crouchSpeed = this.maxSpeed * 0.5;\n        this.activeAnimation = null;\n        this.oldAnimation = null;\n        this.enableShadows = function (enable) {\n            for (var i = 0; i < this.meshes.length; i++) {\n                this.meshes[i].castShadow = enable;\n                this.meshes[i].receiveShadow = enable;\n            }\n        };\n        this.setVisible = function (enable) {\n            for (var i = 0; i < this.meshes.length; i++) {\n                this.meshes[i].visible = enable;\n                this.meshes[i].visible = enable;\n            }\n        };\n        this.shareParts = function (original) {\n            this.animations = original.animations;\n            this.walkSpeed = original.walkSpeed;\n            this.crouchSpeed = original.crouchSpeed;\n            this.skinsBody = original.skinsBody;\n            this.skinsWeapon = original.skinsWeapon;\n            var mesh = createPart(original.meshBody.geometry, this.skinsBody[0]);\n            mesh.scale.set(this.scale, this.scale, this.scale);\n            this.root.position.y = original.root.position.y;\n            this.root.add(mesh);\n            this.meshBody = mesh;\n            this.meshes.push(mesh);\n            for (var i = 0; i < original.weapons.length; i++) {\n                var meshWeapon = createPart(original.weapons[i].geometry, this.skinsWeapon[i]);\n                meshWeapon.scale.set(this.scale, this.scale, this.scale);\n                meshWeapon.visible = false;\n                meshWeapon.name = original.weapons[i].name;\n                this.root.add(meshWeapon);\n                this.weapons[i] = meshWeapon;\n                this.meshWeapon = meshWeapon;\n                this.meshes.push(meshWeapon);\n            }\n        };\n        this.loadParts = function (config) {\n            this.animations = config.animations;\n            this.walkSpeed = config.walkSpeed;\n            this.crouchSpeed = config.crouchSpeed;\n            this.loadCounter = config.weapons.length * 2 + config.skins.length + 1;\n            var weaponsTextures = [];\n            for (var i = 0; i < config.weapons.length; i++)\n                weaponsTextures[i] = config.weapons[i][1];\n            this.skinsBody = loadTextures(config.baseUrl + 'skins/', config.skins);\n            this.skinsWeapon = loadTextures(config.baseUrl + 'skins/', weaponsTextures);\n            var loader = new MD2Loader();\n            loader.load(config.baseUrl + config.body, function (geo) {\n                var boundingBox = new THREE.Box3();\n                boundingBox.setFromBufferAttribute(geo.attributes.position);\n                scope.root.position.y = -scope.scale * boundingBox.min.y;\n                var mesh = createPart(geo, scope.skinsBody[0]);\n                mesh.scale.set(scope.scale, scope.scale, scope.scale);\n                scope.root.add(mesh);\n                scope.meshBody = mesh;\n                scope.meshes.push(mesh);\n                checkLoadingComplete();\n            });\n            var generateCallback = function (index, name) {\n                return function (geo) {\n                    var mesh = createPart(geo, scope.skinsWeapon[index]);\n                    mesh.scale.set(scope.scale, scope.scale, scope.scale);\n                    mesh.visible = false;\n                    mesh.name = name;\n                    scope.root.add(mesh);\n                    scope.weapons[index] = mesh;\n                    scope.meshWeapon = mesh;\n                    scope.meshes.push(mesh);\n                    checkLoadingComplete();\n                };\n            };\n            for (var i = 0; i < config.weapons.length; i++) {\n                loader.load(config.baseUrl + config.weapons[i][0], generateCallback(i, config.weapons[i][0]));\n            }\n        };\n        this.setPlaybackRate = function (rate) {\n            if (this.meshBody)\n                this.meshBody.duration = this.meshBody.baseDuration / rate;\n            if (this.meshWeapon)\n                this.meshWeapon.duration = this.meshWeapon.baseDuration / rate;\n        };\n        this.setWireframe = function (wireframeEnabled) {\n            if (wireframeEnabled) {\n                if (this.meshBody)\n                    this.meshBody.material = this.meshBody.materialWireframe;\n                if (this.meshWeapon)\n                    this.meshWeapon.material = this.meshWeapon.materialWireframe;\n            } else {\n                if (this.meshBody)\n                    this.meshBody.material = this.meshBody.materialTexture;\n                if (this.meshWeapon)\n                    this.meshWeapon.material = this.meshWeapon.materialTexture;\n            }\n        };\n        this.setSkin = function (index) {\n            if (this.meshBody && this.meshBody.material.wireframe === false) {\n                this.meshBody.material.map = this.skinsBody[index];\n                this.currentSkin = index;\n            }\n        };\n        this.setWeapon = function (index) {\n            for (var i = 0; i < this.weapons.length; i++)\n                this.weapons[i].visible = false;\n            var activeWeapon = this.weapons[index];\n            if (activeWeapon) {\n                activeWeapon.visible = true;\n                this.meshWeapon = activeWeapon;\n                if (this.activeAnimation) {\n                    activeWeapon.playAnimation(this.activeAnimation);\n                    this.meshWeapon.setAnimationTime(this.activeAnimation, this.meshBody.getAnimationTime(this.activeAnimation));\n                }\n            }\n        };\n        this.setAnimation = function (animationName) {\n            if (animationName === this.activeAnimation || !animationName)\n                return;\n            if (this.meshBody) {\n                this.meshBody.setAnimationWeight(animationName, 0);\n                this.meshBody.playAnimation(animationName);\n                this.oldAnimation = this.activeAnimation;\n                this.activeAnimation = animationName;\n                this.blendCounter = this.transitionFrames;\n            }\n            if (this.meshWeapon) {\n                this.meshWeapon.setAnimationWeight(animationName, 0);\n                this.meshWeapon.playAnimation(animationName);\n            }\n        };\n        this.update = function (delta) {\n            if (this.controls)\n                this.updateMovementModel(delta);\n            if (this.animations) {\n                this.updateBehaviors();\n                this.updateAnimations(delta);\n            }\n        };\n        this.updateAnimations = function (delta) {\n            var mix = 1;\n            if (this.blendCounter > 0) {\n                mix = (this.transitionFrames - this.blendCounter) / this.transitionFrames;\n                this.blendCounter -= 1;\n            }\n            if (this.meshBody) {\n                this.meshBody.update(delta);\n                this.meshBody.setAnimationWeight(this.activeAnimation, mix);\n                this.meshBody.setAnimationWeight(this.oldAnimation, 1 - mix);\n            }\n            if (this.meshWeapon) {\n                this.meshWeapon.update(delta);\n                this.meshWeapon.setAnimationWeight(this.activeAnimation, mix);\n                this.meshWeapon.setAnimationWeight(this.oldAnimation, 1 - mix);\n            }\n        };\n        this.updateBehaviors = function () {\n            var controls = this.controls;\n            var animations = this.animations;\n            var moveAnimation, idleAnimation;\n            if (controls.crouch) {\n                moveAnimation = animations['crouchMove'];\n                idleAnimation = animations['crouchIdle'];\n            } else {\n                moveAnimation = animations['move'];\n                idleAnimation = animations['idle'];\n            }\n            if (controls.jump) {\n                moveAnimation = animations['jump'];\n                idleAnimation = animations['jump'];\n            }\n            if (controls.attack) {\n                if (controls.crouch) {\n                    moveAnimation = animations['crouchAttack'];\n                    idleAnimation = animations['crouchAttack'];\n                } else {\n                    moveAnimation = animations['attack'];\n                    idleAnimation = animations['attack'];\n                }\n            }\n            if (controls.moveForward || controls.moveBackward || controls.moveLeft || controls.moveRight) {\n                if (this.activeAnimation !== moveAnimation) {\n                    this.setAnimation(moveAnimation);\n                }\n            }\n            if (Math.abs(this.speed) < 0.2 * this.maxSpeed && !(controls.moveLeft || controls.moveRight || controls.moveForward || controls.moveBackward)) {\n                if (this.activeAnimation !== idleAnimation) {\n                    this.setAnimation(idleAnimation);\n                }\n            }\n            if (controls.moveForward) {\n                if (this.meshBody) {\n                    this.meshBody.setAnimationDirectionForward(this.activeAnimation);\n                    this.meshBody.setAnimationDirectionForward(this.oldAnimation);\n                }\n                if (this.meshWeapon) {\n                    this.meshWeapon.setAnimationDirectionForward(this.activeAnimation);\n                    this.meshWeapon.setAnimationDirectionForward(this.oldAnimation);\n                }\n            }\n            if (controls.moveBackward) {\n                if (this.meshBody) {\n                    this.meshBody.setAnimationDirectionBackward(this.activeAnimation);\n                    this.meshBody.setAnimationDirectionBackward(this.oldAnimation);\n                }\n                if (this.meshWeapon) {\n                    this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation);\n                    this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation);\n                }\n            }\n        };\n        this.updateMovementModel = function (delta) {\n            var controls = this.controls;\n            if (controls.crouch)\n                this.maxSpeed = this.crouchSpeed;\n            else\n                this.maxSpeed = this.walkSpeed;\n            this.maxReverseSpeed = -this.maxSpeed;\n            if (controls.moveForward)\n                this.speed = THREE.MathUtils.clamp(this.speed + delta * this.frontAcceleration, this.maxReverseSpeed, this.maxSpeed);\n            if (controls.moveBackward)\n                this.speed = THREE.MathUtils.clamp(this.speed - delta * this.backAcceleration, this.maxReverseSpeed, this.maxSpeed);\n            var dir = 1;\n            if (controls.moveLeft) {\n                this.bodyOrientation += delta * this.angularSpeed;\n                this.speed = THREE.MathUtils.clamp(this.speed + dir * delta * this.frontAcceleration, this.maxReverseSpeed, this.maxSpeed);\n            }\n            if (controls.moveRight) {\n                this.bodyOrientation -= delta * this.angularSpeed;\n                this.speed = THREE.MathUtils.clamp(this.speed + dir * delta * this.frontAcceleration, this.maxReverseSpeed, this.maxSpeed);\n            }\n            if (!(controls.moveForward || controls.moveBackward)) {\n                if (this.speed > 0) {\n                    var k = exponentialEaseOut(this.speed / this.maxSpeed);\n                    this.speed = THREE.MathUtils.clamp(this.speed - k * delta * this.frontDecceleration, 0, this.maxSpeed);\n                } else {\n                    var k = exponentialEaseOut(this.speed / this.maxReverseSpeed);\n                    this.speed = THREE.MathUtils.clamp(this.speed + k * delta * this.backAcceleration, this.maxReverseSpeed, 0);\n                }\n            }\n            var forwardDelta = this.speed * delta;\n            this.root.position.x += Math.sin(this.bodyOrientation) * forwardDelta;\n            this.root.position.z += Math.cos(this.bodyOrientation) * forwardDelta;\n            this.root.rotation.y = this.bodyOrientation;\n        };\n        function loadTextures(baseUrl, textureUrls) {\n            var textureLoader = new THREE.TextureLoader();\n            var textures = [];\n            for (var i = 0; i < textureUrls.length; i++) {\n                textures[i] = textureLoader.load(baseUrl + textureUrls[i], checkLoadingComplete);\n                textures[i].mapping = THREE.UVMapping;\n                textures[i].name = textureUrls[i];\n                textures[i].encoding = THREE.sRGBEncoding;\n            }\n            return textures;\n        }\n        function createPart(geometry, skinMap) {\n            var materialWireframe = new THREE.MeshLambertMaterial({\n                color: 16755200,\n                wireframe: true,\n                morphTargets: true,\n                morphNormals: true\n            });\n            var materialTexture = new THREE.MeshLambertMaterial({\n                color: 16777215,\n                wireframe: false,\n                map: skinMap,\n                morphTargets: true,\n                morphNormals: true\n            });\n            var mesh = new MorphBlendMesh(geometry, materialTexture);\n            mesh.rotation.y = -Math.PI / 2;\n            mesh.materialTexture = materialTexture;\n            mesh.materialWireframe = materialWireframe;\n            mesh.autoCreateAnimations(scope.animationFPS);\n            return mesh;\n        }\n        function checkLoadingComplete() {\n            scope.loadCounter -= 1;\n            if (scope.loadCounter === 0)\n                scope.onLoadComplete();\n        }\n        function exponentialEaseOut(k) {\n            return k === 1 ? 1 : -Math.pow(2, -10 * k) + 1;\n        }\n    };\n    return MD2CharacterComplex;\n});"]}