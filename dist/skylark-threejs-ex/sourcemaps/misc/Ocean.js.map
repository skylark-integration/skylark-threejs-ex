{"version":3,"sources":["misc/Ocean.js"],"names":["define","THREE","threex","OceanShaders","Ocean","renderer","camera","scene","options","optionalParameter","value","defaultValue","undefined","this","changed","initial","oceanCamera","OrthographicCamera","position","z","clearColor","Scene","CLEAR_COLOR","geometryOrigin","GEOMETRY_ORIGIN","sunDirectionX","SUN_DIRECTION","sunDirectionY","sunDirectionZ","oceanColor","OCEAN_COLOR","Vector3","skyColor","SKY_COLOR","exposure","EXPOSURE","geometryResolution","GEOMETRY_RESOLUTION","geometrySize","GEOMETRY_SIZE","resolution","RESOLUTION","floatSize","SIZE_OF_FLOAT","windX","INITIAL_WIND","windY","size","INITIAL_SIZE","choppiness","INITIAL_CHOPPINESS","matrixNeedsUpdate","renderTargetType","USE_HALF_FLOAT","HalfFloatType","FloatType","LinearClampParams","minFilter","LinearFilter","magFilter","wrapS","ClampToEdgeWrapping","wrapT","format","RGBAFormat","stencilBuffer","depthBuffer","premultiplyAlpha","type","NearestClampParams","NearestFilter","NearestRepeatParams","RepeatWrapping","initialSpectrumFramebuffer","WebGLRenderTarget","spectrumFramebuffer","pingPhaseFramebuffer","pongPhaseFramebuffer","pingTransformFramebuffer","pongTransformFramebuffer","displacementMapFramebuffer","normalMapFramebuffer","fullscreeenVertexShader","oceanHorizontalShader","oceanHorizontalUniforms","UniformsUtils","clone","uniforms","materialOceanHorizontal","ShaderMaterial","vertexShader","fragmentShader","u_transformSize","u_subtransformSize","u_input","depthTest","oceanVerticalShader","oceanVerticalUniforms","materialOceanVertical","initialSpectrumShader","initialSpectrumUniforms","materialInitialSpectrum","u_wind","Vector2","u_resolution","phaseShader","phaseUniforms","materialPhase","spectrumShader","spectrumUniforms","materialSpectrum","u_initialSpectrum","normalShader","normalUniforms","materialNormal","u_displacementMap","oceanShader","oceanUniforms","materialOcean","u_geometrySize","texture","u_normalMap","u_oceanColor","u_skyColor","u_sunDirection","u_exposure","blending","screenQuad","Mesh","PlaneBufferGeometry","add","generateSeedPhaseTexture","generateMesh","prototype","geometry","rotateX","Math","PI","oceanMesh","render","currentRenderTarget","getRenderTarget","overrideMaterial","renderInitialSpectrum","renderWavePhase","renderSpectrum","renderSpectrumFFT","renderNormalMap","setRenderTarget","pingPhase","phaseArray","window","Float32Array","i","j","random","pingPhaseTexture","DataTexture","set","u_size","clear","material","u_phases","u_deltaTime","deltaTime","u_choppiness","iterations","log","pow","misc"],"mappings":"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","file":"../../misc/Ocean.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\",\r\n    '../shaders/OceanShaders'\r\n], function (\r\n    THREE, \r\n    threex,\r\n    OceanShaders\r\n) {\r\n    'use strict';\r\n    var Ocean = function (renderer, camera, scene, options) {\r\n        this.changed = true;\r\n        this.initial = true;\r\n        this.oceanCamera = new THREE.OrthographicCamera();\r\n        this.oceanCamera.position.z = 1;\r\n        this.renderer = renderer;\r\n        this.renderer.clearColor(16777215);\r\n        this.scene = new THREE.Scene();\r\n        function optionalParameter(value, defaultValue) {\r\n            return value !== undefined ? value : defaultValue;\r\n        }\r\n        options = options || {};\r\n        this.clearColor = optionalParameter(options.CLEAR_COLOR, [\r\n            1,\r\n            1,\r\n            1,\r\n            0\r\n        ]);\r\n        this.geometryOrigin = optionalParameter(options.GEOMETRY_ORIGIN, [\r\n            -1000,\r\n            -1000\r\n        ]);\r\n        this.sunDirectionX = optionalParameter(options.SUN_DIRECTION[0], -1);\r\n        this.sunDirectionY = optionalParameter(options.SUN_DIRECTION[1], 1);\r\n        this.sunDirectionZ = optionalParameter(options.SUN_DIRECTION[2], 1);\r\n        this.oceanColor = optionalParameter(options.OCEAN_COLOR, new THREE.Vector3(0.004, 0.016, 0.047));\r\n        this.skyColor = optionalParameter(options.SKY_COLOR, new THREE.Vector3(3.2, 9.6, 12.8));\r\n        this.exposure = optionalParameter(options.EXPOSURE, 0.35);\r\n        this.geometryResolution = optionalParameter(options.GEOMETRY_RESOLUTION, 32);\r\n        this.geometrySize = optionalParameter(options.GEOMETRY_SIZE, 2000);\r\n        this.resolution = optionalParameter(options.RESOLUTION, 64);\r\n        this.floatSize = optionalParameter(options.SIZE_OF_FLOAT, 4);\r\n        this.windX = optionalParameter(options.INITIAL_WIND[0], 10);\r\n        this.windY = optionalParameter(options.INITIAL_WIND[1], 10);\r\n        this.size = optionalParameter(options.INITIAL_SIZE, 250);\r\n        this.choppiness = optionalParameter(options.INITIAL_CHOPPINESS, 1.5);\r\n        this.matrixNeedsUpdate = false;\r\n        var renderTargetType = optionalParameter(options.USE_HALF_FLOAT, false) ? THREE.HalfFloatType : THREE.FloatType;\r\n        var LinearClampParams = {\r\n            minFilter: THREE.LinearFilter,\r\n            magFilter: THREE.LinearFilter,\r\n            wrapS: THREE.ClampToEdgeWrapping,\r\n            wrapT: THREE.ClampToEdgeWrapping,\r\n            format: THREE.RGBAFormat,\r\n            stencilBuffer: false,\r\n            depthBuffer: false,\r\n            premultiplyAlpha: false,\r\n            type: renderTargetType\r\n        };\r\n        var NearestClampParams = {\r\n            minFilter: THREE.NearestFilter,\r\n            magFilter: THREE.NearestFilter,\r\n            wrapS: THREE.ClampToEdgeWrapping,\r\n            wrapT: THREE.ClampToEdgeWrapping,\r\n            format: THREE.RGBAFormat,\r\n            stencilBuffer: false,\r\n            depthBuffer: false,\r\n            premultiplyAlpha: false,\r\n            type: renderTargetType\r\n        };\r\n        var NearestRepeatParams = {\r\n            minFilter: THREE.NearestFilter,\r\n            magFilter: THREE.NearestFilter,\r\n            wrapS: THREE.RepeatWrapping,\r\n            wrapT: THREE.RepeatWrapping,\r\n            format: THREE.RGBAFormat,\r\n            stencilBuffer: false,\r\n            depthBuffer: false,\r\n            premultiplyAlpha: false,\r\n            type: renderTargetType\r\n        };\r\n        this.initialSpectrumFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, NearestRepeatParams);\r\n        this.spectrumFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, NearestClampParams);\r\n        this.pingPhaseFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, NearestClampParams);\r\n        this.pongPhaseFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, NearestClampParams);\r\n        this.pingTransformFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, NearestClampParams);\r\n        this.pongTransformFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, NearestClampParams);\r\n        this.displacementMapFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, LinearClampParams);\r\n        this.normalMapFramebuffer = new THREE.WebGLRenderTarget(this.resolution, this.resolution, LinearClampParams);\r\n        var fullscreeenVertexShader = OceanShaders['ocean_sim_vertex'];\r\n        var oceanHorizontalShader = OceanShaders['ocean_subtransform'];\r\n        var oceanHorizontalUniforms = THREE.UniformsUtils.clone(oceanHorizontalShader.uniforms);\r\n        this.materialOceanHorizontal = new THREE.ShaderMaterial({\r\n            uniforms: oceanHorizontalUniforms,\r\n            vertexShader: fullscreeenVertexShader.vertexShader,\r\n            fragmentShader: '#define HORIZONTAL \\n' + oceanHorizontalShader.fragmentShader\r\n        });\r\n        this.materialOceanHorizontal.uniforms.u_transformSize = { value: this.resolution };\r\n        this.materialOceanHorizontal.uniforms.u_subtransformSize = { value: null };\r\n        this.materialOceanHorizontal.uniforms.u_input = { value: null };\r\n        this.materialOceanHorizontal.depthTest = false;\r\n        var oceanVerticalShader = OceanShaders['ocean_subtransform'];\r\n        var oceanVerticalUniforms = THREE.UniformsUtils.clone(oceanVerticalShader.uniforms);\r\n        this.materialOceanVertical = new THREE.ShaderMaterial({\r\n            uniforms: oceanVerticalUniforms,\r\n            vertexShader: fullscreeenVertexShader.vertexShader,\r\n            fragmentShader: oceanVerticalShader.fragmentShader\r\n        });\r\n        this.materialOceanVertical.uniforms.u_transformSize = { value: this.resolution };\r\n        this.materialOceanVertical.uniforms.u_subtransformSize = { value: null };\r\n        this.materialOceanVertical.uniforms.u_input = { value: null };\r\n        this.materialOceanVertical.depthTest = false;\r\n        var initialSpectrumShader = OceanShaders['ocean_initial_spectrum'];\r\n        var initialSpectrumUniforms = THREE.UniformsUtils.clone(initialSpectrumShader.uniforms);\r\n        this.materialInitialSpectrum = new THREE.ShaderMaterial({\r\n            uniforms: initialSpectrumUniforms,\r\n            vertexShader: initialSpectrumShader.vertexShader,\r\n            fragmentShader: initialSpectrumShader.fragmentShader\r\n        });\r\n        this.materialInitialSpectrum.uniforms.u_wind = { value: new THREE.Vector2() };\r\n        this.materialInitialSpectrum.uniforms.u_resolution = { value: this.resolution };\r\n        this.materialInitialSpectrum.depthTest = false;\r\n        var phaseShader = OceanShaders['ocean_phase'];\r\n        var phaseUniforms = THREE.UniformsUtils.clone(phaseShader.uniforms);\r\n        this.materialPhase = new THREE.ShaderMaterial({\r\n            uniforms: phaseUniforms,\r\n            vertexShader: fullscreeenVertexShader.vertexShader,\r\n            fragmentShader: phaseShader.fragmentShader\r\n        });\r\n        this.materialPhase.uniforms.u_resolution = { value: this.resolution };\r\n        this.materialPhase.depthTest = false;\r\n        var spectrumShader = OceanShaders['ocean_spectrum'];\r\n        var spectrumUniforms = THREE.UniformsUtils.clone(spectrumShader.uniforms);\r\n        this.materialSpectrum = new THREE.ShaderMaterial({\r\n            uniforms: spectrumUniforms,\r\n            vertexShader: fullscreeenVertexShader.vertexShader,\r\n            fragmentShader: spectrumShader.fragmentShader\r\n        });\r\n        this.materialSpectrum.uniforms.u_initialSpectrum = { value: null };\r\n        this.materialSpectrum.uniforms.u_resolution = { value: this.resolution };\r\n        this.materialSpectrum.depthTest = false;\r\n        var normalShader = OceanShaders['ocean_normals'];\r\n        var normalUniforms = THREE.UniformsUtils.clone(normalShader.uniforms);\r\n        this.materialNormal = new THREE.ShaderMaterial({\r\n            uniforms: normalUniforms,\r\n            vertexShader: fullscreeenVertexShader.vertexShader,\r\n            fragmentShader: normalShader.fragmentShader\r\n        });\r\n        this.materialNormal.uniforms.u_displacementMap = { value: null };\r\n        this.materialNormal.uniforms.u_resolution = { value: this.resolution };\r\n        this.materialNormal.depthTest = false;\r\n        var oceanShader = OceanShaders['ocean_main'];\r\n        var oceanUniforms = THREE.UniformsUtils.clone(oceanShader.uniforms);\r\n        this.materialOcean = new THREE.ShaderMaterial({\r\n            uniforms: oceanUniforms,\r\n            vertexShader: oceanShader.vertexShader,\r\n            fragmentShader: oceanShader.fragmentShader\r\n        });\r\n        this.materialOcean.uniforms.u_geometrySize = { value: this.resolution };\r\n        this.materialOcean.uniforms.u_displacementMap = { value: this.displacementMapFramebuffer.texture };\r\n        this.materialOcean.uniforms.u_normalMap = { value: this.normalMapFramebuffer.texture };\r\n        this.materialOcean.uniforms.u_oceanColor = { value: this.oceanColor };\r\n        this.materialOcean.uniforms.u_skyColor = { value: this.skyColor };\r\n        this.materialOcean.uniforms.u_sunDirection = { value: new THREE.Vector3(this.sunDirectionX, this.sunDirectionY, this.sunDirectionZ) };\r\n        this.materialOcean.uniforms.u_exposure = { value: this.exposure };\r\n        this.materialOceanHorizontal.blending = 0;\r\n        this.materialOceanVertical.blending = 0;\r\n        this.materialInitialSpectrum.blending = 0;\r\n        this.materialPhase.blending = 0;\r\n        this.materialSpectrum.blending = 0;\r\n        this.materialNormal.blending = 0;\r\n        this.materialOcean.blending = 0;\r\n        this.screenQuad = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2));\r\n        this.scene.add(this.screenQuad);\r\n        this.generateSeedPhaseTexture();\r\n        this.generateMesh();\r\n    };\r\n    Ocean.prototype.generateMesh = function () {\r\n        var geometry = new THREE.PlaneBufferGeometry(this.geometrySize, this.geometrySize, this.geometryResolution, this.geometryResolution);\r\n        geometry.rotateX(-Math.PI / 2);\r\n        this.oceanMesh = new THREE.Mesh(geometry, this.materialOcean);\r\n    };\r\n    Ocean.prototype.render = function () {\r\n        var currentRenderTarget = this.renderer.getRenderTarget();\r\n        this.scene.overrideMaterial = null;\r\n        if (this.changed)\r\n            this.renderInitialSpectrum();\r\n        this.renderWavePhase();\r\n        this.renderSpectrum();\r\n        this.renderSpectrumFFT();\r\n        this.renderNormalMap();\r\n        this.scene.overrideMaterial = null;\r\n        this.renderer.setRenderTarget(currentRenderTarget);\r\n    };\r\n    Ocean.prototype.generateSeedPhaseTexture = function () {\r\n        this.pingPhase = true;\r\n        var phaseArray = new window.Float32Array(this.resolution * this.resolution * 4);\r\n        for (var i = 0; i < this.resolution; i++) {\r\n            for (var j = 0; j < this.resolution; j++) {\r\n                phaseArray[i * this.resolution * 4 + j * 4] = Math.random() * 2 * Math.PI;\r\n                phaseArray[i * this.resolution * 4 + j * 4 + 1] = 0;\r\n                phaseArray[i * this.resolution * 4 + j * 4 + 2] = 0;\r\n                phaseArray[i * this.resolution * 4 + j * 4 + 3] = 0;\r\n            }\r\n        }\r\n        this.pingPhaseTexture = new THREE.DataTexture(phaseArray, this.resolution, this.resolution, THREE.RGBAFormat);\r\n        this.pingPhaseTexture.wrapS = THREE.ClampToEdgeWrapping;\r\n        this.pingPhaseTexture.wrapT = THREE.ClampToEdgeWrapping;\r\n        this.pingPhaseTexture.type = THREE.FloatType;\r\n    };\r\n    Ocean.prototype.renderInitialSpectrum = function () {\r\n        this.scene.overrideMaterial = this.materialInitialSpectrum;\r\n        this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX, this.windY);\r\n        this.materialInitialSpectrum.uniforms.u_size.value = this.size;\r\n        this.renderer.setRenderTarget(this.initialSpectrumFramebuffer);\r\n        this.renderer.clear();\r\n        this.renderer.render(this.scene, this.oceanCamera);\r\n    };\r\n    Ocean.prototype.renderWavePhase = function () {\r\n        this.scene.overrideMaterial = this.materialPhase;\r\n        this.screenQuad.material = this.materialPhase;\r\n        if (this.initial) {\r\n            this.materialPhase.uniforms.u_phases.value = this.pingPhaseTexture;\r\n            this.initial = false;\r\n        } else {\r\n            this.materialPhase.uniforms.u_phases.value = this.pingPhase ? this.pingPhaseFramebuffer.texture : this.pongPhaseFramebuffer.texture;\r\n        }\r\n        this.materialPhase.uniforms.u_deltaTime.value = this.deltaTime;\r\n        this.materialPhase.uniforms.u_size.value = this.size;\r\n        this.renderer.setRenderTarget(this.pingPhase ? this.pongPhaseFramebuffer : this.pingPhaseFramebuffer);\r\n        this.renderer.render(this.scene, this.oceanCamera);\r\n        this.pingPhase = !this.pingPhase;\r\n    };\r\n    Ocean.prototype.renderSpectrum = function () {\r\n        this.scene.overrideMaterial = this.materialSpectrum;\r\n        this.materialSpectrum.uniforms.u_initialSpectrum.value = this.initialSpectrumFramebuffer.texture;\r\n        this.materialSpectrum.uniforms.u_phases.value = this.pingPhase ? this.pingPhaseFramebuffer.texture : this.pongPhaseFramebuffer.texture;\r\n        this.materialSpectrum.uniforms.u_choppiness.value = this.choppiness;\r\n        this.materialSpectrum.uniforms.u_size.value = this.size;\r\n        this.renderer.setRenderTarget(this.spectrumFramebuffer);\r\n        this.renderer.render(this.scene, this.oceanCamera);\r\n    };\r\n    Ocean.prototype.renderSpectrumFFT = function () {\r\n        var iterations = Math.log(this.resolution) / Math.log(2);\r\n        this.scene.overrideMaterial = this.materialOceanHorizontal;\r\n        for (var i = 0; i < iterations; i++) {\r\n            if (i === 0) {\r\n                this.materialOceanHorizontal.uniforms.u_input.value = this.spectrumFramebuffer.texture;\r\n                this.materialOceanHorizontal.uniforms.u_subtransformSize.value = Math.pow(2, i % iterations + 1);\r\n                this.renderer.setRenderTarget(this.pingTransformFramebuffer);\r\n                this.renderer.render(this.scene, this.oceanCamera);\r\n            } else if (i % 2 === 1) {\r\n                this.materialOceanHorizontal.uniforms.u_input.value = this.pingTransformFramebuffer.texture;\r\n                this.materialOceanHorizontal.uniforms.u_subtransformSize.value = Math.pow(2, i % iterations + 1);\r\n                this.renderer.setRenderTarget(this.pongTransformFramebuffer);\r\n                this.renderer.render(this.scene, this.oceanCamera);\r\n            } else {\r\n                this.materialOceanHorizontal.uniforms.u_input.value = this.pongTransformFramebuffer.texture;\r\n                this.materialOceanHorizontal.uniforms.u_subtransformSize.value = Math.pow(2, i % iterations + 1);\r\n                this.renderer.setRenderTarget(this.pingTransformFramebuffer);\r\n                this.renderer.render(this.scene, this.oceanCamera);\r\n            }\r\n        }\r\n        this.scene.overrideMaterial = this.materialOceanVertical;\r\n        for (var i = iterations; i < iterations * 2; i++) {\r\n            if (i === iterations * 2 - 1) {\r\n                this.materialOceanVertical.uniforms.u_input.value = iterations % 2 === 0 ? this.pingTransformFramebuffer.texture : this.pongTransformFramebuffer.texture;\r\n                this.materialOceanVertical.uniforms.u_subtransformSize.value = Math.pow(2, i % iterations + 1);\r\n                this.renderer.setRenderTarget(this.displacementMapFramebuffer);\r\n                this.renderer.render(this.scene, this.oceanCamera);\r\n            } else if (i % 2 === 1) {\r\n                this.materialOceanVertical.uniforms.u_input.value = this.pingTransformFramebuffer.texture;\r\n                this.materialOceanVertical.uniforms.u_subtransformSize.value = Math.pow(2, i % iterations + 1);\r\n                this.renderer.setRenderTarget(this.pongTransformFramebuffer);\r\n                this.renderer.render(this.scene, this.oceanCamera);\r\n            } else {\r\n                this.materialOceanVertical.uniforms.u_input.value = this.pongTransformFramebuffer.texture;\r\n                this.materialOceanVertical.uniforms.u_subtransformSize.value = Math.pow(2, i % iterations + 1);\r\n                this.renderer.setRenderTarget(this.pingTransformFramebuffer);\r\n                this.renderer.render(this.scene, this.oceanCamera);\r\n            }\r\n        }\r\n    };\r\n    Ocean.prototype.renderNormalMap = function () {\r\n        this.scene.overrideMaterial = this.materialNormal;\r\n        if (this.changed)\r\n            this.materialNormal.uniforms.u_size.value = this.size;\r\n        this.materialNormal.uniforms.u_displacementMap.value = this.displacementMapFramebuffer.texture;\r\n        this.renderer.setRenderTarget(this.normalMapFramebuffer);\r\n        this.renderer.clear();\r\n        this.renderer.render(this.scene, this.oceanCamera);\r\n    };\r\n    return threex.misc.Ocean = Ocean;\r\n});"]}