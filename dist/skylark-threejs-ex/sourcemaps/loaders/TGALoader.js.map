{"version":3,"sources":["loaders/TGALoader.js"],"names":["define","THREE","threex","TGALoader","manager","Loader","call","this","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","texture","Texture","loader","FileLoader","setResponseType","setPath","path","buffer","image","parse","needsUpdate","undefined","TGA_TYPE_NO_DATA","TGA_TYPE_INDEXED","TGA_TYPE_RGB","TGA_TYPE_GREY","TGA_TYPE_RLE_INDEXED","TGA_TYPE_RLE_RGB","TGA_TYPE_RLE_GREY","TGA_ORIGIN_MASK","TGA_ORIGIN_SHIFT","TGA_ORIGIN_BL","TGA_ORIGIN_BR","TGA_ORIGIN_UL","TGA_ORIGIN_UR","length","console","error","content","Uint8Array","offset","header","id_length","colormap_type","image_type","colormap_index","colormap_length","colormap_size","origin","width","height","pixel_size","flags","tgaCheckHeader","use_rle","use_pal","use_grey","useOffscreen","OffscreenCanvas","canvas","document","createElement","context","getContext","imageData","createImageData","result","data","pixel_data","pixel_total","palettes","subarray","c","count","i","shift","pixels","set","tgaParse","palette","x_start","y_start","x_step","y_step","x_end","y_end","color","x","y","tgaGetImageDataGrey8bits","tgaGetImageDataGrey16bits","colormap","tgaGetImageData8bits","tgaGetImageData16bits","tgaGetImageData24bits","tgaGetImageData32bits","getTgaRGBA","putImageData","transferToImageBitmap","loaders"],"mappings":";;;;;;;AAAAA,QACI,kBACA,aACD,SACCC,EACAC,GAEA,aACA,IAAIC,EAAY,SAAUC,GACtBH,EAAMI,OAAOC,KAAKC,KAAMH,IAyS5B,OAvSAD,EAAUK,UAAYC,OAAOC,OAAOD,OAAOE,OAAOV,EAAMI,OAAOG,YAC3DI,YAAaT,EACbU,KAAM,SAAUC,EAAKC,EAAQC,EAAYC,GACrC,IAAIC,EAAQX,KACRY,EAAU,IAAIlB,EAAMmB,QACpBC,EAAS,IAAIpB,EAAMqB,WAAWf,KAAKH,SAUvC,OATAiB,EAAOE,gBAAgB,eACvBF,EAAOG,QAAQjB,KAAKkB,MACpBJ,EAAOR,KAAKC,EAAK,SAAUY,GACvBP,EAAQQ,MAAQT,EAAMU,MAAMF,GAC5BP,EAAQU,aAAc,OACPC,IAAXf,GACAA,EAAOI,IAEZH,EAAYC,GACRE,GAEXS,MAAO,SAAUF,GA4Nb,IAAIK,EAAmB,EAAGC,EAAmB,EAAGC,EAAe,EAAGC,EAAgB,EAAGC,EAAuB,EAAGC,EAAmB,GAAIC,EAAoB,GAAIC,EAAkB,GAAIC,EAAmB,EAAGC,EAAgB,EAAGC,EAAgB,EAAGC,EAAgB,EAAGC,EAAgB,EAC/QjB,EAAOkB,OAAS,IAChBC,QAAQC,MAAM,uDAClB,IAAIC,EAAU,IAAIC,WAAWtB,GAASuB,EAAS,EAAGC,GAC1CC,UAAWJ,EAAQE,KACnBG,cAAeL,EAAQE,KACvBI,WAAYN,EAAQE,KACpBK,eAAgBP,EAAQE,KAAYF,EAAQE,MAAa,EACzDM,gBAAiBR,EAAQE,KAAYF,EAAQE,MAAa,EAC1DO,cAAeT,EAAQE,KACvBQ,QACIV,EAAQE,KAAYF,EAAQE,MAAa,EACzCF,EAAQE,KAAYF,EAAQE,MAAa,GAE7CS,MAAOX,EAAQE,KAAYF,EAAQE,MAAa,EAChDU,OAAQZ,EAAQE,KAAYF,EAAQE,MAAa,EACjDW,WAAYb,EAAQE,KACpBY,MAAOd,EAAQE,OA5OvB,SAAwBC,GACpB,OAAQA,EAAOG,YACf,KAAKrB,EACL,KAAKG,GACGe,EAAOK,gBAAkB,KAAgC,KAAzBL,EAAOM,eAAiD,IAAzBN,EAAOE,gBACtEP,QAAQC,MAAM,iEAElB,MACJ,KAAKb,EACL,KAAKC,EACL,KAAKE,EACL,KAAKC,EACGa,EAAOE,eACPP,QAAQC,MAAM,kEAElB,MACJ,KAAKf,EACDc,QAAQC,MAAM,6BAClB,QACID,QAAQC,MAAM,sCAAuCI,EAAOG,aAE5DH,EAAOQ,OAAS,GAAKR,EAAOS,QAAU,IACtCd,QAAQC,MAAM,wCAEQ,IAAtBI,EAAOU,YAA0C,KAAtBV,EAAOU,YAA2C,KAAtBV,EAAOU,YAA2C,KAAtBV,EAAOU,YAC1Ff,QAAQC,MAAM,4CAA6CI,EAAOU,YAqN1EE,CAAeZ,GACXA,EAAOC,UAAYF,EAASvB,EAAOkB,QACnCC,QAAQC,MAAM,6BAElBG,GAAUC,EAAOC,UACjB,IAAIY,GAAU,EAAOC,GAAU,EAAOC,GAAW,EACjD,OAAQf,EAAOG,YACf,KAAKlB,EACD4B,GAAU,EACVC,GAAU,EACV,MACJ,KAAKhC,EACDgC,GAAU,EACV,MACJ,KAAK5B,EACD2B,GAAU,EACV,MACJ,KAAK9B,EACD,MACJ,KAAKI,EACD0B,GAAU,EACVE,GAAW,EACX,MACJ,KAAK/B,EACD+B,GAAW,EAGf,IAAIC,EAA0C,oBAApBC,gBACtBC,EAASF,EAAe,IAAIC,gBAAgBjB,EAAOQ,MAAOR,EAAOS,QAAUU,SAASC,cAAc,UACtGF,EAAOV,MAAQR,EAAOQ,MACtBU,EAAOT,OAAST,EAAOS,OACvB,IAAIY,EAAUH,EAAOI,WAAW,MAC5BC,EAAYF,EAAQG,gBAAgBxB,EAAOQ,MAAOR,EAAOS,QACzDgB,EAnPJ,SAAkBZ,EAASC,EAASd,EAAQD,EAAQ2B,GAChD,IAAIC,EAAYjB,EAAYkB,EAAaC,EAMzC,GALAnB,EAAaV,EAAOU,YAAc,EAClCkB,EAAc5B,EAAOQ,MAAQR,EAAOS,OAASC,EACzCI,IACAe,EAAWH,EAAKI,SAAS/B,EAAQA,GAAUC,EAAOK,iBAAmBL,EAAOM,eAAiB,KAE7FO,EAAS,CAET,IAAIkB,EAAGC,EAAOC,EADdN,EAAa,IAAI7B,WAAW8B,GAI5B,IAFA,IAAIM,EAAQ,EACRC,EAAS,IAAIrC,WAAWY,GACrBwB,EAAQN,GAGX,GADAI,EAAoB,GAAP,KADbD,EAAIL,EAAK3B,OAED,IAAJgC,EAAS,CACT,IAAKE,EAAI,EAAGA,EAAIvB,IAAcuB,EAC1BE,EAAOF,GAAKP,EAAK3B,KAErB,IAAKkC,EAAI,EAAGA,EAAID,IAASC,EACrBN,EAAWS,IAAID,EAAQD,EAAQD,EAAIvB,GAEvCwB,GAASxB,EAAasB,MACnB,CAEH,IADAA,GAAStB,EACJuB,EAAI,EAAGA,EAAID,IAASC,EACrBN,EAAWO,EAAQD,GAAKP,EAAK3B,KAEjCmC,GAASF,QAIjBL,EAAaD,EAAKI,SAAS/B,EAAQA,GAAUe,EAAUd,EAAOQ,MAAQR,EAAOS,OAASmB,GAE1F,OACID,WAAYA,EACZE,SAAUA,GA+MLQ,CAASxB,EAASC,EAASd,EAAQD,EAAQF,IA1HxD,SAAoB6B,EAAMlB,EAAOC,EAAQhC,EAAO6D,GAC5C,IAAIC,EAASC,EAASC,EAAQC,EAAQC,EAAOC,EAC7C,QAAS5C,EAAOW,MAAQvB,IAAoBC,GAC5C,QACA,KAAKG,EACD+C,EAAU,EACVE,EAAS,EACTE,EAAQnC,EACRgC,EAAU,EACVE,EAAS,EACTE,EAAQnC,EACR,MACJ,KAAKnB,EACDiD,EAAU,EACVE,EAAS,EACTE,EAAQnC,EACRgC,EAAU/B,EAAS,EACnBiC,GAAU,EACVE,GAAS,EACT,MACJ,KAAKnD,EACD8C,EAAU/B,EAAQ,EAClBiC,GAAU,EACVE,GAAS,EACTH,EAAU,EACVE,EAAS,EACTE,EAAQnC,EACR,MACJ,KAAKlB,EACDgD,EAAU/B,EAAQ,EAClBiC,GAAU,EACVE,GAAS,EACTH,EAAU/B,EAAS,EACnBiC,GAAU,EACVE,GAAS,EAGb,GAAI7B,EACA,OAAQf,EAAOU,YACf,KAAK,GAlEb,SAAkCa,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GACzF,IAAIoE,EAAcC,EAAGC,EAAVd,EAAI,EACXzB,EAAQR,EAAOQ,MACnB,IAAKuC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAChC,IAAKI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQR,IACxCY,EAAQpE,EAAMwD,GACdV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKF,EACrCtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKF,EACrCtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKF,EACrCtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAK,IA0DrCC,CAAyBtB,EAAMc,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GAC/E,MACJ,KAAK,IAvDb,SAAmC8C,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GAC1F,IAAWqE,EAAGC,EAAVd,EAAI,EACJzB,EAAQR,EAAOQ,MACnB,IAAKuC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAChC,IAAKI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQR,GAAK,EAC7CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAgD/CgB,CAA0BvB,EAAMc,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GAChF,MACJ,QACIkB,QAAQC,MAAM,+CAIlB,OAAQI,EAAOU,YACf,KAAK,GArIb,SAA8Ba,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,EAAOoD,GAC5F,IACIgB,EAAcC,EAAGC,EADjBG,EAAWrB,EACJI,EAAI,EACXzB,EAAQR,EAAOQ,MACnB,IAAKuC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAChC,IAAKI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQR,IACxCY,EAAQpE,EAAMwD,GACdV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAK,IACrCxB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKG,EAAiB,EAARL,EAAY,GAC1DtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKG,EAAiB,EAARL,EAAY,GAC1DtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKG,EAAiB,EAARL,EAAY,GA4H1DM,CAAqBzB,EAAMc,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,EAAO6D,GAClF,MACJ,KAAK,IAzHb,SAA+Bf,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GACtF,IAAIoE,EAAcC,EAAGC,EAAVd,EAAI,EACXzB,EAAQR,EAAOQ,MACnB,IAAKuC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAChC,IAAKI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQR,GAAK,EAC7CY,EAAQpE,EAAMwD,EAAI,IAAMxD,EAAMwD,EAAI,IAAM,GACxCV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,IAAc,MAARF,IAAkB,EACxDtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,IAAc,IAARF,IAAgB,EACtDtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,IAAc,GAARF,IAAe,EACrDtB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAa,MAARF,EAAgB,EAAI,IAiHzDO,CAAsB1B,EAAMc,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GAC5E,MACJ,KAAK,IA9Gb,SAA+B8C,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GACtF,IAAWqE,EAAGC,EAAVd,EAAI,EACJzB,EAAQR,EAAOQ,MACnB,IAAKuC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAChC,IAAKI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQR,GAAK,EAC7CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAK,IACrCxB,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAuG/CoB,CAAsB3B,EAAMc,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GAC5E,MACJ,KAAK,IApGb,SAA+B8C,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GACtF,IAAWqE,EAAGC,EAAVd,EAAI,EACJzB,EAAQR,EAAOQ,MACnB,IAAKuC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAChC,IAAKI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQR,GAAK,EAC7CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GAC/CV,EAA4B,GAAjBuB,EAAItC,EAAQuC,GAAS,GAAKtE,EAAMwD,EAAI,GA6F/CqB,CAAsB5B,EAAMc,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAOlE,GAC5E,MACJ,QACIkB,QAAQC,MAAM,2CA2DX2D,CAAWhC,EAAUG,KAAM1B,EAAOQ,MAAOR,EAAOS,OAAQgB,EAAOE,WAAYF,EAAOI,UAEjG,OADAR,EAAQmC,aAAajC,EAAW,EAAG,GAC5BP,EAAeE,EAAOuC,wBAA0BvC,KAGvDlE,EAAO0G,QAAQzG,UAAYA","file":"../../loaders/TGALoader.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var TGALoader = function (manager) {\r\n        THREE.Loader.call(this, manager);\r\n    };\r\n    TGALoader.prototype = Object.assign(Object.create(THREE.Loader.prototype), {\r\n        constructor: TGALoader,\r\n        load: function (url, onLoad, onProgress, onError) {\r\n            var scope = this;\r\n            var texture = new THREE.Texture();\r\n            var loader = new THREE.FileLoader(this.manager);\r\n            loader.setResponseType('arraybuffer');\r\n            loader.setPath(this.path);\r\n            loader.load(url, function (buffer) {\r\n                texture.image = scope.parse(buffer);\r\n                texture.needsUpdate = true;\r\n                if (onLoad !== undefined) {\r\n                    onLoad(texture);\r\n                }\r\n            }, onProgress, onError);\r\n            return texture;\r\n        },\r\n        parse: function (buffer) {\r\n            function tgaCheckHeader(header) {\r\n                switch (header.image_type) {\r\n                case TGA_TYPE_INDEXED:\r\n                case TGA_TYPE_RLE_INDEXED:\r\n                    if (header.colormap_length > 256 || header.colormap_size !== 24 || header.colormap_type !== 1) {\r\n                        console.error('THREE.TGALoader: Invalid type colormap data for indexed type.');\r\n                    }\r\n                    break;\r\n                case TGA_TYPE_RGB:\r\n                case TGA_TYPE_GREY:\r\n                case TGA_TYPE_RLE_RGB:\r\n                case TGA_TYPE_RLE_GREY:\r\n                    if (header.colormap_type) {\r\n                        console.error('THREE.TGALoader: Invalid type colormap data for colormap type.');\r\n                    }\r\n                    break;\r\n                case TGA_TYPE_NO_DATA:\r\n                    console.error('THREE.TGALoader: No data.');\r\n                default:\r\n                    console.error('THREE.TGALoader: Invalid type \"%s\".', header.image_type);\r\n                }\r\n                if (header.width <= 0 || header.height <= 0) {\r\n                    console.error('THREE.TGALoader: Invalid image size.');\r\n                }\r\n                if (header.pixel_size !== 8 && header.pixel_size !== 16 && header.pixel_size !== 24 && header.pixel_size !== 32) {\r\n                    console.error('THREE.TGALoader: Invalid pixel size \"%s\".', header.pixel_size);\r\n                }\r\n            }\r\n            function tgaParse(use_rle, use_pal, header, offset, data) {\r\n                var pixel_data, pixel_size, pixel_total, palettes;\r\n                pixel_size = header.pixel_size >> 3;\r\n                pixel_total = header.width * header.height * pixel_size;\r\n                if (use_pal) {\r\n                    palettes = data.subarray(offset, offset += header.colormap_length * (header.colormap_size >> 3));\r\n                }\r\n                if (use_rle) {\r\n                    pixel_data = new Uint8Array(pixel_total);\r\n                    var c, count, i;\r\n                    var shift = 0;\r\n                    var pixels = new Uint8Array(pixel_size);\r\n                    while (shift < pixel_total) {\r\n                        c = data[offset++];\r\n                        count = (c & 127) + 1;\r\n                        if (c & 128) {\r\n                            for (i = 0; i < pixel_size; ++i) {\r\n                                pixels[i] = data[offset++];\r\n                            }\r\n                            for (i = 0; i < count; ++i) {\r\n                                pixel_data.set(pixels, shift + i * pixel_size);\r\n                            }\r\n                            shift += pixel_size * count;\r\n                        } else {\r\n                            count *= pixel_size;\r\n                            for (i = 0; i < count; ++i) {\r\n                                pixel_data[shift + i] = data[offset++];\r\n                            }\r\n                            shift += count;\r\n                        }\r\n                    }\r\n                } else {\r\n                    pixel_data = data.subarray(offset, offset += use_pal ? header.width * header.height : pixel_total);\r\n                }\r\n                return {\r\n                    pixel_data: pixel_data,\r\n                    palettes: palettes\r\n                };\r\n            }\r\n            function tgaGetImageData8bits(imageData, y_start, y_step, y_end, x_start, x_step, x_end, image, palettes) {\r\n                var colormap = palettes;\r\n                var color, i = 0, x, y;\r\n                var width = header.width;\r\n                for (y = y_start; y !== y_end; y += y_step) {\r\n                    for (x = x_start; x !== x_end; x += x_step, i++) {\r\n                        color = image[i];\r\n                        imageData[(x + width * y) * 4 + 3] = 255;\r\n                        imageData[(x + width * y) * 4 + 2] = colormap[color * 3 + 0];\r\n                        imageData[(x + width * y) * 4 + 1] = colormap[color * 3 + 1];\r\n                        imageData[(x + width * y) * 4 + 0] = colormap[color * 3 + 2];\r\n                    }\r\n                }\r\n                return imageData;\r\n            }\r\n            function tgaGetImageData16bits(imageData, y_start, y_step, y_end, x_start, x_step, x_end, image) {\r\n                var color, i = 0, x, y;\r\n                var width = header.width;\r\n                for (y = y_start; y !== y_end; y += y_step) {\r\n                    for (x = x_start; x !== x_end; x += x_step, i += 2) {\r\n                        color = image[i + 0] + (image[i + 1] << 8);\r\n                        imageData[(x + width * y) * 4 + 0] = (color & 31744) >> 7;\r\n                        imageData[(x + width * y) * 4 + 1] = (color & 992) >> 2;\r\n                        imageData[(x + width * y) * 4 + 2] = (color & 31) >> 3;\r\n                        imageData[(x + width * y) * 4 + 3] = color & 32768 ? 0 : 255;\r\n                    }\r\n                }\r\n                return imageData;\r\n            }\r\n            function tgaGetImageData24bits(imageData, y_start, y_step, y_end, x_start, x_step, x_end, image) {\r\n                var i = 0, x, y;\r\n                var width = header.width;\r\n                for (y = y_start; y !== y_end; y += y_step) {\r\n                    for (x = x_start; x !== x_end; x += x_step, i += 3) {\r\n                        imageData[(x + width * y) * 4 + 3] = 255;\r\n                        imageData[(x + width * y) * 4 + 2] = image[i + 0];\r\n                        imageData[(x + width * y) * 4 + 1] = image[i + 1];\r\n                        imageData[(x + width * y) * 4 + 0] = image[i + 2];\r\n                    }\r\n                }\r\n                return imageData;\r\n            }\r\n            function tgaGetImageData32bits(imageData, y_start, y_step, y_end, x_start, x_step, x_end, image) {\r\n                var i = 0, x, y;\r\n                var width = header.width;\r\n                for (y = y_start; y !== y_end; y += y_step) {\r\n                    for (x = x_start; x !== x_end; x += x_step, i += 4) {\r\n                        imageData[(x + width * y) * 4 + 2] = image[i + 0];\r\n                        imageData[(x + width * y) * 4 + 1] = image[i + 1];\r\n                        imageData[(x + width * y) * 4 + 0] = image[i + 2];\r\n                        imageData[(x + width * y) * 4 + 3] = image[i + 3];\r\n                    }\r\n                }\r\n                return imageData;\r\n            }\r\n            function tgaGetImageDataGrey8bits(imageData, y_start, y_step, y_end, x_start, x_step, x_end, image) {\r\n                var color, i = 0, x, y;\r\n                var width = header.width;\r\n                for (y = y_start; y !== y_end; y += y_step) {\r\n                    for (x = x_start; x !== x_end; x += x_step, i++) {\r\n                        color = image[i];\r\n                        imageData[(x + width * y) * 4 + 0] = color;\r\n                        imageData[(x + width * y) * 4 + 1] = color;\r\n                        imageData[(x + width * y) * 4 + 2] = color;\r\n                        imageData[(x + width * y) * 4 + 3] = 255;\r\n                    }\r\n                }\r\n                return imageData;\r\n            }\r\n            function tgaGetImageDataGrey16bits(imageData, y_start, y_step, y_end, x_start, x_step, x_end, image) {\r\n                var i = 0, x, y;\r\n                var width = header.width;\r\n                for (y = y_start; y !== y_end; y += y_step) {\r\n                    for (x = x_start; x !== x_end; x += x_step, i += 2) {\r\n                        imageData[(x + width * y) * 4 + 0] = image[i + 0];\r\n                        imageData[(x + width * y) * 4 + 1] = image[i + 0];\r\n                        imageData[(x + width * y) * 4 + 2] = image[i + 0];\r\n                        imageData[(x + width * y) * 4 + 3] = image[i + 1];\r\n                    }\r\n                }\r\n                return imageData;\r\n            }\r\n            function getTgaRGBA(data, width, height, image, palette) {\r\n                var x_start, y_start, x_step, y_step, x_end, y_end;\r\n                switch ((header.flags & TGA_ORIGIN_MASK) >> TGA_ORIGIN_SHIFT) {\r\n                default:\r\n                case TGA_ORIGIN_UL:\r\n                    x_start = 0;\r\n                    x_step = 1;\r\n                    x_end = width;\r\n                    y_start = 0;\r\n                    y_step = 1;\r\n                    y_end = height;\r\n                    break;\r\n                case TGA_ORIGIN_BL:\r\n                    x_start = 0;\r\n                    x_step = 1;\r\n                    x_end = width;\r\n                    y_start = height - 1;\r\n                    y_step = -1;\r\n                    y_end = -1;\r\n                    break;\r\n                case TGA_ORIGIN_UR:\r\n                    x_start = width - 1;\r\n                    x_step = -1;\r\n                    x_end = -1;\r\n                    y_start = 0;\r\n                    y_step = 1;\r\n                    y_end = height;\r\n                    break;\r\n                case TGA_ORIGIN_BR:\r\n                    x_start = width - 1;\r\n                    x_step = -1;\r\n                    x_end = -1;\r\n                    y_start = height - 1;\r\n                    y_step = -1;\r\n                    y_end = -1;\r\n                    break;\r\n                }\r\n                if (use_grey) {\r\n                    switch (header.pixel_size) {\r\n                    case 8:\r\n                        tgaGetImageDataGrey8bits(data, y_start, y_step, y_end, x_start, x_step, x_end, image);\r\n                        break;\r\n                    case 16:\r\n                        tgaGetImageDataGrey16bits(data, y_start, y_step, y_end, x_start, x_step, x_end, image);\r\n                        break;\r\n                    default:\r\n                        console.error('THREE.TGALoader: Format not supported.');\r\n                        break;\r\n                    }\r\n                } else {\r\n                    switch (header.pixel_size) {\r\n                    case 8:\r\n                        tgaGetImageData8bits(data, y_start, y_step, y_end, x_start, x_step, x_end, image, palette);\r\n                        break;\r\n                    case 16:\r\n                        tgaGetImageData16bits(data, y_start, y_step, y_end, x_start, x_step, x_end, image);\r\n                        break;\r\n                    case 24:\r\n                        tgaGetImageData24bits(data, y_start, y_step, y_end, x_start, x_step, x_end, image);\r\n                        break;\r\n                    case 32:\r\n                        tgaGetImageData32bits(data, y_start, y_step, y_end, x_start, x_step, x_end, image);\r\n                        break;\r\n                    default:\r\n                        console.error('THREE.TGALoader: Format not supported.');\r\n                        break;\r\n                    }\r\n                }\r\n                return data;\r\n            }\r\n            var TGA_TYPE_NO_DATA = 0, TGA_TYPE_INDEXED = 1, TGA_TYPE_RGB = 2, TGA_TYPE_GREY = 3, TGA_TYPE_RLE_INDEXED = 9, TGA_TYPE_RLE_RGB = 10, TGA_TYPE_RLE_GREY = 11, TGA_ORIGIN_MASK = 48, TGA_ORIGIN_SHIFT = 4, TGA_ORIGIN_BL = 0, TGA_ORIGIN_BR = 1, TGA_ORIGIN_UL = 2, TGA_ORIGIN_UR = 3;\r\n            if (buffer.length < 19)\r\n                console.error('THREE.TGALoader: Not enough data to contain header.');\r\n            var content = new Uint8Array(buffer), offset = 0, header = {\r\n                    id_length: content[offset++],\r\n                    colormap_type: content[offset++],\r\n                    image_type: content[offset++],\r\n                    colormap_index: content[offset++] | content[offset++] << 8,\r\n                    colormap_length: content[offset++] | content[offset++] << 8,\r\n                    colormap_size: content[offset++],\r\n                    origin: [\r\n                        content[offset++] | content[offset++] << 8,\r\n                        content[offset++] | content[offset++] << 8\r\n                    ],\r\n                    width: content[offset++] | content[offset++] << 8,\r\n                    height: content[offset++] | content[offset++] << 8,\r\n                    pixel_size: content[offset++],\r\n                    flags: content[offset++]\r\n                };\r\n            tgaCheckHeader(header);\r\n            if (header.id_length + offset > buffer.length) {\r\n                console.error('THREE.TGALoader: No data.');\r\n            }\r\n            offset += header.id_length;\r\n            var use_rle = false, use_pal = false, use_grey = false;\r\n            switch (header.image_type) {\r\n            case TGA_TYPE_RLE_INDEXED:\r\n                use_rle = true;\r\n                use_pal = true;\r\n                break;\r\n            case TGA_TYPE_INDEXED:\r\n                use_pal = true;\r\n                break;\r\n            case TGA_TYPE_RLE_RGB:\r\n                use_rle = true;\r\n                break;\r\n            case TGA_TYPE_RGB:\r\n                break;\r\n            case TGA_TYPE_RLE_GREY:\r\n                use_rle = true;\r\n                use_grey = true;\r\n                break;\r\n            case TGA_TYPE_GREY:\r\n                use_grey = true;\r\n                break;\r\n            }\r\n            var useOffscreen = typeof OffscreenCanvas !== 'undefined';\r\n            var canvas = useOffscreen ? new OffscreenCanvas(header.width, header.height) : document.createElement('canvas');\r\n            canvas.width = header.width;\r\n            canvas.height = header.height;\r\n            var context = canvas.getContext('2d');\r\n            var imageData = context.createImageData(header.width, header.height);\r\n            var result = tgaParse(use_rle, use_pal, header, offset, content);\r\n            var rgbaData = getTgaRGBA(imageData.data, header.width, header.height, result.pixel_data, result.palettes);\r\n            context.putImageData(imageData, 0, 0);\r\n            return useOffscreen ? canvas.transferToImageBitmap() : canvas;\r\n        }\r\n    });\r\n    return  threex.loaders.TGALoader = TGALoader;\r\n});"]}