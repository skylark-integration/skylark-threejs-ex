{"version":3,"sources":["loaders/AMFLoader.js"],"names":["define","THREE","threex","AMFLoader","manager","Loader","call","this","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setResponseType","text","parse","data","loadMaterials","node","matName","matId","attributes","id","textContent","color","r","g","b","a","loadedMaterial","i","childNodes","length","matChildEl","nodeName","undefined","type","value","loadColor","MeshPhongMaterial","flatShading","Color","name","transparent","opacity","material","matColor","loadMeshVolume","volume","triangles","materialid","currVolumeNode","firstElementChild","materialId","nodeValue","v1","getElementsByTagName","v2","v3","push","nextElementSibling","loadMeshVertices","vertArray","normalArray","currVerticesNode","vNode","x","y","z","nx","ny","nz","vertices","normals","loadObject","objId","loadedObject","meshes","currColor","currObjNode","currMeshNode","mesh","volumes","loadedVertices","concat","obj","j","xmlData","view","DataView","String","fromCharCode","getUint8","zip","file","console","log","JSZip","e","ReferenceError","files","toLowerCase","substr","asArrayBuffer","fileText","LoaderUtils","decodeText","DOMParser","parseFromString","documentElement","loadDocument","amfName","amfAuthor","amfScale","scale","unit","scaleUnits","millimeter","inch","feet","meter","micron","loadDocumentScale","amfMaterials","amfObjects","child","sceneObject","Group","defaultMaterial","userData","author","part","newObject","objDefaultMaterial","Float32BufferAttribute","clone","newGeometry","BufferGeometry","setIndex","setAttribute","add","Mesh","loaders"],"mappings":"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","file":"../../loaders/AMFLoader.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var AMFLoader = function (manager) {\r\n        THREE.Loader.call(this, manager);\r\n    };\r\n    AMFLoader.prototype = Object.assign(Object.create(THREE.Loader.prototype), {\r\n        constructor: AMFLoader,\r\n        load: function (url, onLoad, onProgress, onError) {\r\n            var scope = this;\r\n            var loader = new THREE.FileLoader(scope.manager);\r\n            loader.setPath(scope.path);\r\n            loader.setResponseType('arraybuffer');\r\n            loader.load(url, function (text) {\r\n                onLoad(scope.parse(text));\r\n            }, onProgress, onError);\r\n        },\r\n        parse: function (data) {\r\n            function loadDocument(data) {\r\n                var view = new DataView(data);\r\n                var magic = String.fromCharCode(view.getUint8(0), view.getUint8(1));\r\n                if (magic === 'PK') {\r\n                    var zip = null;\r\n                    var file = null;\r\n                    console.log('THREE.AMFLoader: Loading Zip');\r\n                    try {\r\n                        zip = new JSZip(data);\r\n                    } catch (e) {\r\n                        if (e instanceof ReferenceError) {\r\n                            console.log('THREE.AMFLoader: jszip missing and file is compressed.');\r\n                            return null;\r\n                        }\r\n                    }\r\n                    for (file in zip.files) {\r\n                        if (file.toLowerCase().substr(-4) === '.amf') {\r\n                            break;\r\n                        }\r\n                    }\r\n                    console.log('THREE.AMFLoader: Trying to load file asset: ' + file);\r\n                    view = new DataView(zip.file(file).asArrayBuffer());\r\n                }\r\n                var fileText = THREE.LoaderUtils.decodeText(view);\r\n                var xmlData = new DOMParser().parseFromString(fileText, 'application/xml');\r\n                if (xmlData.documentElement.nodeName.toLowerCase() !== 'amf') {\r\n                    console.log('THREE.AMFLoader: Error loading AMF - no AMF document found.');\r\n                    return null;\r\n                }\r\n                return xmlData;\r\n            }\r\n            function loadDocumentScale(node) {\r\n                var scale = 1;\r\n                var unit = 'millimeter';\r\n                if (node.documentElement.attributes.unit !== undefined) {\r\n                    unit = node.documentElement.attributes.unit.value.toLowerCase();\r\n                }\r\n                var scaleUnits = {\r\n                    millimeter: 1,\r\n                    inch: 25.4,\r\n                    feet: 304.8,\r\n                    meter: 1000,\r\n                    micron: 0.001\r\n                };\r\n                if (scaleUnits[unit] !== undefined) {\r\n                    scale = scaleUnits[unit];\r\n                }\r\n                console.log('THREE.AMFLoader: Unit scale: ' + scale);\r\n                return scale;\r\n            }\r\n            function loadMaterials(node) {\r\n                var matName = 'AMF Material';\r\n                var matId = node.attributes.id.textContent;\r\n                var color = {\r\n                    r: 1,\r\n                    g: 1,\r\n                    b: 1,\r\n                    a: 1\r\n                };\r\n                var loadedMaterial = null;\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    var matChildEl = node.childNodes[i];\r\n                    if (matChildEl.nodeName === 'metadata' && matChildEl.attributes.type !== undefined) {\r\n                        if (matChildEl.attributes.type.value === 'name') {\r\n                            matName = matChildEl.textContent;\r\n                        }\r\n                    } else if (matChildEl.nodeName === 'color') {\r\n                        color = loadColor(matChildEl);\r\n                    }\r\n                }\r\n                loadedMaterial = new THREE.MeshPhongMaterial({\r\n                    flatShading: true,\r\n                    color: new THREE.Color(color.r, color.g, color.b),\r\n                    name: matName\r\n                });\r\n                if (color.a !== 1) {\r\n                    loadedMaterial.transparent = true;\r\n                    loadedMaterial.opacity = color.a;\r\n                }\r\n                return {\r\n                    id: matId,\r\n                    material: loadedMaterial\r\n                };\r\n            }\r\n            function loadColor(node) {\r\n                var color = {\r\n                    r: 1,\r\n                    g: 1,\r\n                    b: 1,\r\n                    a: 1\r\n                };\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    var matColor = node.childNodes[i];\r\n                    if (matColor.nodeName === 'r') {\r\n                        color.r = matColor.textContent;\r\n                    } else if (matColor.nodeName === 'g') {\r\n                        color.g = matColor.textContent;\r\n                    } else if (matColor.nodeName === 'b') {\r\n                        color.b = matColor.textContent;\r\n                    } else if (matColor.nodeName === 'a') {\r\n                        color.a = matColor.textContent;\r\n                    }\r\n                }\r\n                return color;\r\n            }\r\n            function loadMeshVolume(node) {\r\n                var volume = {\r\n                    name: '',\r\n                    triangles: [],\r\n                    materialid: null\r\n                };\r\n                var currVolumeNode = node.firstElementChild;\r\n                if (node.attributes.materialid !== undefined) {\r\n                    volume.materialId = node.attributes.materialid.nodeValue;\r\n                }\r\n                while (currVolumeNode) {\r\n                    if (currVolumeNode.nodeName === 'metadata') {\r\n                        if (currVolumeNode.attributes.type !== undefined) {\r\n                            if (currVolumeNode.attributes.type.value === 'name') {\r\n                                volume.name = currVolumeNode.textContent;\r\n                            }\r\n                        }\r\n                    } else if (currVolumeNode.nodeName === 'triangle') {\r\n                        var v1 = currVolumeNode.getElementsByTagName('v1')[0].textContent;\r\n                        var v2 = currVolumeNode.getElementsByTagName('v2')[0].textContent;\r\n                        var v3 = currVolumeNode.getElementsByTagName('v3')[0].textContent;\r\n                        volume.triangles.push(v1, v2, v3);\r\n                    }\r\n                    currVolumeNode = currVolumeNode.nextElementSibling;\r\n                }\r\n                return volume;\r\n            }\r\n            function loadMeshVertices(node) {\r\n                var vertArray = [];\r\n                var normalArray = [];\r\n                var currVerticesNode = node.firstElementChild;\r\n                while (currVerticesNode) {\r\n                    if (currVerticesNode.nodeName === 'vertex') {\r\n                        var vNode = currVerticesNode.firstElementChild;\r\n                        while (vNode) {\r\n                            if (vNode.nodeName === 'coordinates') {\r\n                                var x = vNode.getElementsByTagName('x')[0].textContent;\r\n                                var y = vNode.getElementsByTagName('y')[0].textContent;\r\n                                var z = vNode.getElementsByTagName('z')[0].textContent;\r\n                                vertArray.push(x, y, z);\r\n                            } else if (vNode.nodeName === 'normal') {\r\n                                var nx = vNode.getElementsByTagName('nx')[0].textContent;\r\n                                var ny = vNode.getElementsByTagName('ny')[0].textContent;\r\n                                var nz = vNode.getElementsByTagName('nz')[0].textContent;\r\n                                normalArray.push(nx, ny, nz);\r\n                            }\r\n                            vNode = vNode.nextElementSibling;\r\n                        }\r\n                    }\r\n                    currVerticesNode = currVerticesNode.nextElementSibling;\r\n                }\r\n                return {\r\n                    'vertices': vertArray,\r\n                    'normals': normalArray\r\n                };\r\n            }\r\n            function loadObject(node) {\r\n                var objId = node.attributes.id.textContent;\r\n                var loadedObject = {\r\n                    name: 'amfobject',\r\n                    meshes: []\r\n                };\r\n                var currColor = null;\r\n                var currObjNode = node.firstElementChild;\r\n                while (currObjNode) {\r\n                    if (currObjNode.nodeName === 'metadata') {\r\n                        if (currObjNode.attributes.type !== undefined) {\r\n                            if (currObjNode.attributes.type.value === 'name') {\r\n                                loadedObject.name = currObjNode.textContent;\r\n                            }\r\n                        }\r\n                    } else if (currObjNode.nodeName === 'color') {\r\n                        currColor = loadColor(currObjNode);\r\n                    } else if (currObjNode.nodeName === 'mesh') {\r\n                        var currMeshNode = currObjNode.firstElementChild;\r\n                        var mesh = {\r\n                            vertices: [],\r\n                            normals: [],\r\n                            volumes: [],\r\n                            color: currColor\r\n                        };\r\n                        while (currMeshNode) {\r\n                            if (currMeshNode.nodeName === 'vertices') {\r\n                                var loadedVertices = loadMeshVertices(currMeshNode);\r\n                                mesh.normals = mesh.normals.concat(loadedVertices.normals);\r\n                                mesh.vertices = mesh.vertices.concat(loadedVertices.vertices);\r\n                            } else if (currMeshNode.nodeName === 'volume') {\r\n                                mesh.volumes.push(loadMeshVolume(currMeshNode));\r\n                            }\r\n                            currMeshNode = currMeshNode.nextElementSibling;\r\n                        }\r\n                        loadedObject.meshes.push(mesh);\r\n                    }\r\n                    currObjNode = currObjNode.nextElementSibling;\r\n                }\r\n                return {\r\n                    'id': objId,\r\n                    'obj': loadedObject\r\n                };\r\n            }\r\n            var xmlData = loadDocument(data);\r\n            var amfName = '';\r\n            var amfAuthor = '';\r\n            var amfScale = loadDocumentScale(xmlData);\r\n            var amfMaterials = {};\r\n            var amfObjects = {};\r\n            var childNodes = xmlData.documentElement.childNodes;\r\n            var i, j;\r\n            for (i = 0; i < childNodes.length; i++) {\r\n                var child = childNodes[i];\r\n                if (child.nodeName === 'metadata') {\r\n                    if (child.attributes.type !== undefined) {\r\n                        if (child.attributes.type.value === 'name') {\r\n                            amfName = child.textContent;\r\n                        } else if (child.attributes.type.value === 'author') {\r\n                            amfAuthor = child.textContent;\r\n                        }\r\n                    }\r\n                } else if (child.nodeName === 'material') {\r\n                    var loadedMaterial = loadMaterials(child);\r\n                    amfMaterials[loadedMaterial.id] = loadedMaterial.material;\r\n                } else if (child.nodeName === 'object') {\r\n                    var loadedObject = loadObject(child);\r\n                    amfObjects[loadedObject.id] = loadedObject.obj;\r\n                }\r\n            }\r\n            var sceneObject = new THREE.Group();\r\n            var defaultMaterial = new THREE.MeshPhongMaterial({\r\n                color: 11184895,\r\n                flatShading: true\r\n            });\r\n            sceneObject.name = amfName;\r\n            sceneObject.userData.author = amfAuthor;\r\n            sceneObject.userData.loader = 'AMF';\r\n            for (var id in amfObjects) {\r\n                var part = amfObjects[id];\r\n                var meshes = part.meshes;\r\n                var newObject = new THREE.Group();\r\n                newObject.name = part.name || '';\r\n                for (i = 0; i < meshes.length; i++) {\r\n                    var objDefaultMaterial = defaultMaterial;\r\n                    var mesh = meshes[i];\r\n                    var vertices = new THREE.Float32BufferAttribute(mesh.vertices, 3);\r\n                    var normals = null;\r\n                    if (mesh.normals.length) {\r\n                        normals = new THREE.Float32BufferAttribute(mesh.normals, 3);\r\n                    }\r\n                    if (mesh.color) {\r\n                        var color = mesh.color;\r\n                        objDefaultMaterial = defaultMaterial.clone();\r\n                        objDefaultMaterial.color = new THREE.Color(color.r, color.g, color.b);\r\n                        if (color.a !== 1) {\r\n                            objDefaultMaterial.transparent = true;\r\n                            objDefaultMaterial.opacity = color.a;\r\n                        }\r\n                    }\r\n                    var volumes = mesh.volumes;\r\n                    for (j = 0; j < volumes.length; j++) {\r\n                        var volume = volumes[j];\r\n                        var newGeometry = new THREE.BufferGeometry();\r\n                        var material = objDefaultMaterial;\r\n                        newGeometry.setIndex(volume.triangles);\r\n                        newGeometry.setAttribute('position', vertices.clone());\r\n                        if (normals) {\r\n                            newGeometry.setAttribute('normal', normals.clone());\r\n                        }\r\n                        if (amfMaterials[volume.materialId] !== undefined) {\r\n                            material = amfMaterials[volume.materialId];\r\n                        }\r\n                        newGeometry.scale(amfScale, amfScale, amfScale);\r\n                        newObject.add(new THREE.Mesh(newGeometry, material.clone()));\r\n                    }\r\n                }\r\n                sceneObject.add(newObject);\r\n            }\r\n            return sceneObject;\r\n        }\r\n    });\r\n\r\n    return threex.loaders.AMFLoader = AMFLoader;\r\n});"]}