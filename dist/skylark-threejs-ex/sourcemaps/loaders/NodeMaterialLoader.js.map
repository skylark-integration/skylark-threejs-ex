{"version":3,"sources":["loaders/NodeMaterialLoader.js"],"names":["define","THREE","threex","Nodes","NodeMaterialLoader","manager","library","this","undefined","DefaultLoadingManager","nodes","materials","passes","names","Object","assign","prototype","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","text","parse","JSON","value","getObjectByName","uuid","getObjectById","getNode","object","console","warn","resolve","json","test","Array","isArray","i","length","prop","declare","node","nodeType","name","type","material","pass","copy","loaders"],"mappings":"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","file":"../../loaders/NodeMaterialLoader.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\",\r\n    '../nodes/Nodes'\r\n], function (\r\n    THREE,\r\n    threex,\r\n    Nodes\r\n) {\r\n    'use strict';\r\n    var NodeMaterialLoader = function (manager, library) {\r\n        this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\r\n        this.nodes = {};\r\n        this.materials = {};\r\n        this.passes = {};\r\n        this.names = {};\r\n        this.library = library || {};\r\n    };\r\n    var NodeMaterialLoaderUtils = {\r\n        replaceUUIDObject: function (object, uuid, value, recursive) {\r\n            recursive = recursive !== undefined ? recursive : true;\r\n            if (typeof uuid === 'object')\r\n                uuid = uuid.uuid;\r\n            if (typeof object === 'object') {\r\n                var keys = Object.keys(object);\r\n                for (var i = 0; i < keys.length; i++) {\r\n                    var key = keys[i];\r\n                    if (recursive) {\r\n                        object[key] = this.replaceUUIDObject(object[key], uuid, value);\r\n                    }\r\n                    if (key === uuid) {\r\n                        object[uuid] = object[key];\r\n                        delete object[key];\r\n                    }\r\n                }\r\n            }\r\n            return object === uuid ? value : object;\r\n        },\r\n        replaceUUID: function (json, uuid, value) {\r\n            this.replaceUUIDObject(json, uuid, value, false);\r\n            this.replaceUUIDObject(json.nodes, uuid, value);\r\n            this.replaceUUIDObject(json.materials, uuid, value);\r\n            this.replaceUUIDObject(json.passes, uuid, value);\r\n            this.replaceUUIDObject(json.library, uuid, value, false);\r\n            return json;\r\n        }\r\n    };\r\n    Object.assign(NodeMaterialLoader.prototype, {\r\n        load: function (url, onLoad, onProgress, onError) {\r\n            var scope = this;\r\n            var loader = new THREE.FileLoader(scope.manager);\r\n            loader.setPath(scope.path);\r\n            loader.load(url, function (text) {\r\n                onLoad(scope.parse(JSON.parse(text)));\r\n            }, onProgress, onError);\r\n            return this;\r\n        },\r\n        setPath: function (value) {\r\n            this.path = value;\r\n            return this;\r\n        },\r\n        getObjectByName: function (uuid) {\r\n            return this.names[uuid];\r\n        },\r\n        getObjectById: function (uuid) {\r\n            return this.library[uuid] || this.nodes[uuid] || this.materials[uuid] || this.passes[uuid] || this.names[uuid];\r\n        },\r\n        getNode: function (uuid) {\r\n            var object = this.getObjectById(uuid);\r\n            if (!object) {\r\n                console.warn('Node \"' + uuid + '\" not found.');\r\n            }\r\n            return object;\r\n        },\r\n        resolve: function (json) {\r\n            switch (typeof json) {\r\n            case 'boolean':\r\n            case 'number':\r\n                return json;\r\n            case 'string':\r\n                if (/^\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}$/i.test(json) || this.library[json]) {\r\n                    return this.getNode(json);\r\n                }\r\n                return json;\r\n            default:\r\n                if (Array.isArray(json)) {\r\n                    for (var i = 0; i < json.length; i++) {\r\n                        json[i] = this.resolve(json[i]);\r\n                    }\r\n                } else {\r\n                    for (var prop in json) {\r\n                        if (prop === 'uuid')\r\n                            continue;\r\n                        json[prop] = this.resolve(json[prop]);\r\n                    }\r\n                }\r\n            }\r\n            return json;\r\n        },\r\n        declare: function (json) {\r\n            var uuid, node, object;\r\n            for (uuid in json.nodes) {\r\n                node = json.nodes[uuid];\r\n                object = new Nodes[node.nodeType + 'Node']();\r\n                if (node.name) {\r\n                    object.name = node.name;\r\n                    this.names[object.name] = object;\r\n                }\r\n                this.nodes[uuid] = object;\r\n            }\r\n            for (uuid in json.materials) {\r\n                node = json.materials[uuid];\r\n                object = new Nodes[node.type]();\r\n                if (node.name) {\r\n                    object.name = node.name;\r\n                    this.names[object.name] = object;\r\n                }\r\n                this.materials[uuid] = object;\r\n            }\r\n            for (uuid in json.passes) {\r\n                node = json.passes[uuid];\r\n                object = new Nodes[node.type]();\r\n                if (node.name) {\r\n                    object.name = node.name;\r\n                    this.names[object.name] = object;\r\n                }\r\n                this.passes[uuid] = object;\r\n            }\r\n            if (json.material)\r\n                this.material = this.materials[json.material];\r\n            if (json.pass)\r\n                this.pass = this.passes[json.pass];\r\n            return json;\r\n        },\r\n        parse: function (json) {\r\n            var uuid;\r\n            json = this.resolve(this.declare(json));\r\n            for (uuid in json.nodes) {\r\n                this.nodes[uuid].copy(json.nodes[uuid]);\r\n            }\r\n            for (uuid in json.materials) {\r\n                this.materials[uuid].copy(json.materials[uuid]);\r\n            }\r\n            for (uuid in json.passes) {\r\n                this.passes[uuid].copy(json.passes[uuid]);\r\n            }\r\n            return this.material || this.pass || this;\r\n        }\r\n    });\r\n\r\n    return  threex.loaders.NodeMaterialLoader = NodeMaterialLoader;\r\n});"]}