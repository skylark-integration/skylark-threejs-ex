{"version":3,"sources":["loaders/PLYLoader.js"],"names":["define","THREE","threex","PLYLoader","manager","Loader","call","this","propertyNameMapping","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setResponseType","text","parse","setPropertyNameMapping","mapping","data","parseHeader","headerText","headerLength","result","exec","length","currentElement","lineType","lineValues","propertValues","property","header","comments","elements","lines","split","i","line","trim","shift","join","format","version","push","undefined","name","count","parseInt","properties","type","countType","itemType","console","log","parseASCIINumber","n","parseFloat","parseASCIIElement","values","element","list","j","parseASCII","buffer","indices","vertices","normals","uvs","faceVertexUvs","colors","body","currentElementCount","handleElement","postProcess","geometry","BufferGeometry","setIndex","setAttribute","Float32BufferAttribute","toNonIndexed","computeBoundingSphere","elementName","x","y","z","nx","ny","nz","s","t","red","green","blue","vertex_indices","vertex_index","texcoord","binaryRead","dataview","at","little_endian","getInt8","getUint8","getInt16","getUint16","getInt32","getUint32","getFloat32","getFloat64","binaryReadElement","read","ArrayBuffer","LoaderUtils","decodeText","Uint8Array","DataView","loc","parseBinary","loaders"],"mappings":"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","file":"../../loaders/PLYLoader.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\"\r\n], function (\r\n    THREE,\r\n    threex\r\n) {\r\n    'use strict';\r\n    var PLYLoader = function (manager) {\r\n        THREE.Loader.call(this, manager);\r\n        this.propertyNameMapping = {};\r\n    };\r\n    PLYLoader.prototype = Object.assign(Object.create(THREE.Loader.prototype), {\r\n        constructor: PLYLoader,\r\n        load: function (url, onLoad, onProgress, onError) {\r\n            var scope = this;\r\n            var loader = new THREE.FileLoader(this.manager);\r\n            loader.setPath(this.path);\r\n            loader.setResponseType('arraybuffer');\r\n            loader.load(url, function (text) {\r\n                onLoad(scope.parse(text));\r\n            }, onProgress, onError);\r\n        },\r\n        setPropertyNameMapping: function (mapping) {\r\n            this.propertyNameMapping = mapping;\r\n        },\r\n        parse: function (data) {\r\n            function parseHeader(data) {\r\n                var patternHeader = /ply([\\s\\S]*)end_header\\r?\\n/;\r\n                var headerText = '';\r\n                var headerLength = 0;\r\n                var result = patternHeader.exec(data);\r\n                if (result !== null) {\r\n                    headerText = result[1];\r\n                    headerLength = result[0].length;\r\n                }\r\n                var header = {\r\n                    comments: [],\r\n                    elements: [],\r\n                    headerLength: headerLength\r\n                };\r\n                var lines = headerText.split('\\n');\r\n                var currentElement;\r\n                var lineType, lineValues;\r\n                function make_ply_element_property(propertValues, propertyNameMapping) {\r\n                    var property = { type: propertValues[0] };\r\n                    if (property.type === 'list') {\r\n                        property.name = propertValues[3];\r\n                        property.countType = propertValues[1];\r\n                        property.itemType = propertValues[2];\r\n                    } else {\r\n                        property.name = propertValues[1];\r\n                    }\r\n                    if (property.name in propertyNameMapping) {\r\n                        property.name = propertyNameMapping[property.name];\r\n                    }\r\n                    return property;\r\n                }\r\n                for (var i = 0; i < lines.length; i++) {\r\n                    var line = lines[i];\r\n                    line = line.trim();\r\n                    if (line === '')\r\n                        continue;\r\n                    lineValues = line.split(/\\s+/);\r\n                    lineType = lineValues.shift();\r\n                    line = lineValues.join(' ');\r\n                    switch (lineType) {\r\n                    case 'format':\r\n                        header.format = lineValues[0];\r\n                        header.version = lineValues[1];\r\n                        break;\r\n                    case 'comment':\r\n                        header.comments.push(line);\r\n                        break;\r\n                    case 'element':\r\n                        if (currentElement !== undefined) {\r\n                            header.elements.push(currentElement);\r\n                        }\r\n                        currentElement = {};\r\n                        currentElement.name = lineValues[0];\r\n                        currentElement.count = parseInt(lineValues[1]);\r\n                        currentElement.properties = [];\r\n                        break;\r\n                    case 'property':\r\n                        currentElement.properties.push(make_ply_element_property(lineValues, scope.propertyNameMapping));\r\n                        break;\r\n                    default:\r\n                        console.log('unhandled', lineType, lineValues);\r\n                    }\r\n                }\r\n                if (currentElement !== undefined) {\r\n                    header.elements.push(currentElement);\r\n                }\r\n                return header;\r\n            }\r\n            function parseASCIINumber(n, type) {\r\n                switch (type) {\r\n                case 'char':\r\n                case 'uchar':\r\n                case 'short':\r\n                case 'ushort':\r\n                case 'int':\r\n                case 'uint':\r\n                case 'int8':\r\n                case 'uint8':\r\n                case 'int16':\r\n                case 'uint16':\r\n                case 'int32':\r\n                case 'uint32':\r\n                    return parseInt(n);\r\n                case 'float':\r\n                case 'double':\r\n                case 'float32':\r\n                case 'float64':\r\n                    return parseFloat(n);\r\n                }\r\n            }\r\n            function parseASCIIElement(properties, line) {\r\n                var values = line.split(/\\s+/);\r\n                var element = {};\r\n                for (var i = 0; i < properties.length; i++) {\r\n                    if (properties[i].type === 'list') {\r\n                        var list = [];\r\n                        var n = parseASCIINumber(values.shift(), properties[i].countType);\r\n                        for (var j = 0; j < n; j++) {\r\n                            list.push(parseASCIINumber(values.shift(), properties[i].itemType));\r\n                        }\r\n                        element[properties[i].name] = list;\r\n                    } else {\r\n                        element[properties[i].name] = parseASCIINumber(values.shift(), properties[i].type);\r\n                    }\r\n                }\r\n                return element;\r\n            }\r\n            function parseASCII(data, header) {\r\n                var buffer = {\r\n                    indices: [],\r\n                    vertices: [],\r\n                    normals: [],\r\n                    uvs: [],\r\n                    faceVertexUvs: [],\r\n                    colors: []\r\n                };\r\n                var result;\r\n                var patternBody = /end_header\\s([\\s\\S]*)$/;\r\n                var body = '';\r\n                if ((result = patternBody.exec(data)) !== null) {\r\n                    body = result[1];\r\n                }\r\n                var lines = body.split('\\n');\r\n                var currentElement = 0;\r\n                var currentElementCount = 0;\r\n                for (var i = 0; i < lines.length; i++) {\r\n                    var line = lines[i];\r\n                    line = line.trim();\r\n                    if (line === '') {\r\n                        continue;\r\n                    }\r\n                    if (currentElementCount >= header.elements[currentElement].count) {\r\n                        currentElement++;\r\n                        currentElementCount = 0;\r\n                    }\r\n                    var element = parseASCIIElement(header.elements[currentElement].properties, line);\r\n                    handleElement(buffer, header.elements[currentElement].name, element);\r\n                    currentElementCount++;\r\n                }\r\n                return postProcess(buffer);\r\n            }\r\n            function postProcess(buffer) {\r\n                var geometry = new THREE.BufferGeometry();\r\n                if (buffer.indices.length > 0) {\r\n                    geometry.setIndex(buffer.indices);\r\n                }\r\n                geometry.setAttribute('position', new THREE.Float32BufferAttribute(buffer.vertices, 3));\r\n                if (buffer.normals.length > 0) {\r\n                    geometry.setAttribute('normal', new THREE.Float32BufferAttribute(buffer.normals, 3));\r\n                }\r\n                if (buffer.uvs.length > 0) {\r\n                    geometry.setAttribute('uv', new THREE.Float32BufferAttribute(buffer.uvs, 2));\r\n                }\r\n                if (buffer.colors.length > 0) {\r\n                    geometry.setAttribute('color', new THREE.Float32BufferAttribute(buffer.colors, 3));\r\n                }\r\n                if (buffer.faceVertexUvs.length > 0) {\r\n                    geometry = geometry.toNonIndexed();\r\n                    geometry.setAttribute('uv', new THREE.Float32BufferAttribute(buffer.faceVertexUvs, 2));\r\n                }\r\n                geometry.computeBoundingSphere();\r\n                return geometry;\r\n            }\r\n            function handleElement(buffer, elementName, element) {\r\n                if (elementName === 'vertex') {\r\n                    buffer.vertices.push(element.x, element.y, element.z);\r\n                    if ('nx' in element && 'ny' in element && 'nz' in element) {\r\n                        buffer.normals.push(element.nx, element.ny, element.nz);\r\n                    }\r\n                    if ('s' in element && 't' in element) {\r\n                        buffer.uvs.push(element.s, element.t);\r\n                    }\r\n                    if ('red' in element && 'green' in element && 'blue' in element) {\r\n                        buffer.colors.push(element.red / 255, element.green / 255, element.blue / 255);\r\n                    }\r\n                } else if (elementName === 'face') {\r\n                    var vertex_indices = element.vertex_indices || element.vertex_index;\r\n                    var texcoord = element.texcoord;\r\n                    if (vertex_indices.length === 3) {\r\n                        buffer.indices.push(vertex_indices[0], vertex_indices[1], vertex_indices[2]);\r\n                        if (texcoord && texcoord.length === 6) {\r\n                            buffer.faceVertexUvs.push(texcoord[0], texcoord[1]);\r\n                            buffer.faceVertexUvs.push(texcoord[2], texcoord[3]);\r\n                            buffer.faceVertexUvs.push(texcoord[4], texcoord[5]);\r\n                        }\r\n                    } else if (vertex_indices.length === 4) {\r\n                        buffer.indices.push(vertex_indices[0], vertex_indices[1], vertex_indices[3]);\r\n                        buffer.indices.push(vertex_indices[1], vertex_indices[2], vertex_indices[3]);\r\n                    }\r\n                }\r\n            }\r\n            function binaryRead(dataview, at, type, little_endian) {\r\n                switch (type) {\r\n                case 'int8':\r\n                case 'char':\r\n                    return [\r\n                        dataview.getInt8(at),\r\n                        1\r\n                    ];\r\n                case 'uint8':\r\n                case 'uchar':\r\n                    return [\r\n                        dataview.getUint8(at),\r\n                        1\r\n                    ];\r\n                case 'int16':\r\n                case 'short':\r\n                    return [\r\n                        dataview.getInt16(at, little_endian),\r\n                        2\r\n                    ];\r\n                case 'uint16':\r\n                case 'ushort':\r\n                    return [\r\n                        dataview.getUint16(at, little_endian),\r\n                        2\r\n                    ];\r\n                case 'int32':\r\n                case 'int':\r\n                    return [\r\n                        dataview.getInt32(at, little_endian),\r\n                        4\r\n                    ];\r\n                case 'uint32':\r\n                case 'uint':\r\n                    return [\r\n                        dataview.getUint32(at, little_endian),\r\n                        4\r\n                    ];\r\n                case 'float32':\r\n                case 'float':\r\n                    return [\r\n                        dataview.getFloat32(at, little_endian),\r\n                        4\r\n                    ];\r\n                case 'float64':\r\n                case 'double':\r\n                    return [\r\n                        dataview.getFloat64(at, little_endian),\r\n                        8\r\n                    ];\r\n                }\r\n            }\r\n            function binaryReadElement(dataview, at, properties, little_endian) {\r\n                var element = {};\r\n                var result, read = 0;\r\n                for (var i = 0; i < properties.length; i++) {\r\n                    if (properties[i].type === 'list') {\r\n                        var list = [];\r\n                        result = binaryRead(dataview, at + read, properties[i].countType, little_endian);\r\n                        var n = result[0];\r\n                        read += result[1];\r\n                        for (var j = 0; j < n; j++) {\r\n                            result = binaryRead(dataview, at + read, properties[i].itemType, little_endian);\r\n                            list.push(result[0]);\r\n                            read += result[1];\r\n                        }\r\n                        element[properties[i].name] = list;\r\n                    } else {\r\n                        result = binaryRead(dataview, at + read, properties[i].type, little_endian);\r\n                        element[properties[i].name] = result[0];\r\n                        read += result[1];\r\n                    }\r\n                }\r\n                return [\r\n                    element,\r\n                    read\r\n                ];\r\n            }\r\n            function parseBinary(data, header) {\r\n                var buffer = {\r\n                    indices: [],\r\n                    vertices: [],\r\n                    normals: [],\r\n                    uvs: [],\r\n                    faceVertexUvs: [],\r\n                    colors: []\r\n                };\r\n                var little_endian = header.format === 'binary_little_endian';\r\n                var body = new DataView(data, header.headerLength);\r\n                var result, loc = 0;\r\n                for (var currentElement = 0; currentElement < header.elements.length; currentElement++) {\r\n                    for (var currentElementCount = 0; currentElementCount < header.elements[currentElement].count; currentElementCount++) {\r\n                        result = binaryReadElement(body, loc, header.elements[currentElement].properties, little_endian);\r\n                        loc += result[1];\r\n                        var element = result[0];\r\n                        handleElement(buffer, header.elements[currentElement].name, element);\r\n                    }\r\n                }\r\n                return postProcess(buffer);\r\n            }\r\n            var geometry;\r\n            var scope = this;\r\n            if (data instanceof ArrayBuffer) {\r\n                var text = THREE.LoaderUtils.decodeText(new Uint8Array(data));\r\n                var header = parseHeader(text);\r\n                geometry = header.format === 'ascii' ? parseASCII(text, header) : parseBinary(data, header);\r\n            } else {\r\n                geometry = parseASCII(data, parseHeader(data));\r\n            }\r\n            return geometry;\r\n        }\r\n    });\r\n    return threex.loaders.PLYLoader = PLYLoader;\r\n});"]}