{"version":3,"sources":["loaders/obj2/worker/parallel/WorkerRunner.js"],"names":["define","ObjectManipulator","prototype","constructor","applyProperties","objToAlter","params","forceCreation","undefined","property","funcName","values","substring","toLocaleUpperCase","hasOwnProperty","DefaultWorkerPayloadHandler","parser","this","logging","enabled","debug","handlePayload","payload","cmd","scope","callbacks","callbackOnAssetAvailable","self","postMessage","callbackOnProgress","text","console","setLogging","objectManipulator","arraybuffer","data","input","executeFunctionName","getParseFunctionName","usesMeshDisassembler","options","log","msg","error","WorkerRunner","payloadHandler","addEventListener","event","processMessage"],"mappings":";;;;;;;AAAAA,OAAO,WACH,aACA,MAAMC,EAAoB,aAE1BA,EAAkBC,WACdC,YAAaF,EACbG,gBAAiB,SAAUC,EAAYC,EAAQC,GAC3C,QAAmBC,IAAfH,GAA2C,OAAfA,QAAkCG,IAAXF,GAAmC,OAAXA,EAC3E,OACJ,IAAIG,EAAUC,EAAUC,EACxB,IAAKF,KAAYH,EACbI,EAAW,MAAQD,EAASG,UAAU,EAAG,GAAGC,oBAAsBJ,EAASG,UAAU,GACrFD,EAASL,EAAOG,GACoB,mBAAzBJ,EAAWK,GAClBL,EAAWK,GAAUC,IACdN,EAAWS,eAAeL,IAAaF,KAC9CF,EAAWI,GAAYE,KAKvC,MAAMI,EAA8B,SAAUC,GAC1CC,KAAKD,OAASA,EACdC,KAAKC,SACDC,SAAS,EACTC,OAAO,IAGfL,EAA4Bb,WACxBC,YAAaY,EACbM,cAAe,SAAUC,GAKrB,GAJIA,EAAQJ,UACRD,KAAKC,QAAQC,SAAsC,IAA5BG,EAAQJ,QAAQC,QACvCF,KAAKC,QAAQE,OAAkC,IAA1BE,EAAQJ,QAAQE,OAErB,UAAhBE,EAAQC,IAAiB,CACzB,IAAIC,EAAQP,KACRQ,GACAC,yBAA0B,SAAUJ,GAChCK,KAAKC,YAAYN,IAErBO,mBAAoB,SAAUC,GACtBN,EAAMN,QAAQC,SAAWK,EAAMN,QAAQE,OACvCW,QAAQX,MAAM,2BAA6BU,KAGnDd,EAASC,KAAKD,OACkB,mBAAzBA,EAAmB,YAC1BA,EAAOgB,WAAWf,KAAKC,QAAQC,QAASF,KAAKC,QAAQE,OAEzD,IAAIa,EAAoB,IAAIhC,EAC5BgC,EAAkB7B,gBAAgBY,EAAQM,EAAQhB,QAAQ,GAC1D2B,EAAkB7B,gBAAgBY,EAAQS,GAAW,GACrD,IAAIS,EAAcZ,EAAQa,KAAKC,MAC3BC,EAAsB,UACiB,mBAAhCrB,EAAOsB,uBACdD,EAAsBrB,EAAOsB,wBAC7BhB,EAAQiB,sBAERvB,EAAOqB,GAAqBH,EAAaZ,EAAQa,KAAKK,SAEtDvB,KAAKC,QAAQC,SACbY,QAAQU,IAAI,+BAChBd,KAAKC,aACDL,IAAK,kBACLmB,IAAK,qCAGTX,QAAQY,MAAM,2CAA6CrB,EAAQC,OAI/E,MAAMqB,EAAe,SAAUC,GAC3B5B,KAAK4B,eAAiBA,EACtB,IAAIrB,EAAQP,KAIZU,KAAKmB,iBAAiB,UAHH,SAAUC,GACzBvB,EAAMwB,eAAeD,EAAMZ,QAEgB,IAQnD,OANAS,EAAa1C,WACTC,YAAayC,EACbI,eAAgB,SAAU1B,GACtBL,KAAK4B,eAAexB,cAAcC,MAItCsB,aAAAA,EACA7B,4BAAAA,EACAd,kBAAAA","file":"../../../../../loaders/obj2/worker/parallel/WorkerRunner.js","sourcesContent":["define(function () {\n    'use strict';\n    const ObjectManipulator = function () {\n    };\n    ObjectManipulator.prototype = {\n        constructor: ObjectManipulator,\n        applyProperties: function (objToAlter, params, forceCreation) {\n            if (objToAlter === undefined || objToAlter === null || params === undefined || params === null)\n                return;\n            let property, funcName, values;\n            for (property in params) {\n                funcName = 'set' + property.substring(0, 1).toLocaleUpperCase() + property.substring(1);\n                values = params[property];\n                if (typeof objToAlter[funcName] === 'function') {\n                    objToAlter[funcName](values);\n                } else if (objToAlter.hasOwnProperty(property) || forceCreation) {\n                    objToAlter[property] = values;\n                }\n            }\n        }\n    };\n    const DefaultWorkerPayloadHandler = function (parser) {\n        this.parser = parser;\n        this.logging = {\n            enabled: false,\n            debug: false\n        };\n    };\n    DefaultWorkerPayloadHandler.prototype = {\n        constructor: DefaultWorkerPayloadHandler,\n        handlePayload: function (payload) {\n            if (payload.logging) {\n                this.logging.enabled = payload.logging.enabled === true;\n                this.logging.debug = payload.logging.debug === true;\n            }\n            if (payload.cmd === 'parse') {\n                let scope = this;\n                let callbacks = {\n                    callbackOnAssetAvailable: function (payload) {\n                        self.postMessage(payload);\n                    },\n                    callbackOnProgress: function (text) {\n                        if (scope.logging.enabled && scope.logging.debug)\n                            console.debug('WorkerRunner: progress: ' + text);\n                    }\n                };\n                let parser = this.parser;\n                if (typeof parser['setLogging'] === 'function') {\n                    parser.setLogging(this.logging.enabled, this.logging.debug);\n                }\n                let objectManipulator = new ObjectManipulator();\n                objectManipulator.applyProperties(parser, payload.params, false);\n                objectManipulator.applyProperties(parser, callbacks, false);\n                let arraybuffer = payload.data.input;\n                let executeFunctionName = 'execute';\n                if (typeof parser.getParseFunctionName === 'function')\n                    executeFunctionName = parser.getParseFunctionName();\n                if (payload.usesMeshDisassembler) {\n                } else {\n                    parser[executeFunctionName](arraybuffer, payload.data.options);\n                }\n                if (this.logging.enabled)\n                    console.log('WorkerRunner: Run complete!');\n                self.postMessage({\n                    cmd: 'completeOverall',\n                    msg: 'WorkerRunner completed run.'\n                });\n            } else {\n                console.error('WorkerRunner: Received unknown command: ' + payload.cmd);\n            }\n        }\n    };\n    const WorkerRunner = function (payloadHandler) {\n        this.payloadHandler = payloadHandler;\n        let scope = this;\n        let scopedRunner = function (event) {\n            scope.processMessage(event.data);\n        };\n        self.addEventListener('message', scopedRunner, false);\n    };\n    WorkerRunner.prototype = {\n        constructor: WorkerRunner,\n        processMessage: function (payload) {\n            this.payloadHandler.handlePayload(payload);\n        }\n    };\n    return {\n        WorkerRunner,\n        DefaultWorkerPayloadHandler,\n        ObjectManipulator\n    };\n});"]}