{"version":3,"sources":["loaders/obj2/shared/MaterialHandler.js"],"names":["define","THREE","MaterialHandler","this","logging","enabled","debug","callbacks","onLoadMaterials","materials","prototype","constructor","setLogging","_setCallbacks","undefined","Function","createDefaultMaterials","overrideExisting","defaultMaterial","MeshStandardMaterial","color","name","defaultVertexColorMaterial","vertexColors","VertexColors","defaultLineMaterial","LineBasicMaterial","defaultPointMaterial","PointsMaterial","size","runtimeMaterials","addMaterials","addPayloadMaterials","materialPayload","material","materialName","materialCloneInstructions","newMaterials","materialNameOrg","materialOrg","clone","Object","assign","materialProperties","console","info","serializedMaterials","keys","length","materialJson","loader","MaterialLoader","parse","existingMaterial","add","getMaterials","getMaterial","getMaterialsJSON","materialsJSON","toJSON","clearMaterials"],"mappings":"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","file":"../../../../loaders/obj2/shared/MaterialHandler.js","sourcesContent":["define([\n    'skylark-threejs'\n], function (THREE) {\n    'use strict';\n    const MaterialHandler = function () {\n        this.logging = {\n            enabled: false,\n            debug: false\n        };\n        this.callbacks = { onLoadMaterials: null };\n        this.materials = {};\n    };\n    MaterialHandler.prototype = {\n        constructor: MaterialHandler,\n        setLogging: function (enabled, debug) {\n            this.logging.enabled = enabled === true;\n            this.logging.debug = debug === true;\n        },\n        _setCallbacks: function (onLoadMaterials) {\n            if (onLoadMaterials !== undefined && onLoadMaterials !== null && onLoadMaterials instanceof Function) {\n                this.callbacks.onLoadMaterials = onLoadMaterials;\n            }\n        },\n        createDefaultMaterials: function (overrideExisting) {\n            let defaultMaterial = new THREE.MeshStandardMaterial({ color: 14479871 });\n            defaultMaterial.name = 'defaultMaterial';\n            let defaultVertexColorMaterial = new THREE.MeshStandardMaterial({ color: 14479871 });\n            defaultVertexColorMaterial.name = 'defaultVertexColorMaterial';\n            defaultVertexColorMaterial.vertexColors = THREE.VertexColors;\n            let defaultLineMaterial = new THREE.LineBasicMaterial();\n            defaultLineMaterial.name = 'defaultLineMaterial';\n            let defaultPointMaterial = new THREE.PointsMaterial({ size: 0.1 });\n            defaultPointMaterial.name = 'defaultPointMaterial';\n            let runtimeMaterials = {};\n            runtimeMaterials[defaultMaterial.name] = defaultMaterial;\n            runtimeMaterials[defaultVertexColorMaterial.name] = defaultVertexColorMaterial;\n            runtimeMaterials[defaultLineMaterial.name] = defaultLineMaterial;\n            runtimeMaterials[defaultPointMaterial.name] = defaultPointMaterial;\n            this.addMaterials(runtimeMaterials, overrideExisting);\n        },\n        addPayloadMaterials: function (materialPayload) {\n            let material, materialName;\n            let materialCloneInstructions = materialPayload.materials.materialCloneInstructions;\n            let newMaterials = {};\n            if (materialCloneInstructions !== undefined && materialCloneInstructions !== null) {\n                let materialNameOrg = materialCloneInstructions.materialNameOrg;\n                materialNameOrg = materialNameOrg !== undefined && materialNameOrg !== null ? materialNameOrg : '';\n                let materialOrg = this.materials[materialNameOrg];\n                if (materialOrg) {\n                    material = materialOrg.clone();\n                    materialName = materialCloneInstructions.materialName;\n                    material.name = materialName;\n                    Object.assign(material, materialCloneInstructions.materialProperties);\n                    this.materials[materialName] = material;\n                    newMaterials[materialName] = material;\n                } else {\n                    if (this.logging.enabled) {\n                        console.info('Requested material \"' + materialNameOrg + '\" is not available!');\n                    }\n                }\n            }\n            let materials = materialPayload.materials.serializedMaterials;\n            if (materials !== undefined && materials !== null && Object.keys(materials).length > 0) {\n                let loader = new THREE.MaterialLoader();\n                let materialJson;\n                for (materialName in materials) {\n                    materialJson = materials[materialName];\n                    if (materialJson !== undefined && materialJson !== null) {\n                        material = loader.parse(materialJson);\n                        if (this.logging.enabled) {\n                            console.info('De-serialized material with name \"' + materialName + '\" will be added.');\n                        }\n                        this.materials[materialName] = material;\n                        newMaterials[materialName] = material;\n                    }\n                }\n            }\n            materials = materialPayload.materials.runtimeMaterials;\n            newMaterials = this.addMaterials(materials, true, newMaterials);\n            return newMaterials;\n        },\n        addMaterials: function (materials, overrideExisting, newMaterials) {\n            if (newMaterials === undefined || newMaterials === null) {\n                newMaterials = {};\n            }\n            if (materials !== undefined && materials !== null && Object.keys(materials).length > 0) {\n                let material;\n                let existingMaterial;\n                let add;\n                for (let materialName in materials) {\n                    material = materials[materialName];\n                    add = overrideExisting === true;\n                    if (!add) {\n                        existingMaterial = this.materials[materialName];\n                        add = existingMaterial === null || existingMaterial === undefined;\n                    }\n                    if (add) {\n                        this.materials[materialName] = material;\n                        newMaterials[materialName] = material;\n                    }\n                    if (this.logging.enabled && this.logging.debug) {\n                        console.info('Material with name \"' + materialName + '\" was added.');\n                    }\n                }\n            }\n            if (this.callbacks.onLoadMaterials) {\n                this.callbacks.onLoadMaterials(newMaterials);\n            }\n            return newMaterials;\n        },\n        getMaterials: function () {\n            return this.materials;\n        },\n        getMaterial: function (materialName) {\n            return this.materials[materialName];\n        },\n        getMaterialsJSON: function () {\n            let materialsJSON = {};\n            let material;\n            for (let materialName in this.materials) {\n                material = this.materials[materialName];\n                materialsJSON[materialName] = material.toJSON();\n            }\n            return materialsJSON;\n        },\n        clearMaterials: function () {\n            this.materials = {};\n        }\n    };\n    return MaterialHandler;\n});"]}