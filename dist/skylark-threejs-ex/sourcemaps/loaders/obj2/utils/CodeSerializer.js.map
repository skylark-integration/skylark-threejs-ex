{"version":3,"sources":["loaders/obj2/utils/CodeSerializer.js"],"names":["define","serializeClass","targetPrototype","targetPrototypeInstance","basePrototypeName","overrideFunctions","objectPart","constructorString","i","funcInstructions","funcTemp","fullObjectName","constructor","name","prototypeFunctions","objectProperties","objectFunctions","isExtended","undefined","Array","isArray","prototype","CodeSerializationInstruction","setCode","toString","isRemoveCode","getCode","getName","push","getFullName","String","console","log","objectString","length"],"mappings":";;;;;;;AAAAA,OAAO,WACH,aA0FA,OAxFIC,eAAgB,SAAUC,EAAiBC,EAAyBC,EAAmBC,GACnF,IAAIC,EAAYC,EAAmBC,EAAGC,EAAkBC,EACpDC,EAAiBR,EAAwBS,YAAYC,KACrDC,KACAC,KACAC,KACAC,EAAmC,OAAtBb,QAAoDc,IAAtBd,EAC1Ce,MAAMC,QAAQf,KACfA,MACJ,IAAK,IAAIQ,KAAQX,EAAgBmB,UAC7Bf,EAAaJ,EAAgBmB,UAAUR,IACvCJ,EAAmB,IAAIa,6BAA6BT,EAAMF,EAAiB,cAAgBE,IAC1EU,QAAQjB,EAAWkB,YACvB,gBAATX,EACKJ,EAAiBgB,iBAClBlB,EAAoBI,EAAiB,MAAQF,EAAiBiB,UAAY,SAEjD,mBAAfpB,KACdI,EAAWL,EAAkBQ,cACLS,8BAAgCZ,EAASiB,YAAclB,EAAiBkB,YAC5FlB,EAAmBC,GAElBD,EAAiBgB,iBACdR,EACAH,EAAmBc,KAAKnB,EAAiBoB,cAAgB,MAAQpB,EAAiBiB,UAAY,SAE9FZ,EAAmBc,KAAK,KAAOnB,EAAiBkB,UAAY,KAAOlB,EAAiBiB,UAAY,WAKhH,IAAK,IAAIb,KAAQX,EACbI,EAAaJ,EAAgBW,GAC7BJ,EAAmB,IAAIa,6BAA6BT,EAAMF,EAAiB,IAAME,GACvD,mBAAfP,IACPI,EAAWL,EAAkBQ,cACLS,8BAAgCZ,EAASiB,YAAclB,EAAiBkB,UAC5FlB,EAAmBC,EAEnBD,EAAiBc,QAAQjB,EAAWkB,YAEnCf,EAAiBgB,gBAClBT,EAAgBY,KAAKnB,EAAiBoB,cAAgB,MAAQpB,EAAiBiB,UAAY,WAGrE,iBAAfpB,GAA2BA,aAAsBwB,OACxDrB,EAAiBc,QAAQ,IAAMjB,EAAWkB,WAAa,KAC1B,iBAAflB,GACdyB,QAAQC,IAAI,oBAAsBvB,EAAiBkB,UAAY,uCAC/DlB,EAAiBc,QAAQ,OAEzBd,EAAiBc,QAAQjB,GAExBG,EAAiBgB,gBAClBV,EAAiBa,KAAKnB,EAAiBoB,cAAgB,MAAQpB,EAAiBiB,UAAY,QAIxG,IAAIO,EAAe1B,EAAoB,OAMvC,IALIU,IACAgB,GAAgBtB,EAAiB,+BAAiCP,EAAoB,mBAE1F6B,GAAgBtB,EAAiB,4BAA8BA,EAAiB,MAChFsB,GAAgB,OACXzB,EAAI,EAAGA,EAAIO,EAAiBmB,OAAQ1B,IACrCyB,GAAgBlB,EAAiBP,GAGrC,IADAyB,GAAgB,OACXzB,EAAI,EAAGA,EAAIQ,EAAgBkB,OAAQ1B,IACpCyB,GAAgBjB,EAAgBR,GAGpC,GADAyB,GAAgB,OACZhB,EACA,IAAKT,EAAI,EAAGA,EAAIM,EAAmBoB,OAAQ1B,IACvCyB,GAAgBnB,EAAmBN,OAEpC,CAEH,IADAyB,GAAgBtB,EAAiB,qBAC5BH,EAAI,EAAGA,EAAIM,EAAmBoB,OAAQ1B,IACvCyB,GAAgBnB,EAAmBN,GAEvCyB,GAAgB,OAGpB,OADAA,GAAgB","file":"../../../../loaders/obj2/utils/CodeSerializer.js","sourcesContent":["define(function () {\r\n    'use strict';\r\n    const CodeSerializer = {\r\n        serializeClass: function (targetPrototype, targetPrototypeInstance, basePrototypeName, overrideFunctions) {\r\n            let objectPart, constructorString, i, funcInstructions, funcTemp;\r\n            let fullObjectName = targetPrototypeInstance.constructor.name;\r\n            let prototypeFunctions = [];\r\n            let objectProperties = [];\r\n            let objectFunctions = [];\r\n            let isExtended = basePrototypeName !== null && basePrototypeName !== undefined;\r\n            if (!Array.isArray(overrideFunctions))\r\n                overrideFunctions = [];\r\n            for (let name in targetPrototype.prototype) {\r\n                objectPart = targetPrototype.prototype[name];\r\n                funcInstructions = new CodeSerializationInstruction(name, fullObjectName + '.prototype.' + name);\r\n                funcInstructions.setCode(objectPart.toString());\r\n                if (name === 'constructor') {\r\n                    if (!funcInstructions.isRemoveCode()) {\r\n                        constructorString = fullObjectName + ' = ' + funcInstructions.getCode() + ';\\n\\n';\r\n                    }\r\n                } else if (typeof objectPart === 'function') {\r\n                    funcTemp = overrideFunctions[name];\r\n                    if (funcTemp instanceof CodeSerializationInstruction && funcTemp.getName() === funcInstructions.getName()) {\r\n                        funcInstructions = funcTemp;\r\n                    }\r\n                    if (!funcInstructions.isRemoveCode()) {\r\n                        if (isExtended) {\r\n                            prototypeFunctions.push(funcInstructions.getFullName() + ' = ' + funcInstructions.getCode() + ';\\n\\n');\r\n                        } else {\r\n                            prototypeFunctions.push('\\t' + funcInstructions.getName() + ': ' + funcInstructions.getCode() + ',\\n\\n');\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            for (let name in targetPrototype) {\r\n                objectPart = targetPrototype[name];\r\n                funcInstructions = new CodeSerializationInstruction(name, fullObjectName + '.' + name);\r\n                if (typeof objectPart === 'function') {\r\n                    funcTemp = overrideFunctions[name];\r\n                    if (funcTemp instanceof CodeSerializationInstruction && funcTemp.getName() === funcInstructions.getName()) {\r\n                        funcInstructions = funcTemp;\r\n                    } else {\r\n                        funcInstructions.setCode(objectPart.toString());\r\n                    }\r\n                    if (!funcInstructions.isRemoveCode()) {\r\n                        objectFunctions.push(funcInstructions.getFullName() + ' = ' + funcInstructions.getCode() + ';\\n\\n');\r\n                    }\r\n                } else {\r\n                    if (typeof objectPart === 'string' || objectPart instanceof String) {\r\n                        funcInstructions.setCode('\"' + objectPart.toString() + '\"');\r\n                    } else if (typeof objectPart === 'object') {\r\n                        console.log('Omitting object \"' + funcInstructions.getName() + '\" and replace it with empty object.');\r\n                        funcInstructions.setCode('{}');\r\n                    } else {\r\n                        funcInstructions.setCode(objectPart);\r\n                    }\r\n                    if (!funcInstructions.isRemoveCode()) {\r\n                        objectProperties.push(funcInstructions.getFullName() + ' = ' + funcInstructions.getCode() + ';\\n');\r\n                    }\r\n                }\r\n            }\r\n            let objectString = constructorString + '\\n\\n';\r\n            if (isExtended) {\r\n                objectString += fullObjectName + '.prototype = Object.create( ' + basePrototypeName + '.prototype );\\n';\r\n            }\r\n            objectString += fullObjectName + '.prototype.constructor = ' + fullObjectName + ';\\n';\r\n            objectString += '\\n\\n';\r\n            for (i = 0; i < objectProperties.length; i++) {\r\n                objectString += objectProperties[i];\r\n            }\r\n            objectString += '\\n\\n';\r\n            for (i = 0; i < objectFunctions.length; i++) {\r\n                objectString += objectFunctions[i];\r\n            }\r\n            objectString += '\\n\\n';\r\n            if (isExtended) {\r\n                for (i = 0; i < prototypeFunctions.length; i++) {\r\n                    objectString += prototypeFunctions[i];\r\n                }\r\n            } else {\r\n                objectString += fullObjectName + '.prototype = {\\n\\n';\r\n                for (i = 0; i < prototypeFunctions.length; i++) {\r\n                    objectString += prototypeFunctions[i];\r\n                }\r\n                objectString += '\\n};';\r\n            }\r\n            objectString += '\\n\\n';\r\n            return objectString;\r\n        }\r\n    };\r\n\r\n    return  CodeSerializer;\r\n});"]}