{"version":3,"sources":["loaders/VRMLLoader.js"],"names":["define","THREE","threex","chevrotain","VRMLLoader","Error","manager","Loader","call","this","VRMLLexer","tokens","lexer","Lexer","VRMLParser","tokenVocabulary","Parser","$","Version","LCurly","RCurly","LSquare","RSquare","Identifier","RouteIdentifier","StringLiteral","HexLiteral","NumberLiteral","TrueLiteral","FalseLiteral","NullLiteral","DEF","USE","ROUTE","TO","NodeName","RULE","SUBRULE","version","AT_LEAST_ONE","node","MANY","route","CONSUME","OPTION","def","field","OR2","ALT","singleFieldValue","multiFieldValue","OR","use","CONSUME2","performSelfAnalysis","Face","a","b","c","normal","Vector3","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setPath","text","parse","data","nodeMap","buildNodeMap","fields","i","l","length","type","fieldValues","values","j","jl","getNode","identifier","build","isObject3D","isMaterial","clone","undefined","nodeName","name","object","Group","fieldName","parseFieldChildren","axis","angle","quaternion","setFromAxisAngle","scale","set","position","console","warn","buildGroupingNode","groundAngle","groundColor","skyAngle","skyColor","group","skyGeometry","SphereBufferGeometry","skyMaterial","MeshBasicMaterial","fog","side","BackSide","depthWrite","depthTest","paintFaces","toColorArray","vertexColors","color","setRGB","sky","Mesh","add","groundGeometry","Math","PI","groundMaterial","ground","renderOrder","buildBackgroundNode","geometry","material","attributes","_type","pointsMaterial","PointsMaterial","isMeshPhongMaterial","copy","emissive","Points","lineMaterial","LineBasicMaterial","LineSegments","_solid","FrontSide","DoubleSide","Object3D","visible","buildShapeNode","transformData","MeshPhongMaterial","materialData","diffuseColor","emissiveColor","shininess","specularColor","specular","transparency","opacity","transparent","textureNode","map","__type","TEXTURE_TYPE","INTENSITY_ALPHA","RGB","RGBA","center","rotation","repeat","offset","translation","buildAppearanceNode","Color","buildMaterialNode","texture","wrapS","RepeatWrapping","wrapT","textureLoader","ClampToEdgeWrapping","buildImageTextureNode","width","height","num_components","useAlpha","textureType","getTextureType","size","Uint8Array","r","g","k","parseHexColor","stride","DataTexture","RGBAFormat","RGBFormat","buildPixelTextureNode","Vector2","buildTextureTransformNode","coord","texCoord","colorIndex","coordIndex","normalIndex","texCoordIndex","ccw","solid","creaseAngle","colorPerVertex","normalPerVertex","colorNode","coordNode","normalNode","texCoordNode","BufferGeometry","positionAttribute","colorAttribute","normalAttribute","uvAttribute","triangulatedCoordIndex","triangulateFaceIndex","triangulatedColorIndex","computeAttributeFromIndexedData","toNonIndexedAttribute","Float32BufferAttribute","flattenFaceColors","flattenData","triangulatedFaceColors","triangulateFaceData","computeAttributeFromFaceData","triangulatedNormalIndex","flattenFaceNormals","triangulatedFaceNormals","index","faces","vertexNormals","face","vA","fromArray","vB","vC","cb","subVectors","ab","cross","normalize","push","normals","nA","weightedNormal","nB","nC","x","y","z","computeNormalAttribute","triangulatedTexCoordIndex","setAttribute","buildIndexedFaceSetNode","expandedLineIndex","expandLineIndex","expandedColorIndex","flattenLineColors","expandedLineColors","expandLineData","computeAttributeFromLineData","buildIndexedLineSetNode","buildPointSetNode","BoxBufferGeometry","buildBoxNode","radius","openEnded","ConeBufferGeometry","buildConeNode","CylinderBufferGeometry","buildCylinderNode","buildSphereNode","buildGeometricNode","buildNode","hex","INTENSITY","value","parseInt","substring","children","owner","indices","start","i1","i2","i3","triangulatedData","uvA","uvB","uvC","itemSize","array","faceData","lineData","attribute","array2","index2","vector","angleTo","colors","angles","topDown","thresholds","startAngle","point","setFromSphericalCoords","BufferAttribute","Float32Array","count","thresholdIndexA","thresholdIndexB","getX","fromBufferAttribute","t","thresholdA","thresholdB","abs","colorA","colorB","lerp","setXYZ","TextureLoader","resourcePath","setCrossOrigin","crossOrigin","tree","tokenData","createToken","pattern","longer_alt","RegExp","join","Comment","SKIPPED","token","createTokens","parser","visitor","BaseVRMLVisitor","VRMLToASTVisitor","validateVisitor","processField","ctx","visit","stringLiteral","image","replace","numberLiteral","parseFloat","hexLiteral","trueLiteral","falseLiteral","forEach","vrml","nodes","routes","result","FROM","createVisitor","getBaseCstVisitorConstructor","lexingResult","lex","input","cstOutput","errors","error","generateVRMLTree","indexOf","scene","Scene","parseTree","inputText","tokenize","loaders"],"mappings":"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","file":"../../loaders/VRMLLoader.js","sourcesContent":["define([\r\n    \"skylark-threejs\",\r\n    \"../threex\",\r\n//    '../libs/chevrotain.module.min'\r\n], function (\r\n    THREE, \r\n    threex,\r\n    chevrotain\r\n) {\r\n    'use strict';\r\n    var VRMLLoader = function () {\r\n        if (typeof chevrotain === 'undefined') {\r\n            throw Error('THREE.VRMLLoader: External library chevrotain.min.js required.');\r\n        }\r\n        function VRMLLoader(manager) {\r\n            THREE.Loader.call(this, manager);\r\n        }\r\n        VRMLLoader.prototype = Object.assign(Object.create(THREE.Loader.prototype), {\r\n            constructor: VRMLLoader,\r\n            load: function (url, onLoad, onProgress, onError) {\r\n                var scope = this;\r\n                var path = scope.path === '' ? THREE.LoaderUtils.extractUrlBase(url) : scope.path;\r\n                var loader = new THREE.FileLoader(this.manager);\r\n                loader.setPath(scope.path);\r\n                loader.load(url, function (text) {\r\n                    onLoad(scope.parse(text, path));\r\n                }, onProgress, onError);\r\n            },\r\n            parse: function (data, path) {\r\n                var nodeMap = {};\r\n                function generateVRMLTree(data) {\r\n                    var tokenData = createTokens();\r\n                    var lexer = new VRMLLexer(tokenData.tokens);\r\n                    var parser = new VRMLParser(tokenData.tokenVocabulary);\r\n                    var visitor = createVisitor(parser.getBaseCstVisitorConstructor());\r\n                    var lexingResult = lexer.lex(data);\r\n                    parser.input = lexingResult.tokens;\r\n                    var cstOutput = parser.vrml();\r\n                    if (parser.errors.length > 0) {\r\n                        console.error(parser.errors);\r\n                        throw Error('THREE.VRMLLoader: Parsing errors detected.');\r\n                    }\r\n                    var ast = visitor.visit(cstOutput);\r\n                    return ast;\r\n                }\r\n                function createTokens() {\r\n                    var createToken = chevrotain.createToken;\r\n                    var RouteIdentifier = createToken({\r\n                        name: 'RouteIdentifier',\r\n                        pattern: /[^\\x30-\\x39\\0-\\x20\\x22\\x27\\x23\\x2b\\x2c\\x2d\\x2e\\x5b\\x5d\\x5c\\x7b\\x7d][^\\0-\\x20\\x22\\x27\\x23\\x2b\\x2c\\x2d\\x2e\\x5b\\x5d\\x5c\\x7b\\x7d]*[\\.][^\\x30-\\x39\\0-\\x20\\x22\\x27\\x23\\x2b\\x2c\\x2d\\x2e\\x5b\\x5d\\x5c\\x7b\\x7d][^\\0-\\x20\\x22\\x27\\x23\\x2b\\x2c\\x2d\\x2e\\x5b\\x5d\\x5c\\x7b\\x7d]*/\r\n                    });\r\n                    var Identifier = createToken({\r\n                        name: 'Identifier',\r\n                        pattern: /[^\\x30-\\x39\\0-\\x20\\x22\\x27\\x23\\x2b\\x2c\\x2d\\x2e\\x5b\\x5d\\x5c\\x7b\\x7d][^\\0-\\x20\\x22\\x27\\x23\\x2b\\x2c\\x2d\\x2e\\x5b\\x5d\\x5c\\x7b\\x7d]*/,\r\n                        longer_alt: RouteIdentifier\r\n                    });\r\n                    var nodeTypes = [\r\n                        'Anchor',\r\n                        'Billboard',\r\n                        'Collision',\r\n                        'Group',\r\n                        'Transform',\r\n                        'Inline',\r\n                        'LOD',\r\n                        'Switch',\r\n                        'AudioClip',\r\n                        'DirectionalLight',\r\n                        'PointLight',\r\n                        'Script',\r\n                        'Shape',\r\n                        'Sound',\r\n                        'SpotLight',\r\n                        'WorldInfo',\r\n                        'CylinderSensor',\r\n                        'PlaneSensor',\r\n                        'ProximitySensor',\r\n                        'SphereSensor',\r\n                        'TimeSensor',\r\n                        'TouchSensor',\r\n                        'VisibilitySensor',\r\n                        'Box',\r\n                        'Cone',\r\n                        'Cylinder',\r\n                        'ElevationGrid',\r\n                        'Extrusion',\r\n                        'IndexedFaceSet',\r\n                        'IndexedLineSet',\r\n                        'PointSet',\r\n                        'Sphere',\r\n                        'Color',\r\n                        'Coordinate',\r\n                        'Normal',\r\n                        'TextureCoordinate',\r\n                        'Appearance',\r\n                        'FontStyle',\r\n                        'ImageTexture',\r\n                        'Material',\r\n                        'MovieTexture',\r\n                        'PixelTexture',\r\n                        'TextureTransform',\r\n                        'ColorInterpolator',\r\n                        'CoordinateInterpolator',\r\n                        'NormalInterpolator',\r\n                        'OrientationInterpolator',\r\n                        'PositionInterpolator',\r\n                        'ScalarInterpolator',\r\n                        'Background',\r\n                        'Fog',\r\n                        'NavigationInfo',\r\n                        'Viewpoint',\r\n                        'Text'\r\n                    ];\r\n                    var Version = createToken({\r\n                        name: 'Version',\r\n                        pattern: /#VRML.*/,\r\n                        longer_alt: Identifier\r\n                    });\r\n                    var NodeName = createToken({\r\n                        name: 'NodeName',\r\n                        pattern: new RegExp(nodeTypes.join('|')),\r\n                        longer_alt: Identifier\r\n                    });\r\n                    var DEF = createToken({\r\n                        name: 'DEF',\r\n                        pattern: /DEF/,\r\n                        longer_alt: Identifier\r\n                    });\r\n                    var USE = createToken({\r\n                        name: 'USE',\r\n                        pattern: /USE/,\r\n                        longer_alt: Identifier\r\n                    });\r\n                    var ROUTE = createToken({\r\n                        name: 'ROUTE',\r\n                        pattern: /ROUTE/,\r\n                        longer_alt: Identifier\r\n                    });\r\n                    var TO = createToken({\r\n                        name: 'TO',\r\n                        pattern: /TO/,\r\n                        longer_alt: Identifier\r\n                    });\r\n                    var StringLiteral = createToken({\r\n                        name: 'StringLiteral',\r\n                        pattern: /\"(:?[^\\\\\"\\n\\r]+|\\\\(:?[bfnrtv\"\\\\/]|u[0-9a-fA-F]{4}))*\"/\r\n                    });\r\n                    var HexLiteral = createToken({\r\n                        name: 'HexLiteral',\r\n                        pattern: /0[xX][0-9a-fA-F]+/\r\n                    });\r\n                    var NumberLiteral = createToken({\r\n                        name: 'NumberLiteral',\r\n                        pattern: /[-+]?[0-9]*\\.?[0-9]+([eE][-+]?[0-9]+)?/\r\n                    });\r\n                    var TrueLiteral = createToken({\r\n                        name: 'TrueLiteral',\r\n                        pattern: /TRUE/\r\n                    });\r\n                    var FalseLiteral = createToken({\r\n                        name: 'FalseLiteral',\r\n                        pattern: /FALSE/\r\n                    });\r\n                    var NullLiteral = createToken({\r\n                        name: 'NullLiteral',\r\n                        pattern: /NULL/\r\n                    });\r\n                    var LSquare = createToken({\r\n                        name: 'LSquare',\r\n                        pattern: /\\[/\r\n                    });\r\n                    var RSquare = createToken({\r\n                        name: 'RSquare',\r\n                        pattern: /]/\r\n                    });\r\n                    var LCurly = createToken({\r\n                        name: 'LCurly',\r\n                        pattern: /{/\r\n                    });\r\n                    var RCurly = createToken({\r\n                        name: 'RCurly',\r\n                        pattern: /}/\r\n                    });\r\n                    var Comment = createToken({\r\n                        name: 'Comment',\r\n                        pattern: /#.*/,\r\n                        group: chevrotain.Lexer.SKIPPED\r\n                    });\r\n                    var WhiteSpace = createToken({\r\n                        name: 'WhiteSpace',\r\n                        pattern: /[ ,\\s]/,\r\n                        group: chevrotain.Lexer.SKIPPED\r\n                    });\r\n                    var tokens = [\r\n                        WhiteSpace,\r\n                        NodeName,\r\n                        DEF,\r\n                        USE,\r\n                        ROUTE,\r\n                        TO,\r\n                        TrueLiteral,\r\n                        FalseLiteral,\r\n                        NullLiteral,\r\n                        Version,\r\n                        Identifier,\r\n                        RouteIdentifier,\r\n                        StringLiteral,\r\n                        HexLiteral,\r\n                        NumberLiteral,\r\n                        LSquare,\r\n                        RSquare,\r\n                        LCurly,\r\n                        RCurly,\r\n                        Comment\r\n                    ];\r\n                    var tokenVocabulary = {};\r\n                    for (var i = 0, l = tokens.length; i < l; i++) {\r\n                        var token = tokens[i];\r\n                        tokenVocabulary[token.name] = token;\r\n                    }\r\n                    return {\r\n                        tokens: tokens,\r\n                        tokenVocabulary: tokenVocabulary\r\n                    };\r\n                }\r\n                function createVisitor(BaseVRMLVisitor) {\r\n                    function VRMLToASTVisitor() {\r\n                        BaseVRMLVisitor.call(this);\r\n                        this.validateVisitor();\r\n                    }\r\n                    VRMLToASTVisitor.prototype = Object.assign(Object.create(BaseVRMLVisitor.prototype), {\r\n                        constructor: VRMLToASTVisitor,\r\n                        vrml: function (ctx) {\r\n                            var data = {\r\n                                version: this.visit(ctx.version),\r\n                                nodes: [],\r\n                                routes: []\r\n                            };\r\n                            for (var i = 0, l = ctx.node.length; i < l; i++) {\r\n                                var node = ctx.node[i];\r\n                                data.nodes.push(this.visit(node));\r\n                            }\r\n                            if (ctx.route) {\r\n                                for (var i = 0, l = ctx.route.length; i < l; i++) {\r\n                                    var route = ctx.route[i];\r\n                                    data.routes.push(this.visit(route));\r\n                                }\r\n                            }\r\n                            return data;\r\n                        },\r\n                        version: function (ctx) {\r\n                            return ctx.Version[0].image;\r\n                        },\r\n                        node: function (ctx) {\r\n                            var data = {\r\n                                name: ctx.NodeName[0].image,\r\n                                fields: []\r\n                            };\r\n                            if (ctx.field) {\r\n                                for (var i = 0, l = ctx.field.length; i < l; i++) {\r\n                                    var field = ctx.field[i];\r\n                                    data.fields.push(this.visit(field));\r\n                                }\r\n                            }\r\n                            if (ctx.def) {\r\n                                data.DEF = this.visit(ctx.def[0]);\r\n                            }\r\n                            return data;\r\n                        },\r\n                        field: function (ctx) {\r\n                            var data = {\r\n                                name: ctx.Identifier[0].image,\r\n                                type: null,\r\n                                values: null\r\n                            };\r\n                            var result;\r\n                            if (ctx.singleFieldValue) {\r\n                                result = this.visit(ctx.singleFieldValue[0]);\r\n                            }\r\n                            if (ctx.multiFieldValue) {\r\n                                result = this.visit(ctx.multiFieldValue[0]);\r\n                            }\r\n                            data.type = result.type;\r\n                            data.values = result.values;\r\n                            return data;\r\n                        },\r\n                        def: function (ctx) {\r\n                            return ctx.Identifier[0].image;\r\n                        },\r\n                        use: function (ctx) {\r\n                            return { USE: ctx.Identifier[0].image };\r\n                        },\r\n                        singleFieldValue: function (ctx) {\r\n                            return processField(this, ctx);\r\n                        },\r\n                        multiFieldValue: function (ctx) {\r\n                            return processField(this, ctx);\r\n                        },\r\n                        route: function (ctx) {\r\n                            var data = {\r\n                                FROM: ctx.RouteIdentifier[0].image,\r\n                                TO: ctx.RouteIdentifier[1].image\r\n                            };\r\n                            return data;\r\n                        }\r\n                    });\r\n                    function processField(scope, ctx) {\r\n                        var field = {\r\n                            type: null,\r\n                            values: []\r\n                        };\r\n                        if (ctx.node) {\r\n                            field.type = 'node';\r\n                            for (var i = 0, l = ctx.node.length; i < l; i++) {\r\n                                var node = ctx.node[i];\r\n                                field.values.push(scope.visit(node));\r\n                            }\r\n                        }\r\n                        if (ctx.use) {\r\n                            field.type = 'use';\r\n                            for (var i = 0, l = ctx.use.length; i < l; i++) {\r\n                                var use = ctx.use[i];\r\n                                field.values.push(scope.visit(use));\r\n                            }\r\n                        }\r\n                        if (ctx.StringLiteral) {\r\n                            field.type = 'string';\r\n                            for (var i = 0, l = ctx.StringLiteral.length; i < l; i++) {\r\n                                var stringLiteral = ctx.StringLiteral[i];\r\n                                field.values.push(stringLiteral.image.replace(/'|\"/g, ''));\r\n                            }\r\n                        }\r\n                        if (ctx.NumberLiteral) {\r\n                            field.type = 'number';\r\n                            for (var i = 0, l = ctx.NumberLiteral.length; i < l; i++) {\r\n                                var numberLiteral = ctx.NumberLiteral[i];\r\n                                field.values.push(parseFloat(numberLiteral.image));\r\n                            }\r\n                        }\r\n                        if (ctx.HexLiteral) {\r\n                            field.type = 'hex';\r\n                            for (var i = 0, l = ctx.HexLiteral.length; i < l; i++) {\r\n                                var hexLiteral = ctx.HexLiteral[i];\r\n                                field.values.push(hexLiteral.image);\r\n                            }\r\n                        }\r\n                        if (ctx.TrueLiteral) {\r\n                            field.type = 'boolean';\r\n                            for (var i = 0, l = ctx.TrueLiteral.length; i < l; i++) {\r\n                                var trueLiteral = ctx.TrueLiteral[i];\r\n                                if (trueLiteral.image === 'TRUE')\r\n                                    field.values.push(true);\r\n                            }\r\n                        }\r\n                        if (ctx.FalseLiteral) {\r\n                            field.type = 'boolean';\r\n                            for (var i = 0, l = ctx.FalseLiteral.length; i < l; i++) {\r\n                                var falseLiteral = ctx.FalseLiteral[i];\r\n                                if (falseLiteral.image === 'FALSE')\r\n                                    field.values.push(false);\r\n                            }\r\n                        }\r\n                        if (ctx.NullLiteral) {\r\n                            field.type = 'null';\r\n                            ctx.NullLiteral.forEach(function () {\r\n                                field.values.push(null);\r\n                            });\r\n                        }\r\n                        return field;\r\n                    }\r\n                    return new VRMLToASTVisitor();\r\n                }\r\n                function parseTree(tree) {\r\n                    var nodes = tree.nodes;\r\n                    var scene = new THREE.Scene();\r\n                    for (var i = 0, l = nodes.length; i < l; i++) {\r\n                        var node = nodes[i];\r\n                        buildNodeMap(node);\r\n                    }\r\n                    for (var i = 0, l = nodes.length; i < l; i++) {\r\n                        var node = nodes[i];\r\n                        var object = getNode(node);\r\n                        if (object instanceof THREE.Object3D)\r\n                            scene.add(object);\r\n                    }\r\n                    return scene;\r\n                }\r\n                function buildNodeMap(node) {\r\n                    if (node.DEF) {\r\n                        nodeMap[node.DEF] = node;\r\n                    }\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        if (field.type === 'node') {\r\n                            var fieldValues = field.values;\r\n                            for (var j = 0, jl = fieldValues.length; j < jl; j++) {\r\n                                buildNodeMap(fieldValues[j]);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                function getNode(node) {\r\n                    if (node.USE) {\r\n                        return resolveUSE(node.USE);\r\n                    }\r\n                    if (node.build !== undefined)\r\n                        return node.build;\r\n                    node.build = buildNode(node);\r\n                    return node.build;\r\n                }\r\n                function buildNode(node) {\r\n                    var nodeName = node.name;\r\n                    var build;\r\n                    switch (nodeName) {\r\n                    case 'Group':\r\n                    case 'Transform':\r\n                        build = buildGroupingNode(node);\r\n                        break;\r\n                    case 'Background':\r\n                        build = buildBackgroundNode(node);\r\n                        break;\r\n                    case 'Shape':\r\n                        build = buildShapeNode(node);\r\n                        break;\r\n                    case 'Appearance':\r\n                        build = buildAppearanceNode(node);\r\n                        break;\r\n                    case 'Material':\r\n                        build = buildMaterialNode(node);\r\n                        break;\r\n                    case 'ImageTexture':\r\n                        build = buildImageTextureNode(node);\r\n                        break;\r\n                    case 'PixelTexture':\r\n                        build = buildPixelTextureNode(node);\r\n                        break;\r\n                    case 'TextureTransform':\r\n                        build = buildTextureTransformNode(node);\r\n                        break;\r\n                    case 'IndexedFaceSet':\r\n                        build = buildIndexedFaceSetNode(node);\r\n                        break;\r\n                    case 'IndexedLineSet':\r\n                        build = buildIndexedLineSetNode(node);\r\n                        break;\r\n                    case 'PointSet':\r\n                        build = buildPointSetNode(node);\r\n                        break;\r\n                    case 'Box':\r\n                        build = buildBoxNode(node);\r\n                        break;\r\n                    case 'Cone':\r\n                        build = buildConeNode(node);\r\n                        break;\r\n                    case 'Cylinder':\r\n                        build = buildCylinderNode(node);\r\n                        break;\r\n                    case 'Sphere':\r\n                        build = buildSphereNode(node);\r\n                        break;\r\n                    case 'Color':\r\n                    case 'Coordinate':\r\n                    case 'Normal':\r\n                    case 'TextureCoordinate':\r\n                        build = buildGeometricNode(node);\r\n                        break;\r\n                    case 'Anchor':\r\n                    case 'Billboard':\r\n                    case 'Collision':\r\n                    case 'Inline':\r\n                    case 'LOD':\r\n                    case 'Switch':\r\n                    case 'AudioClip':\r\n                    case 'DirectionalLight':\r\n                    case 'PointLight':\r\n                    case 'Script':\r\n                    case 'Sound':\r\n                    case 'SpotLight':\r\n                    case 'WorldInfo':\r\n                    case 'CylinderSensor':\r\n                    case 'PlaneSensor':\r\n                    case 'ProximitySensor':\r\n                    case 'SphereSensor':\r\n                    case 'TimeSensor':\r\n                    case 'TouchSensor':\r\n                    case 'VisibilitySensor':\r\n                    case 'ElevationGrid':\r\n                    case 'Extrusion':\r\n                    case 'Text':\r\n                    case 'FontStyle':\r\n                    case 'MovieTexture':\r\n                    case 'ColorInterpolator':\r\n                    case 'CoordinateInterpolator':\r\n                    case 'NormalInterpolator':\r\n                    case 'OrientationInterpolator':\r\n                    case 'PositionInterpolator':\r\n                    case 'ScalarInterpolator':\r\n                    case 'Fog':\r\n                    case 'NavigationInfo':\r\n                    case 'Viewpoint':\r\n                        break;\r\n                    default:\r\n                        console.warn('THREE.VRMLLoader: Unknown node:', nodeName);\r\n                        break;\r\n                    }\r\n                    return build;\r\n                }\r\n                function buildGroupingNode(node) {\r\n                    var object = new THREE.Group();\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'center':\r\n                            break;\r\n                        case 'children':\r\n                            parseFieldChildren(fieldValues, object);\r\n                            break;\r\n                        case 'rotation':\r\n                            var axis = new THREE.Vector3(fieldValues[0], fieldValues[1], fieldValues[2]);\r\n                            var angle = fieldValues[3];\r\n                            object.quaternion.setFromAxisAngle(axis, angle);\r\n                            break;\r\n                        case 'scale':\r\n                            object.scale.set(fieldValues[0], fieldValues[1], fieldValues[2]);\r\n                            break;\r\n                        case 'scaleOrientation':\r\n                            break;\r\n                        case 'translation':\r\n                            object.position.set(fieldValues[0], fieldValues[1], fieldValues[2]);\r\n                            break;\r\n                        case 'bboxCenter':\r\n                            break;\r\n                        case 'bboxSize':\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    return object;\r\n                }\r\n                function buildBackgroundNode(node) {\r\n                    var group = new THREE.Group();\r\n                    var groundAngle, groundColor;\r\n                    var skyAngle, skyColor;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'groundAngle':\r\n                            groundAngle = fieldValues;\r\n                            break;\r\n                        case 'groundColor':\r\n                            groundColor = fieldValues;\r\n                            break;\r\n                        case 'backUrl':\r\n                            break;\r\n                        case 'bottomUrl':\r\n                            break;\r\n                        case 'frontUrl':\r\n                            break;\r\n                        case 'leftUrl':\r\n                            break;\r\n                        case 'rightUrl':\r\n                            break;\r\n                        case 'topUrl':\r\n                            break;\r\n                        case 'skyAngle':\r\n                            skyAngle = fieldValues;\r\n                            break;\r\n                        case 'skyColor':\r\n                            skyColor = fieldValues;\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var radius = 10000;\r\n                    if (skyColor) {\r\n                        var skyGeometry = new THREE.SphereBufferGeometry(radius, 32, 16);\r\n                        var skyMaterial = new THREE.MeshBasicMaterial({\r\n                            fog: false,\r\n                            side: THREE.BackSide,\r\n                            depthWrite: false,\r\n                            depthTest: false\r\n                        });\r\n                        if (skyColor.length > 3) {\r\n                            paintFaces(skyGeometry, radius, skyAngle, toColorArray(skyColor), true);\r\n                            skyMaterial.vertexColors = true;\r\n                        } else {\r\n                            skyMaterial.color.setRGB(skyColor[0], skyColor[1], skyColor[2]);\r\n                        }\r\n                        var sky = new THREE.Mesh(skyGeometry, skyMaterial);\r\n                        group.add(sky);\r\n                    }\r\n                    if (groundColor) {\r\n                        if (groundColor.length > 0) {\r\n                            var groundGeometry = new THREE.SphereBufferGeometry(radius, 32, 16, 0, 2 * Math.PI, 0.5 * Math.PI, 1.5 * Math.PI);\r\n                            var groundMaterial = new THREE.MeshBasicMaterial({\r\n                                fog: false,\r\n                                side: THREE.BackSide,\r\n                                vertexColors: true,\r\n                                depthWrite: false,\r\n                                depthTest: false\r\n                            });\r\n                            paintFaces(groundGeometry, radius, groundAngle, toColorArray(groundColor), false);\r\n                            var ground = new THREE.Mesh(groundGeometry, groundMaterial);\r\n                            group.add(ground);\r\n                        }\r\n                    }\r\n                    group.renderOrder = -Infinity;\r\n                    return group;\r\n                }\r\n                function buildShapeNode(node) {\r\n                    var fields = node.fields;\r\n                    var material = new THREE.MeshBasicMaterial({ color: 0 });\r\n                    var geometry;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'appearance':\r\n                            if (fieldValues[0] !== null) {\r\n                                material = getNode(fieldValues[0]);\r\n                            }\r\n                            break;\r\n                        case 'geometry':\r\n                            if (fieldValues[0] !== null) {\r\n                                geometry = getNode(fieldValues[0]);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var object;\r\n                    if (geometry && geometry.attributes.position) {\r\n                        var type = geometry._type;\r\n                        if (type === 'points') {\r\n                            var pointsMaterial = new THREE.PointsMaterial({ color: 16777215 });\r\n                            if (geometry.attributes.color !== undefined) {\r\n                                pointsMaterial.vertexColors = true;\r\n                            } else {\r\n                                if (material.isMeshPhongMaterial) {\r\n                                    pointsMaterial.color.copy(material.emissive);\r\n                                }\r\n                            }\r\n                            object = new THREE.Points(geometry, pointsMaterial);\r\n                        } else if (type === 'line') {\r\n                            var lineMaterial = new THREE.LineBasicMaterial({ color: 16777215 });\r\n                            if (geometry.attributes.color !== undefined) {\r\n                                lineMaterial.vertexColors = true;\r\n                            } else {\r\n                                if (material.isMeshPhongMaterial) {\r\n                                    lineMaterial.color.copy(material.emissive);\r\n                                }\r\n                            }\r\n                            object = new THREE.LineSegments(geometry, lineMaterial);\r\n                        } else {\r\n                            if (geometry._solid !== undefined) {\r\n                                material.side = geometry._solid ? THREE.FrontSide : THREE.DoubleSide;\r\n                            }\r\n                            if (geometry.attributes.color !== undefined) {\r\n                                material.vertexColors = true;\r\n                            }\r\n                            object = new THREE.Mesh(geometry, material);\r\n                        }\r\n                    } else {\r\n                        object = new THREE.Object3D();\r\n                        object.visible = false;\r\n                    }\r\n                    return object;\r\n                }\r\n                function buildAppearanceNode(node) {\r\n                    var material = new THREE.MeshPhongMaterial();\r\n                    var transformData;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'material':\r\n                            if (fieldValues[0] !== null) {\r\n                                var materialData = getNode(fieldValues[0]);\r\n                                if (materialData.diffuseColor)\r\n                                    material.color.copy(materialData.diffuseColor);\r\n                                if (materialData.emissiveColor)\r\n                                    material.emissive.copy(materialData.emissiveColor);\r\n                                if (materialData.shininess)\r\n                                    material.shininess = materialData.shininess;\r\n                                if (materialData.specularColor)\r\n                                    material.specular.copy(materialData.specularColor);\r\n                                if (materialData.transparency)\r\n                                    material.opacity = 1 - materialData.transparency;\r\n                                if (materialData.transparency > 0)\r\n                                    material.transparent = true;\r\n                            } else {\r\n                                material = new THREE.MeshBasicMaterial({ color: 0 });\r\n                            }\r\n                            break;\r\n                        case 'texture':\r\n                            var textureNode = fieldValues[0];\r\n                            if (textureNode !== null) {\r\n                                if (textureNode.name === 'ImageTexture' || textureNode.name === 'PixelTexture') {\r\n                                    material.map = getNode(textureNode);\r\n                                } else {\r\n                                }\r\n                            }\r\n                            break;\r\n                        case 'textureTransform':\r\n                            if (fieldValues[0] !== null) {\r\n                                transformData = getNode(fieldValues[0]);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (material.map) {\r\n                        if (material.map.__type) {\r\n                            switch (material.map.__type) {\r\n                            case TEXTURE_TYPE.INTENSITY_ALPHA:\r\n                                material.opacity = 1;\r\n                                break;\r\n                            case TEXTURE_TYPE.RGB:\r\n                                material.color.set(16777215);\r\n                                break;\r\n                            case TEXTURE_TYPE.RGBA:\r\n                                material.color.set(16777215);\r\n                                material.opacity = 1;\r\n                                break;\r\n                            default:\r\n                            }\r\n                            delete material.map.__type;\r\n                        }\r\n                        if (transformData) {\r\n                            material.map.center.copy(transformData.center);\r\n                            material.map.rotation = transformData.rotation;\r\n                            material.map.repeat.copy(transformData.scale);\r\n                            material.map.offset.copy(transformData.translation);\r\n                        }\r\n                    }\r\n                    return material;\r\n                }\r\n                function buildMaterialNode(node) {\r\n                    var materialData = {};\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'ambientIntensity':\r\n                            break;\r\n                        case 'diffuseColor':\r\n                            materialData.diffuseColor = new THREE.Color(fieldValues[0], fieldValues[1], fieldValues[2]);\r\n                            break;\r\n                        case 'emissiveColor':\r\n                            materialData.emissiveColor = new THREE.Color(fieldValues[0], fieldValues[1], fieldValues[2]);\r\n                            break;\r\n                        case 'shininess':\r\n                            materialData.shininess = fieldValues[0];\r\n                            break;\r\n                        case 'specularColor':\r\n                            materialData.emissiveColor = new THREE.Color(fieldValues[0], fieldValues[1], fieldValues[2]);\r\n                            break;\r\n                        case 'transparency':\r\n                            materialData.transparency = fieldValues[0];\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    return materialData;\r\n                }\r\n                function parseHexColor(hex, textureType, color) {\r\n                    switch (textureType) {\r\n                    case TEXTURE_TYPE.INTENSITY:\r\n                        var value = parseInt(hex);\r\n                        color.r = value;\r\n                        color.g = value;\r\n                        color.b = value;\r\n                        break;\r\n                    case TEXTURE_TYPE.INTENSITY_ALPHA:\r\n                        var value = parseInt('0x' + hex.substring(2, 4));\r\n                        color.r = value;\r\n                        color.g = value;\r\n                        color.b = value;\r\n                        color.a = parseInt('0x' + hex.substring(4, 6));\r\n                        break;\r\n                    case TEXTURE_TYPE.RGB:\r\n                        color.r = parseInt('0x' + hex.substring(2, 4));\r\n                        color.g = parseInt('0x' + hex.substring(4, 6));\r\n                        color.b = parseInt('0x' + hex.substring(6, 8));\r\n                        break;\r\n                    case TEXTURE_TYPE.RGBA:\r\n                        color.r = parseInt('0x' + hex.substring(2, 4));\r\n                        color.g = parseInt('0x' + hex.substring(4, 6));\r\n                        color.b = parseInt('0x' + hex.substring(6, 8));\r\n                        color.a = parseInt('0x' + hex.substring(8, 10));\r\n                        break;\r\n                    default:\r\n                    }\r\n                }\r\n                function getTextureType(num_components) {\r\n                    var type;\r\n                    switch (num_components) {\r\n                    case 1:\r\n                        type = TEXTURE_TYPE.INTENSITY;\r\n                        break;\r\n                    case 2:\r\n                        type = TEXTURE_TYPE.INTENSITY_ALPHA;\r\n                        break;\r\n                    case 3:\r\n                        type = TEXTURE_TYPE.RGB;\r\n                        break;\r\n                    case 4:\r\n                        type = TEXTURE_TYPE.RGBA;\r\n                        break;\r\n                    default:\r\n                    }\r\n                    return type;\r\n                }\r\n                function buildPixelTextureNode(node) {\r\n                    var texture;\r\n                    var wrapS = THREE.RepeatWrapping;\r\n                    var wrapT = THREE.RepeatWrapping;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'image':\r\n                            var width = fieldValues[0];\r\n                            var height = fieldValues[1];\r\n                            var num_components = fieldValues[2];\r\n                            var useAlpha = num_components === 2 || num_components === 4;\r\n                            var textureType = getTextureType(num_components);\r\n                            var size = (useAlpha === true ? 4 : 3) * (width * height);\r\n                            var data = new Uint8Array(size);\r\n                            var color = {\r\n                                r: 0,\r\n                                g: 0,\r\n                                b: 0,\r\n                                a: 0\r\n                            };\r\n                            for (var j = 3, k = 0, jl = fieldValues.length; j < jl; j++, k++) {\r\n                                parseHexColor(fieldValues[j], textureType, color);\r\n                                if (useAlpha === true) {\r\n                                    var stride = k * 4;\r\n                                    data[stride + 0] = color.r;\r\n                                    data[stride + 1] = color.g;\r\n                                    data[stride + 2] = color.b;\r\n                                    data[stride + 3] = color.a;\r\n                                } else {\r\n                                    var stride = k * 3;\r\n                                    data[stride + 0] = color.r;\r\n                                    data[stride + 1] = color.g;\r\n                                    data[stride + 2] = color.b;\r\n                                }\r\n                            }\r\n                            texture = new THREE.DataTexture(data, width, height, useAlpha === true ? THREE.RGBAFormat : THREE.RGBFormat);\r\n                            texture.__type = textureType;\r\n                            break;\r\n                        case 'repeatS':\r\n                            if (fieldValues[0] === false)\r\n                                wrapS = THREE.ClampToEdgeWrapping;\r\n                            break;\r\n                        case 'repeatT':\r\n                            if (fieldValues[0] === false)\r\n                                wrapT = THREE.ClampToEdgeWrapping;\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (texture) {\r\n                        texture.wrapS = wrapS;\r\n                        texture.wrapT = wrapT;\r\n                    }\r\n                    return texture;\r\n                }\r\n                function buildImageTextureNode(node) {\r\n                    var texture;\r\n                    var wrapS = THREE.RepeatWrapping;\r\n                    var wrapT = THREE.RepeatWrapping;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'url':\r\n                            var url = fieldValues[0];\r\n                            if (url)\r\n                                texture = textureLoader.load(url);\r\n                            break;\r\n                        case 'repeatS':\r\n                            if (fieldValues[0] === false)\r\n                                wrapS = THREE.ClampToEdgeWrapping;\r\n                            break;\r\n                        case 'repeatT':\r\n                            if (fieldValues[0] === false)\r\n                                wrapT = THREE.ClampToEdgeWrapping;\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (texture) {\r\n                        texture.wrapS = wrapS;\r\n                        texture.wrapT = wrapT;\r\n                    }\r\n                    return texture;\r\n                }\r\n                function buildTextureTransformNode(node) {\r\n                    var transformData = {\r\n                        center: new THREE.Vector2(),\r\n                        rotation: new THREE.Vector2(),\r\n                        scale: new THREE.Vector2(),\r\n                        translation: new THREE.Vector2()\r\n                    };\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'center':\r\n                            transformData.center.set(fieldValues[0], fieldValues[1]);\r\n                            break;\r\n                        case 'rotation':\r\n                            transformData.rotation = fieldValues[0];\r\n                            break;\r\n                        case 'scale':\r\n                            transformData.scale.set(fieldValues[0], fieldValues[1]);\r\n                            break;\r\n                        case 'translation':\r\n                            transformData.translation.set(fieldValues[0], fieldValues[1]);\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    return transformData;\r\n                }\r\n                function buildGeometricNode(node) {\r\n                    return node.fields[0].values;\r\n                }\r\n                function buildIndexedFaceSetNode(node) {\r\n                    var color, coord, normal, texCoord;\r\n                    var ccw = true, solid = true, creaseAngle = 0;\r\n                    var colorIndex, coordIndex, normalIndex, texCoordIndex;\r\n                    var colorPerVertex = true, normalPerVertex = true;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'color':\r\n                            var colorNode = fieldValues[0];\r\n                            if (colorNode !== null) {\r\n                                color = getNode(colorNode);\r\n                            }\r\n                            break;\r\n                        case 'coord':\r\n                            var coordNode = fieldValues[0];\r\n                            if (coordNode !== null) {\r\n                                coord = getNode(coordNode);\r\n                            }\r\n                            break;\r\n                        case 'normal':\r\n                            var normalNode = fieldValues[0];\r\n                            if (normalNode !== null) {\r\n                                normal = getNode(normalNode);\r\n                            }\r\n                            break;\r\n                        case 'texCoord':\r\n                            var texCoordNode = fieldValues[0];\r\n                            if (texCoordNode !== null) {\r\n                                texCoord = getNode(texCoordNode);\r\n                            }\r\n                            break;\r\n                        case 'ccw':\r\n                            ccw = fieldValues[0];\r\n                            break;\r\n                        case 'colorIndex':\r\n                            colorIndex = fieldValues;\r\n                            break;\r\n                        case 'colorPerVertex':\r\n                            colorPerVertex = fieldValues[0];\r\n                            break;\r\n                        case 'convex':\r\n                            break;\r\n                        case 'coordIndex':\r\n                            coordIndex = fieldValues;\r\n                            break;\r\n                        case 'creaseAngle':\r\n                            creaseAngle = fieldValues[0];\r\n                            break;\r\n                        case 'normalIndex':\r\n                            normalIndex = fieldValues;\r\n                            break;\r\n                        case 'normalPerVertex':\r\n                            normalPerVertex = fieldValues[0];\r\n                            break;\r\n                        case 'solid':\r\n                            solid = fieldValues[0];\r\n                            break;\r\n                        case 'texCoordIndex':\r\n                            texCoordIndex = fieldValues;\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (coordIndex === undefined) {\r\n                        console.warn('THREE.VRMLLoader: Missing coordIndex.');\r\n                        return new THREE.BufferGeometry();\r\n                    }\r\n                    var triangulatedCoordIndex = triangulateFaceIndex(coordIndex, ccw);\r\n                    var positionAttribute;\r\n                    var colorAttribute;\r\n                    var normalAttribute;\r\n                    var uvAttribute;\r\n                    if (color) {\r\n                        if (colorPerVertex === true) {\r\n                            if (colorIndex && colorIndex.length > 0) {\r\n                                var triangulatedColorIndex = triangulateFaceIndex(colorIndex, ccw);\r\n                                colorAttribute = computeAttributeFromIndexedData(triangulatedCoordIndex, triangulatedColorIndex, color, 3);\r\n                            } else {\r\n                                colorAttribute = toNonIndexedAttribute(triangulatedCoordIndex, new THREE.Float32BufferAttribute(color, 3));\r\n                            }\r\n                        } else {\r\n                            if (colorIndex && colorIndex.length > 0) {\r\n                                var flattenFaceColors = flattenData(color, colorIndex);\r\n                                var triangulatedFaceColors = triangulateFaceData(flattenFaceColors, coordIndex);\r\n                                colorAttribute = computeAttributeFromFaceData(triangulatedCoordIndex, triangulatedFaceColors);\r\n                            } else {\r\n                                var triangulatedFaceColors = triangulateFaceData(color, coordIndex);\r\n                                colorAttribute = computeAttributeFromFaceData(triangulatedCoordIndex, triangulatedFaceColors);\r\n                            }\r\n                        }\r\n                    }\r\n                    if (normal) {\r\n                        if (normalPerVertex === true) {\r\n                            if (normalIndex && normalIndex.length > 0) {\r\n                                var triangulatedNormalIndex = triangulateFaceIndex(normalIndex, ccw);\r\n                                normalAttribute = computeAttributeFromIndexedData(triangulatedCoordIndex, triangulatedNormalIndex, normal, 3);\r\n                            } else {\r\n                                normalAttribute = toNonIndexedAttribute(triangulatedCoordIndex, new THREE.Float32BufferAttribute(normal, 3));\r\n                            }\r\n                        } else {\r\n                            if (normalIndex && normalIndex.length > 0) {\r\n                                var flattenFaceNormals = flattenData(normal, normalIndex);\r\n                                var triangulatedFaceNormals = triangulateFaceData(flattenFaceNormals, coordIndex);\r\n                                normalAttribute = computeAttributeFromFaceData(triangulatedCoordIndex, triangulatedFaceNormals);\r\n                            } else {\r\n                                var triangulatedFaceNormals = triangulateFaceData(normal, coordIndex);\r\n                                normalAttribute = computeAttributeFromFaceData(triangulatedCoordIndex, triangulatedFaceNormals);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        normalAttribute = computeNormalAttribute(triangulatedCoordIndex, coord, creaseAngle);\r\n                    }\r\n                    if (texCoord) {\r\n                        if (texCoordIndex && texCoordIndex.length > 0) {\r\n                            var triangulatedTexCoordIndex = triangulateFaceIndex(texCoordIndex, ccw);\r\n                            uvAttribute = computeAttributeFromIndexedData(triangulatedCoordIndex, triangulatedTexCoordIndex, texCoord, 2);\r\n                        } else {\r\n                            uvAttribute = toNonIndexedAttribute(triangulatedCoordIndex, new THREE.Float32BufferAttribute(texCoord, 2));\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.BufferGeometry();\r\n                    positionAttribute = toNonIndexedAttribute(triangulatedCoordIndex, new THREE.Float32BufferAttribute(coord, 3));\r\n                    geometry.setAttribute('position', positionAttribute);\r\n                    geometry.setAttribute('normal', normalAttribute);\r\n                    if (colorAttribute)\r\n                        geometry.setAttribute('color', colorAttribute);\r\n                    if (uvAttribute)\r\n                        geometry.setAttribute('uv', uvAttribute);\r\n                    geometry._solid = solid;\r\n                    geometry._type = 'mesh';\r\n                    return geometry;\r\n                }\r\n                function buildIndexedLineSetNode(node) {\r\n                    var color, coord;\r\n                    var colorIndex, coordIndex;\r\n                    var colorPerVertex = true;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'color':\r\n                            var colorNode = fieldValues[0];\r\n                            if (colorNode !== null) {\r\n                                color = getNode(colorNode);\r\n                            }\r\n                            break;\r\n                        case 'coord':\r\n                            var coordNode = fieldValues[0];\r\n                            if (coordNode !== null) {\r\n                                coord = getNode(coordNode);\r\n                            }\r\n                            break;\r\n                        case 'colorIndex':\r\n                            colorIndex = fieldValues;\r\n                            break;\r\n                        case 'colorPerVertex':\r\n                            colorPerVertex = fieldValues[0];\r\n                            break;\r\n                        case 'coordIndex':\r\n                            coordIndex = fieldValues;\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var colorAttribute;\r\n                    var expandedLineIndex = expandLineIndex(coordIndex);\r\n                    if (color) {\r\n                        if (colorPerVertex === true) {\r\n                            if (colorIndex.length > 0) {\r\n                                var expandedColorIndex = expandLineIndex(colorIndex);\r\n                                colorAttribute = computeAttributeFromIndexedData(expandedLineIndex, expandedColorIndex, color, 3);\r\n                            } else {\r\n                                colorAttribute = toNonIndexedAttribute(expandedLineIndex, new THREE.Float32BufferAttribute(color, 3));\r\n                            }\r\n                        } else {\r\n                            if (colorIndex.length > 0) {\r\n                                var flattenLineColors = flattenData(color, colorIndex);\r\n                                var expandedLineColors = expandLineData(flattenLineColors, coordIndex);\r\n                                colorAttribute = computeAttributeFromLineData(expandedLineIndex, expandedLineColors);\r\n                            } else {\r\n                                var expandedLineColors = expandLineData(color, coordIndex);\r\n                                colorAttribute = computeAttributeFromLineData(expandedLineIndex, expandedLineColors);\r\n                            }\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.BufferGeometry();\r\n                    var positionAttribute = toNonIndexedAttribute(expandedLineIndex, new THREE.Float32BufferAttribute(coord, 3));\r\n                    geometry.setAttribute('position', positionAttribute);\r\n                    if (colorAttribute)\r\n                        geometry.setAttribute('color', colorAttribute);\r\n                    geometry._type = 'line';\r\n                    return geometry;\r\n                }\r\n                function buildPointSetNode(node) {\r\n                    var geometry;\r\n                    var color, coord;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'color':\r\n                            var colorNode = fieldValues[0];\r\n                            if (colorNode !== null) {\r\n                                color = getNode(colorNode);\r\n                            }\r\n                            break;\r\n                        case 'coord':\r\n                            var coordNode = fieldValues[0];\r\n                            if (coordNode !== null) {\r\n                                coord = getNode(coordNode);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.BufferGeometry();\r\n                    geometry.setAttribute('position', new THREE.Float32BufferAttribute(coord, 3));\r\n                    if (color)\r\n                        geometry.setAttribute('color', new THREE.Float32BufferAttribute(color, 3));\r\n                    geometry._type = 'points';\r\n                    return geometry;\r\n                }\r\n                function buildBoxNode(node) {\r\n                    var size = new THREE.Vector3(2, 2, 2);\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'size':\r\n                            size.x = fieldValues[0];\r\n                            size.y = fieldValues[1];\r\n                            size.z = fieldValues[2];\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.BoxBufferGeometry(size.x, size.y, size.z);\r\n                    return geometry;\r\n                }\r\n                function buildConeNode(node) {\r\n                    var radius = 1, height = 2, openEnded = false;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'bottom':\r\n                            openEnded = !fieldValues[0];\r\n                            break;\r\n                        case 'bottomRadius':\r\n                            radius = fieldValues[0];\r\n                            break;\r\n                        case 'height':\r\n                            height = fieldValues[0];\r\n                            break;\r\n                        case 'side':\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.ConeBufferGeometry(radius, height, 16, 1, openEnded);\r\n                    return geometry;\r\n                }\r\n                function buildCylinderNode(node) {\r\n                    var radius = 1, height = 2;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'bottom':\r\n                            break;\r\n                        case 'radius':\r\n                            radius = fieldValues[0];\r\n                            break;\r\n                        case 'height':\r\n                            height = fieldValues[0];\r\n                            break;\r\n                        case 'side':\r\n                            break;\r\n                        case 'top':\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.CylinderBufferGeometry(radius, radius, height, 16, 1);\r\n                    return geometry;\r\n                }\r\n                function buildSphereNode(node) {\r\n                    var radius = 1;\r\n                    var fields = node.fields;\r\n                    for (var i = 0, l = fields.length; i < l; i++) {\r\n                        var field = fields[i];\r\n                        var fieldName = field.name;\r\n                        var fieldValues = field.values;\r\n                        switch (fieldName) {\r\n                        case 'radius':\r\n                            radius = fieldValues[0];\r\n                            break;\r\n                        default:\r\n                            console.warn('THREE.VRMLLoader: Unknown field:', fieldName);\r\n                            break;\r\n                        }\r\n                    }\r\n                    var geometry = new THREE.SphereBufferGeometry(radius, 16, 16);\r\n                    return geometry;\r\n                }\r\n                function resolveUSE(identifier) {\r\n                    var node = nodeMap[identifier];\r\n                    var build = getNode(node);\r\n                    return build.isObject3D || build.isMaterial ? build.clone() : build;\r\n                }\r\n                function parseFieldChildren(children, owner) {\r\n                    for (var i = 0, l = children.length; i < l; i++) {\r\n                        var object = getNode(children[i]);\r\n                        if (object instanceof THREE.Object3D)\r\n                            owner.add(object);\r\n                    }\r\n                }\r\n                function triangulateFaceIndex(index, ccw) {\r\n                    var indices = [];\r\n                    var start = 0;\r\n                    for (var i = 0, l = index.length; i < l; i++) {\r\n                        var i1 = index[start];\r\n                        var i2 = index[i + (ccw ? 1 : 2)];\r\n                        var i3 = index[i + (ccw ? 2 : 1)];\r\n                        indices.push(i1, i2, i3);\r\n                        if (index[i + 3] === -1 || i + 3 >= l) {\r\n                            i += 3;\r\n                            start = i + 1;\r\n                        }\r\n                    }\r\n                    return indices;\r\n                }\r\n                function triangulateFaceData(data, index) {\r\n                    var triangulatedData = [];\r\n                    var start = 0;\r\n                    for (var i = 0, l = index.length; i < l; i++) {\r\n                        var stride = start * 3;\r\n                        var x = data[stride];\r\n                        var y = data[stride + 1];\r\n                        var z = data[stride + 2];\r\n                        triangulatedData.push(x, y, z);\r\n                        if (index[i + 3] === -1 || i + 3 >= l) {\r\n                            i += 3;\r\n                            start++;\r\n                        }\r\n                    }\r\n                    return triangulatedData;\r\n                }\r\n                function flattenData(data, index) {\r\n                    var flattenData = [];\r\n                    for (var i = 0, l = index.length; i < l; i++) {\r\n                        var i1 = index[i];\r\n                        var stride = i1 * 3;\r\n                        var x = data[stride];\r\n                        var y = data[stride + 1];\r\n                        var z = data[stride + 2];\r\n                        flattenData.push(x, y, z);\r\n                    }\r\n                    return flattenData;\r\n                }\r\n                function expandLineIndex(index) {\r\n                    var indices = [];\r\n                    for (var i = 0, l = index.length; i < l; i++) {\r\n                        var i1 = index[i];\r\n                        var i2 = index[i + 1];\r\n                        indices.push(i1, i2);\r\n                        if (index[i + 2] === -1 || i + 2 >= l) {\r\n                            i += 2;\r\n                        }\r\n                    }\r\n                    return indices;\r\n                }\r\n                function expandLineData(data, index) {\r\n                    var triangulatedData = [];\r\n                    var start = 0;\r\n                    for (var i = 0, l = index.length; i < l; i++) {\r\n                        var stride = start * 3;\r\n                        var x = data[stride];\r\n                        var y = data[stride + 1];\r\n                        var z = data[stride + 2];\r\n                        triangulatedData.push(x, y, z);\r\n                        if (index[i + 2] === -1 || i + 2 >= l) {\r\n                            i += 2;\r\n                            start++;\r\n                        }\r\n                    }\r\n                    return triangulatedData;\r\n                }\r\n                var vA = new THREE.Vector3();\r\n                var vB = new THREE.Vector3();\r\n                var vC = new THREE.Vector3();\r\n                var uvA = new THREE.Vector2();\r\n                var uvB = new THREE.Vector2();\r\n                var uvC = new THREE.Vector2();\r\n                function computeAttributeFromIndexedData(coordIndex, index, data, itemSize) {\r\n                    var array = [];\r\n                    for (var i = 0, l = coordIndex.length; i < l; i += 3) {\r\n                        var a = index[i];\r\n                        var b = index[i + 1];\r\n                        var c = index[i + 2];\r\n                        if (itemSize === 2) {\r\n                            uvA.fromArray(data, a * itemSize);\r\n                            uvB.fromArray(data, b * itemSize);\r\n                            uvC.fromArray(data, c * itemSize);\r\n                            array.push(uvA.x, uvA.y);\r\n                            array.push(uvB.x, uvB.y);\r\n                            array.push(uvC.x, uvC.y);\r\n                        } else {\r\n                            vA.fromArray(data, a * itemSize);\r\n                            vB.fromArray(data, b * itemSize);\r\n                            vC.fromArray(data, c * itemSize);\r\n                            array.push(vA.x, vA.y, vA.z);\r\n                            array.push(vB.x, vB.y, vB.z);\r\n                            array.push(vC.x, vC.y, vC.z);\r\n                        }\r\n                    }\r\n                    return new THREE.Float32BufferAttribute(array, itemSize);\r\n                }\r\n                function computeAttributeFromFaceData(index, faceData) {\r\n                    var array = [];\r\n                    for (var i = 0, j = 0, l = index.length; i < l; i += 3, j++) {\r\n                        vA.fromArray(faceData, j * 3);\r\n                        array.push(vA.x, vA.y, vA.z);\r\n                        array.push(vA.x, vA.y, vA.z);\r\n                        array.push(vA.x, vA.y, vA.z);\r\n                    }\r\n                    return new THREE.Float32BufferAttribute(array, 3);\r\n                }\r\n                function computeAttributeFromLineData(index, lineData) {\r\n                    var array = [];\r\n                    for (var i = 0, j = 0, l = index.length; i < l; i += 2, j++) {\r\n                        vA.fromArray(lineData, j * 3);\r\n                        array.push(vA.x, vA.y, vA.z);\r\n                        array.push(vA.x, vA.y, vA.z);\r\n                    }\r\n                    return new THREE.Float32BufferAttribute(array, 3);\r\n                }\r\n                function toNonIndexedAttribute(indices, attribute) {\r\n                    var array = attribute.array;\r\n                    var itemSize = attribute.itemSize;\r\n                    var array2 = new array.constructor(indices.length * itemSize);\r\n                    var index = 0, index2 = 0;\r\n                    for (var i = 0, l = indices.length; i < l; i++) {\r\n                        index = indices[i] * itemSize;\r\n                        for (var j = 0; j < itemSize; j++) {\r\n                            array2[index2++] = array[index++];\r\n                        }\r\n                    }\r\n                    return new THREE.Float32BufferAttribute(array2, itemSize);\r\n                }\r\n                var ab = new THREE.Vector3();\r\n                var cb = new THREE.Vector3();\r\n                function computeNormalAttribute(index, coord, creaseAngle) {\r\n                    var faces = [];\r\n                    var vertexNormals = {};\r\n                    for (var i = 0, l = index.length; i < l; i += 3) {\r\n                        var a = index[i];\r\n                        var b = index[i + 1];\r\n                        var c = index[i + 2];\r\n                        var face = new Face(a, b, c);\r\n                        vA.fromArray(coord, a * 3);\r\n                        vB.fromArray(coord, b * 3);\r\n                        vC.fromArray(coord, c * 3);\r\n                        cb.subVectors(vC, vB);\r\n                        ab.subVectors(vA, vB);\r\n                        cb.cross(ab);\r\n                        cb.normalize();\r\n                        face.normal.copy(cb);\r\n                        if (vertexNormals[a] === undefined)\r\n                            vertexNormals[a] = [];\r\n                        if (vertexNormals[b] === undefined)\r\n                            vertexNormals[b] = [];\r\n                        if (vertexNormals[c] === undefined)\r\n                            vertexNormals[c] = [];\r\n                        vertexNormals[a].push(face.normal);\r\n                        vertexNormals[b].push(face.normal);\r\n                        vertexNormals[c].push(face.normal);\r\n                        faces.push(face);\r\n                    }\r\n                    var normals = [];\r\n                    for (var i = 0, l = faces.length; i < l; i++) {\r\n                        var face = faces[i];\r\n                        var nA = weightedNormal(vertexNormals[face.a], face.normal, creaseAngle);\r\n                        var nB = weightedNormal(vertexNormals[face.b], face.normal, creaseAngle);\r\n                        var nC = weightedNormal(vertexNormals[face.c], face.normal, creaseAngle);\r\n                        vA.fromArray(coord, face.a * 3);\r\n                        vB.fromArray(coord, face.b * 3);\r\n                        vC.fromArray(coord, face.c * 3);\r\n                        normals.push(nA.x, nA.y, nA.z);\r\n                        normals.push(nB.x, nB.y, nB.z);\r\n                        normals.push(nC.x, nC.y, nC.z);\r\n                    }\r\n                    return new THREE.Float32BufferAttribute(normals, 3);\r\n                }\r\n                function weightedNormal(normals, vector, creaseAngle) {\r\n                    var normal = new THREE.Vector3();\r\n                    if (creaseAngle === 0) {\r\n                        normal.copy(vector);\r\n                    } else {\r\n                        for (var i = 0, l = normals.length; i < l; i++) {\r\n                            if (normals[i].angleTo(vector) < creaseAngle) {\r\n                                normal.add(normals[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                    return normal.normalize();\r\n                }\r\n                function toColorArray(colors) {\r\n                    var array = [];\r\n                    for (var i = 0, l = colors.length; i < l; i += 3) {\r\n                        array.push(new THREE.Color(colors[i], colors[i + 1], colors[i + 2]));\r\n                    }\r\n                    return array;\r\n                }\r\n                function paintFaces(geometry, radius, angles, colors, topDown) {\r\n                    var thresholds = [];\r\n                    var startAngle = topDown === true ? 0 : Math.PI;\r\n                    for (var i = 0, l = colors.length; i < l; i++) {\r\n                        var angle = i === 0 ? 0 : angles[i - 1];\r\n                        angle = topDown === true ? angle : startAngle - angle;\r\n                        var point = new THREE.Vector3();\r\n                        point.setFromSphericalCoords(radius, angle, 0);\r\n                        thresholds.push(point);\r\n                    }\r\n                    var indices = geometry.index;\r\n                    var positionAttribute = geometry.attributes.position;\r\n                    var colorAttribute = new THREE.BufferAttribute(new Float32Array(geometry.attributes.position.count * 3), 3);\r\n                    var position = new THREE.Vector3();\r\n                    var color = new THREE.Color();\r\n                    for (var i = 0; i < indices.count; i++) {\r\n                        var index = indices.getX(i);\r\n                        position.fromBufferAttribute(positionAttribute, index);\r\n                        var thresholdIndexA, thresholdIndexB;\r\n                        var t = 1;\r\n                        for (var j = 1; j < thresholds.length; j++) {\r\n                            thresholdIndexA = j - 1;\r\n                            thresholdIndexB = j;\r\n                            var thresholdA = thresholds[thresholdIndexA];\r\n                            var thresholdB = thresholds[thresholdIndexB];\r\n                            if (topDown === true) {\r\n                                if (position.y <= thresholdA.y && position.y > thresholdB.y) {\r\n                                    t = Math.abs(thresholdA.y - position.y) / Math.abs(thresholdA.y - thresholdB.y);\r\n                                    break;\r\n                                }\r\n                            } else {\r\n                                if (position.y >= thresholdA.y && position.y < thresholdB.y) {\r\n                                    t = Math.abs(thresholdA.y - position.y) / Math.abs(thresholdA.y - thresholdB.y);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        var colorA = colors[thresholdIndexA];\r\n                        var colorB = colors[thresholdIndexB];\r\n                        color.copy(colorA).lerp(colorB, t);\r\n                        colorAttribute.setXYZ(index, color.r, color.g, color.b);\r\n                    }\r\n                    geometry.setAttribute('color', colorAttribute);\r\n                }\r\n                var textureLoader = new THREE.TextureLoader(this.manager);\r\n                textureLoader.setPath(this.resourcePath || path).setCrossOrigin(this.crossOrigin);\r\n                var tree = generateVRMLTree(data);\r\n                if (tree.version.indexOf('V2.0') === -1) {\r\n                    throw Error('THREE.VRMLLexer: Version of VRML asset not supported.');\r\n                }\r\n                var scene = parseTree(tree);\r\n                return scene;\r\n            }\r\n        });\r\n        function VRMLLexer(tokens) {\r\n            this.lexer = new chevrotain.Lexer(tokens);\r\n        }\r\n        VRMLLexer.prototype = {\r\n            constructor: VRMLLexer,\r\n            lex: function (inputText) {\r\n                var lexingResult = this.lexer.tokenize(inputText);\r\n                if (lexingResult.errors.length > 0) {\r\n                    console.error(lexingResult.errors);\r\n                    throw Error('THREE.VRMLLexer: Lexing errors detected.');\r\n                }\r\n                return lexingResult;\r\n            }\r\n        };\r\n        function VRMLParser(tokenVocabulary) {\r\n            chevrotain.Parser.call(this, tokenVocabulary);\r\n            var $ = this;\r\n            var Version = tokenVocabulary['Version'];\r\n            var LCurly = tokenVocabulary['LCurly'];\r\n            var RCurly = tokenVocabulary['RCurly'];\r\n            var LSquare = tokenVocabulary['LSquare'];\r\n            var RSquare = tokenVocabulary['RSquare'];\r\n            var Identifier = tokenVocabulary['Identifier'];\r\n            var RouteIdentifier = tokenVocabulary['RouteIdentifier'];\r\n            var StringLiteral = tokenVocabulary['StringLiteral'];\r\n            var HexLiteral = tokenVocabulary['HexLiteral'];\r\n            var NumberLiteral = tokenVocabulary['NumberLiteral'];\r\n            var TrueLiteral = tokenVocabulary['TrueLiteral'];\r\n            var FalseLiteral = tokenVocabulary['FalseLiteral'];\r\n            var NullLiteral = tokenVocabulary['NullLiteral'];\r\n            var DEF = tokenVocabulary['DEF'];\r\n            var USE = tokenVocabulary['USE'];\r\n            var ROUTE = tokenVocabulary['ROUTE'];\r\n            var TO = tokenVocabulary['TO'];\r\n            var NodeName = tokenVocabulary['NodeName'];\r\n            $.RULE('vrml', function () {\r\n                $.SUBRULE($.version);\r\n                $.AT_LEAST_ONE(function () {\r\n                    $.SUBRULE($.node);\r\n                });\r\n                $.MANY(function () {\r\n                    $.SUBRULE($.route);\r\n                });\r\n            });\r\n            $.RULE('version', function () {\r\n                $.CONSUME(Version);\r\n            });\r\n            $.RULE('node', function () {\r\n                $.OPTION(function () {\r\n                    $.SUBRULE($.def);\r\n                });\r\n                $.CONSUME(NodeName);\r\n                $.CONSUME(LCurly);\r\n                $.MANY(function () {\r\n                    $.SUBRULE($.field);\r\n                });\r\n                $.CONSUME(RCurly);\r\n            });\r\n            $.RULE('field', function () {\r\n                $.CONSUME(Identifier);\r\n                $.OR2([\r\n                    {\r\n                        ALT: function () {\r\n                            $.SUBRULE($.singleFieldValue);\r\n                        }\r\n                    },\r\n                    {\r\n                        ALT: function () {\r\n                            $.SUBRULE($.multiFieldValue);\r\n                        }\r\n                    }\r\n                ]);\r\n            });\r\n            $.RULE('def', function () {\r\n                $.CONSUME(DEF);\r\n                $.CONSUME(Identifier);\r\n            });\r\n            $.RULE('use', function () {\r\n                $.CONSUME(USE);\r\n                $.CONSUME(Identifier);\r\n            });\r\n            $.RULE('singleFieldValue', function () {\r\n                $.AT_LEAST_ONE(function () {\r\n                    $.OR([\r\n                        {\r\n                            ALT: function () {\r\n                                $.SUBRULE($.node);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.SUBRULE($.use);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(StringLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(HexLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(NumberLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(TrueLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(FalseLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(NullLiteral);\r\n                            }\r\n                        }\r\n                    ]);\r\n                });\r\n            });\r\n            $.RULE('multiFieldValue', function () {\r\n                $.CONSUME(LSquare);\r\n                $.MANY(function () {\r\n                    $.OR([\r\n                        {\r\n                            ALT: function () {\r\n                                $.SUBRULE($.node);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.SUBRULE($.use);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(StringLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(HexLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(NumberLiteral);\r\n                            }\r\n                        },\r\n                        {\r\n                            ALT: function () {\r\n                                $.CONSUME(NullLiteral);\r\n                            }\r\n                        }\r\n                    ]);\r\n                });\r\n                $.CONSUME(RSquare);\r\n            });\r\n            $.RULE('route', function () {\r\n                $.CONSUME(ROUTE);\r\n                $.CONSUME(RouteIdentifier);\r\n                $.CONSUME(TO);\r\n                $.CONSUME2(RouteIdentifier);\r\n            });\r\n            this.performSelfAnalysis();\r\n        }\r\n        VRMLParser.prototype = Object.create(chevrotain.Parser.prototype);\r\n        VRMLParser.prototype.constructor = VRMLParser;\r\n        function Face(a, b, c) {\r\n            this.a = a;\r\n            this.b = b;\r\n            this.c = c;\r\n            this.normal = new THREE.Vector3();\r\n        }\r\n        var TEXTURE_TYPE = {\r\n            INTENSITY: 1,\r\n            INTENSITY_ALPHA: 2,\r\n            RGB: 3,\r\n            RGBA: 4\r\n        };\r\n        return VRMLLoader;\r\n    }();\r\n\r\n    return threex.loaders.VRMLLoader = VRMLLoader;\r\n});"]}