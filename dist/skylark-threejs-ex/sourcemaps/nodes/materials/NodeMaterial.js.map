{"version":3,"sources":["nodes/materials/NodeMaterial.js"],"names":["define","THREE","NodeBuilder","ColorNode","PositionNode","RawNode","NodeMaterial","vertex","fragment","ShaderMaterial","call","this","self","PROJECTION","updaters","onBeforeCompile","shader","renderer","materialProperties","properties","get","version","__version","build","uniforms","vertexShader","fragmentShader","toString","needsCompile","prototype","Object","create","constructor","type","isNodeMaterial","defineProperties","needsUpdate","set","value","updateFrame","frame","i","length","updateNode","params","builder","setMaterial","getCode","defines","extensions","fog","requires","lights","transparent","blending","NormalBlending","copy","source","uuid","name","undefined","userData","JSON","parse","stringify","toJSON","meta","nodes","materials","data","size","sizeAttenuation","flatShading","side","FrontSide","vertexColors","NoColors","depthFunc","LessEqualDepth","depthTest","depthWrite","linewidth","dashSize","gapSize","scale","dithering","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","alphaTest","premultipliedAlpha","morphTargets","skinning","visible","material"],"mappings":"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","file":"../../../nodes/materials/NodeMaterial.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    '../core/NodeBuilder',\n    '../inputs/ColorNode',\n    '../accessors/PositionNode',\n    './nodes/RawNode'\n], function (\n    THREE, \n    NodeBuilder, \n    ColorNode, \n    PositionNode, \n    RawNode\n) {\n    'use strict';\n    function NodeMaterial(vertex, fragment) {\n        THREE.ShaderMaterial.call(this);\n        var self = this;\n        this.vertex = vertex || new RawNode(new PositionNode(PositionNode.PROJECTION));\n        this.fragment = fragment || new RawNode(new ColorNode(16711680));\n        this.updaters = [];\n        this.onBeforeCompile = function (shader, renderer) {\n            var materialProperties = renderer.properties.get(this);\n            if (this.version !== materialProperties.__version) {\n                this.build({ renderer: renderer });\n                shader.uniforms = this.uniforms;\n                shader.vertexShader = this.vertexShader;\n                shader.fragmentShader = this.fragmentShader;\n            }\n        };\n        this.onBeforeCompile.toString = function () {\n            return self.needsCompile;\n        };\n    }\n    NodeMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\n    NodeMaterial.prototype.constructor = NodeMaterial;\n    NodeMaterial.prototype.type = 'NodeMaterial';\n    NodeMaterial.prototype.isNodeMaterial = true;\n    Object.defineProperties(NodeMaterial.prototype, {\n        properties: {\n            get: function () {\n                return this.fragment.properties;\n            }\n        },\n        needsUpdate: {\n            set: function (value) {\n                if (value === true)\n                    this.version++;\n                this.needsCompile = value;\n            },\n            get: function () {\n                return this.needsCompile;\n            }\n        }\n    });\n    NodeMaterial.prototype.updateFrame = function (frame) {\n        for (var i = 0; i < this.updaters.length; ++i) {\n            frame.updateNode(this.updaters[i]);\n        }\n    };\n    NodeMaterial.prototype.build = function (params) {\n        params = params || {};\n        var builder = params.builder || new NodeBuilder();\n        builder.setMaterial(this, params.renderer);\n        builder.build(this.vertex, this.fragment);\n        this.vertexShader = builder.getCode('vertex');\n        this.fragmentShader = builder.getCode('fragment');\n        this.defines = builder.defines;\n        this.uniforms = builder.uniforms;\n        this.extensions = builder.extensions;\n        this.updaters = builder.updaters;\n        this.fog = builder.requires.fog;\n        this.lights = builder.requires.lights;\n        this.transparent = builder.requires.transparent || this.blending > THREE.NormalBlending;\n        return this;\n    };\n    NodeMaterial.prototype.copy = function (source) {\n        var uuid = this.uuid;\n        for (var name in source) {\n            this[name] = source[name];\n        }\n        this.uuid = uuid;\n        if (source.userData !== undefined) {\n            this.userData = JSON.parse(JSON.stringify(source.userData));\n        }\n        return this;\n    };\n    NodeMaterial.prototype.toJSON = function (meta) {\n        var isRootObject = meta === undefined || typeof meta === 'string';\n        if (isRootObject) {\n            meta = { nodes: {} };\n        }\n        if (meta && !meta.materials)\n            meta.materials = {};\n        if (!meta.materials[this.uuid]) {\n            var data = {};\n            data.uuid = this.uuid;\n            data.type = this.type;\n            meta.materials[data.uuid] = data;\n            if (this.name !== '')\n                data.name = this.name;\n            if (this.size !== undefined)\n                data.size = this.size;\n            if (this.sizeAttenuation !== undefined)\n                data.sizeAttenuation = this.sizeAttenuation;\n            if (this.blending !== THREE.NormalBlending)\n                data.blending = this.blending;\n            if (this.flatShading === true)\n                data.flatShading = this.flatShading;\n            if (this.side !== THREE.FrontSide)\n                data.side = this.side;\n            if (this.vertexColors !== THREE.NoColors)\n                data.vertexColors = this.vertexColors;\n            if (this.depthFunc !== THREE.LessEqualDepth)\n                data.depthFunc = this.depthFunc;\n            if (this.depthTest === false)\n                data.depthTest = this.depthTest;\n            if (this.depthWrite === false)\n                data.depthWrite = this.depthWrite;\n            if (this.linewidth !== 1)\n                data.linewidth = this.linewidth;\n            if (this.dashSize !== undefined)\n                data.dashSize = this.dashSize;\n            if (this.gapSize !== undefined)\n                data.gapSize = this.gapSize;\n            if (this.scale !== undefined)\n                data.scale = this.scale;\n            if (this.dithering === true)\n                data.dithering = true;\n            if (this.wireframe === true)\n                data.wireframe = this.wireframe;\n            if (this.wireframeLinewidth > 1)\n                data.wireframeLinewidth = this.wireframeLinewidth;\n            if (this.wireframeLinecap !== 'round')\n                data.wireframeLinecap = this.wireframeLinecap;\n            if (this.wireframeLinejoin !== 'round')\n                data.wireframeLinejoin = this.wireframeLinejoin;\n            if (this.alphaTest > 0)\n                data.alphaTest = this.alphaTest;\n            if (this.premultipliedAlpha === true)\n                data.premultipliedAlpha = this.premultipliedAlpha;\n            if (this.morphTargets === true)\n                data.morphTargets = true;\n            if (this.skinning === true)\n                data.skinning = true;\n            if (this.visible === false)\n                data.visible = false;\n            if (JSON.stringify(this.userData) !== '{}')\n                data.userData = this.userData;\n            data.fog = this.fog;\n            data.lights = this.lights;\n            data.vertex = this.vertex.toJSON(meta).uuid;\n            data.fragment = this.fragment.toJSON(meta).uuid;\n        }\n        meta.material = this.uuid;\n        return meta;\n    };\n    return NodeMaterial;\n});"]}