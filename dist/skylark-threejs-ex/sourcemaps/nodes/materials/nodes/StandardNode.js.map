{"version":3,"sources":["nodes/materials/nodes/StandardNode.js"],"names":["define","THREE","Node","ExpressionNode","ColorNode","FloatNode","SpecularMIPLevelNode","StandardNode","call","this","color","roughness","metalness","prototype","Object","create","constructor","nodeType","build","builder","code","useClearcoat","clearcoat","clearcoatRoughness","clearCoatNormal","requires","lights","extensions","derivatives","shaderTextureLOD","isShader","position","analyzeAndFlow","cache","undefined","mergeUniform","UniformsUtils","merge","UniformsLib","fog","LTC_1","uniforms","ltc_1","value","ltc_2","addParsCode","join","output","push","result","specularRoughness","contextEnvironment","bias","viewNormal","worldNormal","gamma","contextGammaOnly","contextClearcoatEnvironment","mask","analyze","slot","context","alpha","normal","clearcoatNormal","reflectivity","light","ao","ambient","shadow","emissive","environment","irradiance","sheen","flow","radiance","clearcoatEnv","transparent","copy","source","toJSON","meta","data","getJSONNode","createJSONNode","uuid"],"mappings":"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","file":"../../../../nodes/materials/nodes/StandardNode.js","sourcesContent":["define([\n    'skylark-threejs',\n    '../../core/Node',\n    '../../core/ExpressionNode',\n    '../../inputs/ColorNode',\n    '../../inputs/FloatNode',\n    '../../utils/SpecularMIPLevelNode'\n], function (\n    THREE, \n    Node, \n    ExpressionNode, \n    ColorNode, \n    FloatNode, \n    SpecularMIPLevelNode\n) {\n    'use strict';\n    function StandardNode() {\n        Node.call(this);\n        this.color = new ColorNode(16777215);\n        this.roughness = new FloatNode(1);\n        this.metalness = new FloatNode(0);\n    }\n    StandardNode.prototype = Object.create(Node.prototype);\n    StandardNode.prototype.constructor = StandardNode;\n    StandardNode.prototype.nodeType = 'Standard';\n    StandardNode.prototype.build = function (builder) {\n        var code;\n        builder.define('STANDARD');\n        var useClearcoat = this.clearcoat || this.clearcoatRoughness || this.clearCoatNormal;\n        if (useClearcoat) {\n            builder.define('CLEARCOAT');\n        }\n        builder.requires.lights = true;\n        builder.extensions.derivatives = true;\n        builder.extensions.shaderTextureLOD = true;\n        if (builder.isShader('vertex')) {\n            var position = this.position ? this.position.analyzeAndFlow(builder, 'v3', { cache: 'position' }) : undefined;\n            builder.mergeUniform(THREE.UniformsUtils.merge([\n                THREE.UniformsLib.fog,\n                THREE.UniformsLib.lights\n            ]));\n            if (THREE.UniformsLib.LTC_1) {\n                builder.uniforms.ltc_1 = { value: undefined };\n                builder.uniforms.ltc_2 = { value: undefined };\n            }\n            builder.addParsCode([\n                'varying vec3 vViewPosition;',\n                '#ifndef FLAT_SHADED',\n                '\\tvarying vec3 vNormal;',\n                '#endif',\n                '#include <fog_pars_vertex>',\n                '#include <morphtarget_pars_vertex>',\n                '#include <skinning_pars_vertex>',\n                '#include <shadowmap_pars_vertex>',\n                '#include <logdepthbuf_pars_vertex>',\n                '#include <clipping_planes_pars_vertex>'\n            ].join('\\n'));\n            var output = [\n                '#include <beginnormal_vertex>',\n                '#include <morphnormal_vertex>',\n                '#include <skinbase_vertex>',\n                '#include <skinnormal_vertex>',\n                '#include <defaultnormal_vertex>',\n                '#ifndef FLAT_SHADED',\n                '\\tvNormal = normalize( transformedNormal );',\n                '#endif',\n                '#include <begin_vertex>'\n            ];\n            if (position) {\n                output.push(position.code, position.result ? 'transformed = ' + position.result + ';' : '');\n            }\n            output.push('#include <morphtarget_vertex>', '#include <skinning_vertex>', '#include <project_vertex>', '#include <fog_vertex>', '#include <logdepthbuf_vertex>', '#include <clipping_planes_vertex>', '\\tvViewPosition = - mvPosition.xyz;', '#include <worldpos_vertex>', '#include <shadowmap_vertex>');\n            code = output.join('\\n');\n        } else {\n            var specularRoughness = new ExpressionNode('material.specularRoughness', 'f');\n            var clearcoatRoughness = new ExpressionNode('material.clearcoatRoughness', 'f');\n            var contextEnvironment = {\n                roughness: specularRoughness,\n                bias: new SpecularMIPLevelNode(specularRoughness),\n                viewNormal: new ExpressionNode('normal', 'v3'),\n                worldNormal: new ExpressionNode('inverseTransformDirection( geometry.normal, viewMatrix )', 'v3'),\n                gamma: true\n            };\n            var contextGammaOnly = { gamma: true };\n            var contextClearcoatEnvironment = {\n                roughness: clearcoatRoughness,\n                bias: new SpecularMIPLevelNode(clearcoatRoughness),\n                viewNormal: new ExpressionNode('clearcoatNormal', 'v3'),\n                worldNormal: new ExpressionNode('inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )', 'v3'),\n                gamma: true\n            };\n            if (this.mask)\n                this.mask.analyze(builder);\n            this.color.analyze(builder, {\n                slot: 'color',\n                context: contextGammaOnly\n            });\n            this.roughness.analyze(builder);\n            this.metalness.analyze(builder);\n            if (this.alpha)\n                this.alpha.analyze(builder);\n            if (this.normal)\n                this.normal.analyze(builder);\n            if (this.clearcoat)\n                this.clearcoat.analyze(builder);\n            if (this.clearcoatRoughness)\n                this.clearcoatRoughness.analyze(builder);\n            if (this.clearcoatNormal)\n                this.clearcoatNormal.analyze(builder);\n            if (this.reflectivity)\n                this.reflectivity.analyze(builder);\n            if (this.light)\n                this.light.analyze(builder, { cache: 'light' });\n            if (this.ao)\n                this.ao.analyze(builder);\n            if (this.ambient)\n                this.ambient.analyze(builder);\n            if (this.shadow)\n                this.shadow.analyze(builder);\n            if (this.emissive)\n                this.emissive.analyze(builder, { slot: 'emissive' });\n            if (this.environment) {\n                this.environment.analyze(builder, {\n                    cache: 'radiance',\n                    context: contextEnvironment,\n                    slot: 'radiance'\n                });\n                if (builder.requires.irradiance) {\n                    this.environment.analyze(builder, {\n                        cache: 'irradiance',\n                        context: contextEnvironment,\n                        slot: 'irradiance'\n                    });\n                }\n            }\n            if (this.sheen)\n                this.sheen.analyze(builder);\n            var mask = this.mask ? this.mask.flow(builder, 'b') : undefined;\n            var color = this.color.flow(builder, 'c', {\n                slot: 'color',\n                context: contextGammaOnly\n            });\n            var roughness = this.roughness.flow(builder, 'f');\n            var metalness = this.metalness.flow(builder, 'f');\n            var alpha = this.alpha ? this.alpha.flow(builder, 'f') : undefined;\n            var normal = this.normal ? this.normal.flow(builder, 'v3') : undefined;\n            var clearcoat = this.clearcoat ? this.clearcoat.flow(builder, 'f') : undefined;\n            var clearcoatRoughness = this.clearcoatRoughness ? this.clearcoatRoughness.flow(builder, 'f') : undefined;\n            var clearcoatNormal = this.clearcoatNormal ? this.clearcoatNormal.flow(builder, 'v3') : undefined;\n            var reflectivity = this.reflectivity ? this.reflectivity.flow(builder, 'f') : undefined;\n            var light = this.light ? this.light.flow(builder, 'v3', { cache: 'light' }) : undefined;\n            var ao = this.ao ? this.ao.flow(builder, 'f') : undefined;\n            var ambient = this.ambient ? this.ambient.flow(builder, 'c') : undefined;\n            var shadow = this.shadow ? this.shadow.flow(builder, 'c') : undefined;\n            var emissive = this.emissive ? this.emissive.flow(builder, 'c', { slot: 'emissive' }) : undefined;\n            var environment;\n            if (this.environment) {\n                environment = {\n                    radiance: this.environment.flow(builder, 'c', {\n                        cache: 'radiance',\n                        context: contextEnvironment,\n                        slot: 'radiance'\n                    })\n                };\n                if (builder.requires.irradiance) {\n                    environment.irradiance = this.environment.flow(builder, 'c', {\n                        cache: 'irradiance',\n                        context: contextEnvironment,\n                        slot: 'irradiance'\n                    });\n                }\n            }\n            var clearcoatEnv = useClearcoat && environment ? this.environment.flow(builder, 'c', {\n                cache: 'clearcoat',\n                context: contextClearcoatEnvironment,\n                slot: 'environment'\n            }) : undefined;\n            var sheen = this.sheen ? this.sheen.flow(builder, 'c') : undefined;\n            builder.requires.transparent = alpha !== undefined;\n            builder.addParsCode([\n                'varying vec3 vViewPosition;',\n                '#ifndef FLAT_SHADED',\n                '\\tvarying vec3 vNormal;',\n                '#endif',\n                '#include <dithering_pars_fragment>',\n                '#include <fog_pars_fragment>',\n                '#include <bsdfs>',\n                '#include <lights_pars_begin>',\n                '#include <lights_physical_pars_fragment>',\n                '#include <shadowmap_pars_fragment>',\n                '#include <logdepthbuf_pars_fragment>'\n            ].join('\\n'));\n            var output = [\n                '#include <clipping_planes_fragment>',\n                '\\t#include <normal_fragment_begin>',\n                '\\t#include <clearcoat_normal_fragment_begin>',\n                '\\tPhysicalMaterial material;',\n                '\\tmaterial.diffuseColor = vec3( 1.0 );'\n            ];\n            if (mask) {\n                output.push(mask.code, 'if ( ! ' + mask.result + ' ) discard;');\n            }\n            output.push(color.code, '\\tvec3 diffuseColor = ' + color.result + ';', '\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );', '#include <logdepthbuf_fragment>', roughness.code, '\\tfloat roughnessFactor = ' + roughness.result + ';', metalness.code, '\\tfloat metalnessFactor = ' + metalness.result + ';');\n            if (alpha) {\n                output.push(alpha.code, '#ifdef ALPHATEST', '\\tif ( ' + alpha.result + ' <= ALPHATEST ) discard;', '#endif');\n            }\n            if (normal) {\n                output.push(normal.code, 'normal = ' + normal.result + ';');\n            }\n            if (clearcoatNormal) {\n                output.push(clearcoatNormal.code, 'clearcoatNormal = ' + clearcoatNormal.result + ';');\n            }\n            output.push('vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );', 'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );');\n            output.push('material.diffuseColor = ' + (light ? 'vec3( 1.0 )' : 'diffuseColor * ( 1.0 - metalnessFactor )') + ';', 'material.specularRoughness = max( roughnessFactor, 0.0525 );', 'material.specularRoughness += geometryRoughness;', 'material.specularRoughness = min( material.specularRoughness, 1.0 );', 'material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );');\n            if (clearcoat) {\n                output.push(clearcoat.code, 'material.clearcoat = saturate( ' + clearcoat.result + ' );');\n            } else if (useClearcoat) {\n                output.push('material.clearcoat = 0.0;');\n            }\n            if (clearcoatRoughness) {\n                output.push(clearcoatRoughness.code, 'material.clearcoatRoughness = max( ' + clearcoatRoughness.result + ', 0.0525 );', 'material.clearcoatRoughness += geometryRoughness;', 'material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );');\n            } else if (useClearcoat) {\n                output.push('material.clearcoatRoughness = 0.0;');\n            }\n            if (sheen) {\n                output.push('material.sheenColor = ' + sheen.result + ';');\n            }\n            if (reflectivity) {\n                output.push(reflectivity.code, 'material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( ' + reflectivity.result + ' ) ), diffuseColor, metalnessFactor );');\n            } else {\n                output.push('material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );');\n            }\n            output.push('#include <lights_fragment_begin>');\n            if (light) {\n                output.push(light.code, 'reflectedLight.directDiffuse = ' + light.result + ';');\n                output.push('diffuseColor *= 1.0 - metalnessFactor;', 'reflectedLight.directDiffuse *= diffuseColor;', 'reflectedLight.indirectDiffuse *= diffuseColor;');\n            }\n            if (ao) {\n                output.push(ao.code, 'reflectedLight.indirectDiffuse *= ' + ao.result + ';', 'float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );', 'reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ' + ao.result + ', material.specularRoughness );');\n            }\n            if (ambient) {\n                output.push(ambient.code, 'reflectedLight.indirectDiffuse += ' + ambient.result + ';');\n            }\n            if (shadow) {\n                output.push(shadow.code, 'reflectedLight.directDiffuse *= ' + shadow.result + ';', 'reflectedLight.directSpecular *= ' + shadow.result + ';');\n            }\n            if (emissive) {\n                output.push(emissive.code, 'reflectedLight.directDiffuse += ' + emissive.result + ';');\n            }\n            if (environment) {\n                output.push(environment.radiance.code);\n                if (builder.requires.irradiance) {\n                    output.push(environment.irradiance.code);\n                }\n                if (clearcoatEnv) {\n                    output.push(clearcoatEnv.code, 'clearcoatRadiance += ' + clearcoatEnv.result + ';');\n                }\n                output.push('radiance += ' + environment.radiance.result + ';');\n                if (builder.requires.irradiance) {\n                    output.push('iblIrradiance += PI * ' + environment.irradiance.result + ';');\n                }\n            }\n            output.push('#include <lights_fragment_end>');\n            output.push('vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;');\n            if (alpha) {\n                output.push('gl_FragColor = vec4( outgoingLight, ' + alpha.result + ' );');\n            } else {\n                output.push('gl_FragColor = vec4( outgoingLight, 1.0 );');\n            }\n            output.push('#include <tonemapping_fragment>', '#include <encodings_fragment>', '#include <fog_fragment>', '#include <premultiplied_alpha_fragment>', '#include <dithering_fragment>');\n            code = output.join('\\n');\n        }\n        return code;\n    };\n    StandardNode.prototype.copy = function (source) {\n        Node.prototype.copy.call(this, source);\n        if (source.position)\n            this.position = source.position;\n        this.color = source.color;\n        this.roughness = source.roughness;\n        this.metalness = source.metalness;\n        if (source.mask)\n            this.mask = source.mask;\n        if (source.alpha)\n            this.alpha = source.alpha;\n        if (source.normal)\n            this.normal = source.normal;\n        if (source.clearcoat)\n            this.clearcoat = source.clearcoat;\n        if (source.clearcoatRoughness)\n            this.clearcoatRoughness = source.clearcoatRoughness;\n        if (source.clearcoatNormal)\n            this.clearcoatNormal = source.clearcoatNormal;\n        if (source.reflectivity)\n            this.reflectivity = source.reflectivity;\n        if (source.light)\n            this.light = source.light;\n        if (source.shadow)\n            this.shadow = source.shadow;\n        if (source.ao)\n            this.ao = source.ao;\n        if (source.emissive)\n            this.emissive = source.emissive;\n        if (source.ambient)\n            this.ambient = source.ambient;\n        if (source.environment)\n            this.environment = source.environment;\n        if (source.sheen)\n            this.sheen = source.sheen;\n        return this;\n    };\n    StandardNode.prototype.toJSON = function (meta) {\n        var data = this.getJSONNode(meta);\n        if (!data) {\n            data = this.createJSONNode(meta);\n            if (this.position)\n                data.position = this.position.toJSON(meta).uuid;\n            data.color = this.color.toJSON(meta).uuid;\n            data.roughness = this.roughness.toJSON(meta).uuid;\n            data.metalness = this.metalness.toJSON(meta).uuid;\n            if (this.mask)\n                data.mask = this.mask.toJSON(meta).uuid;\n            if (this.alpha)\n                data.alpha = this.alpha.toJSON(meta).uuid;\n            if (this.normal)\n                data.normal = this.normal.toJSON(meta).uuid;\n            if (this.clearcoat)\n                data.clearcoat = this.clearcoat.toJSON(meta).uuid;\n            if (this.clearcoatRoughness)\n                data.clearcoatRoughness = this.clearcoatRoughness.toJSON(meta).uuid;\n            if (this.clearcoatNormal)\n                data.clearcoatNormal = this.clearcoatNormal.toJSON(meta).uuid;\n            if (this.reflectivity)\n                data.reflectivity = this.reflectivity.toJSON(meta).uuid;\n            if (this.light)\n                data.light = this.light.toJSON(meta).uuid;\n            if (this.shadow)\n                data.shadow = this.shadow.toJSON(meta).uuid;\n            if (this.ao)\n                data.ao = this.ao.toJSON(meta).uuid;\n            if (this.emissive)\n                data.emissive = this.emissive.toJSON(meta).uuid;\n            if (this.ambient)\n                data.ambient = this.ambient.toJSON(meta).uuid;\n            if (this.environment)\n                data.environment = this.environment.toJSON(meta).uuid;\n            if (this.sheen)\n                data.sheen = this.sheen.toJSON(meta).uuid;\n        }\n        return data;\n    };\n    return StandardNode;\n});"]}