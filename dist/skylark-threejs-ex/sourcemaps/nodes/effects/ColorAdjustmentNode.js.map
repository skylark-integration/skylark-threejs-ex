{"version":3,"sources":["nodes/effects/ColorAdjustmentNode.js"],"names":["define","TempNode","FunctionNode","LuminanceNode","ColorAdjustmentNode","rgb","adjustment","method","call","this","SATURATION","Nodes","hue","join","saturation","luminance","vibrance","HUE","VIBRANCE","BRIGHTNESS","CONTRAST","prototype","Object","create","constructor","nodeType","generate","builder","output","build","format","getType","include","copy","source","toJSON","meta","data","getJSONNode","createJSONNode","uuid"],"mappings":";;;;;;;AAAAA,QACI,mBACA,uBACA,mBACD,SACCC,EACAC,EACAC,GAEA,aACA,SAASC,EAAoBC,EAAKC,EAAYC,GAC1CN,EAASO,KAAKC,KAAM,MACpBA,KAAKJ,IAAMA,EACXI,KAAKH,WAAaA,EAClBG,KAAKF,OAASA,GAAUH,EAAoBM,WAuEhD,OArEAN,EAAoBO,OA0BZC,IAzBM,IAAIV,GACV,yCACA,oHACA,iGACA,+BACA,iDACA,wDACA,yEACA,KACFW,KAAK,OAiBHC,WAhBa,IAAIZ,GACjB,gDACA,+CACA,8CACA,KACFW,KAAK,OAAQV,EAAcQ,MAAMI,YAY/BC,SAXW,IAAId,GACf,8CACA,mDACA,8CACA,sDACA,wCACA,KACFW,KAAK,QAOXT,EAAoBM,WAAa,aACjCN,EAAoBa,IAAM,MAC1Bb,EAAoBc,SAAW,WAC/Bd,EAAoBe,WAAa,aACjCf,EAAoBgB,SAAW,WAC/BhB,EAAoBiB,UAAYC,OAAOC,OAAOtB,EAASoB,WACvDjB,EAAoBiB,UAAUG,YAAcpB,EAC5CA,EAAoBiB,UAAUI,SAAW,kBACzCrB,EAAoBiB,UAAUK,SAAW,SAAUC,EAASC,GACxD,IAAIvB,EAAMI,KAAKJ,IAAIwB,MAAMF,EAAS,MAAOrB,EAAaG,KAAKH,WAAWuB,MAAMF,EAAS,KACrF,OAAQlB,KAAKF,QACb,KAAKH,EAAoBe,WACrB,OAAOQ,EAAQG,OAAO,KAAOzB,EAAM,MAAQC,EAAa,KAAMG,KAAKsB,QAAQJ,GAAUC,GAEzF,KAAKxB,EAAoBgB,SACrB,OAAOO,EAAQG,OAAO,KAAOzB,EAAM,MAAQC,EAAa,KAAMG,KAAKsB,QAAQJ,GAAUC,GAGzF,IAAIrB,EAASoB,EAAQK,QAAQ5B,EAAoBO,MAAMF,KAAKF,SAC5D,OAAOoB,EAAQG,OAAOvB,EAAS,KAAOF,EAAM,KAAOC,EAAa,KAAMG,KAAKsB,QAAQJ,GAAUC,IAEjGxB,EAAoBiB,UAAUY,KAAO,SAAUC,GAK3C,OAJAjC,EAASoB,UAAUY,KAAKzB,KAAKC,KAAMyB,GACnCzB,KAAKJ,IAAM6B,EAAO7B,IAClBI,KAAKH,WAAa4B,EAAO5B,WACzBG,KAAKF,OAAS2B,EAAO3B,OACdE,MAEXL,EAAoBiB,UAAUc,OAAS,SAAUC,GAC7C,IAAIC,EAAO5B,KAAK6B,YAAYF,GAO5B,OANKC,KACDA,EAAO5B,KAAK8B,eAAeH,IACtB/B,IAAMI,KAAKJ,IAAI8B,OAAOC,GAAMI,KACjCH,EAAK/B,WAAaG,KAAKH,WAAW6B,OAAOC,GAAMI,KAC/CH,EAAK9B,OAASE,KAAKF,QAEhB8B,GAEJjC","file":"../../../nodes/effects/ColorAdjustmentNode.js","sourcesContent":["define([\r\n    '../core/TempNode',\r\n    '../core/FunctionNode',\r\n    './LuminanceNode'\r\n], function (\r\n    TempNode, \r\n    FunctionNode, \r\n    LuminanceNode\r\n) {\r\n    'use strict';\r\n    function ColorAdjustmentNode(rgb, adjustment, method) {\r\n        TempNode.call(this, 'v3');\r\n        this.rgb = rgb;\r\n        this.adjustment = adjustment;\r\n        this.method = method || ColorAdjustmentNode.SATURATION;\r\n    }\r\n    ColorAdjustmentNode.Nodes = function () {\r\n        var hue = new FunctionNode([\r\n            'vec3 hue(vec3 rgb, float adjustment) {',\r\n            '\\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);',\r\n            '\\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);',\r\n            '\\tvec3 yiq = RGBtoYIQ * rgb;',\r\n            '\\tfloat hue = atan(yiq.z, yiq.y) + adjustment;',\r\n            '\\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);',\r\n            '\\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));',\r\n            '}'\r\n        ].join('\\n'));\r\n        var saturation = new FunctionNode([\r\n            'vec3 saturation(vec3 rgb, float adjustment) {',\r\n            '\\tvec3 intensity = vec3( luminance( rgb ) );',\r\n            '\\treturn mix( intensity, rgb, adjustment );',\r\n            '}'\r\n        ].join('\\n'), [LuminanceNode.Nodes.luminance]);\r\n        var vibrance = new FunctionNode([\r\n            'vec3 vibrance(vec3 rgb, float adjustment) {',\r\n            '\\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;',\r\n            '\\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));',\r\n            '\\tfloat amt = (mx - average) * (-3.0 * adjustment);',\r\n            '\\treturn mix(rgb.rgb, vec3(mx), amt);',\r\n            '}'\r\n        ].join('\\n'));\r\n        return {\r\n            hue: hue,\r\n            saturation: saturation,\r\n            vibrance: vibrance\r\n        };\r\n    }();\r\n    ColorAdjustmentNode.SATURATION = 'saturation';\r\n    ColorAdjustmentNode.HUE = 'hue';\r\n    ColorAdjustmentNode.VIBRANCE = 'vibrance';\r\n    ColorAdjustmentNode.BRIGHTNESS = 'brightness';\r\n    ColorAdjustmentNode.CONTRAST = 'contrast';\r\n    ColorAdjustmentNode.prototype = Object.create(TempNode.prototype);\r\n    ColorAdjustmentNode.prototype.constructor = ColorAdjustmentNode;\r\n    ColorAdjustmentNode.prototype.nodeType = 'ColorAdjustment';\r\n    ColorAdjustmentNode.prototype.generate = function (builder, output) {\r\n        var rgb = this.rgb.build(builder, 'v3'), adjustment = this.adjustment.build(builder, 'f');\r\n        switch (this.method) {\r\n        case ColorAdjustmentNode.BRIGHTNESS:\r\n            return builder.format('( ' + rgb + ' + ' + adjustment + ' )', this.getType(builder), output);\r\n            break;\r\n        case ColorAdjustmentNode.CONTRAST:\r\n            return builder.format('( ' + rgb + ' * ' + adjustment + ' )', this.getType(builder), output);\r\n            break;\r\n        }\r\n        var method = builder.include(ColorAdjustmentNode.Nodes[this.method]);\r\n        return builder.format(method + '( ' + rgb + ', ' + adjustment + ' )', this.getType(builder), output);\r\n    };\r\n    ColorAdjustmentNode.prototype.copy = function (source) {\r\n        TempNode.prototype.copy.call(this, source);\r\n        this.rgb = source.rgb;\r\n        this.adjustment = source.adjustment;\r\n        this.method = source.method;\r\n        return this;\r\n    };\r\n    ColorAdjustmentNode.prototype.toJSON = function (meta) {\r\n        var data = this.getJSONNode(meta);\r\n        if (!data) {\r\n            data = this.createJSONNode(meta);\r\n            data.rgb = this.rgb.toJSON(meta).uuid;\r\n            data.adjustment = this.adjustment.toJSON(meta).uuid;\r\n            data.method = this.method;\r\n        }\r\n        return data;\r\n    };\r\n    return ColorAdjustmentNode;\r\n});"]}