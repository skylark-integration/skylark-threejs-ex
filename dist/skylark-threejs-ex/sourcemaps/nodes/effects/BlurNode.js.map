{"version":3,"sources":["nodes/effects/BlurNode.js"],"names":["define","THREE","TempNode","FunctionNode","FloatNode","Vector2Node","UVNode","BlurNode","value","uv","radius","size","call","this","blurX","blurY","horizontal","vertical","Nodes","join","prototype","Object","create","constructor","nodeType","updateFrame","x","y","image","width","height","generate","builder","output","isShader","code","blurCode","include","push","build","length","format","getType","console","warn","shader","copy","source","undefined","Vector2","toJSON","meta","data","getJSONNode","createJSONNode","uuid"],"mappings":"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","file":"../../../nodes/effects/BlurNode.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    '../core/TempNode',\n    '../core/FunctionNode',\n    '../inputs/FloatNode',\n    '../inputs/Vector2Node',\n    '../accessors/UVNode'\n], function (\n    THREE, \n    TempNode, \n    FunctionNode, \n    FloatNode, \n    Vector2Node, \n    UVNode\n) {\n    'use strict';\n    function BlurNode(value, uv, radius, size) {\n        TempNode.call(this, 'v4');\n        this.value = value;\n        this.uv = uv || new UVNode();\n        this.radius = radius || new Vector2Node(1, 1);\n        this.size = size;\n        this.blurX = true;\n        this.blurY = true;\n        this.horizontal = new FloatNode(1 / 64);\n        this.vertical = new FloatNode(1 / 64);\n    }\n    BlurNode.Nodes = function () {\n        var blurX = new FunctionNode([\n            'vec4 blurX( sampler2D texture, vec2 uv, float s ) {',\n            '\\tvec4 sum = vec4( 0.0 );',\n            '\\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;',\n            '\\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;',\n            '\\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;',\n            '\\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;',\n            '\\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;',\n            '\\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;',\n            '\\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;',\n            '\\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;',\n            '\\treturn sum * .667;',\n            '}'\n        ].join('\\n'));\n        var blurY = new FunctionNode([\n            'vec4 blurY( sampler2D texture, vec2 uv, float s ) {',\n            '\\tvec4 sum = vec4( 0.0 );',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;',\n            '\\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;',\n            '\\treturn sum * .667;',\n            '}'\n        ].join('\\n'));\n        return {\n            blurX: blurX,\n            blurY: blurY\n        };\n    }();\n    BlurNode.prototype = Object.create(TempNode.prototype);\n    BlurNode.prototype.constructor = BlurNode;\n    BlurNode.prototype.nodeType = 'Blur';\n    BlurNode.prototype.updateFrame = function () {\n        if (this.size) {\n            this.horizontal.value = this.radius.x / this.size.x;\n            this.vertical.value = this.radius.y / this.size.y;\n        } else if (this.value.value && this.value.value.image) {\n            var image = this.value.value.image;\n            this.horizontal.value = this.radius.x / image.width;\n            this.vertical.value = this.radius.y / image.height;\n        }\n    };\n    BlurNode.prototype.generate = function (builder, output) {\n        if (builder.isShader('fragment')) {\n            var blurCode = [], code;\n            var blurX = builder.include(BlurNode.Nodes.blurX), blurY = builder.include(BlurNode.Nodes.blurY);\n            if (this.blurX) {\n                blurCode.push(blurX + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.uv.build(builder, 'v2') + ', ' + this.horizontal.build(builder, 'f') + ' )');\n            }\n            if (this.blurY) {\n                blurCode.push(blurY + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.uv.build(builder, 'v2') + ', ' + this.vertical.build(builder, 'f') + ' )');\n            }\n            if (blurCode.length == 2)\n                code = '( ' + blurCode.join(' + ') + ' / 2.0 )';\n            else if (blurCode.length)\n                code = '( ' + blurCode[0] + ' )';\n            else\n                code = 'vec4( 0.0 )';\n            return builder.format(code, this.getType(builder), output);\n        } else {\n            console.warn('THREE.BlurNode is not compatible with ' + builder.shader + ' shader.');\n            return builder.format('vec4( 0.0 )', this.getType(builder), output);\n        }\n    };\n    BlurNode.prototype.copy = function (source) {\n        TempNode.prototype.copy.call(this, source);\n        this.value = source.value;\n        this.uv = source.uv;\n        this.radius = source.radius;\n        if (source.size !== undefined)\n            this.size = new THREE.Vector2(source.size.x, source.size.y);\n        this.blurX = source.blurX;\n        this.blurY = source.blurY;\n        return this;\n    };\n    BlurNode.prototype.toJSON = function (meta) {\n        var data = this.getJSONNode(meta);\n        if (!data) {\n            data = this.createJSONNode(meta);\n            data.value = this.value.toJSON(meta).uuid;\n            data.uv = this.uv.toJSON(meta).uuid;\n            data.radius = this.radius.toJSON(meta).uuid;\n            if (this.size)\n                data.size = {\n                    x: this.size.x,\n                    y: this.size.y\n                };\n            data.blurX = this.blurX;\n            data.blurY = this.blurY;\n        }\n        return data;\n    };\n    return BlurNode;\n});"]}