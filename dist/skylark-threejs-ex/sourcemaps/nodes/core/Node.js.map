{"version":3,"sources":["nodes/core/Node.js"],"names":["define","THREE","Node","type","this","uuid","MathUtils","generateUUID","name","userData","prototype","constructor","isNode","analyze","builder","settings","analyzing","build","addFlow","slot","cache","context","clearVertexNodeCode","clearFragmentNodeCode","removeFlow","analyzeAndFlow","output","flow","result","code","clearNodeCode","extra","getType","data","getNodeData","appendDepsNode","nodes","indexOf","push","undefined","updateFrame","updaters","generate","deps","outputLen","getTypeLength","outputMax","setName","getName","getJSONNode","meta","copy","source","JSON","parse","stringify","createJSONNode","isRootObject","nodeType","Error","toJSON"],"mappings":"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","file":"../../../nodes/core/Node.js","sourcesContent":["define([\n    \"skylark-threejs\"\n], function (THREE) {\n    'use strict';\n    function Node(type) {\n        this.uuid = THREE.MathUtils.generateUUID();\n        this.name = '';\n        this.type = type;\n        this.userData = {};\n    }\n    Node.prototype = {\n        constructor: Node,\n        isNode: true,\n        analyze: function (builder, settings) {\n            settings = settings || {};\n            builder.analyzing = true;\n            this.build(builder.addFlow(settings.slot, settings.cache, settings.context), 'v4');\n            builder.clearVertexNodeCode();\n            builder.clearFragmentNodeCode();\n            builder.removeFlow();\n            builder.analyzing = false;\n        },\n        analyzeAndFlow: function (builder, output, settings) {\n            settings = settings || {};\n            this.analyze(builder, settings);\n            return this.flow(builder, output, settings);\n        },\n        flow: function (builder, output, settings) {\n            settings = settings || {};\n            builder.addFlow(settings.slot, settings.cache, settings.context);\n            var flow = {};\n            flow.result = this.build(builder, output);\n            flow.code = builder.clearNodeCode();\n            flow.extra = builder.context.extra;\n            builder.removeFlow();\n            return flow;\n        },\n        build: function (builder, output, uuid) {\n            output = output || this.getType(builder, output);\n            var data = builder.getNodeData(uuid || this);\n            if (builder.analyzing) {\n                this.appendDepsNode(builder, data, output);\n            }\n            if (builder.nodes.indexOf(this) === -1) {\n                builder.nodes.push(this);\n            }\n            if (this.updateFrame !== undefined && builder.updaters.indexOf(this) === -1) {\n                builder.updaters.push(this);\n            }\n            return this.generate(builder, output, uuid);\n        },\n        generate: function () {\n        },\n        appendDepsNode: function (builder, data, output) {\n            data.deps = (data.deps || 0) + 1;\n            var outputLen = builder.getTypeLength(output);\n            if (outputLen > (data.outputMax || 0) || this.getType(builder, output)) {\n                data.outputMax = outputLen;\n                data.output = output;\n            }\n        },\n        setName: function (name) {\n            this.name = name;\n            return this;\n        },\n        getName: function () {\n            return this.name;\n        },\n        getType: function (builder, output) {\n            return output === 'sampler2D' || output === 'samplerCube' ? output : this.type;\n        },\n        getJSONNode: function (meta) {\n            var isRootObject = meta === undefined || typeof meta === 'string';\n            if (!isRootObject && meta.nodes[this.uuid] !== undefined) {\n                return meta.nodes[this.uuid];\n            }\n        },\n        copy: function (source) {\n            if (source.name !== undefined)\n                this.name = source.name;\n            if (source.userData !== undefined)\n                this.userData = JSON.parse(JSON.stringify(source.userData));\n            return this;\n        },\n        createJSONNode: function (meta) {\n            var isRootObject = meta === undefined || typeof meta === 'string';\n            var data = {};\n            if (typeof this.nodeType !== 'string')\n                throw new Error('Node does not allow serialization.');\n            data.uuid = this.uuid;\n            data.nodeType = this.nodeType;\n            if (this.name !== '')\n                data.name = this.name;\n            if (JSON.stringify(this.userData) !== '{}')\n                data.userData = this.userData;\n            if (!isRootObject) {\n                meta.nodes[this.uuid] = data;\n            }\n            return data;\n        },\n        toJSON: function (meta) {\n            return this.getJSONNode(meta) || this.createJSONNode(meta);\n        }\n    };\n    return Node;\n});"]}