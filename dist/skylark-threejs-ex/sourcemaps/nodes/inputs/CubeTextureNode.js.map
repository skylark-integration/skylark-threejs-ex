{"version":3,"sources":["nodes/inputs/CubeTextureNode.js"],"names":["define","InputNode","ReflectNode","ColorSpaceNode","ExpressionNode","CubeTextureNode","value","uv","bias","call","this","shared","prototype","Object","create","constructor","nodeType","getTexture","builder","output","generate","uuid","code","cubetex","build","undefined","context","setTexture","include","isShader","ignoreCache","outputType","getType","addContext","colorSpace","fromDecoding","getTextureEncodingFromMap","input","parse","removeContext","format","copy","source","toJSON","meta","data","getJSONNode","createJSONNode"],"mappings":";;;;;;;AAAAA,QACI,oBACA,2BACA,0BACA,0BACD,SAAUC,EAAWC,EAAaC,EAAgBC,GACjD,aACA,SAASC,EAAgBC,EAAOC,EAAIC,GAChCP,EAAUQ,KAAKC,KAAM,MAAQC,QAAQ,IACrCD,KAAKJ,MAAQA,EACbI,KAAKH,GAAKA,GAAM,IAAIL,EACpBQ,KAAKF,KAAOA,EAwDhB,OAtDAH,EAAgBO,UAAYC,OAAOC,OAAOb,EAAUW,WACpDP,EAAgBO,UAAUG,YAAcV,EACxCA,EAAgBO,UAAUI,SAAW,cACrCX,EAAgBO,UAAUK,WAAa,SAAUC,EAASC,GACtD,OAAOlB,EAAUW,UAAUQ,SAASX,KAAKC,KAAMQ,EAASC,EAAQT,KAAKJ,MAAMe,KAAM,OAErFhB,EAAgBO,UAAUQ,SAAW,SAAUF,EAASC,GACpD,GAAe,gBAAXA,EACA,OAAOT,KAAKO,WAAWC,EAASC,GAEpC,IAMIG,EANAC,EAAUb,KAAKO,WAAWC,EAASC,GACnCZ,EAAKG,KAAKH,GAAGiB,MAAMN,EAAS,MAC5BV,EAAOE,KAAKF,KAAOE,KAAKF,KAAKgB,MAAMN,EAAS,UAAOO,OAC1CA,IAATjB,GAAsBU,EAAQQ,QAAQlB,OACtCA,EAAOU,EAAQQ,QAAQlB,KAAKmB,WAAWjB,MAAMc,MAAMN,EAAS,MAI5DI,EADAd,EACO,gBAAkBe,EAAU,KAAOhB,EAAK,KAAOC,EAAO,KAEtD,YAAce,EAAU,KAAOhB,EAAK,KAC/C,IAAImB,GACAE,QAASV,EAAQW,SAAS,UAC1BC,aAAa,GAEbC,EAAarB,KAAKsB,QAAQd,GAO9B,OANAA,EAAQe,WAAWP,GACnBhB,KAAKwB,WAAaxB,KAAKwB,YAAc,IAAI/B,EAAe,IAAIC,EAAe,GAAI2B,IAC/ErB,KAAKwB,WAAWC,aAAajB,EAAQkB,0BAA0B1B,KAAKJ,QACpEI,KAAKwB,WAAWG,MAAMC,MAAMhB,GAC5BA,EAAOZ,KAAKwB,WAAWV,MAAMN,EAASa,GACtCb,EAAQqB,gBACDrB,EAAQsB,OAAOlB,EAAMS,EAAYZ,IAE5Cd,EAAgBO,UAAU6B,KAAO,SAAUC,GAOvC,OANAzC,EAAUW,UAAU6B,KAAKhC,KAAKC,KAAMgC,GAChCA,EAAOpC,QACPI,KAAKJ,MAAQoC,EAAOpC,OACxBI,KAAKH,GAAKmC,EAAOnC,GACbmC,EAAOlC,OACPE,KAAKF,KAAOkC,EAAOlC,MAChBE,MAEXL,EAAgBO,UAAU+B,OAAS,SAAUC,GACzC,IAAIC,EAAOnC,KAAKoC,YAAYF,GAQ5B,OAPKC,KACDA,EAAOnC,KAAKqC,eAAeH,IACtBtC,MAAQI,KAAKJ,MAAMe,KACxBwB,EAAKtC,GAAKG,KAAKH,GAAGoC,OAAOC,GAAMvB,KAC3BX,KAAKF,OACLqC,EAAKrC,KAAOE,KAAKF,KAAKmC,OAAOC,GAAMvB,OAEpCwB,GAEJxC","file":"../../../nodes/inputs/CubeTextureNode.js","sourcesContent":["define([\n    '../core/InputNode',\n    '../accessors/ReflectNode',\n    '../utils/ColorSpaceNode',\n    '../core/ExpressionNode'\n], function (InputNode, ReflectNode, ColorSpaceNode, ExpressionNode) {\n    'use strict';\n    function CubeTextureNode(value, uv, bias) {\n        InputNode.call(this, 'v4', { shared: true });\n        this.value = value;\n        this.uv = uv || new ReflectNode();\n        this.bias = bias;\n    }\n    CubeTextureNode.prototype = Object.create(InputNode.prototype);\n    CubeTextureNode.prototype.constructor = CubeTextureNode;\n    CubeTextureNode.prototype.nodeType = 'CubeTexture';\n    CubeTextureNode.prototype.getTexture = function (builder, output) {\n        return InputNode.prototype.generate.call(this, builder, output, this.value.uuid, 'tc');\n    };\n    CubeTextureNode.prototype.generate = function (builder, output) {\n        if (output === 'samplerCube') {\n            return this.getTexture(builder, output);\n        }\n        var cubetex = this.getTexture(builder, output);\n        var uv = this.uv.build(builder, 'v3');\n        var bias = this.bias ? this.bias.build(builder, 'f') : undefined;\n        if (bias === undefined && builder.context.bias) {\n            bias = builder.context.bias.setTexture(this).build(builder, 'f');\n        }\n        var code;\n        if (bias)\n            code = 'texCubeBias( ' + cubetex + ', ' + uv + ', ' + bias + ' )';\n        else\n            code = 'texCube( ' + cubetex + ', ' + uv + ' )';\n        var context = {\n            include: builder.isShader('vertex'),\n            ignoreCache: true\n        };\n        var outputType = this.getType(builder);\n        builder.addContext(context);\n        this.colorSpace = this.colorSpace || new ColorSpaceNode(new ExpressionNode('', outputType));\n        this.colorSpace.fromDecoding(builder.getTextureEncodingFromMap(this.value));\n        this.colorSpace.input.parse(code);\n        code = this.colorSpace.build(builder, outputType);\n        builder.removeContext();\n        return builder.format(code, outputType, output);\n    };\n    CubeTextureNode.prototype.copy = function (source) {\n        InputNode.prototype.copy.call(this, source);\n        if (source.value)\n            this.value = source.value;\n        this.uv = source.uv;\n        if (source.bias)\n            this.bias = source.bias;\n        return this;\n    };\n    CubeTextureNode.prototype.toJSON = function (meta) {\n        var data = this.getJSONNode(meta);\n        if (!data) {\n            data = this.createJSONNode(meta);\n            data.value = this.value.uuid;\n            data.uv = this.uv.toJSON(meta).uuid;\n            if (this.bias)\n                data.bias = this.bias.toJSON(meta).uuid;\n        }\n        return data;\n    };\n    return CubeTextureNode;\n});"]}