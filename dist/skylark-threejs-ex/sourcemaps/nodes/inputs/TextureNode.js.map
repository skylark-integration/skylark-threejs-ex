{"version":3,"sources":["nodes/inputs/TextureNode.js"],"names":["define","InputNode","UVNode","ColorSpaceNode","ExpressionNode","TextureNode","value","uv","bias","project","call","this","shared","undefined","prototype","Object","create","constructor","nodeType","getTexture","builder","output","generate","uuid","method","code","tex","build","context","setTexture","include","isShader","ignoreCache","outputType","getType","addContext","colorSpace","fromDecoding","getTextureEncodingFromMap","input","parse","removeContext","format","copy","source","toJSON","meta","data","getJSONNode","createJSONNode"],"mappings":";;;;;;;AAAAA,QACI,oBACA,sBACA,0BACA,0BACD,SACCC,EACAC,EACAC,EACAC,GAEA,aACA,SAASC,EAAYC,EAAOC,EAAIC,EAAMC,GAClCR,EAAUS,KAAKC,KAAM,MAAQC,QAAQ,IACrCD,KAAKL,MAAQA,EACbK,KAAKJ,GAAKA,GAAM,IAAIL,EACpBS,KAAKH,KAAOA,EACZG,KAAKF,aAAsBI,IAAZJ,GAAwBA,EA8D3C,OA5DAJ,EAAYS,UAAYC,OAAOC,OAAOf,EAAUa,WAChDT,EAAYS,UAAUG,YAAcZ,EACpCA,EAAYS,UAAUI,SAAW,UACjCb,EAAYS,UAAUK,WAAa,SAAUC,EAASC,GAClD,OAAOpB,EAAUa,UAAUQ,SAASZ,KAAKC,KAAMS,EAASC,EAAQV,KAAKL,MAAMiB,KAAM,MAErFlB,EAAYS,UAAUQ,SAAW,SAAUF,EAASC,GAChD,GAAe,cAAXA,EACA,OAAOV,KAAKQ,WAAWC,EAASC,GAEpC,IAIIG,EAAQC,EAJRC,EAAMf,KAAKQ,WAAWC,EAASC,GAASd,EAAKI,KAAKJ,GAAGoB,MAAMP,EAAST,KAAKF,QAAU,KAAO,MAAOD,EAAOG,KAAKH,KAAOG,KAAKH,KAAKmB,MAAMP,EAAS,UAAOP,OAC3IA,IAATL,GAAsBY,EAAQQ,QAAQpB,OACtCA,EAAOY,EAAQQ,QAAQpB,KAAKqB,WAAWlB,MAAMgB,MAAMP,EAAS,MAI5DI,EADAb,KAAKF,QACI,gBAEAD,EAAO,YAAc,QAE9BiB,EADAjB,EACOgB,EAAS,KAAOE,EAAM,KAAOnB,EAAK,KAAOC,EAAO,KAEhDgB,EAAS,KAAOE,EAAM,KAAOnB,EAAK,KAC7C,IAAIqB,GACAE,QAASV,EAAQW,SAAS,UAC1BC,aAAa,GAEbC,EAAatB,KAAKuB,QAAQd,GAO9B,OANAA,EAAQe,WAAWP,GACnBjB,KAAKyB,WAAazB,KAAKyB,YAAc,IAAIjC,EAAe,IAAIC,EAAe,GAAI6B,IAC/EtB,KAAKyB,WAAWC,aAAajB,EAAQkB,0BAA0B3B,KAAKL,QACpEK,KAAKyB,WAAWG,MAAMC,MAAMf,GAC5BA,EAAOd,KAAKyB,WAAWT,MAAMP,EAASa,GACtCb,EAAQqB,gBACDrB,EAAQsB,OAAOjB,EAAMQ,EAAYZ,IAE5ChB,EAAYS,UAAU6B,KAAO,SAAUC,GASnC,OARA3C,EAAUa,UAAU6B,KAAKjC,KAAKC,KAAMiC,GAChCA,EAAOtC,QACPK,KAAKL,MAAQsC,EAAOtC,OACxBK,KAAKJ,GAAKqC,EAAOrC,GACbqC,EAAOpC,OACPG,KAAKH,KAAOoC,EAAOpC,WACAK,IAAnB+B,EAAOnC,UACPE,KAAKF,QAAUmC,EAAOnC,SACnBE,MAEXN,EAAYS,UAAU+B,OAAS,SAAUC,GACrC,IAAIC,EAAOpC,KAAKqC,YAAYF,GAU5B,OATKC,IACDA,EAAOpC,KAAKsC,eAAeH,GACvBnC,KAAKL,QACLyC,EAAKzC,MAAQK,KAAKL,MAAMiB,MAC5BwB,EAAKxC,GAAKI,KAAKJ,GAAGsC,OAAOC,GAAMvB,KAC/BwB,EAAKtC,QAAUE,KAAKF,QAChBE,KAAKH,OACLuC,EAAKvC,KAAOG,KAAKH,KAAKqC,OAAOC,GAAMvB,OAEpCwB,GAEJ1C","file":"../../../nodes/inputs/TextureNode.js","sourcesContent":["define([\r\n    '../core/InputNode',\r\n    '../accessors/UVNode',\r\n    '../utils/ColorSpaceNode',\r\n    '../core/ExpressionNode'\r\n], function (\r\n    InputNode, \r\n    UVNode, \r\n    ColorSpaceNode, \r\n    ExpressionNode\r\n) {\r\n    'use strict';\r\n    function TextureNode(value, uv, bias, project) {\r\n        InputNode.call(this, 'v4', { shared: true });\r\n        this.value = value;\r\n        this.uv = uv || new UVNode();\r\n        this.bias = bias;\r\n        this.project = project !== undefined ? project : false;\r\n    }\r\n    TextureNode.prototype = Object.create(InputNode.prototype);\r\n    TextureNode.prototype.constructor = TextureNode;\r\n    TextureNode.prototype.nodeType = 'Texture';\r\n    TextureNode.prototype.getTexture = function (builder, output) {\r\n        return InputNode.prototype.generate.call(this, builder, output, this.value.uuid, 't');\r\n    };\r\n    TextureNode.prototype.generate = function (builder, output) {\r\n        if (output === 'sampler2D') {\r\n            return this.getTexture(builder, output);\r\n        }\r\n        var tex = this.getTexture(builder, output), uv = this.uv.build(builder, this.project ? 'v4' : 'v2'), bias = this.bias ? this.bias.build(builder, 'f') : undefined;\r\n        if (bias === undefined && builder.context.bias) {\r\n            bias = builder.context.bias.setTexture(this).build(builder, 'f');\r\n        }\r\n        var method, code;\r\n        if (this.project)\r\n            method = 'texture2DProj';\r\n        else\r\n            method = bias ? 'tex2DBias' : 'tex2D';\r\n        if (bias)\r\n            code = method + '( ' + tex + ', ' + uv + ', ' + bias + ' )';\r\n        else\r\n            code = method + '( ' + tex + ', ' + uv + ' )';\r\n        var context = {\r\n            include: builder.isShader('vertex'),\r\n            ignoreCache: true\r\n        };\r\n        var outputType = this.getType(builder);\r\n        builder.addContext(context);\r\n        this.colorSpace = this.colorSpace || new ColorSpaceNode(new ExpressionNode('', outputType));\r\n        this.colorSpace.fromDecoding(builder.getTextureEncodingFromMap(this.value));\r\n        this.colorSpace.input.parse(code);\r\n        code = this.colorSpace.build(builder, outputType);\r\n        builder.removeContext();\r\n        return builder.format(code, outputType, output);\r\n    };\r\n    TextureNode.prototype.copy = function (source) {\r\n        InputNode.prototype.copy.call(this, source);\r\n        if (source.value)\r\n            this.value = source.value;\r\n        this.uv = source.uv;\r\n        if (source.bias)\r\n            this.bias = source.bias;\r\n        if (source.project !== undefined)\r\n            this.project = source.project;\r\n        return this;\r\n    };\r\n    TextureNode.prototype.toJSON = function (meta) {\r\n        var data = this.getJSONNode(meta);\r\n        if (!data) {\r\n            data = this.createJSONNode(meta);\r\n            if (this.value)\r\n                data.value = this.value.uuid;\r\n            data.uv = this.uv.toJSON(meta).uuid;\r\n            data.project = this.project;\r\n            if (this.bias)\r\n                data.bias = this.bias.toJSON(meta).uuid;\r\n        }\r\n        return data;\r\n    };\r\n    return TextureNode;\r\n});"]}