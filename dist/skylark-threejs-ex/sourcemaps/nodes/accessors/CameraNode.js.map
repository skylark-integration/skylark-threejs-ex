{"version":3,"sources":["nodes/accessors/CameraNode.js"],"names":["define","TempNode","FunctionNode","FloatNode","PositionNode","CameraNode","scope","camera","call","this","setScope","POSITION","setCamera","Nodes","depthColor","join","DEPTH","TO_VERTEX","prototype","Object","create","constructor","nodeType","updateFrame","undefined","onUpdateFrame","near","far","getType","type","getUnique","getShared","generate","builder","output","result","include","build","WORLD","format","value","copy","source","number","toJSON","meta","data","getJSONNode","createJSONNode","uuid"],"mappings":"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","file":"../../../nodes/accessors/CameraNode.js","sourcesContent":["define([\r\n    '../core/TempNode',\r\n    '../core/FunctionNode',\r\n    '../inputs/FloatNode',\r\n    '../accessors/PositionNode'\r\n], function (TempNode, FunctionNode, FloatNode, PositionNode) {\r\n    'use strict';\r\n    function CameraNode(scope, camera) {\r\n        TempNode.call(this, 'v3');\r\n        this.setScope(scope || CameraNode.POSITION);\r\n        this.setCamera(camera);\r\n    }\r\n    CameraNode.Nodes = function () {\r\n        var depthColor = new FunctionNode([\r\n            'float depthColor( float mNear, float mFar ) {',\r\n            '\\t#ifdef USE_LOGDEPTHBUF_EXT',\r\n            '\\t\\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;',\r\n            '\\t#else',\r\n            '\\t\\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n            '\\t#endif',\r\n            '\\treturn 1.0 - smoothstep( mNear, mFar, depth );',\r\n            '}'\r\n        ].join('\\n'));\r\n        return { depthColor: depthColor };\r\n    }();\r\n    CameraNode.POSITION = 'position';\r\n    CameraNode.DEPTH = 'depth';\r\n    CameraNode.TO_VERTEX = 'toVertex';\r\n    CameraNode.prototype = Object.create(TempNode.prototype);\r\n    CameraNode.prototype.constructor = CameraNode;\r\n    CameraNode.prototype.nodeType = 'Camera';\r\n    CameraNode.prototype.setCamera = function (camera) {\r\n        this.camera = camera;\r\n        this.updateFrame = camera !== undefined ? this.onUpdateFrame : undefined;\r\n    };\r\n    CameraNode.prototype.setScope = function (scope) {\r\n        switch (this.scope) {\r\n        case CameraNode.DEPTH:\r\n            delete this.near;\r\n            delete this.far;\r\n            break;\r\n        }\r\n        this.scope = scope;\r\n        switch (scope) {\r\n        case CameraNode.DEPTH:\r\n            var camera = this.camera;\r\n            this.near = new FloatNode(camera ? camera.near : 1);\r\n            this.far = new FloatNode(camera ? camera.far : 1200);\r\n            break;\r\n        }\r\n    };\r\n    CameraNode.prototype.getType = function () {\r\n        switch (this.scope) {\r\n        case CameraNode.DEPTH:\r\n            return 'f';\r\n        }\r\n        return this.type;\r\n    };\r\n    CameraNode.prototype.getUnique = function () {\r\n        switch (this.scope) {\r\n        case CameraNode.DEPTH:\r\n        case CameraNode.TO_VERTEX:\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    CameraNode.prototype.getShared = function () {\r\n        switch (this.scope) {\r\n        case CameraNode.POSITION:\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    CameraNode.prototype.generate = function (builder, output) {\r\n        var result;\r\n        switch (this.scope) {\r\n        case CameraNode.POSITION:\r\n            result = 'cameraPosition';\r\n            break;\r\n        case CameraNode.DEPTH:\r\n            var depthColor = builder.include(CameraNode.Nodes.depthColor);\r\n            result = depthColor + '( ' + this.near.build(builder, 'f') + ', ' + this.far.build(builder, 'f') + ' )';\r\n            break;\r\n        case CameraNode.TO_VERTEX:\r\n            result = 'normalize( ' + new PositionNode(PositionNode.WORLD).build(builder, 'v3') + ' - cameraPosition )';\r\n            break;\r\n        }\r\n        return builder.format(result, this.getType(builder), output);\r\n    };\r\n    CameraNode.prototype.onUpdateFrame = function () {\r\n        switch (this.scope) {\r\n        case CameraNode.DEPTH:\r\n            var camera = this.camera;\r\n            this.near.value = camera.near;\r\n            this.far.value = camera.far;\r\n            break;\r\n        }\r\n    };\r\n    CameraNode.prototype.copy = function (source) {\r\n        TempNode.prototype.copy.call(this, source);\r\n        this.setScope(source.scope);\r\n        if (source.camera) {\r\n            this.setCamera(source.camera);\r\n        }\r\n        switch (source.scope) {\r\n        case CameraNode.DEPTH:\r\n            this.near.number = source.near;\r\n            this.far.number = source.far;\r\n            break;\r\n        }\r\n        return this;\r\n    };\r\n    CameraNode.prototype.toJSON = function (meta) {\r\n        var data = this.getJSONNode(meta);\r\n        if (!data) {\r\n            data = this.createJSONNode(meta);\r\n            data.scope = this.scope;\r\n            if (this.camera)\r\n                data.camera = this.camera.uuid;\r\n            switch (this.scope) {\r\n            case CameraNode.DEPTH:\r\n                data.near = this.near.value;\r\n                data.far = this.far.value;\r\n                break;\r\n            }\r\n        }\r\n        return data;\r\n    };\r\n    return CameraNode;\r\n});"]}