{"version":3,"sources":["nodes/accessors/PositionNode.js"],"names":["define","TempNode","NodeLib","PositionNode","scope","call","this","LOCAL","WORLD","VIEW","PROJECTION","prototype","Object","create","constructor","nodeType","getType","type","getShared","generate","builder","output","result","isShader","requires","position","worldPosition","format","copy","source","toJSON","meta","data","getJSONNode","createJSONNode","addKeyword"],"mappings":";;;;;;;AAAAA,QACI,mBACA,mBACD,SAAUC,EAAUC,GACnB,aACA,SAASC,EAAaC,GAClBH,EAASI,KAAKC,KAAM,MACpBA,KAAKF,MAAQA,GAASD,EAAaI,MA0EvC,OAxEAJ,EAAaI,MAAQ,QACrBJ,EAAaK,MAAQ,QACrBL,EAAaM,KAAO,OACpBN,EAAaO,WAAa,aAC1BP,EAAaQ,UAAYC,OAAOC,OAAOZ,EAASU,WAChDR,EAAaQ,UAAUG,YAAcX,EACrCA,EAAaQ,UAAUI,SAAW,WAClCZ,EAAaQ,UAAUK,QAAU,WAC7B,OAAQV,KAAKF,OACb,KAAKD,EAAaO,WACd,MAAO,KAEX,OAAOJ,KAAKW,MAEhBd,EAAaQ,UAAUO,UAAY,WAC/B,OAAQZ,KAAKF,OACb,KAAKD,EAAaI,MAClB,KAAKJ,EAAaK,MACd,OAAO,EAEX,OAAO,GAEXL,EAAaQ,UAAUQ,SAAW,SAAUC,EAASC,GACjD,IAAIC,EACJ,OAAQhB,KAAKF,OACb,KAAKD,EAAaI,MACVa,EAAQG,SAAS,UACjBD,EAAS,eAETF,EAAQI,SAASC,UAAW,EAC5BH,EAAS,aAEb,MACJ,KAAKnB,EAAaK,MACd,GAAIY,EAAQG,SAAS,UACjB,MAAO,iDAEPH,EAAQI,SAASE,eAAgB,EACjCJ,EAAS,aAEb,MACJ,KAAKnB,EAAaM,KACda,EAASF,EAAQG,SAAS,UAAY,kBAAoB,gBAC1D,MACJ,KAAKpB,EAAaO,WACdY,EAASF,EAAQG,SAAS,UAAY,iEAAmE,cAG7G,OAAOH,EAAQO,OAAOL,EAAQhB,KAAKU,QAAQI,GAAUC,IAEzDlB,EAAaQ,UAAUiB,KAAO,SAAUC,GAGpC,OAFA5B,EAASU,UAAUiB,KAAKvB,KAAKC,KAAMuB,GACnCvB,KAAKF,MAAQyB,EAAOzB,MACbE,MAEXH,EAAaQ,UAAUmB,OAAS,SAAUC,GACtC,IAAIC,EAAO1B,KAAK2B,YAAYF,GAK5B,OAJKC,KACDA,EAAO1B,KAAK4B,eAAeH,IACtB3B,MAAQE,KAAKF,OAEf4B,GAEX9B,EAAQiC,WAAW,WAAY,WAC3B,OAAO,IAAIhC,IAEfD,EAAQiC,WAAW,gBAAiB,WAChC,OAAO,IAAIhC,EAAaA,EAAaK,SAEzCN,EAAQiC,WAAW,eAAgB,WAC/B,OAAO,IAAIhC,EAAaA,EAAaM,QAElCN","file":"../../../nodes/accessors/PositionNode.js","sourcesContent":["define([\n    '../core/TempNode',\n    '../core/NodeLib'\n], function (TempNode, NodeLib) {\n    'use strict';\n    function PositionNode(scope) {\n        TempNode.call(this, 'v3');\n        this.scope = scope || PositionNode.LOCAL;\n    }\n    PositionNode.LOCAL = 'local';\n    PositionNode.WORLD = 'world';\n    PositionNode.VIEW = 'view';\n    PositionNode.PROJECTION = 'projection';\n    PositionNode.prototype = Object.create(TempNode.prototype);\n    PositionNode.prototype.constructor = PositionNode;\n    PositionNode.prototype.nodeType = 'Position';\n    PositionNode.prototype.getType = function () {\n        switch (this.scope) {\n        case PositionNode.PROJECTION:\n            return 'v4';\n        }\n        return this.type;\n    };\n    PositionNode.prototype.getShared = function () {\n        switch (this.scope) {\n        case PositionNode.LOCAL:\n        case PositionNode.WORLD:\n            return false;\n        }\n        return true;\n    };\n    PositionNode.prototype.generate = function (builder, output) {\n        var result;\n        switch (this.scope) {\n        case PositionNode.LOCAL:\n            if (builder.isShader('vertex')) {\n                result = 'transformed';\n            } else {\n                builder.requires.position = true;\n                result = 'vPosition';\n            }\n            break;\n        case PositionNode.WORLD:\n            if (builder.isShader('vertex')) {\n                return '( modelMatrix * vec4( transformed, 1.0 ) ).xyz';\n            } else {\n                builder.requires.worldPosition = true;\n                result = 'vWPosition';\n            }\n            break;\n        case PositionNode.VIEW:\n            result = builder.isShader('vertex') ? '-mvPosition.xyz' : 'vViewPosition';\n            break;\n        case PositionNode.PROJECTION:\n            result = builder.isShader('vertex') ? '( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )' : 'vec4( 0.0 )';\n            break;\n        }\n        return builder.format(result, this.getType(builder), output);\n    };\n    PositionNode.prototype.copy = function (source) {\n        TempNode.prototype.copy.call(this, source);\n        this.scope = source.scope;\n        return this;\n    };\n    PositionNode.prototype.toJSON = function (meta) {\n        var data = this.getJSONNode(meta);\n        if (!data) {\n            data = this.createJSONNode(meta);\n            data.scope = this.scope;\n        }\n        return data;\n    };\n    NodeLib.addKeyword('position', function () {\n        return new PositionNode();\n    });\n    NodeLib.addKeyword('worldPosition', function () {\n        return new PositionNode(PositionNode.WORLD);\n    });\n    NodeLib.addKeyword('viewPosition', function () {\n        return new PositionNode(PositionNode.VIEW);\n    });\n    return PositionNode;\n});"]}