{"version":3,"sources":["nodes/accessors/NormalNode.js"],"names":["define","TempNode","NodeLib","NormalNode","scope","call","this","VIEW","LOCAL","WORLD","prototype","Object","create","constructor","nodeType","getShared","build","builder","output","uuid","ns","contextNormal","context","generate","result","isShader","requires","normal","worldNormal","format","getType","copy","source","toJSON","meta","data","getJSONNode","createJSONNode","addKeyword","NORMAL"],"mappings":";;;;;;;AAAAA,QACI,mBACA,mBACD,SAAUC,EAAUC,GACnB,aACA,SAASC,EAAWC,GAChBH,EAASI,KAAKC,KAAM,MACpBA,KAAKF,MAAQA,GAASD,EAAWI,KAoErC,OAlEAJ,EAAWK,MAAQ,QACnBL,EAAWM,MAAQ,QACnBN,EAAWI,KAAO,OAClBJ,EAAWO,UAAYC,OAAOC,OAAOX,EAASS,WAC9CP,EAAWO,UAAUG,YAAcV,EACnCA,EAAWO,UAAUI,SAAW,SAChCX,EAAWO,UAAUK,UAAY,WAC7B,OAAOT,KAAKF,QAAUD,EAAWM,OAErCN,EAAWO,UAAUM,MAAQ,SAAUC,EAASC,EAAQC,EAAMC,GAC1D,IAAIC,EAAgBJ,EAAQK,QAAQhB,KAAKF,MAAQ,UACjD,OAAIiB,EACOA,EAAcL,MAAMC,EAASC,EAAQC,EAAMC,GAE/CnB,EAASS,UAAUM,MAAMX,KAAKC,KAAMW,EAASC,EAAQC,IAEhEhB,EAAWO,UAAUa,SAAW,SAAUN,EAASC,GAC/C,IAAIM,EACJ,OAAQlB,KAAKF,OACb,KAAKD,EAAWI,KAERiB,EADAP,EAAQQ,SAAS,UACR,oBAEA,iBACb,MACJ,KAAKtB,EAAWK,MACRS,EAAQQ,SAAS,UACjBD,EAAS,gBAETP,EAAQS,SAASC,QAAS,EAC1BH,EAAS,iBAEb,MACJ,KAAKrB,EAAWM,MACRQ,EAAQQ,SAAS,UACjBD,EAAS,kEAETP,EAAQS,SAASE,aAAc,EAC/BJ,EAAS,YAIjB,OAAOP,EAAQY,OAAOL,EAAQlB,KAAKwB,QAAQb,GAAUC,IAEzDf,EAAWO,UAAUqB,KAAO,SAAUC,GAGlC,OAFA/B,EAASS,UAAUqB,KAAK1B,KAAKC,KAAM0B,GACnC1B,KAAKF,MAAQ4B,EAAO5B,MACbE,MAEXH,EAAWO,UAAUuB,OAAS,SAAUC,GACpC,IAAIC,EAAO7B,KAAK8B,YAAYF,GAK5B,OAJKC,KACDA,EAAO7B,KAAK+B,eAAeH,IACtB9B,MAAQE,KAAKF,OAEf+B,GAEXjC,EAAQoC,WAAW,aAAc,WAC7B,OAAO,IAAInC,EAAWA,EAAWI,QAErCL,EAAQoC,WAAW,cAAe,WAC9B,OAAO,IAAInC,EAAWA,EAAWoC,UAErCrC,EAAQoC,WAAW,cAAe,WAC9B,OAAO,IAAInC,EAAWA,EAAWM,SAE9BN","file":"../../../nodes/accessors/NormalNode.js","sourcesContent":["define([\r\n    '../core/TempNode',\r\n    '../core/NodeLib'\r\n], function (TempNode, NodeLib) {\r\n    'use strict';\r\n    function NormalNode(scope) {\r\n        TempNode.call(this, 'v3');\r\n        this.scope = scope || NormalNode.VIEW;\r\n    }\r\n    NormalNode.LOCAL = 'local';\r\n    NormalNode.WORLD = 'world';\r\n    NormalNode.VIEW = 'view';\r\n    NormalNode.prototype = Object.create(TempNode.prototype);\r\n    NormalNode.prototype.constructor = NormalNode;\r\n    NormalNode.prototype.nodeType = 'Normal';\r\n    NormalNode.prototype.getShared = function () {\r\n        return this.scope === NormalNode.WORLD;\r\n    };\r\n    NormalNode.prototype.build = function (builder, output, uuid, ns) {\r\n        var contextNormal = builder.context[this.scope + 'Normal'];\r\n        if (contextNormal) {\r\n            return contextNormal.build(builder, output, uuid, ns);\r\n        }\r\n        return TempNode.prototype.build.call(this, builder, output, uuid);\r\n    };\r\n    NormalNode.prototype.generate = function (builder, output) {\r\n        var result;\r\n        switch (this.scope) {\r\n        case NormalNode.VIEW:\r\n            if (builder.isShader('vertex'))\r\n                result = 'transformedNormal';\r\n            else\r\n                result = 'geometryNormal';\r\n            break;\r\n        case NormalNode.LOCAL:\r\n            if (builder.isShader('vertex')) {\r\n                result = 'objectNormal';\r\n            } else {\r\n                builder.requires.normal = true;\r\n                result = 'vObjectNormal';\r\n            }\r\n            break;\r\n        case NormalNode.WORLD:\r\n            if (builder.isShader('vertex')) {\r\n                result = 'inverseTransformDirection( transformedNormal, viewMatrix ).xyz';\r\n            } else {\r\n                builder.requires.worldNormal = true;\r\n                result = 'vWNormal';\r\n            }\r\n            break;\r\n        }\r\n        return builder.format(result, this.getType(builder), output);\r\n    };\r\n    NormalNode.prototype.copy = function (source) {\r\n        TempNode.prototype.copy.call(this, source);\r\n        this.scope = source.scope;\r\n        return this;\r\n    };\r\n    NormalNode.prototype.toJSON = function (meta) {\r\n        var data = this.getJSONNode(meta);\r\n        if (!data) {\r\n            data = this.createJSONNode(meta);\r\n            data.scope = this.scope;\r\n        }\r\n        return data;\r\n    };\r\n    NodeLib.addKeyword('viewNormal', function () {\r\n        return new NormalNode(NormalNode.VIEW);\r\n    });\r\n    NodeLib.addKeyword('localNormal', function () {\r\n        return new NormalNode(NormalNode.NORMAL);\r\n    });\r\n    NodeLib.addKeyword('worldNormal', function () {\r\n        return new NormalNode(NormalNode.WORLD);\r\n    });\r\n    return NormalNode;\r\n});"]}