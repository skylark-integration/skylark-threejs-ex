{"version":3,"sources":["nodes/postprocessing/NodePostProcessing.js"],"names":["define","THREE","NodeMaterial","ScreenNode","NodePostProcessing","renderer","renderTarget","undefined","parameters","minFilter","LinearFilter","magFilter","format","RGBAFormat","stencilBuffer","size","getDrawingBufferSize","Vector2","WebGLRenderTarget","width","height","this","output","material","camera","OrthographicCamera","scene","Scene","quad","Mesh","PlaneBufferGeometry","frustumCulled","add","needsUpdate","prototype","constructor","render","frame","dispose","fragment","value","build","uniforms","renderTexture","texture","setRenderer","setRenderTexture","setRenderTarget","updateNode","setPixelRatio","getSize","setSize","pixelRatio","getPixelRatio","copy","source","toJSON","meta","nodes","post","uuid","data","type","name","JSON","stringify","userData"],"mappings":";;;;;;;AAAAA,QACI,kBACA,4BACA,wBACD,SACCC,EACAC,EACAC,GAEA,aACA,SAASC,EAAmBC,EAAUC,GAClC,QAAqBC,IAAjBD,EAA4B,CAC5B,IAAIE,GACAC,UAAWR,EAAMS,aACjBC,UAAWV,EAAMS,aACjBE,OAAQX,EAAMY,WACdC,eAAe,GAEfC,EAAOV,EAASW,qBAAqB,IAAIf,EAAMgB,SACnDX,EAAe,IAAIL,EAAMiB,kBAAkBH,EAAKI,MAAOJ,EAAKK,OAAQZ,GAExEa,KAAKhB,SAAWA,EAChBgB,KAAKf,aAAeA,EACpBe,KAAKC,OAAS,IAAInB,EAClBkB,KAAKE,SAAW,IAAIrB,EACpBmB,KAAKG,OAAS,IAAIvB,EAAMwB,oBAAoB,EAAG,EAAG,GAAI,EAAG,EAAG,GAC5DJ,KAAKK,MAAQ,IAAIzB,EAAM0B,MACvBN,KAAKO,KAAO,IAAI3B,EAAM4B,KAAK,IAAI5B,EAAM6B,oBAAoB,EAAG,GAAIT,KAAKE,UACrEF,KAAKO,KAAKG,eAAgB,EAC1BV,KAAKK,MAAMM,IAAIX,KAAKO,MACpBP,KAAKY,aAAc,EAyDvB,OAvDA7B,EAAmB8B,WACfC,YAAa/B,EACbgC,OAAQ,SAAUV,EAAOF,EAAQa,GACzBhB,KAAKY,cACLZ,KAAKE,SAASe,UACdjB,KAAKE,SAASgB,SAASC,MAAQnB,KAAKC,OACpCD,KAAKE,SAASkB,QACVpB,KAAKE,SAASmB,SAASC,gBACvBtB,KAAKE,SAASmB,SAASC,cAAcH,MAAQnB,KAAKf,aAAasC,SAEnEvB,KAAKY,aAAc,GAEvBI,EAAMQ,YAAYxB,KAAKhB,UAAUyC,iBAAiBzB,KAAKf,aAAasC,SACpEvB,KAAKhB,SAAS0C,gBAAgB1B,KAAKf,cACnCe,KAAKhB,SAAS+B,OAAOV,EAAOF,GAC5Ba,EAAMW,WAAW3B,KAAKE,UACtBF,KAAKhB,SAAS0C,gBAAgB,MAC9B1B,KAAKhB,SAAS+B,OAAOf,KAAKK,MAAOL,KAAKG,SAE1CyB,cAAe,SAAUT,GACrBnB,KAAKhB,SAAS4C,cAAcT,GAC5B,IAAIzB,EAAOM,KAAKhB,SAAS6C,QAAQ,IAAIjD,EAAMgB,SAC3CI,KAAK8B,QAAQpC,EAAKI,MAAOJ,EAAKK,SAElC+B,QAAS,SAAUhC,EAAOC,GACtB,IAAIgC,EAAa/B,KAAKhB,SAASgD,gBAC/BhC,KAAKf,aAAa6C,QAAQhC,EAAQiC,EAAYhC,EAASgC,GACvD/B,KAAKhB,SAAS8C,QAAQhC,EAAOC,IAEjCkC,KAAM,SAAUC,GAEZ,OADAlC,KAAKC,OAASiC,EAAOjC,OACdD,MAEXmC,OAAQ,SAAUC,GAOd,SAN4BlD,IAATkD,GAAsC,iBAATA,KAE5CA,GAASC,WAETD,IAASA,EAAKE,OACdF,EAAKE,UACJF,EAAKE,KAAKtC,KAAKuC,MAAO,CACvB,IAAIC,KACJA,EAAKD,KAAOvC,KAAKuC,KACjBC,EAAKC,KAAO,qBACZL,EAAKE,KAAKtC,KAAKuC,MAAQC,EACL,KAAdxC,KAAK0C,OACLF,EAAKE,KAAO1C,KAAK0C,MACiB,OAAlCC,KAAKC,UAAU5C,KAAK6C,YACpBL,EAAKK,SAAW7C,KAAK6C,UACzBL,EAAKvC,OAASD,KAAKC,OAAOkC,OAAOC,GAAMG,KAG3C,OADAH,EAAKE,KAAOtC,KAAKuC,KACVH,IAGRrD","file":"../../../nodes/postprocessing/NodePostProcessing.js","sourcesContent":["define([\n    \"skylark-threejs\",\n    '../materials/NodeMaterial',\n    '../inputs/ScreenNode'\n], function (\n    THREE, \n    NodeMaterial, \n    ScreenNode\n) {\n    'use strict';\n    function NodePostProcessing(renderer, renderTarget) {\n        if (renderTarget === undefined) {\n            var parameters = {\n                minFilter: THREE.LinearFilter,\n                magFilter: THREE.LinearFilter,\n                format: THREE.RGBAFormat,\n                stencilBuffer: false\n            };\n            var size = renderer.getDrawingBufferSize(new THREE.Vector2());\n            renderTarget = new THREE.WebGLRenderTarget(size.width, size.height, parameters);\n        }\n        this.renderer = renderer;\n        this.renderTarget = renderTarget;\n        this.output = new ScreenNode();\n        this.material = new NodeMaterial();\n        this.camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\n        this.scene = new THREE.Scene();\n        this.quad = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2), this.material);\n        this.quad.frustumCulled = false;\n        this.scene.add(this.quad);\n        this.needsUpdate = true;\n    }\n    NodePostProcessing.prototype = {\n        constructor: NodePostProcessing,\n        render: function (scene, camera, frame) {\n            if (this.needsUpdate) {\n                this.material.dispose();\n                this.material.fragment.value = this.output;\n                this.material.build();\n                if (this.material.uniforms.renderTexture) {\n                    this.material.uniforms.renderTexture.value = this.renderTarget.texture;\n                }\n                this.needsUpdate = false;\n            }\n            frame.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture);\n            this.renderer.setRenderTarget(this.renderTarget);\n            this.renderer.render(scene, camera);\n            frame.updateNode(this.material);\n            this.renderer.setRenderTarget(null);\n            this.renderer.render(this.scene, this.camera);\n        },\n        setPixelRatio: function (value) {\n            this.renderer.setPixelRatio(value);\n            var size = this.renderer.getSize(new THREE.Vector2());\n            this.setSize(size.width, size.height);\n        },\n        setSize: function (width, height) {\n            var pixelRatio = this.renderer.getPixelRatio();\n            this.renderTarget.setSize(width * pixelRatio, height * pixelRatio);\n            this.renderer.setSize(width, height);\n        },\n        copy: function (source) {\n            this.output = source.output;\n            return this;\n        },\n        toJSON: function (meta) {\n            var isRootObject = meta === undefined || typeof meta === 'string';\n            if (isRootObject) {\n                meta = { nodes: {} };\n            }\n            if (meta && !meta.post)\n                meta.post = {};\n            if (!meta.post[this.uuid]) {\n                var data = {};\n                data.uuid = this.uuid;\n                data.type = 'NodePostProcessing';\n                meta.post[this.uuid] = data;\n                if (this.name !== '')\n                    data.name = this.name;\n                if (JSON.stringify(this.userData) !== '{}')\n                    data.userData = this.userData;\n                data.output = this.output.toJSON(meta).uuid;\n            }\n            meta.post = this.uuid;\n            return meta;\n        }\n    };\n    return NodePostProcessing;\n});"]}