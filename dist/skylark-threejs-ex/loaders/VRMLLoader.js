/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs"],function(e,r){"use strict";return function(){if(void 0===r)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function a(r){e.Loader.call(this,r)}function t(e){this.lexer=new r.Lexer(e)}function n(e){r.Parser.call(this,e);var a=this,t=e.Version,n=e.LCurly,o=e.RCurly,i=e.LSquare,s=e.RSquare,l=e.Identifier,c=e.RouteIdentifier,u=e.StringLiteral,f=e.HexLiteral,d=e.NumberLiteral,p=e.TrueLiteral,v=e.FalseLiteral,h=e.NullLiteral,b=e.DEF,x=e.USE,m=e.ROUTE,g=e.TO,L=e.NodeName;a.RULE("vrml",function(){a.SUBRULE(a.version),a.AT_LEAST_ONE(function(){a.SUBRULE(a.node)}),a.MANY(function(){a.SUBRULE(a.route)})}),a.RULE("version",function(){a.CONSUME(t)}),a.RULE("node",function(){a.OPTION(function(){a.SUBRULE(a.def)}),a.CONSUME(L),a.CONSUME(n),a.MANY(function(){a.SUBRULE(a.field)}),a.CONSUME(o)}),a.RULE("field",function(){a.CONSUME(l),a.OR2([{ALT:function(){a.SUBRULE(a.singleFieldValue)}},{ALT:function(){a.SUBRULE(a.multiFieldValue)}}])}),a.RULE("def",function(){a.CONSUME(b),a.CONSUME(l)}),a.RULE("use",function(){a.CONSUME(x),a.CONSUME(l)}),a.RULE("singleFieldValue",function(){a.AT_LEAST_ONE(function(){a.OR([{ALT:function(){a.SUBRULE(a.node)}},{ALT:function(){a.SUBRULE(a.use)}},{ALT:function(){a.CONSUME(u)}},{ALT:function(){a.CONSUME(f)}},{ALT:function(){a.CONSUME(d)}},{ALT:function(){a.CONSUME(p)}},{ALT:function(){a.CONSUME(v)}},{ALT:function(){a.CONSUME(h)}}])})}),a.RULE("multiFieldValue",function(){a.CONSUME(i),a.MANY(function(){a.OR([{ALT:function(){a.SUBRULE(a.node)}},{ALT:function(){a.SUBRULE(a.use)}},{ALT:function(){a.CONSUME(u)}},{ALT:function(){a.CONSUME(f)}},{ALT:function(){a.CONSUME(d)}},{ALT:function(){a.CONSUME(h)}}])}),a.CONSUME(s)}),a.RULE("route",function(){a.CONSUME(m),a.CONSUME(c),a.CONSUME(g),a.CONSUME2(c)}),this.performSelfAnalysis()}function o(r,a,t){this.a=r,this.b=a,this.c=t,this.normal=new e.Vector3}a.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:a,load:function(r,a,t,n){var o=this,i=""===o.path?e.LoaderUtils.extractUrlBase(r):o.path,s=new e.FileLoader(this.manager);s.setPath(o.path),s.load(r,function(e){a(o.parse(e,i))},t,n)},parse:function(a,s){var l={};function c(e){e.DEF&&(l[e.DEF]=e);for(var r=e.fields,a=0,t=r.length;a<t;a++){var n=r[a];if("node"===n.type)for(var o=n.values,i=0,s=o.length;i<s;i++)c(o[i])}}function u(r){return r.USE?(a=r.USE,(t=u(l[a])).isObject3D||t.isMaterial?t.clone():t):void 0!==r.build?r.build:(r.build=function(r){var a,t=r.name;switch(t){case"Group":case"Transform":a=function(r){for(var a=new e.Group,t=r.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,l=i.values;switch(s){case"center":break;case"children":p(l,a);break;case"rotation":var c=new e.Vector3(l[0],l[1],l[2]),u=l[3];a.quaternion.setFromAxisAngle(c,u);break;case"scale":a.scale.set(l[0],l[1],l[2]);break;case"scaleOrientation":break;case"translation":a.position.set(l[0],l[1],l[2]);break;case"bboxCenter":case"bboxSize":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return a}(r);break;case"Background":a=function(r){for(var a,t,n,o,i=new e.Group,s=r.fields,l=0,c=s.length;l<c;l++){var u=s[l],f=u.name,d=u.values;switch(f){case"groundAngle":a=d;break;case"groundColor":t=d;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":n=d;break;case"skyColor":o=d;break;default:console.warn("THREE.VRMLLoader: Unknown field:",f)}}if(o){var p=new e.SphereBufferGeometry(1e4,32,16),v=new e.MeshBasicMaterial({fog:!1,side:e.BackSide,depthWrite:!1,depthTest:!1});o.length>3?(V(p,1e4,n,I(o),!0),v.vertexColors=!0):v.color.setRGB(o[0],o[1],o[2]);var h=new e.Mesh(p,v);i.add(h)}if(t&&t.length>0){var b=new e.SphereBufferGeometry(1e4,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),x=new e.MeshBasicMaterial({fog:!1,side:e.BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});V(b,1e4,a,I(t),!1);var m=new e.Mesh(b,x);i.add(m)}return i.renderOrder=-1/0,i}(r);break;case"Shape":a=function(r){for(var a,t,n=r.fields,o=new e.MeshBasicMaterial({color:0}),i=0,s=n.length;i<s;i++){var l=n[i],c=l.name,f=l.values;switch(c){case"appearance":null!==f[0]&&(o=u(f[0]));break;case"geometry":null!==f[0]&&(a=u(f[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(a&&a.attributes.position){var d=a._type;if("points"===d){var p=new e.PointsMaterial({color:16777215});void 0!==a.attributes.color?p.vertexColors=!0:o.isMeshPhongMaterial&&p.color.copy(o.emissive),t=new e.Points(a,p)}else if("line"===d){var v=new e.LineBasicMaterial({color:16777215});void 0!==a.attributes.color?v.vertexColors=!0:o.isMeshPhongMaterial&&v.color.copy(o.emissive),t=new e.LineSegments(a,v)}else void 0!==a._solid&&(o.side=a._solid?e.FrontSide:e.DoubleSide),void 0!==a.attributes.color&&(o.vertexColors=!0),t=new e.Mesh(a,o)}else(t=new e.Object3D).visible=!1;return t}(r);break;case"Appearance":a=function(r){for(var a,t=new e.MeshPhongMaterial,n=r.fields,o=0,s=n.length;o<s;o++){var l=n[o],c=l.name,f=l.values;switch(c){case"material":if(null!==f[0]){var d=u(f[0]);d.diffuseColor&&t.color.copy(d.diffuseColor),d.emissiveColor&&t.emissive.copy(d.emissiveColor),d.shininess&&(t.shininess=d.shininess),d.specularColor&&t.specular.copy(d.specularColor),d.transparency&&(t.opacity=1-d.transparency),d.transparency>0&&(t.transparent=!0)}else t=new e.MeshBasicMaterial({color:0});break;case"texture":var p=f[0];null!==p&&("ImageTexture"!==p.name&&"PixelTexture"!==p.name||(t.map=u(p)));break;case"textureTransform":null!==f[0]&&(a=u(f[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(t.map){if(t.map.__type){switch(t.map.__type){case i.INTENSITY_ALPHA:t.opacity=1;break;case i.RGB:t.color.set(16777215);break;case i.RGBA:t.color.set(16777215),t.opacity=1}delete t.map.__type}a&&(t.map.center.copy(a.center),t.map.rotation=a.rotation,t.map.repeat.copy(a.scale),t.map.offset.copy(a.translation))}return t}(r);break;case"Material":a=function(r){for(var a={},t=r.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,l=i.values;switch(s){case"ambientIntensity":break;case"diffuseColor":a.diffuseColor=new e.Color(l[0],l[1],l[2]);break;case"emissiveColor":a.emissiveColor=new e.Color(l[0],l[1],l[2]);break;case"shininess":a.shininess=l[0];break;case"specularColor":a.emissiveColor=new e.Color(l[0],l[1],l[2]);break;case"transparency":a.transparency=l[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return a}(r);break;case"ImageTexture":a=function(r){for(var a,t=e.RepeatWrapping,n=e.RepeatWrapping,o=r.fields,i=0,s=o.length;i<s;i++){var l=o[i],c=l.name,u=l.values;switch(c){case"url":var f=u[0];f&&(a=N.load(f));break;case"repeatS":!1===u[0]&&(t=e.ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(n=e.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}a&&(a.wrapS=t,a.wrapT=n);return a}(r);break;case"PixelTexture":a=function(r){for(var a,t=e.RepeatWrapping,n=e.RepeatWrapping,o=r.fields,i=0,s=o.length;i<s;i++){var l=o[i],c=l.name,u=l.values;switch(c){case"image":for(var p=u[0],v=u[1],h=u[2],b=2===h||4===h,x=d(h),m=p*v*(!0===b?4:3),g=new Uint8Array(m),L={r:0,g:0,b:0,a:0},w=3,E=0,y=u.length;w<y;w++,E++)if(f(u[w],x,L),!0===b){var k=4*E;g[k+0]=L.r,g[k+1]=L.g,g[k+2]=L.b,g[k+3]=L.a}else{var k=3*E;g[k+0]=L.r,g[k+1]=L.g,g[k+2]=L.b}(a=new e.DataTexture(g,p,v,!0===b?e.RGBAFormat:e.RGBFormat)).__type=x;break;case"repeatS":!1===u[0]&&(t=e.ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(n=e.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}a&&(a.wrapS=t,a.wrapT=n);return a}(r);break;case"TextureTransform":a=function(r){for(var a={center:new e.Vector2,rotation:new e.Vector2,scale:new e.Vector2,translation:new e.Vector2},t=r.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,l=i.values;switch(s){case"center":a.center.set(l[0],l[1]);break;case"rotation":a.rotation=l[0];break;case"scale":a.scale.set(l[0],l[1]);break;case"translation":a.translation.set(l[0],l[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return a}(r);break;case"IndexedFaceSet":a=function(r){for(var a,t,n,i,s,l,c,f,d=!0,p=!0,x=0,m=!0,E=!0,y=r.fields,k=0,R=y.length;k<R;k++){var I=y[k],V=I.name,N=I.values;switch(V){case"color":var B=N[0];null!==B&&(a=u(B));break;case"coord":var O=N[0];null!==O&&(t=u(O));break;case"normal":var F=N[0];null!==F&&(n=u(F));break;case"texCoord":var P=N[0];null!==P&&(i=u(P));break;case"ccw":d=N[0];break;case"colorIndex":s=N;break;case"colorPerVertex":m=N[0];break;case"convex":break;case"coordIndex":l=N;break;case"creaseAngle":x=N[0];break;case"normalIndex":c=N;break;case"normalPerVertex":E=N[0];break;case"solid":p=N[0];break;case"texCoordIndex":f=N;break;default:console.warn("THREE.VRMLLoader: Unknown field:",V)}}if(void 0===l)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new e.BufferGeometry;var H,_,G,z,D=v(l,d);if(a)if(!0===m)if(s&&s.length>0){var W=v(s,d);_=S(D,W,a,3)}else _=U(D,new e.Float32BufferAttribute(a,3));else if(s&&s.length>0){var j=b(a,s),Y=h(j,l);_=T(D,Y)}else{var Y=h(a,l);_=T(D,Y)}if(n)if(!0===E)if(c&&c.length>0){var q=v(c,d);G=S(D,q,n,3)}else G=U(D,new e.Float32BufferAttribute(n,3));else if(c&&c.length>0){var X=b(n,c),K=h(X,l);G=T(D,K)}else{var K=h(n,l);G=T(D,K)}else G=function(r,a,t){for(var n=[],i={},s=0,l=r.length;s<l;s+=3){var c=r[s],u=r[s+1],f=r[s+2],d=new o(c,u,f);g.fromArray(a,3*c),L.fromArray(a,3*u),w.fromArray(a,3*f),C.subVectors(w,L),A.subVectors(g,L),C.cross(A),C.normalize(),d.normal.copy(C),void 0===i[c]&&(i[c]=[]),void 0===i[u]&&(i[u]=[]),void 0===i[f]&&(i[f]=[]),i[c].push(d.normal),i[u].push(d.normal),i[f].push(d.normal),n.push(d)}for(var p=[],s=0,l=n.length;s<l;s++){var d=n[s],v=M(i[d.a],d.normal,t),h=M(i[d.b],d.normal,t),b=M(i[d.c],d.normal,t);g.fromArray(a,3*d.a),L.fromArray(a,3*d.b),w.fromArray(a,3*d.c),p.push(v.x,v.y,v.z),p.push(h.x,h.y,h.z),p.push(b.x,b.y,b.z)}return new e.Float32BufferAttribute(p,3)}(D,t,x);if(i)if(f&&f.length>0){var Z=v(f,d);z=S(D,Z,i,2)}else z=U(D,new e.Float32BufferAttribute(i,2));var J=new e.BufferGeometry;H=U(D,new e.Float32BufferAttribute(t,3)),J.setAttribute("position",H),J.setAttribute("normal",G),_&&J.setAttribute("color",_);z&&J.setAttribute("uv",z);return J._solid=p,J._type="mesh",J}(r);break;case"IndexedLineSet":a=function(r){for(var a,t,n,o,i,s=!0,l=r.fields,c=0,f=l.length;c<f;c++){var d=l[c],p=d.name,v=d.values;switch(p){case"color":var h=v[0];null!==h&&(a=u(h));break;case"coord":var g=v[0];null!==g&&(t=u(g));break;case"colorIndex":n=v;break;case"colorPerVertex":s=v[0];break;case"coordIndex":o=v;break;default:console.warn("THREE.VRMLLoader: Unknown field:",p)}}var L=x(o);if(a)if(!0===s)if(n.length>0){var w=x(n);i=S(L,w,a,3)}else i=U(L,new e.Float32BufferAttribute(a,3));else if(n.length>0){var E=b(a,n),y=m(E,o);i=R(L,y)}else{var y=m(a,o);i=R(L,y)}var k=new e.BufferGeometry,T=U(L,new e.Float32BufferAttribute(t,3));k.setAttribute("position",T),i&&k.setAttribute("color",i);return k._type="line",k}(r);break;case"PointSet":a=function(r){for(var a,t,n=r.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,c=s.values;switch(l){case"color":var f=c[0];null!==f&&(a=u(f));break;case"coord":var d=c[0];null!==d&&(t=u(d));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}var p;(p=new e.BufferGeometry).setAttribute("position",new e.Float32BufferAttribute(t,3)),a&&p.setAttribute("color",new e.Float32BufferAttribute(a,3));return p._type="points",p}(r);break;case"Box":a=function(r){for(var a=new e.Vector3(2,2,2),t=r.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,l=i.values;switch(s){case"size":a.x=l[0],a.y=l[1],a.z=l[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new e.BoxBufferGeometry(a.x,a.y,a.z)}(r);break;case"Cone":a=function(r){for(var a=1,t=2,n=!1,o=r.fields,i=0,s=o.length;i<s;i++){var l=o[i],c=l.name,u=l.values;switch(c){case"bottom":n=!u[0];break;case"bottomRadius":a=u[0];break;case"height":t=u[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}return new e.ConeBufferGeometry(a,t,16,1,n)}(r);break;case"Cylinder":a=function(r){for(var a=1,t=2,n=r.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,c=s.values;switch(l){case"bottom":break;case"radius":a=c[0];break;case"height":t=c[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new e.CylinderBufferGeometry(a,a,t,16,1)}(r);break;case"Sphere":a=function(r){for(var a=1,t=r.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,l=i.values;switch(s){case"radius":a=l[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new e.SphereBufferGeometry(a,16,16)}(r);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":a=function(e){return e.fields[0].values}(r);break;case"Anchor":case"Billboard":case"Collision":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"WorldInfo":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"ElevationGrid":case"Extrusion":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",t)}return a}(r),r.build);var a,t}function f(e,r,a){switch(r){case i.INTENSITY:var t=parseInt(e);a.r=t,a.g=t,a.b=t;break;case i.INTENSITY_ALPHA:t=parseInt("0x"+e.substring(2,4));a.r=t,a.g=t,a.b=t,a.a=parseInt("0x"+e.substring(4,6));break;case i.RGB:a.r=parseInt("0x"+e.substring(2,4)),a.g=parseInt("0x"+e.substring(4,6)),a.b=parseInt("0x"+e.substring(6,8));break;case i.RGBA:a.r=parseInt("0x"+e.substring(2,4)),a.g=parseInt("0x"+e.substring(4,6)),a.b=parseInt("0x"+e.substring(6,8)),a.a=parseInt("0x"+e.substring(8,10))}}function d(e){var r;switch(e){case 1:r=i.INTENSITY;break;case 2:r=i.INTENSITY_ALPHA;break;case 3:r=i.RGB;break;case 4:r=i.RGBA}return r}function p(r,a){for(var t=0,n=r.length;t<n;t++){var o=u(r[t]);o instanceof e.Object3D&&a.add(o)}}function v(e,r){for(var a=[],t=0,n=0,o=e.length;n<o;n++){var i=e[t],s=e[n+(r?1:2)],l=e[n+(r?2:1)];a.push(i,s,l),(-1===e[n+3]||n+3>=o)&&(t=(n+=3)+1)}return a}function h(e,r){for(var a=[],t=0,n=0,o=r.length;n<o;n++){var i=3*t,s=e[i],l=e[i+1],c=e[i+2];a.push(s,l,c),(-1===r[n+3]||n+3>=o)&&(n+=3,t++)}return a}function b(e,r){for(var a=[],t=0,n=r.length;t<n;t++){var o=3*r[t],i=e[o],s=e[o+1],l=e[o+2];a.push(i,s,l)}return a}function x(e){for(var r=[],a=0,t=e.length;a<t;a++){var n=e[a],o=e[a+1];r.push(n,o),(-1===e[a+2]||a+2>=t)&&(a+=2)}return r}function m(e,r){for(var a=[],t=0,n=0,o=r.length;n<o;n++){var i=3*t,s=e[i],l=e[i+1],c=e[i+2];a.push(s,l,c),(-1===r[n+2]||n+2>=o)&&(n+=2,t++)}return a}var g=new e.Vector3,L=new e.Vector3,w=new e.Vector3,E=new e.Vector2,y=new e.Vector2,k=new e.Vector2;function S(r,a,t,n){for(var o=[],i=0,s=r.length;i<s;i+=3){var l=a[i],c=a[i+1],u=a[i+2];2===n?(E.fromArray(t,l*n),y.fromArray(t,c*n),k.fromArray(t,u*n),o.push(E.x,E.y),o.push(y.x,y.y),o.push(k.x,k.y)):(g.fromArray(t,l*n),L.fromArray(t,c*n),w.fromArray(t,u*n),o.push(g.x,g.y,g.z),o.push(L.x,L.y,L.z),o.push(w.x,w.y,w.z))}return new e.Float32BufferAttribute(o,n)}function T(r,a){for(var t=[],n=0,o=0,i=r.length;n<i;n+=3,o++)g.fromArray(a,3*o),t.push(g.x,g.y,g.z),t.push(g.x,g.y,g.z),t.push(g.x,g.y,g.z);return new e.Float32BufferAttribute(t,3)}function R(r,a){for(var t=[],n=0,o=0,i=r.length;n<i;n+=2,o++)g.fromArray(a,3*o),t.push(g.x,g.y,g.z),t.push(g.x,g.y,g.z);return new e.Float32BufferAttribute(t,3)}function U(r,a){for(var t=a.array,n=a.itemSize,o=new t.constructor(r.length*n),i=0,s=0,l=0,c=r.length;l<c;l++){i=r[l]*n;for(var u=0;u<n;u++)o[s++]=t[i++]}return new e.Float32BufferAttribute(o,n)}var A=new e.Vector3,C=new e.Vector3;function M(r,a,t){var n=new e.Vector3;if(0===t)n.copy(a);else for(var o=0,i=r.length;o<i;o++)r[o].angleTo(a)<t&&n.add(r[o]);return n.normalize()}function I(r){for(var a=[],t=0,n=r.length;t<n;t+=3)a.push(new e.Color(r[t],r[t+1],r[t+2]));return a}function V(r,a,t,n,o){for(var i=[],s=!0===o?0:Math.PI,l=0,c=n.length;l<c;l++){var u=0===l?0:t[l-1];u=!0===o?u:s-u;var f=new e.Vector3;f.setFromSphericalCoords(a,u,0),i.push(f)}var d=r.index,p=r.attributes.position,v=new e.BufferAttribute(new Float32Array(3*r.attributes.position.count),3),h=new e.Vector3,b=new e.Color;for(l=0;l<d.count;l++){var x,m,g=d.getX(l);h.fromBufferAttribute(p,g);for(var L=1,w=1;w<i.length;w++){m=w;var E=i[x=w-1],y=i[m];if(!0===o){if(h.y<=E.y&&h.y>y.y){L=Math.abs(E.y-h.y)/Math.abs(E.y-y.y);break}}else if(h.y>=E.y&&h.y<y.y){L=Math.abs(E.y-h.y)/Math.abs(E.y-y.y);break}}var k=n[x],S=n[m];b.copy(k).lerp(S,L),v.setXYZ(g,b.r,b.g,b.b)}r.setAttribute("color",v)}var N=new e.TextureLoader(this.manager);N.setPath(this.resourcePath||s).setCrossOrigin(this.crossOrigin);var B=function(e){var a=function(){for(var e=r.createToken,a=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),t=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:a}),n=e({name:"Version",pattern:/#VRML.*/,longer_alt:t}),o=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:t}),i=e({name:"DEF",pattern:/DEF/,longer_alt:t}),s=e({name:"USE",pattern:/USE/,longer_alt:t}),l=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:t}),c=e({name:"TO",pattern:/TO/,longer_alt:t}),u=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),f=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),d=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),p=e({name:"TrueLiteral",pattern:/TRUE/}),v=e({name:"FalseLiteral",pattern:/FALSE/}),h=e({name:"NullLiteral",pattern:/NULL/}),b=e({name:"LSquare",pattern:/\[/}),x=e({name:"RSquare",pattern:/]/}),m=e({name:"LCurly",pattern:/{/}),g=e({name:"RCurly",pattern:/}/}),L=e({name:"Comment",pattern:/#.*/,group:r.Lexer.SKIPPED}),w=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:r.Lexer.SKIPPED}),o,i,s,l,c,p,v,h,n,t,a,u,f,d,b,x,m,g,L],E={},y=0,k=w.length;y<k;y++){var S=w[y];E[S.name]=S}return{tokens:w,tokenVocabulary:E}}(),o=new t(a.tokens),i=new n(a.tokenVocabulary),s=function(e){function r(){e.call(this),this.validateVisitor()}function a(e,r){var a={type:null,values:[]};if(r.node){a.type="node";for(var t=0,n=r.node.length;t<n;t++){var o=r.node[t];a.values.push(e.visit(o))}}if(r.use){a.type="use";for(var t=0,n=r.use.length;t<n;t++){var i=r.use[t];a.values.push(e.visit(i))}}if(r.StringLiteral){a.type="string";for(var t=0,n=r.StringLiteral.length;t<n;t++){var s=r.StringLiteral[t];a.values.push(s.image.replace(/'|"/g,""))}}if(r.NumberLiteral){a.type="number";for(var t=0,n=r.NumberLiteral.length;t<n;t++){var l=r.NumberLiteral[t];a.values.push(parseFloat(l.image))}}if(r.HexLiteral){a.type="hex";for(var t=0,n=r.HexLiteral.length;t<n;t++){var c=r.HexLiteral[t];a.values.push(c.image)}}if(r.TrueLiteral){a.type="boolean";for(var t=0,n=r.TrueLiteral.length;t<n;t++){var u=r.TrueLiteral[t];"TRUE"===u.image&&a.values.push(!0)}}if(r.FalseLiteral){a.type="boolean";for(var t=0,n=r.FalseLiteral.length;t<n;t++){var f=r.FalseLiteral[t];"FALSE"===f.image&&a.values.push(!1)}}return r.NullLiteral&&(a.type="null",r.NullLiteral.forEach(function(){a.values.push(null)})),a}return r.prototype=Object.assign(Object.create(e.prototype),{constructor:r,vrml:function(e){for(var r={version:this.visit(e.version),nodes:[],routes:[]},a=0,t=e.node.length;a<t;a++){var n=e.node[a];r.nodes.push(this.visit(n))}if(e.route)for(a=0,t=e.route.length;a<t;a++){var o=e.route[a];r.routes.push(this.visit(o))}return r},version:function(e){return e.Version[0].image},node:function(e){var r={name:e.NodeName[0].image,fields:[]};if(e.field)for(var a=0,t=e.field.length;a<t;a++){var n=e.field[a];r.fields.push(this.visit(n))}return e.def&&(r.DEF=this.visit(e.def[0])),r},field:function(e){var r,a={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(r=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(r=this.visit(e.multiFieldValue[0])),a.type=r.type,a.values=r.values,a},def:function(e){return e.Identifier[0].image},use:function(e){return{USE:e.Identifier[0].image}},singleFieldValue:function(e){return a(this,e)},multiFieldValue:function(e){return a(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new r}(i.getBaseCstVisitorConstructor()),l=o.lex(e);i.input=l.tokens;var c=i.vrml();if(i.errors.length>0)throw console.error(i.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return s.visit(c)}(a);if(-1===B.version.indexOf("V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(r){for(var a=r.nodes,t=new e.Scene,n=0,o=a.length;n<o;n++)c(a[n]);for(n=0,o=a.length;n<o;n++){var i=u(a[n]);i instanceof e.Object3D&&t.add(i)}return t}(B)}}),t.prototype={constructor:t,lex:function(e){var r=this.lexer.tokenize(e);if(r.errors.length>0)throw console.error(r.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return r}},n.prototype=Object.create(r.Parser.prototype),n.prototype.constructor=n;var i={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};return a}()});
//# sourceMappingURL=../sourcemaps/loaders/VRMLLoader.js.map
