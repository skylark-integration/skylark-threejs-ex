/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex"],function(t,e){"use strict";var r,s=function(e){t.Loader.call(this,e)};return s.prototype=Object.assign(Object.create(t.Loader.prototype),{constructor:s,load:function(e,r,s,n){var o=this,a=new t.FileLoader(o.manager);a.setPath(o.path),a.setResponseType("arraybuffer"),a.load(e,function(t){r(o.parse(t))},s,n)},parse:(r=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(e){for(var s=new DataView(e),n={},o=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],a=0;a<o.length;a++)n[o[a]]=s.getInt32(4*a,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===s.byteLength){for(var i=new t.BufferGeometry,f=[],u=n.offset_st,l=(a=0,n.num_st);a<l;a++){var m=s.getInt16(u+0,!0),h=s.getInt16(u+2,!0);f.push(m/n.skinwidth,1-h/n.skinheight),u+=4}u=n.offset_tris;var g=[],p=[];for(a=0,l=n.num_tris;a<l;a++)g.push(s.getUint16(u+0,!0),s.getUint16(u+2,!0),s.getUint16(u+4,!0)),p.push(s.getUint16(u+6,!0),s.getUint16(u+8,!0),s.getUint16(u+10,!0)),u+=12;var v=new t.Vector3,c=new t.Vector3,_=[],d=[];for(u=n.offset_frames,a=0,l=n.num_frames;a<l;a++){c.set(s.getFloat32(u+0,!0),s.getFloat32(u+4,!0),s.getFloat32(u+8,!0)),v.set(s.getFloat32(u+12,!0),s.getFloat32(u+16,!0),s.getFloat32(u+20,!0)),u+=24;for(var b=0;b<16;b++){var w=s.getUint8(u+b,!0);if(0===w)break;_[b]=w}var F={name:String.fromCharCode.apply(null,_),vertices:[],normals:[]};for(u+=16,b=0;b<n.num_vertices;b++){var A=s.getUint8(u++,!0),U=s.getUint8(u++,!0),y=s.getUint8(u++,!0),k=r[s.getUint8(u++,!0)];A=A*c.x+v.x,U=U*c.y+v.y,y=y*c.z+v.z,F.vertices.push(A,y,U),F.normals.push(k[0],k[2],k[1])}d.push(F)}var B=[],C=[],L=[],D=d[0].vertices,M=d[0].normals;for(a=0,l=g.length;a<l;a++){A=D[R=3*g[a]],U=D[R+1],y=D[R+2],B.push(A,U,y);var j=M[R],x=M[R+1],z=M[R+2];C.push(j,x,z),m=f[R=2*p[a]],h=f[R+1],L.push(m,h)}i.setAttribute("position",new t.Float32BufferAttribute(B,3)),i.setAttribute("normal",new t.Float32BufferAttribute(C,3)),i.setAttribute("uv",new t.Float32BufferAttribute(L,2));var I=[],T=[];for(a=0,l=d.length;a<l;a++){var V=(F=d[a]).name;if(F.vertices.length>0){B=[],b=0;for(var O=g.length;b<O;b++){var R=3*g[b];A=F.vertices[R],U=F.vertices[R+1],y=F.vertices[R+2],B.push(A,U,y)}var S=new t.Float32BufferAttribute(B,3);S.name=V,I.push(S)}if(F.normals.length>0){for(C=[],b=0,O=g.length;b<O;b++)R=3*g[b],j=F.normals[R],x=F.normals[R+1],z=F.normals[R+2],C.push(j,x,z);var q=new t.Float32BufferAttribute(C,3);q.name=V,T.push(q)}}return i.morphAttributes.position=I,i.morphAttributes.normal=T,i.morphTargetsRelative=!1,i.animations=t.AnimationClip.CreateClipsFromMorphTargetSequences(d,10),i}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})}),e.loaders.MD2Loader=s});
//# sourceMappingURL=../sourcemaps/loaders/MD2Loader.js.map
