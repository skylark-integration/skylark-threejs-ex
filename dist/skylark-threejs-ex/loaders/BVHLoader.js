/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs"],function(e){return e.BVHLoader=function(o){e.Loader.call(this,o),this.animateBonePositions=!0,this.animateBoneRotations=!0},e.BVHLoader.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:e.BVHLoader,load:function(o,t,r,a){var n=this,i=new e.FileLoader(n.manager);i.setPath(n.path),i.load(o,function(e){t(n.parse(e))},r,a)},parse:function(o){function t(o,r,a){if("ENDSITE"!==a.type){var n={time:r,position:new e.Vector3,rotation:new e.Quaternion};a.frames.push(n);for(var i=new e.Quaternion,s=new e.Vector3(1,0,0),p=new e.Vector3(0,1,0),l=new e.Vector3(0,0,1),c=0;c<a.channels.length;c++)switch(a.channels[c]){case"Xposition":n.position.x=parseFloat(o.shift().trim());break;case"Yposition":n.position.y=parseFloat(o.shift().trim());break;case"Zposition":n.position.z=parseFloat(o.shift().trim());break;case"Xrotation":i.setFromAxisAngle(s,parseFloat(o.shift().trim())*Math.PI/180),n.rotation.multiply(i);break;case"Yrotation":i.setFromAxisAngle(p,parseFloat(o.shift().trim())*Math.PI/180),n.rotation.multiply(i);break;case"Zrotation":i.setFromAxisAngle(l,parseFloat(o.shift().trim())*Math.PI/180),n.rotation.multiply(i);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(c=0;c<a.children.length;c++)t(o,r,a.children[c])}}function r(e){for(var o;0===(o=e.shift().trim()).length;);return o}var a=this,n=function(o){"HIERARCHY"!==r(o)&&console.error("THREE.BVHLoader: HIERARCHY expected.");var a=[],n=function o(t,a,n){var i={name:"",type:"",frames:[]};n.push(i);var s=a.split(/[\s]+/);"END"===s[0].toUpperCase()&&"SITE"===s[1].toUpperCase()?(i.type="ENDSITE",i.name="ENDSITE"):(i.name=s[1],i.type=s[0].toUpperCase()),"{"!==r(t)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),"OFFSET"!==(s=r(t).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+s[0]),4!==s.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");var p=new e.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));if((isNaN(p.x)||isNaN(p.y)||isNaN(p.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),i.offset=p,"ENDSITE"!==i.type){"CHANNELS"!==(s=r(t).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");var l=parseInt(s[1]);i.channels=s.splice(2,l),i.children=[]}for(;;){var c=r(t);if("}"===c)return i;i.children.push(o(t,c,n))}}(o,r(o),a);"MOTION"!==r(o)&&console.error("THREE.BVHLoader: MOTION expected.");var i=r(o).split(/[\s]+/),s=parseInt(i[1]);isNaN(s)&&console.error("THREE.BVHLoader: Failed to read number of frames."),i=r(o).split(/[\s]+/);var p=parseFloat(i[2]);isNaN(p)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(var l=0;l<s;l++)t(i=r(o).split(/[\s]+/),l*p,n);return a}(o.split(/[\r\n]+/g)),i=[];!function o(t,r){var a=new e.Bone;if(r.push(a),a.position.add(t.offset),a.name=t.name,"ENDSITE"!==t.type)for(var n=0;n<t.children.length;n++)a.add(o(t.children[n],r));return a}(n[0],i);var s=function(o){for(var t=[],r=0;r<o.length;r++){var n=o[r];if("ENDSITE"!==n.type){for(var i=[],s=[],p=[],l=0;l<n.frames.length;l++){var c=n.frames[l];i.push(c.time),s.push(c.position.x+n.offset.x),s.push(c.position.y+n.offset.y),s.push(c.position.z+n.offset.z),p.push(c.rotation.x),p.push(c.rotation.y),p.push(c.rotation.z),p.push(c.rotation.w)}a.animateBonePositions&&t.push(new e.VectorKeyframeTrack(".bones["+n.name+"].position",i,s)),a.animateBoneRotations&&t.push(new e.QuaternionKeyframeTrack(".bones["+n.name+"].quaternion",i,p))}}return new e.AnimationClip("animation",-1,t)}(n);return{skeleton:new e.Skeleton(i),clip:s}}}),e.BVHLoader});
//# sourceMappingURL=../sourcemaps/loaders/BVHLoader.js.map
