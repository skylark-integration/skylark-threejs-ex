/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","../threex","skylark-zlib/Inflate"],function(e,r,a){"use strict";var n=function(r){e.DataTextureLoader.call(this,r),this.type=e.FloatType};return n.prototype=Object.assign(Object.create(e.DataTextureLoader.prototype),{constructor:n,parse:function(r){const n=65536,t=n>>3,i=14,o=65537,l=1<<i,f=l-1,s=59,u=63,c=2+u-s,v=8,h=4,p=4,w=2,y=1,d=0,g=1,S=0,A=1,m=2,b=Math.pow(2.7182818,2.2);const U={l:0,c:0,lc:0};function M(e,r,a,n,t){for(;a<e;)r=r<<8|K(n,t),a+=8;a-=e,U.l=r>>a&(1<<e)-1,U.c=r,U.lc=a}const O=new Array(59);function C(e,r,a,n,t,i,l){for(var f=a,v=0,h=0;t<=i;t++){if(f.value-a.value>n)return!1;M(6,v,h,e,f);var p=U.l;if(v=U.c,h=U.lc,l[t]=p,p==u){if(f.value-a.value>n)throw"Something wrong with hufUnpackEncTable";M(8,v,h,e,f);var w=U.l+c;if(v=U.c,h=U.lc,t+w>i+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)l[t++]=0;t--}else if(p>=s){if(t+(w=p-s+2)>i+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)l[t++]=0;t--}}!function(e){for(var r=0;r<=58;++r)O[r]=0;for(r=0;r<o;++r)O[e[r]]+=1;var a=0;for(r=58;r>0;--r){var n=a+O[r]>>1;O[r]=a,a=n}for(r=0;r<o;++r){var t=e[r];t>0&&(e[r]=t|O[t]++<<6)}}(l)}function x(e){return 63&e}function I(e){return e>>6}const E={c:0,lc:0};function R(e,r,a,n){e=e<<8|K(a,n),r+=8,E.c=e,E.lc=r}const z={c:0,lc:0};function P(e,r,a,n,t,i,o,l,f,s){if(e==r){n<8&&(R(a,n,t,o),a=E.c,n=E.lc);var u=a>>(n-=8);u=new Uint8Array([u])[0];if(f.value+u>s)return!1;for(var c=l[f.value-1];u-- >0;)l[f.value++]=c}else{if(!(f.value<s))return!1;l[f.value++]=e}z.c=a,z.lc=n}function N(e){var r=function(e){return 65535&e}(e);return r>32767?r-65536:r}const T={a:0,b:0};function k(e,r){var a=N(e),n=N(r),t=a+(1&n)+(n>>1),i=t,o=t-n;T.a=i,T.b=o}function D(e,r,a,n,t,i){for(var o,l=a>t?t:a,f=1;f<=l;)f<<=1;for(o=f>>=1,f>>=1;f>=1;){for(var s,u,c,v,h=0,p=h+i*(t-o),w=i*f,y=i*o,d=n*f,g=n*o;h<=p;h+=y){for(var S=h,A=h+n*(a-o);S<=A;S+=g){var m=S+d,b=(U=S+w)+d;k(e[S+r],e[U+r]),s=T.a,c=T.b,k(e[m+r],e[b+r]),u=T.a,v=T.b,k(s,u),e[S+r]=T.a,e[m+r]=T.b,k(c,v),e[U+r]=T.a,e[b+r]=T.b}if(a&f){var U=S+w;k(e[S+r],e[U+r]),s=T.a,e[U+r]=T.b,e[S+r]=s}}if(t&f)for(S=h,A=h+n*(a-o);S<=A;S+=g){m=S+d;k(e[S+r],e[m+r]),s=T.a,e[m+r]=T.b,e[S+r]=s}o=f,f>>=1}return h}function F(e,r,a,n,t,s){var u=a.value,c=J(r,a),v=J(r,a);a.value+=4;var h=J(r,a);if(a.value+=4,c<0||c>=o||v<0||v>=o)throw"Something wrong with HUF_ENCSIZE";var p=new Array(o),w=new Array(l);if(function(e){for(var r=0;r<l;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}(w),C(e,0,a,n-(a.value-u),c,v,p),h>8*(n-(a.value-u)))throw"Something wrong with hufUncompress";!function(e,r,a,n){for(;r<=a;r++){var t=I(e[r]),o=x(e[r]);if(t>>o)throw"Invalid table entry";if(o>i){if((u=n[t>>o-i]).len)throw"Invalid table entry";if(u.lit++,u.p){var l=u.p;u.p=new Array(u.lit);for(var f=0;f<u.lit-1;++f)u.p[f]=l[f]}else u.p=new Array(1);u.p[u.lit-1]=r}else if(o){var s=0;for(f=1<<i-o;f>0;f--){var u;if((u=n[(t<<i-o)+s]).len||u.p)throw"Invalid table entry";u.len=o,u.lit=r,s++}}}}(p,c,v,w),function(e,r,a,n,t,o,l,s,u,c){for(var v=0,h=0,p=s,w=Math.trunc(t.value+(o+7)/8);t.value<w;)for(R(v,h,a,t),v=E.c,h=E.lc;h>=i;)if((S=r[v>>h-i&f]).len)h-=S.len,P(S.lit,l,v,h,a,0,t,u,c,p),v=z.c,h=z.lc;else{if(!S.p)throw"hufDecode issues";var y;for(y=0;y<S.lit;y++){for(var d=x(e[S.p[y]]);h<d&&t.value<w;)R(v,h,a,t),v=E.c,h=E.lc;if(h>=d&&I(e[S.p[y]])==(v>>h-d&(1<<d)-1)){h-=d,P(S.p[y],l,v,h,a,0,t,u,c,p),v=z.c,h=z.lc;break}}if(y==S.lit)throw"hufDecode issues"}var g=8-o&7;for(v>>=g,h-=g;h>0;){var S;if(!(S=r[v<<i-h&f]).len)throw"hufDecode issues";h-=S.len,P(S.lit,l,v,h,a,0,t,u,c,p),v=z.c,h=z.lc}}(p,w,e,0,a,h,v,s,t,{value:0})}function _(e){for(var r=1;r<e.length;r++){var a=e[r-1]+e[r]-128;e[r]=a}}function L(e,r){for(var a=0,n=Math.floor((e.length+1)/2),t=0,i=e.length-1;!(t>i||(r[t++]=e[a++],t>i));)r[t++]=e[n++]}function X(e){for(var r=e.byteLength,a=new Array,n=0,t=new DataView(e);r>0;){var i=t.getInt8(n++);if(i<0){r-=(l=-i)+1;for(var o=0;o<l;o++)a.push(t.getUint8(n++))}else{var l=i;r-=2;var f=t.getUint8(n++);for(o=0;o<l+1;o++)a.push(f)}}return a}function V(e,r,a){for(var n,t=1;t<64;)65280==(n=r[e.value])?t=64:n>>8==255?t+=255&n:(a[t]=n,t++),e.value++}function W(e){const r=.5*Math.cos(.7853975),a=.5*Math.cos(.196349375),n=.5*Math.cos(.39269875),t=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(1.374445625);for(var f=new Array(4),s=new Array(4),u=new Array(4),c=new Array(4),v=0;v<8;++v){var h=8*v;f[0]=n*e[h+2],f[1]=o*e[h+2],f[2]=n*e[h+6],f[3]=o*e[h+6],s[0]=a*e[h+1]+t*e[h+3]+i*e[h+5]+l*e[h+7],s[1]=t*e[h+1]-l*e[h+3]-a*e[h+5]-i*e[h+7],s[2]=i*e[h+1]-a*e[h+3]+l*e[h+5]+t*e[h+7],s[3]=l*e[h+1]-i*e[h+3]+t*e[h+5]-a*e[h+7],u[0]=r*(e[h+0]+e[h+4]),u[3]=r*(e[h+0]-e[h+4]),u[1]=f[0]+f[3],u[2]=f[1]-f[2],c[0]=u[0]+u[1],c[1]=u[3]+u[2],c[2]=u[3]-u[2],c[3]=u[0]-u[1],e[h+0]=c[0]+s[0],e[h+1]=c[1]+s[1],e[h+2]=c[2]+s[2],e[h+3]=c[3]+s[3],e[h+4]=c[3]-s[3],e[h+5]=c[2]-s[2],e[h+6]=c[1]-s[1],e[h+7]=c[0]-s[0]}for(var p=0;p<8;++p)f[0]=n*e[16+p],f[1]=o*e[16+p],f[2]=n*e[48+p],f[3]=o*e[48+p],s[0]=a*e[8+p]+t*e[24+p]+i*e[40+p]+l*e[56+p],s[1]=t*e[8+p]-l*e[24+p]-a*e[40+p]-i*e[56+p],s[2]=i*e[8+p]-a*e[24+p]+l*e[40+p]+t*e[56+p],s[3]=l*e[8+p]-i*e[24+p]+t*e[40+p]-a*e[56+p],u[0]=r*(e[p]+e[32+p]),u[3]=r*(e[p]-e[32+p]),u[1]=f[0]+f[3],u[2]=f[1]-f[2],c[0]=u[0]+u[1],c[1]=u[3]+u[2],c[2]=u[3]-u[2],c[3]=u[0]-u[1],e[0+p]=c[0]+s[0],e[8+p]=c[1]+s[1],e[16+p]=c[2]+s[2],e[24+p]=c[3]+s[3],e[32+p]=c[3]-s[3],e[40+p]=c[2]-s[2],e[48+p]=c[1]-s[1],e[56+p]=c[0]-s[0]}function Z(e){for(var r=0;r<64;++r){var a=e[0][r],n=e[1][r],t=e[2][r];e[0][r]=a+1.5747*t,e[1][r]=a-.1873*n-.4682*t,e[2][r]=a+1.8556*n}}function B(e,r,a){for(var n=0;n<64;++n)r[a+n]=te(H(e[n]))}function H(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(b,Math.abs(e)-1)}function Y(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=new a(r,{resize:!0,verify:!0}),t=new Uint8Array(n.decompress().buffer),i=new Uint8Array(t.length);return _(t),L(t,i),new DataView(i.buffer)}function j(e){var r=e.viewer,n={value:e.offset.value},t=new Uint8Array(e.width*e.lines*(se.channels.length*e.type*w)),i={version:$(r,n),unknownUncompressedSize:$(r,n),unknownCompressedSize:$(r,n),acCompressedSize:$(r,n),dcCompressedSize:$(r,n),rleCompressedSize:$(r,n),rleUncompressedSize:$(r,n),rleRawSize:$(r,n),totalAcUncompressedCount:$(r,n),totalDcUncompressedCount:$(r,n),acCompression:$(r,n)};if(i.version<2)throw"EXRLoader.parse: "+se.compression+" version "+i.version+" is unsupported";for(var o=new Array,l=ie(r,n)-w;l>0;){var f=G(r.buffer,n),s=Q(r,n),u=s>>2&3,c=new Int8Array([(s>>4)-1])[0],v=Q(r,n);o.push({name:f,index:c,type:v,compression:u}),l-=f.length+3}for(var h=se.channels,p=new Array(e.channels),y=0;y<e.channels;++y){var b=p[y]={},U=h[y];b.name=U.name,b.compression=S,b.decoded=!1,b.type=U.pixelType,b.pLinear=U.pLinear,b.width=e.width,b.height=e.lines}for(var M={idx:new Array(3)},O=0;O<e.channels;++O)for(b=p[O],y=0;y<o.length;++y){var C=o[y];b.name==C.name&&(b.compression=C.compression,C.index>=0&&(M.idx[C.index]=O),b.offset=O)}if(i.acCompressedSize>0)switch(i.acCompression){case d:var x=new Uint16Array(i.totalAcUncompressedCount);F(e.array,r,n,i.acCompressedSize,x,i.totalAcUncompressedCount);break;case g:var I=e.array.slice(n.value,n.value+i.totalAcUncompressedCount),E=new a(I,{resize:!0,verify:!0});x=new Uint16Array(E.decompress().buffer);n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){var R={array:e.array,offset:n,size:i.dcCompressedSize},z=new Uint16Array(Y(R).buffer);n.value+=i.dcCompressedSize}if(i.rleRawSize>0){I=e.array.slice(n.value,n.value+i.rleCompressedSize);var P=X((E=new a(I,{resize:!0,verify:!0})).decompress().buffer);n.value+=i.rleCompressedSize}var N=0,T=new Array(p.length);for(y=0;y<T.length;++y)T[y]=new Array;for(var k=0;k<e.lines;++k)for(var D=0;D<p.length;++D)T[D].push(N),N+=p[D].width*e.type*w;!function(e,r,a,n,t,i){var o=new DataView(i.buffer),l=a[e.idx[0]].width,f=a[e.idx[0]].height,s=Math.floor(l/8),u=Math.ceil(l/8),c=Math.ceil(f/8),v=l-8*(u-1),h=f-8*(c-1),p={value:0},y=new Array(3),d=new Array(3),g=new Array(3),S=new Array(3),A=new Array(3);for(let a=0;a<3;++a)A[a]=r[e.idx[a]],y[a]=a<1?0:y[a-1]+u*c,d[a]=new Float32Array(64),g[a]=new Uint16Array(64),S[a]=new Uint16Array(64*u);for(let r=0;r<c;++r){var m=8;r==c-1&&(m=h);var b=8;for(let e=0;e<u;++e){e==u-1&&(b=v);for(let e=0;e<3;++e)g[e].fill(0),g[e][0]=t[y[e]++],V(p,n,g[e]),U=g[e],(M=d[e])[0]=re(U[0]),M[1]=re(U[1]),M[2]=re(U[5]),M[3]=re(U[6]),M[4]=re(U[14]),M[5]=re(U[15]),M[6]=re(U[27]),M[7]=re(U[28]),M[8]=re(U[2]),M[9]=re(U[4]),M[10]=re(U[7]),M[11]=re(U[13]),M[12]=re(U[16]),M[13]=re(U[26]),M[14]=re(U[29]),M[15]=re(U[42]),M[16]=re(U[3]),M[17]=re(U[8]),M[18]=re(U[12]),M[19]=re(U[17]),M[20]=re(U[25]),M[21]=re(U[30]),M[22]=re(U[41]),M[23]=re(U[43]),M[24]=re(U[9]),M[25]=re(U[11]),M[26]=re(U[18]),M[27]=re(U[24]),M[28]=re(U[31]),M[29]=re(U[40]),M[30]=re(U[44]),M[31]=re(U[53]),M[32]=re(U[10]),M[33]=re(U[19]),M[34]=re(U[23]),M[35]=re(U[32]),M[36]=re(U[39]),M[37]=re(U[45]),M[38]=re(U[52]),M[39]=re(U[54]),M[40]=re(U[20]),M[41]=re(U[22]),M[42]=re(U[33]),M[43]=re(U[38]),M[44]=re(U[46]),M[45]=re(U[51]),M[46]=re(U[55]),M[47]=re(U[60]),M[48]=re(U[21]),M[49]=re(U[34]),M[50]=re(U[37]),M[51]=re(U[47]),M[52]=re(U[50]),M[53]=re(U[56]),M[54]=re(U[59]),M[55]=re(U[61]),M[56]=re(U[35]),M[57]=re(U[36]),M[58]=re(U[48]),M[59]=re(U[49]),M[60]=re(U[57]),M[61]=re(U[58]),M[62]=re(U[62]),M[63]=re(U[63]),W(d[e]);Z(d);for(let r=0;r<3;++r)B(d[r],S[r],64*e)}let i=0;for(let n=0;n<3;++n){let t=a[e.idx[n]].type;for(let e=8*r;e<8*r+m;++e){i=A[n][e];for(let r=0;r<s;++r){let a=64*r+8*(7&e);o.setUint16(i+0*w*t,S[n][a+0],!0),o.setUint16(i+1*w*t,S[n][a+1],!0),o.setUint16(i+2*w*t,S[n][a+2],!0),o.setUint16(i+3*w*t,S[n][a+3],!0),o.setUint16(i+4*w*t,S[n][a+4],!0),o.setUint16(i+5*w*t,S[n][a+5],!0),o.setUint16(i+6*w*t,S[n][a+6],!0),o.setUint16(i+7*w*t,S[n][a+7],!0),i+=8*w*t}}if(s!=u)for(let e=8*r;e<8*r+m;++e){let r=A[n][e]+8*s*w*t,a=64*s+8*(7&e);for(let e=0;e<b;++e)o.setUint16(r+e*w*t,S[n][a+e],!0)}}}var U,M;for(var O=new Uint16Array(l),C=(o=new DataView(i.buffer),0);C<3;++C){a[e.idx[C]].decoded=!0;var x=a[e.idx[C]].type;if(2==a[C].type)for(var I=0;I<f;++I){let e=A[C][I];for(var E=0;E<l;++E)O[E]=o.getUint16(e+E*w*x,!0);for(E=0;E<l;++E)o.setFloat32(e+E*w*x,re(O[E]),!0)}}}(M,T,p,x,z,t);for(y=0;y<p.length;++y){if(!(b=p[y]).decoded)switch(b.compression){case m:var _=0,L=0;for(k=0;k<e.lines;++k){for(var H=T[y][_],j=0;j<b.width;++j){for(var q=0;q<w*b.type;++q)t[H++]=P[L+q*b.width*b.height];L++}_++}break;case A:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(t.buffer)}function G(e,r){for(var a=new Uint8Array(e),n=0;0!=a[r.value+n];)n+=1;var t=(new TextDecoder).decode(a.slice(r.value,r.value+n));return r.value=r.value+n+1,t}function q(e,r){var a=e.getUint32(0,!0);return r.value=r.value+v,a}function J(e,r){var a=e.getUint32(r.value,!0);return r.value=r.value+p,a}function K(e,r){var a=e[r.value];return r.value=r.value+y,a}function Q(e,r){var a=e.getUint8(r.value);return r.value=r.value+y,a}function $(e,r){var a=Number(e.getBigInt64(r.value,!0));return r.value+=v,a}function ee(e,r){var a=e.getFloat32(r.value,!0);return r.value+=h,a}function re(e){var r=(31744&e)>>10,a=1023&e;return(e>>15?-1:1)*(r?31===r?a?NaN:1/0:Math.pow(2,r-15)*(1+a/1024):a/1024*6103515625e-14)}var ae,ne,te=(ae=new Float32Array(1),ne=new Int32Array(ae.buffer),function(e){ae[0]=e;var r=ne[0],a=r>>16&32768,n=r>>12&2047,t=r>>23&255;return t<103?a:t>142?(a|=31744,a|=(255==t?0:1)&&8388607&r):t<113?a|=((n|=2048)>>114-t)+(n>>113-t&1):(a|=t-112<<10|n>>1,a+=1&n)});function ie(e,r){var a=e.getUint16(r.value,!0);return r.value+=w,a}function oe(e,r,a,n,t){if("string"===n||"stringvector"===n||"iccProfile"===n)return function(e,r,a){var n=(new TextDecoder).decode(new Uint8Array(e).slice(r.value,r.value+a));return r.value=r.value+a,n}(r,a,t);if("chlist"===n)return function(e,r,a,n){for(var t=a.value,i=[];a.value<t+n-1;){var o=G(r,a),l=J(e,a),f=Q(e,a);a.value+=3;var s=J(e,a),u=J(e,a);i.push({name:o,pixelType:l,pLinear:f,xSampling:s,ySampling:u})}return a.value+=1,i}(e,r,a,t);if("chromaticities"===n)return function(e,r){return{redX:ee(e,r),redY:ee(e,r),greenX:ee(e,r),greenY:ee(e,r),blueX:ee(e,r),blueY:ee(e,r),whiteX:ee(e,r),whiteY:ee(e,r)}}(e,a);if("compression"===n)return function(e,r){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Q(e,r)]}(e,a);if("box2i"===n)return function(e,r){return{xMin:J(e,r),yMin:J(e,r),xMax:J(e,r),yMax:J(e,r)}}(e,a);if("lineOrder"===n)return function(e,r){return["INCREASING_Y"][Q(e,r)]}(e,a);if("float"===n)return ee(e,a);if("v2f"===n)return function(e,r){return[ee(e,r),ee(e,r)]}(e,a);if("int"===n)return J(e,a);throw"Cannot parse value for unsupported type: "+n}var le=new DataView(r),fe=new Uint8Array(r),se={};le.getUint32(0,!0),le.getUint8(4,!0),le.getUint8(5,!0);for(var ue={value:8},ce=!0;ce;){var ve=G(r,ue);if(0==ve)ce=!1;else{var he=oe(le,r,ue,G(r,ue),J(le,ue));se[ve]=he}}var pe,we,ye,de,ge=se.dataWindow.yMax+1;switch(se.compression){case"NO_COMPRESSION":we=1,pe=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":we=1,pe=function(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(X(r)),n=new Uint8Array(a.length);return _(a),L(a,n),new DataView(n.buffer)};break;case"ZIPS_COMPRESSION":we=1,pe=Y;break;case"ZIP_COMPRESSION":we=16,pe=Y;break;case"PIZ_COMPRESSION":we=32,pe=function(e){for(var r=e.viewer,a={value:e.offset.value},i=e.width*we*(se.channels.length*e.type),o=new Uint16Array(i),l=new Uint8Array(t),f=0,s=new Array(e.channels),u=0;u<e.channels;u++)s[u]={},s[u].start=f,s[u].end=s[u].start,s[u].nx=e.width,s[u].ny=e.lines,s[u].size=e.type,f+=s[u].nx*s[u].ny*s[u].size;var c=ie(r,a),v=ie(r,a);if(v>=t)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=v)for(u=0;u<v-c+1;u++)l[u+c]=Q(r,a);var h=new Uint16Array(n);!function(e,r){for(var a=0,t=0;t<n;++t)(0==t||e[t>>3]&1<<(7&t))&&(r[a++]=t);for(;a<n;)r[a++]=0}(l,h);var p=J(r,a);for(F(e.array,r,a,p,o,f),u=0;u<e.channels;++u)for(var y=s[u],d=0;d<s[u].size;++d)D(o,y.start+d,y.nx,y.size,y.ny,y.nx*y.size);!function(e,r,a){for(var n=0;n<a;++n)r[n]=e[r[n]]}(h,o,f);for(var g=0,S=new Uint8Array(o.buffer.byteLength),A=0;A<e.lines;A++)for(var m=0;m<e.channels;m++){var b=(y=s[m]).nx*y.size,U=new Uint8Array(o.buffer,y.end*w,b*w);S.set(U,g),g+=b*w,y.end+=b}return new DataView(S.buffer)};break;case"DWAA_COMPRESSION":we=32,pe=j;break;case"DWAB_COMPRESSION":we=256,pe=j;break;default:throw"EXRLoader.parse: "+se.compression+" is unsupported"}var Se=se.channels[0].pixelType;if(1===Se)switch(this.type){case e.FloatType:de=function(e,r){return re(ie(e,r))},ye=w;break;case e.HalfFloatType:de=ie,ye=w}else{if(2!==Se)throw"EXRLoader.parse: unsupported pixelType "+Se+" for "+se.compression+".";switch(this.type){case e.FloatType:de=ee,ye=h;break;case e.HalfFloatType:throw"EXRLoader.parse: unsupported HalfFloatType texture for FloatType image file."}}for(var Ae=ge/we,me=0;me<Ae;me++)q(le,ue);var be=se.dataWindow.xMax-se.dataWindow.xMin+1,Ue=se.dataWindow.yMax-se.dataWindow.yMin+1,Me=be*Ue*4;switch(this.type){case e.FloatType:var Oe=new Float32Array(Me);se.channels.length<4&&Oe.fill(1,0,Me);break;case e.HalfFloatType:Oe=new Uint16Array(Me);se.channels.length<4&&Oe.fill(15360,0,Me);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}for(var Ce,xe,Ie={R:0,G:1,B:2,A:3},Ee={size:0,width:be,lines:we,offset:ue,array:fe,viewer:le,type:Se,channels:se.channels.length},Re={value:0},ze=0;ze<Ue/we;ze++){Ce=J(le,ue),Me=J(le,ue),Ee.lines=Ce+we>Ue?Ue-Ce:we,Ee.offset=ue,Ee.size=Me,xe=pe(Ee),ue.value+=Me;for(var Pe=0;Pe<we;Pe++){var Ne=Pe+ze*we;if(Ne>=Ue)break;for(var Te=0;Te<se.channels.length;Te++)for(var ke=Ie[se.channels[Te].name],De=0;De<be;De++){var Fe=Pe*(se.channels.length*be)+Te*be+De;Re.value=Fe*ye;var _e=de(xe,Re);Oe[4*be*(Ue-1-Ne)+4*De+ke]=_e}}}return{header:se,width:be,height:Ue,data:Oe,format:e.RGBAFormat,type:this.type}},setDataType:function(e){return this.type=e,this},load:function(r,a,n,t){return e.DataTextureLoader.prototype.load.call(this,r,function(r,n){switch(r.type){case e.FloatType:case e.HalfFloatType:r.encoding=e.LinearEncoding,r.minFilter=e.LinearFilter,r.magFilter=e.LinearFilter,r.generateMipmaps=!1,r.flipY=!1}a&&a(r,n)},n,t)}}),r.loaders.EXRLoader=n});
//# sourceMappingURL=../sourcemaps/loaders/EXRLoader.js.map
