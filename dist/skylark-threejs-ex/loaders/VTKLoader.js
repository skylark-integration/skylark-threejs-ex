/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs","skylark-zlib/Inflate"],function(t,e){"use strict";var r=function(e){t.Loader.call(this,e)};return r.prototype=Object.assign(Object.create(t.Loader.prototype),{constructor:r,load:function(e,r,a,n){var s=this,i=new t.FileLoader(s.manager);i.setPath(s.path),i.setResponseType("arraybuffer"),i.load(e,function(t){r(s.parse(t))},a,n)},parse:function(r){function a(t,e){var r=t.length,a=new Int32Array(r+e.length);return a.set(t),a.set(e,r),a}function n(t){for(var e="",r=new Uint8Array(t),a=0,n=r.length;n--;)e+=String.fromCharCode(r[a++]);return e}var s=t.LoaderUtils.decodeText(new Uint8Array(r,0,250)).split("\n");return-1!==s[0].indexOf("xml")?function(r){function n(t){var e,r,a,n,s,i,o="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],f=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=u.length;for(e=0;e<p;e++)l[e]=u[e];for(e=0;e<p;++e)f[u.charCodeAt(e)]=e;if(f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63,(p=t.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i=new o(3*p/4-(s="="===t[p-2]?2:"="===t[p-1]?1:0)),a=s>0?p-4:p;var A=0;for(e=0,r=0;e<a;e+=4,r+=3)n=f[t.charCodeAt(e)]<<18|f[t.charCodeAt(e+1)]<<12|f[t.charCodeAt(e+2)]<<6|f[t.charCodeAt(e+3)],i[A++]=(16711680&n)>>16,i[A++]=(65280&n)>>8,i[A++]=255&n;return 2===s?(n=f[t.charCodeAt(e)]<<2|f[t.charCodeAt(e+1)]>>4,i[A++]=255&n):1===s&&(n=f[t.charCodeAt(e)]<<10|f[t.charCodeAt(e+1)]<<4|f[t.charCodeAt(e+2)]>>2,i[A++]=n>>8&255,i[A++]=255&n),i}function s(t,r){var s,i,l,f,u=0;if("UInt64"===o.attributes.header_type?u=8:"UInt32"===o.attributes.header_type&&(u=4),"binary"===t.attributes.format&&r){var p,A,h,y,c,d;if("Float32"===t.attributes.type)var b=new Float32Array;else"Int64"===t.attributes.type&&(b=new Int32Array);A=(p=n(t["#text"]))[0];for(var v=1;v<u-1;v++)A|=p[v]<<v*u;for(y=(A+3)*u,d=y+=y%3>0?3-y%3:0,(c=[]).push(d),h=3*u,v=0;v<A;v++){for(var w=p[v*u+h],x=1;x<u-1;x++)w|=p[v*u+h+x]<<8*x;d+=w,c.push(d)}for(v=0;v<c.length-1;v++)I=(I=new e(p.slice(c[v],c[v+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?(I=new Float32Array(I),i=I,f=void 0,l=(s=b).length,(f=new Float32Array(l+i.length)).set(s),f.set(i,l),b=f):"Int64"===t.attributes.type&&(b=a(b,I=new Int32Array(I)));delete t["#text"],"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(b=b.filter(function(t,e){if(e%2!=1)return!0}))}else{if("binary"!==t.attributes.format||r)if(t["#text"])var I=t["#text"].split(/\s+/).filter(function(t){if(""!==t)return t});else I=new Int32Array(0).buffer;else I=(I=n(t["#text"])).slice(u).buffer;delete t["#text"],"Float32"===t.attributes.type?b=new Float32Array(I):"Int32"===t.attributes.type?b=new Int32Array(I):"Int64"===t.attributes.type&&(b=new Int32Array(I),"binary"===t.attributes.format&&(b=b.filter(function(t,e){if(e%2!=1)return!0})))}return b}var i=null;if(window.DOMParser)try{i=(new DOMParser).parseFromString(r,"text/xml")}catch(t){i=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((i=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!i.loadXML())throw new Error(i.parseError.reason+i.parseError.srcText)}catch(t){i=null}}var o=function t(e){var r={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){r.attributes={};for(var a=0;a<e.attributes.length;a++){var n=e.attributes.item(a);r.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===e.nodeType&&(r=e.nodeValue.trim());if(e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++){var i=e.childNodes.item(s),o=i.nodeName;if(void 0===r[o])""!==(f=t(i))&&(r[o]=f);else{if(void 0===r[o].push){var l=r[o];r[o]=[l]}var f;""!==(f=t(i))&&r[o].push(f)}}return r}(i.documentElement),l=[],f=[],u=[];if(o.PolyData){for(var p=o.PolyData.Piece,A=o.attributes.hasOwnProperty("compressor"),h=["PointData","Points","Strips","Polys"],y=0,c=h.length;y<c;){var d=p[h[y]];if(d&&d.DataArray){if("[object Array]"===Object.prototype.toString.call(d.DataArray))var b=d.DataArray;else b=[d.DataArray];for(var v=0,w=b.length;v<w;)"#text"in b[v]&&b[v]["#text"].length>0&&(b[v].text=s(b[v],A)),v++;switch(h[y]){case"PointData":var x=parseInt(p.attributes.NumberOfPoints),I=d.attributes.Normals;if(x>0)for(var g=0,m=b.length;g<m;g++)if(I===b[g].attributes.Name){var O=b[g].attributes.NumberOfComponents;(f=new Float32Array(x*O)).set(b[g].text,0)}break;case"Points":(x=parseInt(p.attributes.NumberOfPoints))>0&&(O=d.DataArray.attributes.NumberOfComponents,(l=new Float32Array(x*O)).set(d.DataArray.text,0));break;case"Strips":var D=parseInt(p.attributes.NumberOfStrips);if(D>0){var F=new Int32Array(d.DataArray[0].text.length),T=new Int32Array(d.DataArray[1].text.length);F.set(d.DataArray[0].text,0),T.set(d.DataArray[1].text,0);var P=D+F.length;u=new Uint32Array(3*P-9*D);var S=0;for(g=0,m=D;g<m;g++){for(var C=[],N=0,L=T[g],E=0;N<L-E;N++)C.push(F[N]),g>0&&(E=T[g-1]);var U=0;for(L=T[g],E=0;U<L-E-2;U++)U%2?(u[S++]=C[U],u[S++]=C[U+2],u[S++]=C[U+1]):(u[S++]=C[U],u[S++]=C[U+1],u[S++]=C[U+2]),g>0&&(E=T[g-1])}}break;case"Polys":var B=parseInt(p.attributes.NumberOfPolys);if(B>0){F=new Int32Array(d.DataArray[0].text.length),T=new Int32Array(d.DataArray[1].text.length),F.set(d.DataArray[0].text,0),T.set(d.DataArray[1].text,0),P=B+F.length,u=new Uint32Array(3*P-9*B),S=0;var j=0;for(g=0,m=B,E=0;g<m;){var k=[];for(N=0,L=T[g];N<L-E;)k.push(F[j++]),N++;for(U=1;U<L-E-1;)u[S++]=k[0],u[S++]=k[U],u[S++]=k[U+1],U++;E=T[++g-1]}}}}y++}var R=new t.BufferGeometry;return R.setIndex(new t.BufferAttribute(u,1)),R.setAttribute("position",new t.BufferAttribute(l,3)),f.length===l.length&&R.setAttribute("normal",new t.BufferAttribute(f,3)),R}throw new Error("Unsupported DATASET type")}(n(r)):s[2].includes("ASCII")?function(e){var r,a=[],n=[],s=[],i=[],o=/^[^\d.\s-]+/,l=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,f=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,p=/^POLYGONS /,A=/^TRIANGLE_STRIPS /,h=/^POINT_DATA[ ]+(\d+)/,y=/^CELL_DATA[ ]+(\d+)/,c=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,d=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,b=!1,v=!1,w=!1,x=!1,I=!1,g=!1,m=!1,O=e.split("\n");for(var D in O){var F=O[D].trim();if(0===F.indexOf("DATASET")){var T=F.split(" ")[1];if("POLYDATA"!==T)throw new Error("Unsupported DATASET type: "+T)}else if(b)for(;null!==(r=l.exec(F))&&null===o.exec(F);){var P=parseFloat(r[1]),S=parseFloat(r[2]),C=parseFloat(r[3]);n.push(P,S,C)}else if(v){if(null!==(r=f.exec(F))){var N=parseInt(r[1]),L=r[2].split(/\s+/);if(N>=3)for(var E=parseInt(L[0]),U=1,B=0;B<N-2;++B)j=parseInt(L[U]),k=parseInt(L[U+1]),a.push(E,j,k),U++}}else if(w){if(null!==(r=f.exec(F))){var j,k;if(N=parseInt(r[1]),L=r[2].split(/\s+/),N>=3)for(B=0;B<N-2;B++)B%2==1?(E=parseInt(L[B]),j=parseInt(L[B+2]),k=parseInt(L[B+1]),a.push(E,j,k)):(E=parseInt(L[B]),j=parseInt(L[B+1]),k=parseInt(L[B+2]),a.push(E,j,k))}}else if(x||I)if(g)for(;null!==(r=l.exec(F))&&null===o.exec(F);){var R=parseFloat(r[1]),_=parseFloat(r[2]),G=parseFloat(r[3]);s.push(R,_,G)}else if(m)for(;null!==(r=l.exec(F))&&null===o.exec(F);){var M=parseFloat(r[1]),X=parseFloat(r[2]),Y=parseFloat(r[3]);i.push(M,X,Y)}null!==p.exec(F)?(v=!0,b=!1,w=!1):null!==u.exec(F)?(v=!1,b=!0,w=!1):null!==A.exec(F)?(v=!1,b=!1,w=!0):null!==h.exec(F)?(x=!0,b=!1,v=!1,w=!1):null!==y.exec(F)?(I=!0,b=!1,v=!1,w=!1):null!==c.exec(F)?(g=!0,m=!1,b=!1,v=!1,w=!1):null!==d.exec(F)&&(m=!0,g=!1,b=!1,v=!1,w=!1)}var V=new t.BufferGeometry;if(V.setIndex(a),V.setAttribute("position",new t.Float32BufferAttribute(n,3)),i.length===n.length&&V.setAttribute("normal",new t.Float32BufferAttribute(i,3)),s.length!==a.length)s.length===n.length&&V.setAttribute("color",new t.Float32BufferAttribute(s,3));else{var z=(V=V.toNonIndexed()).attributes.position.count/3;if(s.length===3*z){var q=[];for(D=0;D<z;D++)R=s[3*D+0],_=s[3*D+1],G=s[3*D+2],q.push(R,_,G),q.push(R,_,G),q.push(R,_,G);V.setAttribute("color",new t.Float32BufferAttribute(q,3))}}return V}(n(r)):function(e){var r,a,n,s,i,o,l,f=new Uint8Array(e),u=new DataView(e),p=[],A=[],h=[],y=[],c=0;function d(t,e){for(var r=e,a=t[r],n=[];10!==a;)n.push(String.fromCharCode(a)),a=t[++r];return{start:e,end:r,next:r+1,parsedString:n.join("")}}for(;;){if(0===(l=(o=d(f,c)).parsedString).indexOf("DATASET")){var b=l.split(" ")[1];if("POLYDATA"!==b)throw new Error("Unsupported DATASET type: "+b)}else if(0===l.indexOf("POINTS")){for(y.push(l),r=4*(s=parseInt(l.split(" ")[1],10))*3,p=new Float32Array(3*s),a=o.next,n=0;n<s;n++)p[3*n]=u.getFloat32(a,!1),p[3*n+1]=u.getFloat32(a+4,!1),p[3*n+2]=u.getFloat32(a+8,!1),a+=12;o.next=o.next+r+1}else if(0===l.indexOf("TRIANGLE_STRIPS")){var v=parseInt(l.split(" ")[1],10);r=4*(m=parseInt(l.split(" ")[2],10)),h=new Uint32Array(3*m-9*v);var w=0;for(a=o.next,n=0;n<v;n++){var x=u.getInt32(a,!1),I=[];for(a+=4,i=0;i<x;i++)I.push(u.getInt32(a,!1)),a+=4;for(var g=0;g<x-2;g++)g%2?(h[w++]=I[g],h[w++]=I[g+2],h[w++]=I[g+1]):(h[w++]=I[g],h[w++]=I[g+1],h[w++]=I[g+2])}o.next=o.next+r+1}else if(0===l.indexOf("POLYGONS")){var m;for(v=parseInt(l.split(" ")[1],10),r=4*(m=parseInt(l.split(" ")[2],10)),h=new Uint32Array(3*m-9*v),w=0,a=o.next,n=0;n<v;n++){for(x=u.getInt32(a,!1),I=[],a+=4,i=0;i<x;i++)I.push(u.getInt32(a,!1)),a+=4;for(g=1;g<x-1;g++)h[w++]=I[0],h[w++]=I[g],h[w++]=I[g+1]}o.next=o.next+r+1}else if(0===l.indexOf("POINT_DATA")){for(s=parseInt(l.split(" ")[1],10),o=d(f,o.next),r=4*s*3,A=new Float32Array(3*s),a=o.next,n=0;n<s;n++)A[3*n]=u.getFloat32(a,!1),A[3*n+1]=u.getFloat32(a+4,!1),A[3*n+2]=u.getFloat32(a+8,!1),a+=12;o.next=o.next+r}if((c=o.next)>=f.byteLength)break}var O=new t.BufferGeometry;return O.setIndex(new t.BufferAttribute(h,1)),O.setAttribute("position",new t.BufferAttribute(p,3)),A.length===p.length&&O.setAttribute("normal",new t.BufferAttribute(A,3)),O}(r)}}),r});
//# sourceMappingURL=../sourcemaps/loaders/VTKLoader.js.map
