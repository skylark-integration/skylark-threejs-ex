/**
 * skylark-threejs-ex - A version of threejs extentions library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-ex/
 * @license MIT
 */
define(["skylark-threejs"],function(t,e){return t.VTKLoader=function(e){t.Loader.call(this,e)},t.VTKLoader.prototype=Object.assign(Object.create(t.Loader.prototype),{constructor:t.VTKLoader,load:function(e,r,a,n){var o=this,s=new t.FileLoader(o.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.load(e,function(t){r(o.parse(t))},a,n)},parse:function(r){function a(t,e){var r=t.length,a=new Int32Array(r+e.length);return a.set(t),a.set(e,r),a}function n(t){for(var e="",r=new Uint8Array(t),a=0,n=r.length;n--;)e+=String.fromCharCode(r[a++]);return e}var o=t.LoaderUtils.decodeText(new Uint8Array(r,0,250)).split("\n");return-1!==o[0].indexOf("xml")?function(r){function n(t){var e,r,a,n,o,s,i="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],f=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=u.length;for(e=0;e<p;e++)l[e]=u[e];for(e=0;e<p;++e)f[u.charCodeAt(e)]=e;if(f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63,(p=t.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s=new i(3*p/4-(o="="===t[p-2]?2:"="===t[p-1]?1:0)),a=o>0?p-4:p;var A=0;for(e=0,r=0;e<a;e+=4,r+=3)n=f[t.charCodeAt(e)]<<18|f[t.charCodeAt(e+1)]<<12|f[t.charCodeAt(e+2)]<<6|f[t.charCodeAt(e+3)],s[A++]=(16711680&n)>>16,s[A++]=(65280&n)>>8,s[A++]=255&n;return 2===o?(n=f[t.charCodeAt(e)]<<2|f[t.charCodeAt(e+1)]>>4,s[A++]=255&n):1===o&&(n=f[t.charCodeAt(e)]<<10|f[t.charCodeAt(e+1)]<<4|f[t.charCodeAt(e+2)]>>2,s[A++]=n>>8&255,s[A++]=255&n),s}function o(t,r){var o,s,l,f,u=0;if("UInt64"===i.attributes.header_type?u=8:"UInt32"===i.attributes.header_type&&(u=4),"binary"===t.attributes.format&&r){var p,A,h,d,y,c;if("Float32"===t.attributes.type)var b=new Float32Array;else"Int64"===t.attributes.type&&(b=new Int32Array);A=(p=n(t["#text"]))[0];for(var v=1;v<u-1;v++)A|=p[v]<<v*u;for(d=(A+3)*u,c=d+=d%3>0?3-d%3:0,(y=[]).push(c),h=3*u,v=0;v<A;v++){for(var w=p[v*u+h],x=1;x<u-1;x++)w|=p[v*u+h+x]<<8*x;c+=w,y.push(c)}for(v=0;v<y.length-1;v++)I=(I=new e.Inflate(p.slice(y[v],y[v+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?(I=new Float32Array(I),s=I,f=void 0,l=(o=b).length,(f=new Float32Array(l+s.length)).set(o),f.set(s,l),b=f):"Int64"===t.attributes.type&&(b=a(b,I=new Int32Array(I)));delete t["#text"],"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(b=b.filter(function(t,e){if(e%2!=1)return!0}))}else{if("binary"!==t.attributes.format||r)if(t["#text"])var I=t["#text"].split(/\s+/).filter(function(t){if(""!==t)return t});else I=new Int32Array(0).buffer;else I=(I=n(t["#text"])).slice(u).buffer;delete t["#text"],"Float32"===t.attributes.type?b=new Float32Array(I):"Int32"===t.attributes.type?b=new Int32Array(I):"Int64"===t.attributes.type&&(b=new Int32Array(I),"binary"===t.attributes.format&&(b=b.filter(function(t,e){if(e%2!=1)return!0})))}return b}var s=null;if(window.DOMParser)try{s=(new DOMParser).parseFromString(r,"text/xml")}catch(t){s=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((s=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!s.loadXML())throw new Error(s.parseError.reason+s.parseError.srcText)}catch(t){s=null}}var i=function t(e){var r={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){r.attributes={};for(var a=0;a<e.attributes.length;a++){var n=e.attributes.item(a);r.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===e.nodeType&&(r=e.nodeValue.trim());if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var s=e.childNodes.item(o),i=s.nodeName;if(void 0===r[i])""!==(f=t(s))&&(r[i]=f);else{if(void 0===r[i].push){var l=r[i];r[i]=[l]}var f;""!==(f=t(s))&&r[i].push(f)}}return r}(s.documentElement),l=[],f=[],u=[];if(i.PolyData){for(var p=i.PolyData.Piece,A=i.attributes.hasOwnProperty("compressor"),h=["PointData","Points","Strips","Polys"],d=0,y=h.length;d<y;){var c=p[h[d]];if(c&&c.DataArray){if("[object Array]"===Object.prototype.toString.call(c.DataArray))var b=c.DataArray;else b=[c.DataArray];for(var v=0,w=b.length;v<w;)"#text"in b[v]&&b[v]["#text"].length>0&&(b[v].text=o(b[v],A)),v++;switch(h[d]){case"PointData":var x=parseInt(p.attributes.NumberOfPoints),I=c.attributes.Normals;if(x>0)for(var g=0,m=b.length;g<m;g++)if(I===b[g].attributes.Name){var O=b[g].attributes.NumberOfComponents;(f=new Float32Array(x*O)).set(b[g].text,0)}break;case"Points":(x=parseInt(p.attributes.NumberOfPoints))>0&&(O=c.DataArray.attributes.NumberOfComponents,(l=new Float32Array(x*O)).set(c.DataArray.text,0));break;case"Strips":var D=parseInt(p.attributes.NumberOfStrips);if(D>0){var F=new Int32Array(c.DataArray[0].text.length),T=new Int32Array(c.DataArray[1].text.length);F.set(c.DataArray[0].text,0),T.set(c.DataArray[1].text,0);var P=D+F.length;u=new Uint32Array(3*P-9*D);var S=0;for(g=0,m=D;g<m;g++){for(var C=[],L=0,N=T[g],E=0;L<N-E;L++)C.push(F[L]),g>0&&(E=T[g-1]);var U=0;for(N=T[g],E=0;U<N-E-2;U++)U%2?(u[S++]=C[U],u[S++]=C[U+2],u[S++]=C[U+1]):(u[S++]=C[U],u[S++]=C[U+1],u[S++]=C[U+2]),g>0&&(E=T[g-1])}}break;case"Polys":var B=parseInt(p.attributes.NumberOfPolys);if(B>0){F=new Int32Array(c.DataArray[0].text.length),T=new Int32Array(c.DataArray[1].text.length),F.set(c.DataArray[0].text,0),T.set(c.DataArray[1].text,0),P=B+F.length,u=new Uint32Array(3*P-9*B),S=0;var j=0;for(g=0,m=B,E=0;g<m;){var R=[];for(L=0,N=T[g];L<N-E;)R.push(F[j++]),L++;for(U=1;U<N-E-1;)u[S++]=R[0],u[S++]=R[U],u[S++]=R[U+1],U++;E=T[++g-1]}}}}d++}var _=new t.BufferGeometry;return _.setIndex(new t.BufferAttribute(u,1)),_.setAttribute("position",new t.BufferAttribute(l,3)),f.length===l.length&&_.setAttribute("normal",new t.BufferAttribute(f,3)),_}throw new Error("Unsupported DATASET type")}(n(r)):o[2].includes("ASCII")?function(e){var r,a=[],n=[],o=[],s=[],i=/^[^\d.\s-]+/,l=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,f=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,p=/^POLYGONS /,A=/^TRIANGLE_STRIPS /,h=/^POINT_DATA[ ]+(\d+)/,d=/^CELL_DATA[ ]+(\d+)/,y=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,c=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,b=!1,v=!1,w=!1,x=!1,I=!1,g=!1,m=!1,O=e.split("\n");for(var D in O){var F=O[D].trim();if(0===F.indexOf("DATASET")){var T=F.split(" ")[1];if("POLYDATA"!==T)throw new Error("Unsupported DATASET type: "+T)}else if(b)for(;null!==(r=l.exec(F))&&null===i.exec(F);){var P=parseFloat(r[1]),S=parseFloat(r[2]),C=parseFloat(r[3]);n.push(P,S,C)}else if(v){if(null!==(r=f.exec(F))){var L=parseInt(r[1]),N=r[2].split(/\s+/);if(L>=3)for(var E=parseInt(N[0]),U=1,B=0;B<L-2;++B)j=parseInt(N[U]),R=parseInt(N[U+1]),a.push(E,j,R),U++}}else if(w){if(null!==(r=f.exec(F))){var j,R;if(L=parseInt(r[1]),N=r[2].split(/\s+/),L>=3)for(B=0;B<L-2;B++)B%2==1?(E=parseInt(N[B]),j=parseInt(N[B+2]),R=parseInt(N[B+1]),a.push(E,j,R)):(E=parseInt(N[B]),j=parseInt(N[B+1]),R=parseInt(N[B+2]),a.push(E,j,R))}}else if(x||I)if(g)for(;null!==(r=l.exec(F))&&null===i.exec(F);){var _=parseFloat(r[1]),G=parseFloat(r[2]),M=parseFloat(r[3]);o.push(_,G,M)}else if(m)for(;null!==(r=l.exec(F))&&null===i.exec(F);){var V=parseFloat(r[1]),k=parseFloat(r[2]),K=parseFloat(r[3]);s.push(V,k,K)}null!==p.exec(F)?(v=!0,b=!1,w=!1):null!==u.exec(F)?(v=!1,b=!0,w=!1):null!==A.exec(F)?(v=!1,b=!1,w=!0):null!==h.exec(F)?(x=!0,b=!1,v=!1,w=!1):null!==d.exec(F)?(I=!0,b=!1,v=!1,w=!1):null!==y.exec(F)?(g=!0,m=!1,b=!1,v=!1,w=!1):null!==c.exec(F)&&(m=!0,g=!1,b=!1,v=!1,w=!1)}var X=new t.BufferGeometry;if(X.setIndex(a),X.setAttribute("position",new t.Float32BufferAttribute(n,3)),s.length===n.length&&X.setAttribute("normal",new t.Float32BufferAttribute(s,3)),o.length!==a.length)o.length===n.length&&X.setAttribute("color",new t.Float32BufferAttribute(o,3));else{var Y=(X=X.toNonIndexed()).attributes.position.count/3;if(o.length===3*Y){var z=[];for(D=0;D<Y;D++)_=o[3*D+0],G=o[3*D+1],M=o[3*D+2],z.push(_,G,M),z.push(_,G,M),z.push(_,G,M);X.setAttribute("color",new t.Float32BufferAttribute(z,3))}}return X}(n(r)):function(e){var r,a,n,o,s,i,l,f=new Uint8Array(e),u=new DataView(e),p=[],A=[],h=[],d=[],y=0;function c(t,e){for(var r=e,a=t[r],n=[];10!==a;)n.push(String.fromCharCode(a)),a=t[++r];return{start:e,end:r,next:r+1,parsedString:n.join("")}}for(;;){if(0===(l=(i=c(f,y)).parsedString).indexOf("DATASET")){var b=l.split(" ")[1];if("POLYDATA"!==b)throw new Error("Unsupported DATASET type: "+b)}else if(0===l.indexOf("POINTS")){for(d.push(l),r=4*(o=parseInt(l.split(" ")[1],10))*3,p=new Float32Array(3*o),a=i.next,n=0;n<o;n++)p[3*n]=u.getFloat32(a,!1),p[3*n+1]=u.getFloat32(a+4,!1),p[3*n+2]=u.getFloat32(a+8,!1),a+=12;i.next=i.next+r+1}else if(0===l.indexOf("TRIANGLE_STRIPS")){var v=parseInt(l.split(" ")[1],10);r=4*(m=parseInt(l.split(" ")[2],10)),h=new Uint32Array(3*m-9*v);var w=0;for(a=i.next,n=0;n<v;n++){var x=u.getInt32(a,!1),I=[];for(a+=4,s=0;s<x;s++)I.push(u.getInt32(a,!1)),a+=4;for(var g=0;g<x-2;g++)g%2?(h[w++]=I[g],h[w++]=I[g+2],h[w++]=I[g+1]):(h[w++]=I[g],h[w++]=I[g+1],h[w++]=I[g+2])}i.next=i.next+r+1}else if(0===l.indexOf("POLYGONS")){var m;for(v=parseInt(l.split(" ")[1],10),r=4*(m=parseInt(l.split(" ")[2],10)),h=new Uint32Array(3*m-9*v),w=0,a=i.next,n=0;n<v;n++){for(x=u.getInt32(a,!1),I=[],a+=4,s=0;s<x;s++)I.push(u.getInt32(a,!1)),a+=4;for(g=1;g<x-1;g++)h[w++]=I[0],h[w++]=I[g],h[w++]=I[g+1]}i.next=i.next+r+1}else if(0===l.indexOf("POINT_DATA")){for(o=parseInt(l.split(" ")[1],10),i=c(f,i.next),r=4*o*3,A=new Float32Array(3*o),a=i.next,n=0;n<o;n++)A[3*n]=u.getFloat32(a,!1),A[3*n+1]=u.getFloat32(a+4,!1),A[3*n+2]=u.getFloat32(a+8,!1),a+=12;i.next=i.next+r}if((y=i.next)>=f.byteLength)break}var O=new t.BufferGeometry;return O.setIndex(new t.BufferAttribute(h,1)),O.setAttribute("position",new t.BufferAttribute(p,3)),A.length===p.length&&O.setAttribute("normal",new t.BufferAttribute(A,3)),O}(r)}}),t.VTKLoader});
//# sourceMappingURL=../sourcemaps/loaders/VTKLoader.js.map
